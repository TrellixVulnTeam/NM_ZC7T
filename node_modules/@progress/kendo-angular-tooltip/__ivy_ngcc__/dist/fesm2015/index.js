/**-----------------------------------------------------------------------------------------
* Copyright © 2021 Progress Software Corporation. All rights reserved.
* Licensed under commercial license. See LICENSE.md in the project root for more information
*-------------------------------------------------------------------------------------------*/
import { __decorate, __metadata, __param } from 'tslib';
import { InjectionToken, Injectable, EventEmitter, HostBinding, Output, Input, TemplateRef, ElementRef, Component, isDevMode, Directive, Optional, Inject, NgZone, Renderer2, ContentChild, forwardRef, NgModule } from '@angular/core';
import { filter, debounceTime, take, auditTime } from 'rxjs/operators';
import { fromEvent, Subscription, BehaviorSubject, Subject, combineLatest } from 'rxjs';
import { PopupService, PopupModule } from '@progress/kendo-angular-popup';
import { validatePackage } from '@progress/kendo-licensing';
import { LocalizationService, L10N_PREFIX, ComponentMessages } from '@progress/kendo-angular-l10n';
import { PreventableEvent, isDocumentAvailable, closest, hasObservers } from '@progress/kendo-angular-common';
import { CommonModule } from '@angular/common';

/**
 * @hidden
 */
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@progress/kendo-angular-l10n';
import * as ɵngcc2 from '@angular/common';
import * as ɵngcc3 from '@progress/kendo-angular-popup';

function TooltipContentComponent_div_2_ng_template_1_Template(rf, ctx) { }
const _c2 = function (a0, a1) { return { $implicit: a0, anchor: a1 }; };
function TooltipContentComponent_div_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 7);
    ɵngcc0.ɵɵtemplate(1, TooltipContentComponent_div_2_ng_template_1_Template, 0, 0, "ng-template", 3);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r0.titleTemplate)("ngTemplateOutlet", ctx_r0.titleTemplate)("ngTemplateOutletContext", ɵngcc0.ɵɵpureFunction2(3, _c2, ctx_r0.anchor, ctx_r0.anchor));
} }
function TooltipContentComponent_ng_template_3_Template(rf, ctx) { }
function TooltipContentComponent_ng_template_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtext(0);
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵtextInterpolate1(" ", ctx_r2.templateString, " ");
} }
function TooltipContentComponent_div_5_Template(rf, ctx) { if (rf & 1) {
    const _r7 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 8);
    ɵngcc0.ɵɵlistener("click", function TooltipContentComponent_div_5_Template_div_click_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r7); const ctx_r6 = ɵngcc0.ɵɵnextContext(); return ctx_r6.onCloseClick($event); });
    ɵngcc0.ɵɵelement(1, "a", 9);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵattribute("title", ctx_r3.closeButtonTitle);
} }
function TooltipContentComponent_div_6_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "div", 10);
} if (rf & 2) {
    const ctx_r4 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngClass", ctx_r4.calloutPositionClass());
} }
function PopoverComponent_div_0_div_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "div", 6);
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("ngClass", ctx_r1.getCalloutPosition());
} }
function PopoverComponent_div_0_div_2_1_ng_template_0_Template(rf, ctx) { }
const _c3 = function (a0, a1) { return { $implicit: a0, data: a1 }; };
function PopoverComponent_div_0_div_2_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, PopoverComponent_div_0_div_2_1_ng_template_0_Template, 0, 0, "ng-template", 9);
} if (rf & 2) {
    const ctx_r5 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r5.titleTemplate == null ? null : ctx_r5.titleTemplate.templateRef)("ngTemplateOutletContext", ɵngcc0.ɵɵpureFunction2(2, _c3, ctx_r5.anchor, ctx_r5.contextData));
} }
function PopoverComponent_div_0_div_2_ng_container_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const ctx_r6 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ctx_r6.title, " ");
} }
function PopoverComponent_div_0_div_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 7);
    ɵngcc0.ɵɵtemplate(1, PopoverComponent_div_0_div_2_1_Template, 1, 5, null, 8);
    ɵngcc0.ɵɵtemplate(2, PopoverComponent_div_0_div_2_ng_container_2_Template, 2, 1, "ng-container", 8);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r2.titleTemplate);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r2.title && !ctx_r2.titleTemplate);
} }
function PopoverComponent_div_0_div_3_1_ng_template_0_Template(rf, ctx) { }
function PopoverComponent_div_0_div_3_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, PopoverComponent_div_0_div_3_1_ng_template_0_Template, 0, 0, "ng-template", 9);
} if (rf & 2) {
    const ctx_r8 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r8.bodyTemplate == null ? null : ctx_r8.bodyTemplate.templateRef)("ngTemplateOutletContext", ɵngcc0.ɵɵpureFunction2(2, _c3, ctx_r8.anchor, ctx_r8.contextData));
} }
function PopoverComponent_div_0_div_3_ng_container_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const ctx_r9 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ctx_r9.body, " ");
} }
function PopoverComponent_div_0_div_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 10);
    ɵngcc0.ɵɵtemplate(1, PopoverComponent_div_0_div_3_1_Template, 1, 5, null, 8);
    ɵngcc0.ɵɵtemplate(2, PopoverComponent_div_0_div_3_ng_container_2_Template, 2, 1, "ng-container", 8);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r3.bodyTemplate);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r3.body && !ctx_r3.bodyTemplate);
} }
function PopoverComponent_div_0_div_4_1_ng_template_0_Template(rf, ctx) { }
function PopoverComponent_div_0_div_4_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, PopoverComponent_div_0_div_4_1_ng_template_0_Template, 0, 0, "ng-template", 9);
} if (rf & 2) {
    const ctx_r11 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r11.actionsTemplate == null ? null : ctx_r11.actionsTemplate.templateRef)("ngTemplateOutletContext", ɵngcc0.ɵɵpureFunction2(2, _c3, ctx_r11.anchor, ctx_r11.contextData));
} }
function PopoverComponent_div_0_div_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 11);
    ɵngcc0.ɵɵtemplate(1, PopoverComponent_div_0_div_4_1_Template, 1, 5, null, 8);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r4 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r4.actionsTemplate);
} }
const _c4 = function (a0, a1) { return { "width.px": a0, "height.px": a1 }; };
function PopoverComponent_div_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 1);
    ɵngcc0.ɵɵtemplate(1, PopoverComponent_div_0_div_1_Template, 1, 1, "div", 2);
    ɵngcc0.ɵɵtemplate(2, PopoverComponent_div_0_div_2_Template, 3, 2, "div", 3);
    ɵngcc0.ɵɵtemplate(3, PopoverComponent_div_0_div_3_Template, 3, 2, "div", 4);
    ɵngcc0.ɵɵtemplate(4, PopoverComponent_div_0_div_4_Template, 2, 1, "div", 5);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngStyle", ɵngcc0.ɵɵpureFunction2(5, _c4, ctx_r0.width, ctx_r0.height));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r0.callout);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r0.titleTemplate || ctx_r0.title);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r0.bodyTemplate || ctx_r0.body);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r0.actionsTemplate);
} }
const packageMetadata = {
    name: '@progress/kendo-angular-tooltip',
    productName: 'Kendo UI for Angular',
    productCodes: ['KENDOUIANGULAR', 'KENDOUICOMPLETE'],
    publishDate: 1646219971,
    version: '',
    licensingDocsUrl: 'https://www.telerik.com/kendo-angular-ui/my-license/?utm_medium=product&utm_source=kendoangular&utm_campaign=kendo-ui-angular-purchase-license-keys-warning'
};

/**
 * Obsolete. Provide the TooltipSettings class instead.
 *
 * @hidden
 */
const TOOLTIP_SETTINGS = new InjectionToken('kendo-ui-tooltip-settings');
/**
 * Provides a global configuration for the Kendo UI Tooltip. Once injected through
 * the `AppComponent` constructor, the configuration properties can be overridden.
 *
 * @example
 * ```ts-no-run
 * import { TooltipSettings } from '@progress/kendo-angular-tooltip';
 *
 * _@Component({
 *    selector: 'my-app',
 *    template: `
 *      <div kendoTooltip>
 *          <button title="Saves the current document">Save</button>
 *      </div>`,
 *    providers: [{
 *        provide: TooltipSettings,
 *        useFactory: (): TooltipSettings => ({
 *          // Override default values of tooltips if wanted
 *          position: 'right'
 *        })
 *    }]
 * })
 * export class AppComponent { }
 * ```
 */
let TooltipSettings = class TooltipSettings {
};
TooltipSettings.ɵfac = function TooltipSettings_Factory(t) { return new (t || TooltipSettings)(); };
TooltipSettings.ɵprov = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjectable({ token: TooltipSettings, factory: function (t) { return TooltipSettings.ɵfac(t); } });

/**
 * @hidden
 */
function align(position, offset) {
    let anchorAlign = {};
    let popupAlign = {};
    let popupMargin = {};
    switch (position) {
        case 'top':
            anchorAlign = { horizontal: 'center', vertical: 'top' };
            popupAlign = { horizontal: 'center', vertical: 'bottom' };
            popupMargin = { horizontal: 0, vertical: offset };
            break;
        case 'bottom':
            anchorAlign = { horizontal: 'center', vertical: 'bottom' };
            popupAlign = { horizontal: 'center', vertical: 'top' };
            popupMargin = { horizontal: 0, vertical: offset };
            break;
        case 'right':
            anchorAlign = { horizontal: 'right', vertical: 'center' };
            popupAlign = { horizontal: 'left', vertical: 'center' };
            popupMargin = { horizontal: offset, vertical: 0 };
            break;
        case 'left':
            anchorAlign = { horizontal: 'left', vertical: 'center' };
            popupAlign = { horizontal: 'right', vertical: 'center' };
            popupMargin = { horizontal: offset, vertical: 0 };
            break;
        default: break;
    }
    return {
        anchorAlign,
        popupAlign,
        popupMargin
    };
}
/**
 * @hidden
 */
function collision(inputcollision, position) {
    if (inputcollision) {
        return inputcollision;
    }
    if (position === 'top' || position === 'bottom') {
        return { horizontal: 'fit', vertical: 'flip' };
    }
    return { horizontal: 'flip', vertical: 'fit' };
}
function isDocumentNode(container) {
    return container.nodeType === 9;
}
/**
 * @hidden
 */
function closestBySelector(element, selector) {
    if (element.closest) {
        return element.closest(selector);
    }
    const matches = Element.prototype.matches ?
        (el, sel) => el.matches(sel)
        : (el, sel) => el.msMatchesSelector(sel);
    let node = element;
    while (node && !isDocumentNode(node)) {
        if (matches(node, selector)) {
            return node;
        }
        node = node.parentNode;
    }
}
/**
 * @hidden
 */
function contains(container, child) {
    if (!container) {
        return false;
    }
    if (isDocumentNode(container)) {
        return false;
    }
    if (container.contains) {
        return container.contains(child);
    }
    if (container.compareDocumentPosition) {
        // tslint:disable-next-line
        return !!(container.compareDocumentPosition(child) & Node.DOCUMENT_POSITION_CONTAINED_BY);
    }
}
/**
 * @hidden
 */
const hasParent = (node, parent) => {
    while (node && node !== parent) {
        node = node.parentNode;
    }
    return node;
};
/**
 * @hidden
 */
function getCenterOffset(item, dir, size) {
    const rect = item.getBoundingClientRect();
    return rect[dir] + (rect[size] / 2);
}
/**
 * @hidden
 */
function containsItem(collection, item) {
    return collection.indexOf(item) !== -1;
}

/**
 * @hidden
 */
let TooltipContentComponent = class TooltipContentComponent {
    constructor(content, localizationService) {
        this.content = content;
        this.localizationService = localizationService;
        this.close = new EventEmitter();
        this.tooltipWidth = null;
        this.tooltipHeight = null;
        this.callout = true;
        this.calloutStyles = (position, calloutSize, isFlip) => {
            const styles = {};
            const isVertical = position === 'top' || position === 'bottom';
            const flipDeg = '180deg';
            const zeroDeg = '0deg';
            if (!isFlip) {
                styles.transform = isVertical ? `rotateX(${zeroDeg})` : `rotateY(${zeroDeg})`;
                return styles;
            }
            if (position === 'top') {
                styles.bottom = 'unset';
            }
            else if (position === 'bottom') {
                styles.top = 'unset';
            }
            else if (position === 'left') {
                styles.right = 'unset';
            }
            else if (position === 'right') {
                styles.left = 'unset';
            }
            styles[position] = `${-calloutSize}px`;
            styles.transform = isVertical ? `rotateX(${flipDeg})` : `rotateY(${flipDeg})`;
            return styles;
        };
        this.direction = localizationService.rtl ? 'rtl' : 'ltr';
    }
    get cssClasses() {
        return 'k-widget k-tooltip';
    }
    get className() {
        return this.closable;
    }
    get cssPosition() {
        return 'relative';
    }
    ngOnInit() {
        this.dynamicRTLSubscription = this.localizationService.changes
            .subscribe(({ rtl }) => this.direction = rtl ? 'rtl' : 'ltr');
    }
    ngOnDestroy() {
        if (this.dynamicRTLSubscription) {
            this.dynamicRTLSubscription.unsubscribe();
        }
    }
    get closeButtonTitle() {
        return this.closeTitle || this.localizationService.get('closeTitle');
    }
    calloutPositionClass() {
        return {
            'top': 'k-callout-s',
            'left': 'k-callout-e',
            'bottom': 'k-callout-n',
            'right': 'k-callout-w'
        }[this.position];
    }
    onCloseClick(event) {
        event.preventDefault();
        this.close.emit();
    }
    updateCalloutPosition(position, isFlip) {
        if (!this.callout) {
            return;
        }
        const callout = this.content.nativeElement.querySelector('.k-callout');
        const isVertical = position === 'top' || position === 'bottom';
        const size = isVertical ? 'width' : 'height';
        const dir = isVertical ? 'left' : 'top';
        const offsetProperty = isVertical ? 'marginLeft' : 'marginTop';
        const calloutSize = callout.getBoundingClientRect()[size];
        const anchorCenter = getCenterOffset(this.anchor.nativeElement, dir, size);
        const contentCenter = getCenterOffset(this.content.nativeElement, dir, size);
        const diff = Math.abs(contentCenter - anchorCenter);
        if (diff > 1 || diff === 0 || Math.round(diff) === 0) {
            const newMargin = contentCenter - anchorCenter + (calloutSize / 2);
            callout.style[offsetProperty] = `${-newMargin}px`;
        }
        const calloutStyles = this.calloutStyles(position, calloutSize, isFlip);
        Object.keys(calloutStyles).forEach((style) => {
            callout.style[style] = calloutStyles[style];
        });
    }
};
TooltipContentComponent.ɵfac = function TooltipContentComponent_Factory(t) { return new (t || TooltipContentComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.LocalizationService)); };
TooltipContentComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: TooltipContentComponent, selectors: [["kendo-tooltip"]], hostVars: 11, hostBindings: function TooltipContentComponent_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵattribute("dir", ctx.direction);
        ɵngcc0.ɵɵclassMap(ctx.cssClasses);
        ɵngcc0.ɵɵstyleProp("width", ctx.tooltipWidth, "px")("height", ctx.tooltipHeight, "px")("position", ctx.cssPosition);
        ɵngcc0.ɵɵclassProp("k-tooltip-closable", ctx.className);
    } }, inputs: { tooltipWidth: "tooltipWidth", tooltipHeight: "tooltipHeight", titleTemplate: "titleTemplate", anchor: "anchor", closable: "closable", templateRef: "templateRef", templateString: "templateString" }, outputs: { close: "close" }, features: [ɵngcc0.ɵɵProvidersFeature([
            LocalizationService,
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.tooltip'
            }
        ])], decls: 7, vars: 10, consts: function () { let i18n_0; if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
        /**
         * @desc The title of the close button
         * @meaning kendo.tooltip.closeTitle
         */
        const MSG_EXTERNAL_1245147641110884896$$DIST_FESM2015_INDEX_JS_1 = goog.getMsg("Close");
        i18n_0 = MSG_EXTERNAL_1245147641110884896$$DIST_FESM2015_INDEX_JS_1;
    }
    else {
        i18n_0 = $localize `:kendo.tooltip.closeTitle|The title of the close button␟de53b3f74f2d4a81b5c3f54c0ac1269cb017bd4f␟1245147641110884896:Close`;
    } return [["kendoTooltipLocalizedMessages", "", "closeTitle", i18n_0], [1, "k-tooltip-content"], ["class", "k-tooltip-title", 4, "ngIf"], [3, "ngIf", "ngTemplateOutlet", "ngTemplateOutletContext"], [3, "ngIf"], ["class", "k-tooltip-button", 3, "click", 4, "ngIf"], ["class", "k-callout", 3, "ngClass", 4, "ngIf"], [1, "k-tooltip-title"], [1, "k-tooltip-button", 3, "click"], ["href", "#", 1, "k-icon", "k-i-close"], [1, "k-callout", 3, "ngClass"]]; }, template: function TooltipContentComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementContainer(0, 0);
        ɵngcc0.ɵɵelementStart(1, "div", 1);
        ɵngcc0.ɵɵtemplate(2, TooltipContentComponent_div_2_Template, 2, 6, "div", 2);
        ɵngcc0.ɵɵtemplate(3, TooltipContentComponent_ng_template_3_Template, 0, 0, "ng-template", 3);
        ɵngcc0.ɵɵtemplate(4, TooltipContentComponent_ng_template_4_Template, 1, 1, "ng-template", 4);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(5, TooltipContentComponent_div_5_Template, 2, 1, "div", 5);
        ɵngcc0.ɵɵtemplate(6, TooltipContentComponent_div_6_Template, 1, 1, "div", 6);
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.titleTemplate);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.templateRef)("ngTemplateOutlet", ctx.templateRef)("ngTemplateOutletContext", ɵngcc0.ɵɵpureFunction2(7, _c2, ctx.anchor, ctx.anchor));
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.templateString);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.closable);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.callout);
    } }, directives: function () { return [LocalizedMessagesDirective, ɵngcc2.NgIf, ɵngcc2.NgTemplateOutlet, ɵngcc2.NgClass]; }, encapsulation: 2 });
__decorate([
    HostBinding('attr.dir'),
    __metadata("design:type", String)
], TooltipContentComponent.prototype, "direction", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], TooltipContentComponent.prototype, "close", void 0);
__decorate([
    HostBinding('class'),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [])
], TooltipContentComponent.prototype, "cssClasses", null);
__decorate([
    HostBinding('class.k-tooltip-closable'),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [])
], TooltipContentComponent.prototype, "className", null);
__decorate([
    HostBinding('style.position'),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [])
], TooltipContentComponent.prototype, "cssPosition", null);
__decorate([
    HostBinding('style.width.px'),
    Input(),
    __metadata("design:type", Number)
], TooltipContentComponent.prototype, "tooltipWidth", void 0);
__decorate([
    HostBinding('style.height.px'),
    Input(),
    __metadata("design:type", Number)
], TooltipContentComponent.prototype, "tooltipHeight", void 0);
__decorate([
    Input(),
    __metadata("design:type", TemplateRef)
], TooltipContentComponent.prototype, "titleTemplate", void 0);
__decorate([
    Input(),
    __metadata("design:type", ElementRef)
], TooltipContentComponent.prototype, "anchor", void 0);
__decorate([
    Input(),
    __metadata("design:type", Boolean)
], TooltipContentComponent.prototype, "closable", void 0);
__decorate([
    Input(),
    __metadata("design:type", TemplateRef)
], TooltipContentComponent.prototype, "templateRef", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], TooltipContentComponent.prototype, "templateString", void 0);
TooltipContentComponent = __decorate([ __metadata("design:paramtypes", [ElementRef,
        LocalizationService])
], TooltipContentComponent);

/**
 * Represents the [Kendo UI Tooltip directive for Angular]({% slug overview_tooltip %}).
 * Used to display additional information that is related to an element.
 *
 * @example
 * ```ts-no-run
 * <div kendoTooltip>
 *    <a title="Tooltip title" href="foo">foo</a>
 * </div>
 * ```
 */
let TooltipDirective = class TooltipDirective {
    constructor(tooltipWrapper, ngZone, renderer, popupService, settings, legacySettings) {
        this.tooltipWrapper = tooltipWrapper;
        this.ngZone = ngZone;
        this.renderer = renderer;
        this.popupService = popupService;
        /**
         * Specifies a selector for elements within a container which will display a tooltip
         * ([see example]({% slug anchorelements_tooltip %})). The possible values include any
         * DOM `selector`. The default value is `[title]`.
         */
        this.filter = '[title]';
        /**
         * Specifies the position of the Tooltip that is relative to the
         * anchor element ([see example]({% slug positioning_tooltip %})).
         *
         * The possible values are:
         * * `top` (default)
         * * `bottom`
         * * `left`
         * * `right`
         */
        this.position = 'top';
        /**
         * Specifies the delay in milliseconds before the Tooltip is shown.
         * * `100` (default) milliseconds.
         */
        this.showAfter = 100;
        /**
         * Specifies if the Тooltip will display a callout arrow.
         *
         * The possible values are:
         * * `true` (default)
         * * `false`
         */
        this.callout = true;
        /**
         * Specifies if the Тooltip will display a **Close** button
         * ([see example]({% slug closable_tooltip %})).
         *
         * The possible values are:
         * * `true`
         * * `false`
         */
        this.closable = false;
        /**
         * Specifies the offset in pixels between the Tooltip and the anchor. Defaults to `6` pixels.
         * If the `callout` property is set to `true`, the offset is rendered from the callout arrow.
         * If the `callout` property is set to `false`, the offset is rendered from the content of the Tooltip.
         */
        this.offset = 6;
        this.anchor = null;
        this.validPositions = ['top', 'bottom', 'right', 'left'];
        this.validShowOptions = ['hover', 'click', 'none'];
        validatePackage(packageMetadata);
        Object.assign(this, settings, legacySettings);
        this.ngZone.runOutsideAngular(() => {
            const wrapper = this.tooltipWrapper.nativeElement;
            this.anchorTitleSubscription = fromEvent(wrapper, 'mouseover')
                .pipe(filter(() => this.filter !== ''))
                .subscribe((e) => {
                const filterElement = closestBySelector(e.target, this.filter);
                if (filterElement) {
                    this.hideElementTitle({ nativeElement: filterElement });
                }
            });
            this.mouseOverSubscription = fromEvent(wrapper, 'mouseover')
                .pipe(debounceTime(100), filter(() => this.filter !== ''))
                .subscribe(e => this.onMouseOver(e));
            this.mouseOutSubscription = fromEvent(wrapper, 'mouseout')
                .pipe(debounceTime(100))
                .subscribe(e => this.onMouseOut(e));
        });
    }
    /**
     * Sets the content of the Tooltip as a template reference
     * ([see example]({% slug templates_tooltip %})).
     */
    set tooltipTemplate(value) {
        this.template = value;
    }
    get tooltipTemplate() { return this.template; }
    /**
     * Shows the Tooltip.
     * @param anchor&mdash; ElementRef|Element.
     * Specifies the element that will be used as an anchor. The Tooltip opens relative to that element.
     */
    show(anchor) {
        if (this.popupRef) {
            return;
        }
        if (anchor instanceof Element) {
            anchor = { nativeElement: anchor };
        }
        this.anchor = anchor;
        if (this.showOn === 'hover') {
            if (this.popupRef) {
                return;
            }
            clearTimeout(this.showTimeout);
            this.showTimeout = window.setTimeout(() => this.showContent(this.anchor), this.showAfter);
        }
        else {
            this.hideElementTitle(this.anchor);
            this.showContent(this.anchor);
        }
    }
    /**
     * Hides the Tooltip.
     */
    hide() {
        clearTimeout(this.showTimeout);
        const anchor = this.anchor && this.anchor.nativeElement;
        if (anchor && anchor.getAttribute('data-title')) {
            if (!anchor.getAttribute('title') && anchor.hasAttribute('title')) {
                anchor.setAttribute('title', anchor.getAttribute('data-title'));
            }
            anchor.setAttribute('data-title', '');
        }
        if (this.popupMouseOutSubscription) {
            this.popupMouseOutSubscription.unsubscribe();
        }
        if (this.closeClickSubscription) {
            this.closeClickSubscription.unsubscribe();
        }
        this.closePopup();
    }
    /**
     * Toggle visibility of the Tooltip.
     *
     * @param anchor&mdash; ElementRef|Element. Specifies the element that will be used as an anchor.
     * @param show&mdash; Optional. Boolean. Specifies if the Tooltip will be rendered.
     */
    toggle(anchor, show) {
        const previousAnchor = this.anchor && this.anchor.nativeElement;
        if (anchor instanceof Element) {
            anchor = { nativeElement: anchor };
        }
        if (previousAnchor !== anchor.nativeElement) {
            this.hide();
        }
        if (previousAnchor === anchor.nativeElement && this.showOn === 'click') {
            this.hide();
        }
        if (typeof show === 'undefined') {
            show = !this.popupRef;
        }
        if (show) {
            this.show(anchor);
        }
        else {
            this.hide();
        }
    }
    ngOnInit() {
        if (this.showOn === undefined) {
            this.showOn = 'hover';
        }
        this.verifyProperties();
    }
    ngOnChanges(changes) {
        if (changes.showOn) {
            this.subscribeClick();
        }
    }
    ngAfterViewChecked() {
        if (!this.popupRef) {
            return;
        }
        if (this.anchor &&
            !hasParent(this.anchor.nativeElement || this.anchor, this.tooltipWrapper.nativeElement)) {
            this.anchor = null;
            this.hide();
        }
    }
    ngOnDestroy() {
        this.hide();
        this.template = null;
        this.anchorTitleSubscription.unsubscribe();
        this.mouseOverSubscription.unsubscribe();
        this.mouseOutSubscription.unsubscribe();
        if (this.mouseClickSubscription) {
            this.mouseClickSubscription.unsubscribe();
        }
        if (this.popupPositionChangeSubscription) {
            this.popupPositionChangeSubscription.unsubscribe();
        }
        if (this.popupMouseOutSubscription) {
            this.popupMouseOutSubscription.unsubscribe();
        }
    }
    showContent(anchorRef) {
        if (!anchorRef.nativeElement.getAttribute('data-title') && !this.template) {
            return;
        }
        this.ngZone.run(() => {
            this.openPopup(anchorRef);
            this.bindContent(this.popupRef.content, anchorRef);
        });
        this.popupRef.popupAnchorViewportLeave
            .pipe(take(1))
            .subscribe(() => this.hide());
    }
    bindContent(contentComponent, anchorRef) {
        const content = contentComponent.instance;
        this.closeClickSubscription = content.close
            .subscribe(() => { this.hide(); });
        if (!this.template) {
            content.templateString = this.anchor.nativeElement.getAttribute('data-title');
        }
        else {
            content.templateRef = this.template;
        }
        if (this.titleTemplate) {
            content.titleTemplate = this.titleTemplate;
        }
        content.closeTitle = this.closeTitle;
        content.anchor = anchorRef;
        content.callout = this.callout;
        content.closable = this.closable;
        content.position = this.position;
        content.tooltipWidth = this.tooltipWidth;
        content.tooltipHeight = this.tooltipHeight;
        this.popupRef.content.changeDetectorRef.detectChanges();
    }
    hideElementTitle(elementRef) {
        const element = elementRef.nativeElement;
        if (element.getAttribute('title')) {
            element.setAttribute('data-title', element.getAttribute('title'));
            element.setAttribute('title', '');
        }
    }
    openPopup(anchorRef) {
        const alignSettings = align(this.position, this.offset);
        const anchorAlign = alignSettings.anchorAlign;
        const popupAlign = alignSettings.popupAlign;
        const popupMargin = alignSettings.popupMargin;
        this.popupRef = this.popupService.open({
            anchor: anchorRef,
            anchorAlign,
            animate: false,
            content: TooltipContentComponent,
            collision: collision(this.collision, this.position),
            margin: popupMargin,
            popupAlign,
            popupClass: 'k-popup-transparent'
        });
        this.renderer.addClass(this.popupRef.popupElement, 'k-tooltip-wrapper');
        if (this.tooltipClass) {
            this.renderer.addClass(this.popupRef.popupElement, this.tooltipClass);
        }
        const popupInstance = this.popupRef.content.instance;
        if (popupInstance.callout) {
            this.popupPositionChangeSubscription = this.popupRef.popupPositionChange
                .subscribe(({ flip }) => {
                const isFlip = flip.horizontal === true || flip.vertical === true;
                popupInstance.updateCalloutPosition(this.position, isFlip);
            });
        }
        if (this.showOn === 'hover') {
            this.ngZone.runOutsideAngular(() => {
                const popup = this.popupRef.popupElement;
                this.popupMouseOutSubscription = fromEvent(popup, 'mouseout')
                    .subscribe((e) => this.onMouseOut(e));
            });
        }
    }
    closePopup() {
        if (this.popupRef) {
            this.popupRef.close();
            this.popupRef = null;
        }
        if (this.popupPositionChangeSubscription) {
            this.popupPositionChangeSubscription.unsubscribe();
        }
    }
    subscribeClick() {
        if (this.mouseClickSubscription) {
            this.mouseClickSubscription.unsubscribe();
        }
        if (this.showOn === 'click') {
            this.mouseClickSubscription = fromEvent(document, 'click')
                .pipe(filter(() => this.filter !== ''))
                .subscribe(e => this.onMouseClick(e, this.tooltipWrapper.nativeElement));
        }
    }
    onMouseClick(e, wrapper) {
        const target = e.target;
        const filterElement = closestBySelector(target, this.filter);
        const popup = this.popupRef && this.popupRef.popupElement;
        if (popup) {
            if (popup.contains(target)) {
                return;
            }
            if (this.closable) {
                return;
            }
        }
        if (wrapper.contains(target) && filterElement) {
            this.toggle(filterElement, true);
        }
        else if (popup) {
            this.hide();
        }
    }
    onMouseOver(e) {
        const filterElement = closestBySelector(e.target, this.filter);
        if (this.showOn !== 'hover') {
            return;
        }
        if (filterElement) {
            this.toggle(filterElement, true);
        }
    }
    onMouseOut(e) {
        if (this.showOn !== 'hover') {
            return;
        }
        if (this.closable) {
            return;
        }
        const popup = this.popupRef && this.popupRef.popupElement;
        const relatedTarget = e.relatedTarget;
        if (relatedTarget && this.anchor && contains(this.anchor.nativeElement, relatedTarget)) {
            return;
        }
        if (relatedTarget && contains(popup, relatedTarget)) {
            return;
        }
        this.hide();
    }
    verifyProperties() {
        if (!isDevMode()) {
            return;
        }
        if (!containsItem(this.validPositions, this.position)) {
            throw new Error(`Invalid value provided for position property.The available options are 'top', 'bottom', 'left', or 'right'.`);
        }
        if (!containsItem(this.validShowOptions, this.showOn)) {
            throw new Error(`Invalid value provided for showOn property.The available options are 'hover' or 'none'.`);
        }
    }
};
TooltipDirective.ɵfac = function TooltipDirective_Factory(t) { return new (t || TooltipDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.PopupService), ɵngcc0.ɵɵdirectiveInject(TooltipSettings, 8), ɵngcc0.ɵɵdirectiveInject(TOOLTIP_SETTINGS, 8)); };
TooltipDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: TooltipDirective, selectors: [["", "kendoTooltip", ""]], inputs: { filter: "filter", position: "position", showAfter: "showAfter", callout: "callout", closable: "closable", offset: "offset", tooltipTemplate: "tooltipTemplate", showOn: "showOn", titleTemplate: "titleTemplate", tooltipWidth: "tooltipWidth", tooltipHeight: "tooltipHeight", tooltipClass: "tooltipClass", collision: "collision", closeTitle: "closeTitle" }, exportAs: ["kendoTooltip"], features: [ɵngcc0.ɵɵNgOnChangesFeature] });
__decorate([
    Input(),
    __metadata("design:type", String)
], TooltipDirective.prototype, "filter", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], TooltipDirective.prototype, "position", void 0);
__decorate([
    Input(),
    __metadata("design:type", TemplateRef)
], TooltipDirective.prototype, "titleTemplate", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], TooltipDirective.prototype, "showOn", void 0);
__decorate([
    Input(),
    __metadata("design:type", Number)
], TooltipDirective.prototype, "showAfter", void 0);
__decorate([
    Input(),
    __metadata("design:type", Boolean)
], TooltipDirective.prototype, "callout", void 0);
__decorate([
    Input(),
    __metadata("design:type", Boolean)
], TooltipDirective.prototype, "closable", void 0);
__decorate([
    Input(),
    __metadata("design:type", Number)
], TooltipDirective.prototype, "offset", void 0);
__decorate([
    Input(),
    __metadata("design:type", Number)
], TooltipDirective.prototype, "tooltipWidth", void 0);
__decorate([
    Input(),
    __metadata("design:type", Number)
], TooltipDirective.prototype, "tooltipHeight", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], TooltipDirective.prototype, "tooltipClass", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], TooltipDirective.prototype, "collision", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], TooltipDirective.prototype, "closeTitle", void 0);
__decorate([
    Input(),
    __metadata("design:type", TemplateRef),
    __metadata("design:paramtypes", [TemplateRef])
], TooltipDirective.prototype, "tooltipTemplate", null);
TooltipDirective = __decorate([ __param(4, Optional()),
    __param(5, Optional()), __param(5, Inject(TOOLTIP_SETTINGS)),
    __metadata("design:paramtypes", [ElementRef,
        NgZone,
        Renderer2,
        PopupService,
        TooltipSettings,
        TooltipSettings])
], TooltipDirective);

/**
 * @hidden
 */
const ERRORS = {
    popover: `Invalid value provided for the 'popover' property. The accepted data types are 'PopoverComponent' or 'PopoverFn'.`,
    templateData: `templateData must be a function, but received`,
    showOn: `Invalid value provided for the 'showOn' property. The available options are 'click', 'hover', 'focus' or 'none'.`
};

/**
 * Represents a template that defines the content of the Popover title.
 *
 * To define the template, nest an `<ng-template>` tag
 * with the `kendoPopoverTitleTemplate` directive inside the `<kendo-popover>` tag.
 */
let PopoverTitleTemplateDirective = class PopoverTitleTemplateDirective {
    constructor(templateRef) {
        this.templateRef = templateRef;
    }
};
PopoverTitleTemplateDirective.ɵfac = function PopoverTitleTemplateDirective_Factory(t) { return new (t || PopoverTitleTemplateDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.TemplateRef, 8)); };
PopoverTitleTemplateDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: PopoverTitleTemplateDirective, selectors: [["", "kendoPopoverTitleTemplate", ""]] });
PopoverTitleTemplateDirective = __decorate([ __param(0, Optional()),
    __metadata("design:paramtypes", [TemplateRef])
], PopoverTitleTemplateDirective);

/**
 * Represents a template that defines the content of the Popover body.
 *
 * To define the template, nest an `<ng-template>` tag
 * with the `kendoPopoverBodyTemplate` directive inside the `<kendo-popover>` tag.
 */
let PopoverBodyTemplateDirective = class PopoverBodyTemplateDirective {
    constructor(templateRef) {
        this.templateRef = templateRef;
    }
};
PopoverBodyTemplateDirective.ɵfac = function PopoverBodyTemplateDirective_Factory(t) { return new (t || PopoverBodyTemplateDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.TemplateRef, 8)); };
PopoverBodyTemplateDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: PopoverBodyTemplateDirective, selectors: [["", "kendoPopoverBodyTemplate", ""]] });
PopoverBodyTemplateDirective = __decorate([ __param(0, Optional()),
    __metadata("design:paramtypes", [TemplateRef])
], PopoverBodyTemplateDirective);

/**
 * Represents a template that defines the content of the Popover actions.
 *
 * To define the template, nest an `<ng-template>` tag
 * with the `kendoPopoverActionsTemplate` directive inside the `<kendo-popover>` tag.
 */
let PopoverActionsTemplateDirective = class PopoverActionsTemplateDirective {
    constructor(templateRef) {
        this.templateRef = templateRef;
    }
};
PopoverActionsTemplateDirective.ɵfac = function PopoverActionsTemplateDirective_Factory(t) { return new (t || PopoverActionsTemplateDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.TemplateRef, 8)); };
PopoverActionsTemplateDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: PopoverActionsTemplateDirective, selectors: [["", "kendoPopoverActionsTemplate", ""]] });
PopoverActionsTemplateDirective = __decorate([ __param(0, Optional()),
    __metadata("design:paramtypes", [TemplateRef])
], PopoverActionsTemplateDirective);

/**
 * Represents the [Kendo UI Popover component for Angular]({% slug overview_popover %}).
 * Used to display additional information that is related to a target element.
 *
 * @example
 * ```ts-no-run
 * <kendo-popover>
 *    <ng-template kendoPopoverTitleTemplate>Foo Title</ng-template>
 *    <ng-template kendoPopoverBodyTemplate>Foo Body</ng-template>
 *    <ng-template kendoPopoverActionsTemplate>Foo Actions</ng-template>
 * </kendo-popover>
 * ```
 */
let PopoverComponent = class PopoverComponent {
    constructor(localization) {
        this.localization = localization;
        /**
         * Specifies the position of the Popover in relation to its anchor element. [See example]({% slug positioning_popover %})
         *
         * The possible options are:
         * `top`
         * `bottom`
         * `right` (Default)
         * `left`
         */
        this.position = 'right';
        /**
         * Determines whether a callout will be rendered along the Popover. [See example]({% slug callout_popover %})
         *
         * @default true
         */
        this.callout = true;
        /**
         * Enables and configures the Popover animation. [See example]({% slug animations_popover %})
         *
         * The possible options are:
         *
         * * `boolean`&mdash;Enables the default animation
         * * `PopoverAnimation`&mdash;A configuration object which allows setting the `direction`, `duration` and `type` of the animation.
         *
         * @default false
         */
        this.animation = false;
        /**
         * @hidden
         * Determines the visibility of the Popover.
         */
        this.visible = false;
        /**
         * Fires before the Popover is about to be shown ([see example]({% slug events_popover %})).
         * The event is preventable. If canceled, the Popover will not be displayed. [See example]({% slug events_popover %})
         */
        this.show = new EventEmitter();
        /**
         * Fires after the Popover has been shown and the animation has ended. [See example]({% slug events_popover %})
         */
        this.shown = new EventEmitter();
        /**
         * Fires when the Popover is about to be hidden ([see example]({% slug events_popover %})).
         * The event is preventable. If canceled, the Popover will remain visible.
         */
        this.hide = new EventEmitter();
        /**
         * Fires after the Popover has been hidden and the animation has ended. [See example]({% slug events_popover %})
         */
        this.hidden = new EventEmitter();
        this._offset = 6;
        this._width = 'auto';
        this._height = 'auto';
        this.subs = new Subscription();
        /**
         * @hidden
         */
        this._templateData = () => null;
        validatePackage(packageMetadata);
    }
    /**
     * Specifies the distance from the Popover to its anchor element in pixels.
     *
     * @default `6`
     */
    set offset(value) {
        this._offset = value;
    }
    get offset() {
        const calloutBuffer = 14;
        return this.callout
            ? calloutBuffer + this._offset
            : this._offset;
    }
    /**
     * Determines the width of the popover. Numeric values are treated as pixels.
     * @default 'auto'
     */
    set width(value) {
        this._width = typeof value === 'number' ? `${value}px` : value;
    }
    get width() {
        return this._width;
    }
    /**
     * Determines the height of the popover. Numeric values are treated as pixels.
     * @default 'auto'
     */
    set height(value) {
        this._height = typeof value === 'number' ? `${value}px` : value;
    }
    get height() {
        return this._height;
    }
    /**
     * Defines a callback function which returns custom data passed to the Popover templates.
     * It exposes the current anchor element as an argument. [See example]({% slug templates_popover %}#toc-popoverdatacallback)
     */
    set templateData(fn) {
        if (isDevMode && typeof fn !== 'function') {
            throw new Error(`${ERRORS.templateData} ${JSON.stringify(fn)}.`);
        }
        this._templateData = fn;
    }
    get templateData() {
        return this._templateData;
    }
    /**
     * @hidden
     */
    get isHidden() {
        return !this.visible;
    }
    /**
     * @hidden
     */
    get hasAttributeHidden() {
        return !this.visible;
    }
    ngOnInit() {
        this.subs.add(this.localization.changes.subscribe(({ rtl }) => {
            this.direction = rtl ? 'rtl' : 'ltr';
        }));
    }
    ngOnDestroy() {
        this.subs.unsubscribe();
    }
    /**
     * @hidden
     */
    getCalloutPosition() {
        switch (this.position) {
            case 'top': return { 'k-callout-s': true };
            case 'bottom': return { 'k-callout-n': true };
            case 'left': return { 'k-callout-e': true };
            case 'right': return { 'k-callout-w': true };
            default: return { 'k-callout-s': true };
        }
    }
};
PopoverComponent.ɵfac = function PopoverComponent_Factory(t) { return new (t || PopoverComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.LocalizationService)); };
PopoverComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: PopoverComponent, selectors: [["kendo-popover"]], contentQueries: function PopoverComponent_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
        ɵngcc0.ɵɵcontentQuery(dirIndex, PopoverTitleTemplateDirective, 5);
        ɵngcc0.ɵɵcontentQuery(dirIndex, PopoverBodyTemplateDirective, 5);
        ɵngcc0.ɵɵcontentQuery(dirIndex, PopoverActionsTemplateDirective, 5);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.titleTemplate = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.bodyTemplate = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.actionsTemplate = _t.first);
    } }, hostVars: 8, hostBindings: function PopoverComponent_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵattribute("aria-hidden", ctx.hasAttributeHidden)("dir", ctx.direction);
        ɵngcc0.ɵɵstyleProp("width", ctx.width)("height", ctx.height);
        ɵngcc0.ɵɵclassProp("k-hidden", ctx.isHidden);
    } }, inputs: { position: "position", callout: "callout", animation: "animation", offset: "offset", width: "width", height: "height", templateData: "templateData", title: "title", subtitle: "subtitle", body: "body" }, outputs: { show: "show", shown: "shown", hide: "hide", hidden: "hidden" }, features: [ɵngcc0.ɵɵProvidersFeature([
            LocalizationService,
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.popover'
            }
        ])], decls: 1, vars: 1, consts: [["role", "tooltip", "class", "k-popover", 3, "ngStyle", 4, "ngIf"], ["role", "tooltip", 1, "k-popover", 3, "ngStyle"], ["class", "k-popover-callout", 3, "ngClass", 4, "ngIf"], ["class", "k-popover-header", 4, "ngIf"], ["class", "k-popover-body", 4, "ngIf"], ["class", "k-popover-actions k-actions k-hstack k-justify-content-between", 4, "ngIf"], [1, "k-popover-callout", 3, "ngClass"], [1, "k-popover-header"], [4, "ngIf"], [3, "ngTemplateOutlet", "ngTemplateOutletContext"], [1, "k-popover-body"], [1, "k-popover-actions", "k-actions", "k-hstack", "k-justify-content-between"]], template: function PopoverComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, PopoverComponent_div_0_Template, 5, 8, "div", 0);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngIf", ctx.visible);
    } }, directives: [ɵngcc2.NgIf, ɵngcc2.NgStyle, ɵngcc2.NgClass, ɵngcc2.NgTemplateOutlet], encapsulation: 2 });
__decorate([
    Input(),
    __metadata("design:type", String)
], PopoverComponent.prototype, "position", void 0);
__decorate([
    Input(),
    __metadata("design:type", Number),
    __metadata("design:paramtypes", [Number])
], PopoverComponent.prototype, "offset", null);
__decorate([
    HostBinding('style.width'),
    Input(),
    __metadata("design:type", Object),
    __metadata("design:paramtypes", [Object])
], PopoverComponent.prototype, "width", null);
__decorate([
    HostBinding('style.height'),
    Input(),
    __metadata("design:type", Object),
    __metadata("design:paramtypes", [Object])
], PopoverComponent.prototype, "height", null);
__decorate([
    HostBinding('attr.dir'),
    __metadata("design:type", String)
], PopoverComponent.prototype, "direction", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], PopoverComponent.prototype, "title", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], PopoverComponent.prototype, "subtitle", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], PopoverComponent.prototype, "body", void 0);
__decorate([
    Input(),
    __metadata("design:type", Boolean)
], PopoverComponent.prototype, "callout", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], PopoverComponent.prototype, "animation", void 0);
__decorate([
    Input(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Function])
], PopoverComponent.prototype, "templateData", null);
__decorate([
    HostBinding('class.k-hidden'),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [])
], PopoverComponent.prototype, "isHidden", null);
__decorate([
    HostBinding('attr.aria-hidden'),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [])
], PopoverComponent.prototype, "hasAttributeHidden", null);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], PopoverComponent.prototype, "show", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], PopoverComponent.prototype, "shown", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], PopoverComponent.prototype, "hide", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], PopoverComponent.prototype, "hidden", void 0);
__decorate([
    ContentChild(PopoverTitleTemplateDirective, { static: false }),
    __metadata("design:type", PopoverTitleTemplateDirective)
], PopoverComponent.prototype, "titleTemplate", void 0);
__decorate([
    ContentChild(PopoverBodyTemplateDirective, { static: false }),
    __metadata("design:type", PopoverBodyTemplateDirective)
], PopoverComponent.prototype, "bodyTemplate", void 0);
__decorate([
    ContentChild(PopoverActionsTemplateDirective, { static: false }),
    __metadata("design:type", PopoverActionsTemplateDirective)
], PopoverComponent.prototype, "actionsTemplate", void 0);
PopoverComponent = __decorate([ __metadata("design:paramtypes", [LocalizationService])
], PopoverComponent);

/**
 * Arguments for the `show` event. The `show` event fires when a popover is about
 * to be opened. If you cancel the event, the opening is prevented.
 */
class PopoverShowEvent extends PreventableEvent {
    /**
     * @hidden
     * Constructs the event arguments for the `show` event.
     * @param anchor - The host element related to the popover.
     */
    constructor(anchor) {
        super();
        this.anchor = anchor;
    }
}
/**
 * Arguments for the `hide` event. The `hide` event fires when a popover is about
 * to be closed. If you cancel the event, the popover stays open.
 */
class PopoverHideEvent extends PreventableEvent {
    /**
     * @hidden
     * Constructs the event arguments for the `hide` event.
     * @param anchor - The host element related to the popover.
     * @param popover - The popover element.
     */
    constructor(anchor, popover) {
        super();
        this.anchor = anchor;
        this.popover = popover;
    }
}
/**
 * Arguments for the `shown` event. The `shown` event fires after the popover has opened and its opening animation has finished.
 */
class PopoverShownEvent {
    /**
     * @hidden
     * Constructs the event arguments for the `shown` event.
     * @param anchor - The host element related to the popover.
     * @param popover - The popover element.
     */
    constructor(anchor, popover) {
        this.anchor = anchor;
        this.popover = popover;
    }
}
/**
 * Arguments for the `hidden` event. The `hidden` event fires after the popover has closed and its closing animation has finished.
 */
class PopoverHiddenEvent {
    /**
     * @hidden
     * Constructs the event arguments for the `hidden` event.
     * @param anchor - The host element related to the popover.
     */
    constructor(anchor) {
        this.anchor = anchor;
    }
}

const validShowOptions = ['hover', 'click', 'none', 'focus'];
/**
 * @hidden
 */
class PopoverDirectivesBase {
    constructor(ngZone, popupService, renderer) {
        this.ngZone = ngZone;
        this.popupService = popupService;
        this.renderer = renderer;
        this.subs = new Subscription();
        this._showOn = 'click';
    }
    /**
     * Specifies the popover instance that will be rendered.
     * Accepts a [`PopoverComponent`]({% slug api_tooltip_popovercomponent %}) instance or
     * a [`PopoverFn`]({% slug api_tooltip_popoverfn %}) callback which returns a [`PopoverComponent`]({% slug api_tooltip_popovercomponent %}) instance
     * depending on the current anchor element.
     *
     * [See example]({% slug templates_popover %}#toc-popovercallback)
     */
    set popover(value) {
        if (value instanceof PopoverComponent || typeof value === `function`) {
            this._popover = value;
        }
        else {
            if (isDevMode) {
                throw new Error(ERRORS.popover);
            }
        }
    }
    get popover() {
        return this._popover;
    }
    /**
     * The event on which the Popover will be shown
     *
     * The supported values are:
     * - `click` (default) &mdash;The Popover will be shown when its `anchor` element is clicked.
     * - `hover`&mdash;The Popover will be shown when its `anchor` element is hovered.
     * - `focus`&mdash;The Popover will be shown when its `anchor` element is focused.
     * - `none`&mdash;The Popover will not be shown on user interaction. It could be rendered via the Popover API methods.
     */
    set showOn(value) {
        if (isDevMode && !containsItem(validShowOptions, value)) {
            throw new Error(ERRORS.showOn);
        }
        this._showOn = value;
    }
    get showOn() {
        return this._showOn;
    }
    ngAfterViewInit() {
        if (!isDocumentAvailable()) {
            return;
        }
        this.ngZone.runOutsideAngular(() => {
            switch (this.showOn) {
                case 'hover':
                    this.subscribeToEvents([{
                            name: 'mouseenter', handler: this.mouseenterHandler
                        }, {
                            name: 'mouseleave', handler: this.mouseleaveHandler
                        }]);
                    break;
                case 'focus':
                    this.subscribeToEvents([{
                            name: 'focus', handler: this.focusHandler
                        }, {
                            name: 'blur', handler: this.blurHandler
                        }]);
                    break;
                case 'click':
                    this.subscribeClick();
                    break;
                default:
                    break;
            }
        });
    }
    ngOnDestroy() {
        this.closePopup();
        if (this.disposeHoverOverListener) {
            this.disposeHoverOverListener();
        }
        if (this.disposeHoverOutListener) {
            this.disposeHoverOutListener();
        }
        if (this.disposeClickListener) {
            this.disposeClickListener();
        }
        if (this._focusInsideSub) {
            this._focusInsideSub.unsubscribe();
        }
        if (this._hideSub) {
            this._hideSub.unsubscribe();
        }
        if (this.subs) {
            this.subs.unsubscribe();
        }
        if (this._popupOpenSub) {
            this._popupOpenSub.unsubscribe();
        }
        if (this._popupCloseSub) {
            this._popupCloseSub.unsubscribe();
        }
    }
    /**
     * Hides the Popover ([See example]({% slug programmaticcontrol_popover %})).
     */
    hide() {
        this.closePopup();
    }
    /**
     * @hidden
     */
    closePopup() {
        if (this.popupRef) {
            this.popupRef.close();
            this.popupRef = null;
            if (this.disposePopupHoverOutListener) {
                this.disposePopupHoverOutListener();
            }
            if (this.disposePopupHoverInListener) {
                this.disposePopupHoverInListener();
            }
            if (this.disposePopupFocusOutListener) {
                this.disposePopupFocusOutListener();
            }
        }
    }
    /**
     * @hidden
     */
    openPopup(anchor) {
        const _anchor = anchor instanceof ElementRef ? anchor.nativeElement : anchor;
        const popoverComp = this.popover instanceof PopoverComponent ? this.popover : this.popover(_anchor);
        const alignSettings = align(popoverComp.position, popoverComp.offset);
        const anchorAlign = alignSettings.anchorAlign;
        const popupAlign = alignSettings.popupAlign;
        const popupMargin = alignSettings.popupMargin;
        const _animation = popoverComp.animation;
        this.popupRef = this.popupService.open({
            anchor: { nativeElement: _anchor },
            animate: _animation,
            content: PopoverComponent,
            popupAlign,
            anchorAlign,
            margin: popupMargin,
            popupClass: 'k-popup-transparent',
            collision: { horizontal: 'fit', vertical: 'fit' }
        });
        this.applySettings(this.popupRef.content, popoverComp, anchor);
        this.monitorPopup();
        this.initializeCompletionEvents(popoverComp, _anchor);
    }
    /**
     * @hidden
     */
    isPrevented(anchorElement, show) {
        const popoverComp = this.popover instanceof PopoverComponent ? this.popover : this.popover(anchorElement);
        let eventArgs;
        eventArgs = this.initializeEvents(popoverComp, eventArgs, show, anchorElement);
        return eventArgs.isDefaultPrevented();
    }
    /**
     * @hidden
     */
    monitorPopup() {
        if (this.showOn === 'hover') {
            this.ngZone.runOutsideAngular(() => {
                const popup = this.popupRef.popupElement;
                this.disposePopupHoverInListener = this.renderer.listen(popup, 'mouseenter', _ => {
                    this.ngZone.run(_ => this._popoverService.emitPopoverState(true));
                });
                this.disposePopupHoverOutListener = this.renderer.listen(popup, 'mouseleave', _ => {
                    this.ngZone.run(_ => this._popoverService.emitPopoverState(false));
                });
            });
        }
        if (this.showOn === 'focus') {
            this.ngZone.runOutsideAngular(() => {
                const popup = this.popupRef.popupElement;
                this.disposePopupFocusOutListener = this.renderer.listen(popup, 'focusout', (e) => {
                    const isInsidePopover = closest(e.relatedTarget, (node) => node.classList && node.classList.contains('k-popover'));
                    if (!isInsidePopover) {
                        this.ngZone.run(_ => this._popoverService.emitFocusInsidePopover(false));
                    }
                });
            });
        }
    }
    applySettings(contentComponent, popover, anchor) {
        const content = contentComponent.instance;
        const _anchor = anchor instanceof ElementRef ? anchor.nativeElement : anchor;
        content.visible = true;
        content.anchor = _anchor;
        content.position = popover.position;
        content.offset = popover.offset;
        content.width = popover.width;
        content.height = popover.height;
        content.title = popover.title;
        content.body = popover.body;
        content.callout = popover.callout;
        content.animation = popover.animation;
        content.contextData = popover.templateData(_anchor);
        content.titleTemplate = popover.titleTemplate;
        content.bodyTemplate = popover.bodyTemplate;
        content.actionsTemplate = popover.actionsTemplate;
        this.popupRef.content.changeDetectorRef.detectChanges();
    }
    /**
     * @hidden
     */
    initializeEvents(popoverComp, eventArgs, show, anchorElement) {
        if (show) {
            eventArgs = new PopoverShowEvent(anchorElement);
            if (this.shouldEmitEvent(!!this.popupRef, 'show', popoverComp)) {
                this.ngZone.run(() => popoverComp.show.emit(eventArgs));
            }
        }
        else {
            eventArgs = new PopoverHideEvent(anchorElement, this.popupRef);
            if (this.shouldEmitEvent(!!this.popupRef, 'hide', popoverComp)) {
                this.ngZone.run(() => popoverComp.hide.emit(eventArgs));
            }
        }
        return eventArgs;
    }
    initializeCompletionEvents(popoverComp, _anchor) {
        if (this.shouldEmitCompletionEvents('shown', popoverComp)) {
            this.popupRef.popupOpen.subscribe(() => {
                const eventArgs = new PopoverShownEvent(_anchor, this.popupRef);
                popoverComp.shown.emit(eventArgs);
            });
        }
        if (this.shouldEmitCompletionEvents('hidden', popoverComp)) {
            this.popupRef.popupClose.subscribe(() => {
                this.ngZone.run(_ => {
                    const eventArgs = new PopoverHiddenEvent(_anchor);
                    popoverComp.hidden.emit(eventArgs);
                });
            });
        }
    }
    shouldEmitEvent(hasPopup, event, popoverComp) {
        if ((event === 'show' && !hasPopup && hasObservers(popoverComp[event]))
            || (event === 'hide' && hasPopup && hasObservers(popoverComp[event]))) {
            return true;
        }
        return false;
    }
    shouldEmitCompletionEvents(event, popoverComp) {
        if ((hasObservers(popoverComp[event]) && !this._popupOpenSub)
            || (hasObservers(popoverComp[event]) && !this._popupCloseSub)) {
            return true;
        }
        return false;
    }
}
PopoverDirectivesBase.ɵfac = function PopoverDirectivesBase_Factory(t) { ɵngcc0.ɵɵinvalidFactory(); };
PopoverDirectivesBase.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: PopoverDirectivesBase, inputs: { popover: "popover", showOn: "showOn" } });
__decorate([
    Input(),
    __metadata("design:type", Object),
    __metadata("design:paramtypes", [Object])
], PopoverDirectivesBase.prototype, "popover", null);
__decorate([
    Input(),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [String])
], PopoverDirectivesBase.prototype, "showOn", null);

/**
 * @hidden
 */
let PopoverService = class PopoverService {
    constructor(ngZone) {
        this.ngZone = ngZone;
        this._pointerOverPopup = new BehaviorSubject(null);
        this._pointerOverAnchor = new BehaviorSubject(null);
        this._focusInsidePopover = new BehaviorSubject(null);
        this._hidePopover = new Subject();
        this.subs = new Subscription();
        this.monitor();
    }
    ngOnDestroy() {
        this.subs.unsubscribe();
    }
    get isPopoverHovered() {
        return this._pointerOverPopup.asObservable();
    }
    emitPopoverState(isHovered) {
        this.ngZone.run(_ => this._pointerOverPopup.next(isHovered));
    }
    get isAnchorHovered() {
        return this._pointerOverAnchor.asObservable();
    }
    emitAnchorState(isHovered, anchor) {
        this._isOrigin = this.originAnchor === anchor;
        this.currentAnchor = anchor;
        if (isHovered) {
            this.originAnchor = anchor;
        }
        this.ngZone.run(_ => this._pointerOverAnchor.next(isHovered));
    }
    get isFocusInsidePopover() {
        return this._focusInsidePopover.asObservable();
    }
    emitFocusInsidePopover(isFocused) {
        this.ngZone.run(_ => this._focusInsidePopover.next(isFocused));
        this._focusInsidePopover.next(null);
    }
    get hidePopover() {
        return this._hidePopover.asObservable();
    }
    monitor() {
        this.subs.add(combineLatest(this.isPopoverHovered, this.isAnchorHovered).pipe(
        // `auditTime` is used because the `mouseleave` event is emitted before `mouseenter`
        // i.e. there is a millisecond in which the pointer leaves the first target (e.g. anchor) and hasn't reached the second one (e.g. popup)
        // resulting in both observables emitting `false`
        auditTime(20)).subscribe(val => {
            const [isPopoverHovered, isAnchorHovered] = val;
            this._hidePopover.next([isPopoverHovered, isAnchorHovered, this._isOrigin, this.currentAnchor]);
        }));
    }
};
PopoverService.ɵfac = function PopoverService_Factory(t) { return new (t || PopoverService)(ɵngcc0.ɵɵinject(ɵngcc0.NgZone)); };
PopoverService.ɵprov = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjectable({ token: PopoverService, factory: function (t) { return PopoverService.ɵfac(t); } });
PopoverService = __decorate([ __metadata("design:paramtypes", [NgZone])
], PopoverService);

/**
 * Represents the [`kendoPopoverContainer`]({% slug configuration_popover %}#toc-containerdirective) directive.
 * It is used to filter and target multiple elements, which should display a popover on interaction.
 *
 * @example
 * ```ts-no-run
 * <div kendoPopoverContainer [popover]="myPopover" filter=".has-popover">
 *     <button class="has-popover">Show Popover</button>
 *     <button>Button Without Popover</button>
 *     <button class="has-popover">Show Popover</button>
 * </div>
 * ```
 */
let PopoverContainerDirective = class PopoverContainerDirective extends PopoverDirectivesBase {
    constructor(wrapperEl, ngZone, popupService, renderer, popoverService) {
        super(ngZone, popupService, renderer);
        this.wrapperEl = wrapperEl;
        this.ngZone = ngZone;
        this.popupService = popupService;
        this.renderer = renderer;
        this.popoverService = popoverService;
        this.mouseenterHandler = (anchor) => {
            this.controlVisibility(anchor, true);
        };
        this.mouseleaveHandler = (args) => {
            const anchor = args.anchor;
            if (this.isPrevented(anchor, false)) {
                return;
            }
            if (!this._hideSub) {
                this._hideSub = this.popoverService.hidePopover.subscribe((val) => {
                    const [isPopoverHovered, , isOriginAnchor, currentAnchor] = val;
                    if (!isPopoverHovered && !isOriginAnchor) {
                        this.hide();
                        if (!isOriginAnchor && currentAnchor) {
                            this.show(currentAnchor);
                        }
                    }
                });
            }
        };
        this.focusHandler = (anchor) => {
            this.controlVisibility(anchor, true);
        };
        this.blurHandler = (args) => {
            const anchor = args.anchor;
            const event = args.domEvent;
            if (this.isPrevented(anchor, false)) {
                return;
            }
            // from anchor to popup focus check
            const isFocusInside = !!closest(event.relatedTarget, (node) => node.classList && node.classList.contains('k-popover'));
            if (!isFocusInside) {
                this.hide();
            }
            if (!this._focusInsideSub) {
                // inside popup focus check
                this._focusInsideSub = this.popoverService.isFocusInsidePopover.pipe(filter(v => v !== null)).subscribe((val) => {
                    if (!val && !isFocusInside) {
                        this.hide();
                    }
                });
            }
        };
        this._popoverService = this.popoverService;
    }
    /**
     * Shows the Popover.
     *
     * @param anchor&mdash;Specifies the element that will be used as an anchor. The Popover opens relative to that element. [See example]({% slug programmaticcontrol_popover %})
     */
    show(anchor) {
        if (this.popupRef) {
            return;
        }
        this.ngZone.run(() => {
            this.openPopup(anchor);
        });
        this.popupRef.popupAnchorViewportLeave
            .pipe(take(1))
            .subscribe(() => this.hide());
    }
    /**
     * Toggles the visibility of the Popover. [See example]({% slug programmaticcontrol_popover %})
     *
     * @param anchor&mdash;Specifies the element that will be used as an anchor. The Popover opens relative to that element.
     */
    toggle(anchor) {
        const previousAnchor = this.popupRef && this.popupRef.content.instance.anchor;
        if (this.popupRef) {
            this.hide();
            if (previousAnchor !== anchor) {
                this.show(anchor);
            }
        }
        else {
            this.show(anchor);
        }
    }
    subscribeClick() {
        if (this.disposeClickListener) {
            this.disposeClickListener();
        }
        this.disposeClickListener = this.renderer.listen(document, 'click', (e) => {
            const filterElement = closestBySelector(e.target, this.filter);
            this.clickHandler(filterElement, e);
        });
    }
    subscribeToEvents(arr) {
        const filteredElements = Array.from(document.querySelectorAll(this.filter));
        filteredElements.forEach((el) => {
            this.subs.add(this.renderer.listen(el, arr[0].name, () => {
                this.popoverService.emitAnchorState(true, el);
                arr[0].handler(el);
            }));
            this.subs.add(this.renderer.listen(el, arr[1].name, (e) => {
                this.popoverService.emitAnchorState(false, null);
                arr[1].handler({ anchor: el, domEvent: e });
            }));
        });
    }
    clickHandler(anchor, event) {
        const isInsidePopup = !!closest(event.target, (node) => node.classList && node.classList.contains('k-popup'));
        const popupRefAnchor = this.popupRef && this.popupRef.content.instance.anchor;
        let isOriginAnchor = !!closest(event.target, (node) => node === (popupRefAnchor ? popupRefAnchor : anchor));
        if (this.showOn !== 'click' || isInsidePopup || (this.popupRef && isOriginAnchor)) {
            return;
        }
        if (!anchor && this.popupRef) {
            this.controlVisibility(anchor, false);
            return;
        }
        if (isOriginAnchor) {
            this.controlVisibility(anchor, true);
        }
        else if (this.popupRef) {
            this.controlVisibility(anchor, false);
            this.controlVisibility(anchor, true);
        }
    }
    controlVisibility(anchor, show) {
        if (this.isPrevented(anchor, show)) {
            return;
        }
        show ? this.show(anchor) : this.hide();
    }
};
PopoverContainerDirective.ɵfac = function PopoverContainerDirective_Factory(t) { return new (t || PopoverContainerDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.PopupService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(PopoverService)); };
PopoverContainerDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: PopoverContainerDirective, selectors: [["", "kendoPopoverContainer", ""]], inputs: { filter: "filter" }, exportAs: ["kendoPopoverContainer"], features: [ɵngcc0.ɵɵProvidersFeature([PopoverService]), ɵngcc0.ɵɵInheritDefinitionFeature] });
__decorate([
    Input(),
    __metadata("design:type", String)
], PopoverContainerDirective.prototype, "filter", void 0);
PopoverContainerDirective = __decorate([ __metadata("design:paramtypes", [ElementRef,
        NgZone,
        PopupService,
        Renderer2,
        PopoverService])
], PopoverContainerDirective);

/**
 * Represents the [`kendoPopoverAnchor`]({% slug configuration_popover %}#toc-anchordirective) directive.
 * It is used to target an element, which should display a popover on interaction.
 *
 * @example
 * ```ts-no-run
 * <button kendoPopoverAnchor [popover]="myPopover">Show Popover</button>
 * ```
 */
let PopoverAnchorDirective = class PopoverAnchorDirective extends PopoverDirectivesBase {
    constructor(hostEl, ngZone, popupService, renderer, popoverService) {
        super(ngZone, popupService, renderer);
        this.hostEl = hostEl;
        this.ngZone = ngZone;
        this.popupService = popupService;
        this.renderer = renderer;
        this.popoverService = popoverService;
        this.mouseenterHandler = () => {
            this.controlVisibility(this.hostEl.nativeElement, true);
        };
        this.mouseleaveHandler = () => {
            if (this.isPrevented(this.hostEl.nativeElement, false)) {
                return;
            }
            if (!this._hideSub) {
                this._hideSub = this.popoverService.hidePopover.subscribe((val) => {
                    const [isPopoverHovered, isAnchorHovered] = val;
                    if (!isPopoverHovered && !isAnchorHovered) {
                        this.hide();
                    }
                });
            }
        };
        this.focusHandler = () => {
            this.controlVisibility(this.hostEl.nativeElement, true);
        };
        this.blurHandler = (args) => {
            const event = args.domEvent;
            if (this.isPrevented(this.hostEl.nativeElement, false)) {
                return;
            }
            // from anchor to popup focus check
            const isFocusInside = !!closest(event.relatedTarget, (node) => node.classList && node.classList.contains('k-popover'));
            if (!isFocusInside) {
                this.hide();
            }
            if (!this._focusInsideSub) {
                // inside popup focus check
                this._focusInsideSub = this.popoverService.isFocusInsidePopover.pipe(filter(v => v !== null)).subscribe((val) => {
                    if (!val) {
                        this.hide();
                    }
                });
            }
        };
        this._popoverService = this.popoverService;
    }
    /**
     * Shows the Popover. [See example]({% slug programmaticcontrol_popover %})
     */
    show() {
        if (this.popupRef) {
            return;
        }
        this.ngZone.run(() => {
            this.openPopup(this.hostEl);
        });
        this.popupRef.popupAnchorViewportLeave
            .pipe(take(1))
            .subscribe(() => this.hide());
    }
    /**
     * Toggles the visibility of the Popover. [See example]({% slug programmaticcontrol_popover %})
     */
    toggle() {
        if (this.popupRef) {
            this.hide();
        }
        else {
            this.show();
        }
    }
    subscribeToEvents(arr) {
        this.subs.add(this.renderer.listen(this.hostEl.nativeElement, arr[0].name, () => {
            this.popoverService.emitAnchorState(true, this.hostEl.nativeElement);
            arr[0].handler();
        }));
        this.subs.add(this.renderer.listen(this.hostEl.nativeElement, arr[1].name, (e) => {
            this.popoverService.emitAnchorState(false, null);
            arr[1].handler({ domEvent: e });
        }));
    }
    subscribeClick() {
        if (this.disposeClickListener) {
            this.disposeClickListener();
        }
        this.disposeClickListener = this.renderer.listen(document, 'click', (e) => {
            this.onClick(e);
        });
    }
    /**
     * @hidden
     */
    onClick(event) {
        const isInsidePopup = !!closest(event.target, (node) => node.classList && node.classList.contains('k-popup'));
        let isAnchor = !!closest(event.target, (node) => node === this.hostEl.nativeElement);
        if (isInsidePopup || (this.popupRef && isAnchor)) {
            return;
        }
        if (isAnchor) {
            // on opening
            this.controlVisibility(this.hostEl.nativeElement, true);
        }
        else {
            // on closing
            this.controlVisibility(this.hostEl.nativeElement, false);
        }
    }
    controlVisibility(anchor, show) {
        if (this.isPrevented(anchor, show)) {
            return;
        }
        show ? this.show() : this.hide();
    }
};
PopoverAnchorDirective.ɵfac = function PopoverAnchorDirective_Factory(t) { return new (t || PopoverAnchorDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.PopupService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(PopoverService)); };
PopoverAnchorDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: PopoverAnchorDirective, selectors: [["", "kendoPopoverAnchor", ""]], exportAs: ["kendoPopoverAnchor"], features: [ɵngcc0.ɵɵProvidersFeature([PopoverService]), ɵngcc0.ɵɵInheritDefinitionFeature] });
PopoverAnchorDirective = __decorate([ __metadata("design:paramtypes", [ElementRef,
        NgZone,
        PopupService,
        Renderer2,
        PopoverService])
], PopoverAnchorDirective);

var LocalizedMessagesDirective_1;
/**
 * @hidden
 */
let LocalizedMessagesDirective = LocalizedMessagesDirective_1 = class LocalizedMessagesDirective extends ComponentMessages {
    constructor(service) {
        super();
        this.service = service;
    }
};
LocalizedMessagesDirective.ɵfac = function LocalizedMessagesDirective_Factory(t) { return new (t || LocalizedMessagesDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.LocalizationService)); };
LocalizedMessagesDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: LocalizedMessagesDirective, selectors: [["", "kendoTooltipLocalizedMessages", ""]], inputs: { closeTitle: "closeTitle" }, features: [ɵngcc0.ɵɵProvidersFeature([
            {
                provide: ComponentMessages,
                useExisting: forwardRef(() => LocalizedMessagesDirective_1)
            }
        ]), ɵngcc0.ɵɵInheritDefinitionFeature] });
__decorate([
    Input(),
    __metadata("design:type", String)
], LocalizedMessagesDirective.prototype, "closeTitle", void 0);
LocalizedMessagesDirective = LocalizedMessagesDirective_1 = __decorate([ __metadata("design:paramtypes", [LocalizationService])
], LocalizedMessagesDirective);

const COMPONENT_DIRECTIVES = [TooltipDirective, TooltipContentComponent, LocalizedMessagesDirective];
const COMPONENT_MODULES = [PopupModule];
/**
 * Represents the [NgModule]({{ site.data.urls.angular['ngmoduleapi'] }})
 * definition for the Tooltip component.
 *
 * The package exports:
 * - `KendoTooltipDirective`&mdash;The Tooltip directive class.
 *
 * @example
 *
 * ```ts-no-run
 * // Import the Tooltip module
 * import { TooltipModule } from '@progress/kendo-angular-tooltip';
 *
 * // The browser platform with a compiler
 * import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';
 *
 * import { NgModule } from '@angular/core';
 *
 * // Import the app component
 * _@NgModule{{
 *    declarations: [AppComponent], // declare app component
 *    imports:      [BrowserModule, TooltipModule], // import TooltipModule module
 *    bootstrap:    [AppComponent]
 * }}
 * export class AppModule {}
 *
 * // Compile and launch the module
 * platformBrowserDynamic().bootstrapModule(AppModule);
 * ```
 */
let TooltipModule = class TooltipModule {
};
TooltipModule.ɵfac = function TooltipModule_Factory(t) { return new (t || TooltipModule)(); };
TooltipModule.ɵmod = /*@__PURE__*/ ɵngcc0.ɵɵdefineNgModule({ type: TooltipModule });
TooltipModule.ɵinj = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjector({ imports: [[CommonModule, ...COMPONENT_MODULES]] });

const DIRECTIVES = [
    PopoverActionsTemplateDirective,
    PopoverBodyTemplateDirective,
    PopoverTitleTemplateDirective,
    PopoverAnchorDirective,
    PopoverContainerDirective
];
/**
 * Represents the [NgModule]({{ site.data.urls.angular['ngmoduleapi'] }})
 * definition for the Popover component.
 *
 * @example
 *
 * ```ts-no-run
 * import { PopoverModule } from '@progress/kendo-angular-tooltip';
 *
 * import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';
 * import { NgModule } from '@angular/core';
 *
 * import { AppComponent } from './app.component';
 *
 * _@NgModule({
 *     declarations: [AppComponent],
 *     imports:      [BrowserModule, PopoverModule],
 *     bootstrap:    [AppComponent]
 * })
 * export class AppModule {}
 *
 * platformBrowserDynamic().bootstrapModule(AppModule);
 *
 * ```
 */
let PopoverModule = class PopoverModule {
};
PopoverModule.ɵfac = function PopoverModule_Factory(t) { return new (t || PopoverModule)(); };
PopoverModule.ɵmod = /*@__PURE__*/ ɵngcc0.ɵɵdefineNgModule({ type: PopoverModule });
PopoverModule.ɵinj = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjector({ imports: [[
            CommonModule,
            PopupModule
        ]] });

/**
 * Represents the [NgModule]({{ site.data.urls.angular['ngmoduleapi'] }})
 * definition for the Tooltips components.
 *
 * @example
 *
 * ```ts-no-run
 * import { TooltipsModule } from '@progress/kendo-angular-tooltip';
 *
 * // The browser platform with a compiler
 * import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';
 *
 * import { NgModule } from '@angular/core';
 *
 * // Import the app component
 * _@NgModule{{
 *    declarations: [AppComponent], // declare app component
 *    imports:      [BrowserModule, TooltipsModule], // import TooltipsModule module
 *    bootstrap:    [AppComponent]
 * }}
 * export class AppModule {}
 *
 * // Compile and launch the module
 * platformBrowserDynamic().bootstrapModule(AppModule);
 * ```
 */
let TooltipsModule = class TooltipsModule {
};
TooltipsModule.ɵfac = function TooltipsModule_Factory(t) { return new (t || TooltipsModule)(); };
TooltipsModule.ɵmod = /*@__PURE__*/ ɵngcc0.ɵɵdefineNgModule({ type: TooltipsModule });
TooltipsModule.ɵinj = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjector({ imports: [TooltipModule, PopoverModule] });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(TooltipSettings, [{
        type: Injectable
    }], null, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(TooltipContentComponent, [{
        type: Component,
        args: [{
                selector: 'kendo-tooltip',
                template: `
        <ng-container kendoTooltipLocalizedMessages
            i18n-closeTitle="kendo.tooltip.closeTitle|The title of the close button"
            closeTitle="Close"
        >
        </ng-container>

        <div class="k-tooltip-content">
            <div class="k-tooltip-title" *ngIf="titleTemplate">
                <ng-template
                    [ngIf]="titleTemplate"
                    [ngTemplateOutlet]="titleTemplate"
                    [ngTemplateOutletContext]="{ $implicit: anchor, anchor: anchor }">
                </ng-template>
            </div>

            <ng-template
                [ngIf]="templateRef"
                [ngTemplateOutlet]="templateRef"
                [ngTemplateOutletContext]="{ $implicit: anchor, anchor: anchor }">
            </ng-template>
            <ng-template
                [ngIf]="templateString">
                {{ templateString }}
            </ng-template>
        </div>

        <div *ngIf="closable" class="k-tooltip-button" (click)="onCloseClick($event)">
            <a href="#" class="k-icon k-i-close" [attr.title]="closeButtonTitle"></a>
        </div>

        <div class="k-callout" *ngIf="callout" [ngClass]="calloutPositionClass()"></div>
    `,
                providers: [
                    LocalizationService,
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.tooltip'
                    }
                ]
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc1.LocalizationService }]; }, { close: [{
            type: Output
        }], tooltipWidth: [{
            type: HostBinding,
            args: ['style.width.px']
        }, {
            type: Input
        }], tooltipHeight: [{
            type: HostBinding,
            args: ['style.height.px']
        }, {
            type: Input
        }], direction: [{
            type: HostBinding,
            args: ['attr.dir']
        }], cssClasses: [{
            type: HostBinding,
            args: ['class']
        }], className: [{
            type: HostBinding,
            args: ['class.k-tooltip-closable']
        }], cssPosition: [{
            type: HostBinding,
            args: ['style.position']
        }], titleTemplate: [{
            type: Input
        }], anchor: [{
            type: Input
        }], closable: [{
            type: Input
        }], templateRef: [{
            type: Input
        }], templateString: [{
            type: Input
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(TooltipDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoTooltip]',
                exportAs: 'kendoTooltip'
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.NgZone }, { type: ɵngcc0.Renderer2 }, { type: ɵngcc3.PopupService }, { type: TooltipSettings, decorators: [{
                type: Optional
            }] }, { type: TooltipSettings, decorators: [{
                type: Optional
            }, {
                type: Inject,
                args: [TOOLTIP_SETTINGS]
            }] }]; }, { filter: [{
            type: Input
        }], position: [{
            type: Input
        }], showAfter: [{
            type: Input
        }], callout: [{
            type: Input
        }], closable: [{
            type: Input
        }], offset: [{
            type: Input
        }], tooltipTemplate: [{
            type: Input
        }], showOn: [{
            type: Input
        }], titleTemplate: [{
            type: Input
        }], tooltipWidth: [{
            type: Input
        }], tooltipHeight: [{
            type: Input
        }], tooltipClass: [{
            type: Input
        }], collision: [{
            type: Input
        }], closeTitle: [{
            type: Input
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(PopoverTitleTemplateDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoPopoverTitleTemplate]'
            }]
    }], function () { return [{ type: ɵngcc0.TemplateRef, decorators: [{
                type: Optional
            }] }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(PopoverBodyTemplateDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoPopoverBodyTemplate]'
            }]
    }], function () { return [{ type: ɵngcc0.TemplateRef, decorators: [{
                type: Optional
            }] }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(PopoverActionsTemplateDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoPopoverActionsTemplate]'
            }]
    }], function () { return [{ type: ɵngcc0.TemplateRef, decorators: [{
                type: Optional
            }] }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(PopoverComponent, [{
        type: Component,
        args: [{
                selector: 'kendo-popover',
                providers: [
                    LocalizationService,
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.popover'
                    }
                ],
                template: `
    <div *ngIf="visible" role="tooltip" class="k-popover" [ngStyle]="{'width.px': width, 'height.px': height}">
        <div class="k-popover-callout" [ngClass]="getCalloutPosition()" *ngIf="callout"></div>

        <div *ngIf="titleTemplate || title" class="k-popover-header">
            <ng-template *ngIf="titleTemplate"
                [ngTemplateOutlet]="titleTemplate?.templateRef"
                [ngTemplateOutletContext]="{ $implicit: anchor, data: contextData }">
            </ng-template>
            <ng-container *ngIf="title && !titleTemplate">
                {{ title }}
            </ng-container>
        </div>

        <div *ngIf="bodyTemplate || body" class="k-popover-body">
            <ng-template *ngIf="bodyTemplate"
                [ngTemplateOutlet]="bodyTemplate?.templateRef"
                [ngTemplateOutletContext]="{ $implicit: anchor, data: contextData }">
            </ng-template>
            <ng-container *ngIf="body && !bodyTemplate">
                {{ body }}
            </ng-container>
        </div>

        <div *ngIf="actionsTemplate" class="k-popover-actions k-actions k-hstack k-justify-content-between">
            <ng-template *ngIf="actionsTemplate"
                [ngTemplateOutlet]="actionsTemplate?.templateRef"
                [ngTemplateOutletContext]="{ $implicit: anchor, data: contextData }">
            </ng-template>
        </div>
    </div>
    `
            }]
    }], function () { return [{ type: ɵngcc1.LocalizationService }]; }, { position: [{
            type: Input
        }], callout: [{
            type: Input
        }], animation: [{
            type: Input
        }], show: [{
            type: Output
        }], shown: [{
            type: Output
        }], hide: [{
            type: Output
        }], hidden: [{
            type: Output
        }], offset: [{
            type: Input
        }], width: [{
            type: HostBinding,
            args: ['style.width']
        }, {
            type: Input
        }], height: [{
            type: HostBinding,
            args: ['style.height']
        }, {
            type: Input
        }], templateData: [{
            type: Input
        }], isHidden: [{
            type: HostBinding,
            args: ['class.k-hidden']
        }], hasAttributeHidden: [{
            type: HostBinding,
            args: ['attr.aria-hidden']
        }], direction: [{
            type: HostBinding,
            args: ['attr.dir']
        }], title: [{
            type: Input
        }], subtitle: [{
            type: Input
        }], body: [{
            type: Input
        }], titleTemplate: [{
            type: ContentChild,
            args: [PopoverTitleTemplateDirective, { static: false }]
        }], bodyTemplate: [{
            type: ContentChild,
            args: [PopoverBodyTemplateDirective, { static: false }]
        }], actionsTemplate: [{
            type: ContentChild,
            args: [PopoverActionsTemplateDirective, { static: false }]
        }] }); })();

(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(PopoverService, [{
        type: Injectable
    }], function () { return [{ type: ɵngcc0.NgZone }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(PopoverContainerDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoPopoverContainer]',
                exportAs: 'kendoPopoverContainer',
                providers: [PopoverService]
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.NgZone }, { type: ɵngcc3.PopupService }, { type: ɵngcc0.Renderer2 }, { type: PopoverService }]; }, { filter: [{
            type: Input
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(PopoverAnchorDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoPopoverAnchor]',
                exportAs: 'kendoPopoverAnchor',
                providers: [PopoverService]
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.NgZone }, { type: ɵngcc3.PopupService }, { type: ɵngcc0.Renderer2 }, { type: PopoverService }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(LocalizedMessagesDirective, [{
        type: Directive,
        args: [{
                providers: [
                    {
                        provide: ComponentMessages,
                        useExisting: forwardRef(() => LocalizedMessagesDirective_1)
                    }
                ],
                selector: `[kendoTooltipLocalizedMessages]`
            }]
    }], function () { return [{ type: ɵngcc1.LocalizationService }]; }, { closeTitle: [{
            type: Input
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(TooltipModule, [{
        type: NgModule,
        args: [{
                declarations: [COMPONENT_DIRECTIVES],
                entryComponents: [TooltipContentComponent],
                imports: [CommonModule, ...COMPONENT_MODULES],
                exports: [COMPONENT_DIRECTIVES]
            }]
    }], null, null); })();
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(TooltipModule, { declarations: function () { return [TooltipDirective, TooltipContentComponent, LocalizedMessagesDirective]; }, imports: function () { return [CommonModule, PopupModule]; }, exports: function () { return [TooltipDirective, TooltipContentComponent, LocalizedMessagesDirective]; } }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(PopoverModule, [{
        type: NgModule,
        args: [{
                declarations: [
                    ...DIRECTIVES,
                    PopoverComponent
                ],
                entryComponents: [PopoverComponent],
                exports: [...DIRECTIVES, PopoverComponent],
                imports: [
                    CommonModule,
                    PopupModule
                ]
            }]
    }], null, null); })();
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(PopoverModule, { declarations: function () { return [PopoverActionsTemplateDirective, PopoverBodyTemplateDirective, PopoverTitleTemplateDirective, PopoverAnchorDirective, PopoverContainerDirective, PopoverComponent]; }, imports: function () { return [CommonModule,
        PopupModule]; }, exports: function () { return [PopoverActionsTemplateDirective, PopoverBodyTemplateDirective, PopoverTitleTemplateDirective, PopoverAnchorDirective, PopoverContainerDirective, PopoverComponent]; } }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(TooltipsModule, [{
        type: NgModule,
        args: [{
                exports: [TooltipModule, PopoverModule]
            }]
    }], null, null); })();
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(TooltipsModule, { exports: [TooltipModule, PopoverModule] }); })();

// Tooltip

/**
 * Generated bundle index. Do not edit.
 */

export { LocalizedMessagesDirective, PopoverDirectivesBase, PopoverService, TooltipContentComponent, TooltipDirective, TooltipSettings, TOOLTIP_SETTINGS, PopoverComponent, PopoverContainerDirective, PopoverAnchorDirective, PopoverTitleTemplateDirective, PopoverBodyTemplateDirective, PopoverActionsTemplateDirective, PopoverShowEvent, PopoverShownEvent, PopoverHideEvent, PopoverHiddenEvent, TooltipModule, PopoverModule, TooltipsModule };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzt1SkFHb0I7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7cUpBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBNENHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzttakJBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFLRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O3lLQUFFO0FBQ0YsNENBSUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztzS0FBRTtBQUNGLDJDQUlHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7K0tBQUU7QUFDRiw4Q0FJRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztpSEFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBMkNHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O3VKQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7b0pBQUU7QUFDRiw2QkFFRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OzRUQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3Q0FNRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O2tSQUFFO0FBQ0YscUNBTUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztrREFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0VBVUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztnSEFRa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O2NBY2tCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7K0pBS21CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyIvKiotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuKiBDb3B5cmlnaHQgwqkgMjAyMSBQcm9ncmVzcyBTb2Z0d2FyZSBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiogTGljZW5zZWQgdW5kZXIgY29tbWVyY2lhbCBsaWNlbnNlLiBTZWUgTElDRU5TRS5tZCBpbiB0aGUgcHJvamVjdCByb290IGZvciBtb3JlIGluZm9ybWF0aW9uXG4qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5pbXBvcnQgeyBfX2RlY29yYXRlLCBfX21ldGFkYXRhLCBfX3BhcmFtIH0gZnJvbSAndHNsaWInO1xuaW1wb3J0IHsgSW5qZWN0aW9uVG9rZW4sIEluamVjdGFibGUsIEV2ZW50RW1pdHRlciwgSG9zdEJpbmRpbmcsIE91dHB1dCwgSW5wdXQsIFRlbXBsYXRlUmVmLCBFbGVtZW50UmVmLCBDb21wb25lbnQsIGlzRGV2TW9kZSwgRGlyZWN0aXZlLCBPcHRpb25hbCwgSW5qZWN0LCBOZ1pvbmUsIFJlbmRlcmVyMiwgQ29udGVudENoaWxkLCBmb3J3YXJkUmVmLCBOZ01vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgZmlsdGVyLCBkZWJvdW5jZVRpbWUsIHRha2UsIGF1ZGl0VGltZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IGZyb21FdmVudCwgU3Vic2NyaXB0aW9uLCBCZWhhdmlvclN1YmplY3QsIFN1YmplY3QsIGNvbWJpbmVMYXRlc3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFBvcHVwU2VydmljZSwgUG9wdXBNb2R1bGUgfSBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tYW5ndWxhci1wb3B1cCc7XG5pbXBvcnQgeyB2YWxpZGF0ZVBhY2thZ2UgfSBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tbGljZW5zaW5nJztcbmltcG9ydCB7IExvY2FsaXphdGlvblNlcnZpY2UsIEwxME5fUFJFRklYLCBDb21wb25lbnRNZXNzYWdlcyB9IGZyb20gJ0Bwcm9ncmVzcy9rZW5kby1hbmd1bGFyLWwxMG4nO1xuaW1wb3J0IHsgUHJldmVudGFibGVFdmVudCwgaXNEb2N1bWVudEF2YWlsYWJsZSwgY2xvc2VzdCwgaGFzT2JzZXJ2ZXJzIH0gZnJvbSAnQHByb2dyZXNzL2tlbmRvLWFuZ3VsYXItY29tbW9uJztcbmltcG9ydCB7IENvbW1vbk1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5cbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBwYWNrYWdlTWV0YWRhdGEgPSB7XG4gICAgbmFtZTogJ0Bwcm9ncmVzcy9rZW5kby1hbmd1bGFyLXRvb2x0aXAnLFxuICAgIHByb2R1Y3ROYW1lOiAnS2VuZG8gVUkgZm9yIEFuZ3VsYXInLFxuICAgIHByb2R1Y3RDb2RlczogWydLRU5ET1VJQU5HVUxBUicsICdLRU5ET1VJQ09NUExFVEUnXSxcbiAgICBwdWJsaXNoRGF0ZTogMTY0NjIxOTk3MSxcbiAgICB2ZXJzaW9uOiAnJyxcbiAgICBsaWNlbnNpbmdEb2NzVXJsOiAnaHR0cHM6Ly93d3cudGVsZXJpay5jb20va2VuZG8tYW5ndWxhci11aS9teS1saWNlbnNlLz91dG1fbWVkaXVtPXByb2R1Y3QmdXRtX3NvdXJjZT1rZW5kb2FuZ3VsYXImdXRtX2NhbXBhaWduPWtlbmRvLXVpLWFuZ3VsYXItcHVyY2hhc2UtbGljZW5zZS1rZXlzLXdhcm5pbmcnXG59O1xuXG4vKipcbiAqIE9ic29sZXRlLiBQcm92aWRlIHRoZSBUb29sdGlwU2V0dGluZ3MgY2xhc3MgaW5zdGVhZC5cbiAqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IFRPT0xUSVBfU0VUVElOR1MgPSBuZXcgSW5qZWN0aW9uVG9rZW4oJ2tlbmRvLXVpLXRvb2x0aXAtc2V0dGluZ3MnKTtcbi8qKlxuICogUHJvdmlkZXMgYSBnbG9iYWwgY29uZmlndXJhdGlvbiBmb3IgdGhlIEtlbmRvIFVJIFRvb2x0aXAuIE9uY2UgaW5qZWN0ZWQgdGhyb3VnaFxuICogdGhlIGBBcHBDb21wb25lbnRgIGNvbnN0cnVjdG9yLCB0aGUgY29uZmlndXJhdGlvbiBwcm9wZXJ0aWVzIGNhbiBiZSBvdmVycmlkZGVuLlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGB0cy1uby1ydW5cbiAqIGltcG9ydCB7IFRvb2x0aXBTZXR0aW5ncyB9IGZyb20gJ0Bwcm9ncmVzcy9rZW5kby1hbmd1bGFyLXRvb2x0aXAnO1xuICpcbiAqIF9AQ29tcG9uZW50KHtcbiAqICAgIHNlbGVjdG9yOiAnbXktYXBwJyxcbiAqICAgIHRlbXBsYXRlOiBgXG4gKiAgICAgIDxkaXYga2VuZG9Ub29sdGlwPlxuICogICAgICAgICAgPGJ1dHRvbiB0aXRsZT1cIlNhdmVzIHRoZSBjdXJyZW50IGRvY3VtZW50XCI+U2F2ZTwvYnV0dG9uPlxuICogICAgICA8L2Rpdj5gLFxuICogICAgcHJvdmlkZXJzOiBbe1xuICogICAgICAgIHByb3ZpZGU6IFRvb2x0aXBTZXR0aW5ncyxcbiAqICAgICAgICB1c2VGYWN0b3J5OiAoKTogVG9vbHRpcFNldHRpbmdzID0+ICh7XG4gKiAgICAgICAgICAvLyBPdmVycmlkZSBkZWZhdWx0IHZhbHVlcyBvZiB0b29sdGlwcyBpZiB3YW50ZWRcbiAqICAgICAgICAgIHBvc2l0aW9uOiAncmlnaHQnXG4gKiAgICAgICAgfSlcbiAqICAgIH1dXG4gKiB9KVxuICogZXhwb3J0IGNsYXNzIEFwcENvbXBvbmVudCB7IH1cbiAqIGBgYFxuICovXG5sZXQgVG9vbHRpcFNldHRpbmdzID0gY2xhc3MgVG9vbHRpcFNldHRpbmdzIHtcbn07XG5Ub29sdGlwU2V0dGluZ3MgPSBfX2RlY29yYXRlKFtcbiAgICBJbmplY3RhYmxlKClcbl0sIFRvb2x0aXBTZXR0aW5ncyk7XG5cbi8qKlxuICogQGhpZGRlblxuICovXG5mdW5jdGlvbiBhbGlnbihwb3NpdGlvbiwgb2Zmc2V0KSB7XG4gICAgbGV0IGFuY2hvckFsaWduID0ge307XG4gICAgbGV0IHBvcHVwQWxpZ24gPSB7fTtcbiAgICBsZXQgcG9wdXBNYXJnaW4gPSB7fTtcbiAgICBzd2l0Y2ggKHBvc2l0aW9uKSB7XG4gICAgICAgIGNhc2UgJ3RvcCc6XG4gICAgICAgICAgICBhbmNob3JBbGlnbiA9IHsgaG9yaXpvbnRhbDogJ2NlbnRlcicsIHZlcnRpY2FsOiAndG9wJyB9O1xuICAgICAgICAgICAgcG9wdXBBbGlnbiA9IHsgaG9yaXpvbnRhbDogJ2NlbnRlcicsIHZlcnRpY2FsOiAnYm90dG9tJyB9O1xuICAgICAgICAgICAgcG9wdXBNYXJnaW4gPSB7IGhvcml6b250YWw6IDAsIHZlcnRpY2FsOiBvZmZzZXQgfTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdib3R0b20nOlxuICAgICAgICAgICAgYW5jaG9yQWxpZ24gPSB7IGhvcml6b250YWw6ICdjZW50ZXInLCB2ZXJ0aWNhbDogJ2JvdHRvbScgfTtcbiAgICAgICAgICAgIHBvcHVwQWxpZ24gPSB7IGhvcml6b250YWw6ICdjZW50ZXInLCB2ZXJ0aWNhbDogJ3RvcCcgfTtcbiAgICAgICAgICAgIHBvcHVwTWFyZ2luID0geyBob3Jpem9udGFsOiAwLCB2ZXJ0aWNhbDogb2Zmc2V0IH07XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAncmlnaHQnOlxuICAgICAgICAgICAgYW5jaG9yQWxpZ24gPSB7IGhvcml6b250YWw6ICdyaWdodCcsIHZlcnRpY2FsOiAnY2VudGVyJyB9O1xuICAgICAgICAgICAgcG9wdXBBbGlnbiA9IHsgaG9yaXpvbnRhbDogJ2xlZnQnLCB2ZXJ0aWNhbDogJ2NlbnRlcicgfTtcbiAgICAgICAgICAgIHBvcHVwTWFyZ2luID0geyBob3Jpem9udGFsOiBvZmZzZXQsIHZlcnRpY2FsOiAwIH07XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnbGVmdCc6XG4gICAgICAgICAgICBhbmNob3JBbGlnbiA9IHsgaG9yaXpvbnRhbDogJ2xlZnQnLCB2ZXJ0aWNhbDogJ2NlbnRlcicgfTtcbiAgICAgICAgICAgIHBvcHVwQWxpZ24gPSB7IGhvcml6b250YWw6ICdyaWdodCcsIHZlcnRpY2FsOiAnY2VudGVyJyB9O1xuICAgICAgICAgICAgcG9wdXBNYXJnaW4gPSB7IGhvcml6b250YWw6IG9mZnNldCwgdmVydGljYWw6IDAgfTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OiBicmVhaztcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgYW5jaG9yQWxpZ24sXG4gICAgICAgIHBvcHVwQWxpZ24sXG4gICAgICAgIHBvcHVwTWFyZ2luXG4gICAgfTtcbn1cbi8qKlxuICogQGhpZGRlblxuICovXG5mdW5jdGlvbiBjb2xsaXNpb24oaW5wdXRjb2xsaXNpb24sIHBvc2l0aW9uKSB7XG4gICAgaWYgKGlucHV0Y29sbGlzaW9uKSB7XG4gICAgICAgIHJldHVybiBpbnB1dGNvbGxpc2lvbjtcbiAgICB9XG4gICAgaWYgKHBvc2l0aW9uID09PSAndG9wJyB8fCBwb3NpdGlvbiA9PT0gJ2JvdHRvbScpIHtcbiAgICAgICAgcmV0dXJuIHsgaG9yaXpvbnRhbDogJ2ZpdCcsIHZlcnRpY2FsOiAnZmxpcCcgfTtcbiAgICB9XG4gICAgcmV0dXJuIHsgaG9yaXpvbnRhbDogJ2ZsaXAnLCB2ZXJ0aWNhbDogJ2ZpdCcgfTtcbn1cbmZ1bmN0aW9uIGlzRG9jdW1lbnROb2RlKGNvbnRhaW5lcikge1xuICAgIHJldHVybiBjb250YWluZXIubm9kZVR5cGUgPT09IDk7XG59XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuZnVuY3Rpb24gY2xvc2VzdEJ5U2VsZWN0b3IoZWxlbWVudCwgc2VsZWN0b3IpIHtcbiAgICBpZiAoZWxlbWVudC5jbG9zZXN0KSB7XG4gICAgICAgIHJldHVybiBlbGVtZW50LmNsb3Nlc3Qoc2VsZWN0b3IpO1xuICAgIH1cbiAgICBjb25zdCBtYXRjaGVzID0gRWxlbWVudC5wcm90b3R5cGUubWF0Y2hlcyA/XG4gICAgICAgIChlbCwgc2VsKSA9PiBlbC5tYXRjaGVzKHNlbClcbiAgICAgICAgOiAoZWwsIHNlbCkgPT4gZWwubXNNYXRjaGVzU2VsZWN0b3Ioc2VsKTtcbiAgICBsZXQgbm9kZSA9IGVsZW1lbnQ7XG4gICAgd2hpbGUgKG5vZGUgJiYgIWlzRG9jdW1lbnROb2RlKG5vZGUpKSB7XG4gICAgICAgIGlmIChtYXRjaGVzKG5vZGUsIHNlbGVjdG9yKSkge1xuICAgICAgICAgICAgcmV0dXJuIG5vZGU7XG4gICAgICAgIH1cbiAgICAgICAgbm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcbiAgICB9XG59XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuZnVuY3Rpb24gY29udGFpbnMoY29udGFpbmVyLCBjaGlsZCkge1xuICAgIGlmICghY29udGFpbmVyKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKGlzRG9jdW1lbnROb2RlKGNvbnRhaW5lcikpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoY29udGFpbmVyLmNvbnRhaW5zKSB7XG4gICAgICAgIHJldHVybiBjb250YWluZXIuY29udGFpbnMoY2hpbGQpO1xuICAgIH1cbiAgICBpZiAoY29udGFpbmVyLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKSB7XG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZVxuICAgICAgICByZXR1cm4gISEoY29udGFpbmVyLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGNoaWxkKSAmIE5vZGUuRE9DVU1FTlRfUE9TSVRJT05fQ09OVEFJTkVEX0JZKTtcbiAgICB9XG59XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgaGFzUGFyZW50ID0gKG5vZGUsIHBhcmVudCkgPT4ge1xuICAgIHdoaWxlIChub2RlICYmIG5vZGUgIT09IHBhcmVudCkge1xuICAgICAgICBub2RlID0gbm9kZS5wYXJlbnROb2RlO1xuICAgIH1cbiAgICByZXR1cm4gbm9kZTtcbn07XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuZnVuY3Rpb24gZ2V0Q2VudGVyT2Zmc2V0KGl0ZW0sIGRpciwgc2l6ZSkge1xuICAgIGNvbnN0IHJlY3QgPSBpdGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHJldHVybiByZWN0W2Rpcl0gKyAocmVjdFtzaXplXSAvIDIpO1xufVxuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmZ1bmN0aW9uIGNvbnRhaW5zSXRlbShjb2xsZWN0aW9uLCBpdGVtKSB7XG4gICAgcmV0dXJuIGNvbGxlY3Rpb24uaW5kZXhPZihpdGVtKSAhPT0gLTE7XG59XG5cbi8qKlxuICogQGhpZGRlblxuICovXG5sZXQgVG9vbHRpcENvbnRlbnRDb21wb25lbnQgPSBjbGFzcyBUb29sdGlwQ29udGVudENvbXBvbmVudCB7XG4gICAgY29uc3RydWN0b3IoY29udGVudCwgbG9jYWxpemF0aW9uU2VydmljZSkge1xuICAgICAgICB0aGlzLmNvbnRlbnQgPSBjb250ZW50O1xuICAgICAgICB0aGlzLmxvY2FsaXphdGlvblNlcnZpY2UgPSBsb2NhbGl6YXRpb25TZXJ2aWNlO1xuICAgICAgICB0aGlzLmNsb3NlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLnRvb2x0aXBXaWR0aCA9IG51bGw7XG4gICAgICAgIHRoaXMudG9vbHRpcEhlaWdodCA9IG51bGw7XG4gICAgICAgIHRoaXMuY2FsbG91dCA9IHRydWU7XG4gICAgICAgIHRoaXMuY2FsbG91dFN0eWxlcyA9IChwb3NpdGlvbiwgY2FsbG91dFNpemUsIGlzRmxpcCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc3R5bGVzID0ge307XG4gICAgICAgICAgICBjb25zdCBpc1ZlcnRpY2FsID0gcG9zaXRpb24gPT09ICd0b3AnIHx8IHBvc2l0aW9uID09PSAnYm90dG9tJztcbiAgICAgICAgICAgIGNvbnN0IGZsaXBEZWcgPSAnMTgwZGVnJztcbiAgICAgICAgICAgIGNvbnN0IHplcm9EZWcgPSAnMGRlZyc7XG4gICAgICAgICAgICBpZiAoIWlzRmxpcCkge1xuICAgICAgICAgICAgICAgIHN0eWxlcy50cmFuc2Zvcm0gPSBpc1ZlcnRpY2FsID8gYHJvdGF0ZVgoJHt6ZXJvRGVnfSlgIDogYHJvdGF0ZVkoJHt6ZXJvRGVnfSlgO1xuICAgICAgICAgICAgICAgIHJldHVybiBzdHlsZXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocG9zaXRpb24gPT09ICd0b3AnKSB7XG4gICAgICAgICAgICAgICAgc3R5bGVzLmJvdHRvbSA9ICd1bnNldCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwb3NpdGlvbiA9PT0gJ2JvdHRvbScpIHtcbiAgICAgICAgICAgICAgICBzdHlsZXMudG9wID0gJ3Vuc2V0JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHBvc2l0aW9uID09PSAnbGVmdCcpIHtcbiAgICAgICAgICAgICAgICBzdHlsZXMucmlnaHQgPSAndW5zZXQnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocG9zaXRpb24gPT09ICdyaWdodCcpIHtcbiAgICAgICAgICAgICAgICBzdHlsZXMubGVmdCA9ICd1bnNldCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzdHlsZXNbcG9zaXRpb25dID0gYCR7LWNhbGxvdXRTaXplfXB4YDtcbiAgICAgICAgICAgIHN0eWxlcy50cmFuc2Zvcm0gPSBpc1ZlcnRpY2FsID8gYHJvdGF0ZVgoJHtmbGlwRGVnfSlgIDogYHJvdGF0ZVkoJHtmbGlwRGVnfSlgO1xuICAgICAgICAgICAgcmV0dXJuIHN0eWxlcztcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBsb2NhbGl6YXRpb25TZXJ2aWNlLnJ0bCA/ICdydGwnIDogJ2x0cic7XG4gICAgfVxuICAgIGdldCBjc3NDbGFzc2VzKCkge1xuICAgICAgICByZXR1cm4gJ2std2lkZ2V0IGstdG9vbHRpcCc7XG4gICAgfVxuICAgIGdldCBjbGFzc05hbWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNsb3NhYmxlO1xuICAgIH1cbiAgICBnZXQgY3NzUG9zaXRpb24oKSB7XG4gICAgICAgIHJldHVybiAncmVsYXRpdmUnO1xuICAgIH1cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5keW5hbWljUlRMU3Vic2NyaXB0aW9uID0gdGhpcy5sb2NhbGl6YXRpb25TZXJ2aWNlLmNoYW5nZXNcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKHsgcnRsIH0pID0+IHRoaXMuZGlyZWN0aW9uID0gcnRsID8gJ3J0bCcgOiAnbHRyJyk7XG4gICAgfVxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICBpZiAodGhpcy5keW5hbWljUlRMU3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLmR5bmFtaWNSVExTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgY2xvc2VCdXR0b25UaXRsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvc2VUaXRsZSB8fCB0aGlzLmxvY2FsaXphdGlvblNlcnZpY2UuZ2V0KCdjbG9zZVRpdGxlJyk7XG4gICAgfVxuICAgIGNhbGxvdXRQb3NpdGlvbkNsYXNzKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgJ3RvcCc6ICdrLWNhbGxvdXQtcycsXG4gICAgICAgICAgICAnbGVmdCc6ICdrLWNhbGxvdXQtZScsXG4gICAgICAgICAgICAnYm90dG9tJzogJ2stY2FsbG91dC1uJyxcbiAgICAgICAgICAgICdyaWdodCc6ICdrLWNhbGxvdXQtdydcbiAgICAgICAgfVt0aGlzLnBvc2l0aW9uXTtcbiAgICB9XG4gICAgb25DbG9zZUNsaWNrKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHRoaXMuY2xvc2UuZW1pdCgpO1xuICAgIH1cbiAgICB1cGRhdGVDYWxsb3V0UG9zaXRpb24ocG9zaXRpb24sIGlzRmxpcCkge1xuICAgICAgICBpZiAoIXRoaXMuY2FsbG91dCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNhbGxvdXQgPSB0aGlzLmNvbnRlbnQubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuay1jYWxsb3V0Jyk7XG4gICAgICAgIGNvbnN0IGlzVmVydGljYWwgPSBwb3NpdGlvbiA9PT0gJ3RvcCcgfHwgcG9zaXRpb24gPT09ICdib3R0b20nO1xuICAgICAgICBjb25zdCBzaXplID0gaXNWZXJ0aWNhbCA/ICd3aWR0aCcgOiAnaGVpZ2h0JztcbiAgICAgICAgY29uc3QgZGlyID0gaXNWZXJ0aWNhbCA/ICdsZWZ0JyA6ICd0b3AnO1xuICAgICAgICBjb25zdCBvZmZzZXRQcm9wZXJ0eSA9IGlzVmVydGljYWwgPyAnbWFyZ2luTGVmdCcgOiAnbWFyZ2luVG9wJztcbiAgICAgICAgY29uc3QgY2FsbG91dFNpemUgPSBjYWxsb3V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpW3NpemVdO1xuICAgICAgICBjb25zdCBhbmNob3JDZW50ZXIgPSBnZXRDZW50ZXJPZmZzZXQodGhpcy5hbmNob3IubmF0aXZlRWxlbWVudCwgZGlyLCBzaXplKTtcbiAgICAgICAgY29uc3QgY29udGVudENlbnRlciA9IGdldENlbnRlck9mZnNldCh0aGlzLmNvbnRlbnQubmF0aXZlRWxlbWVudCwgZGlyLCBzaXplKTtcbiAgICAgICAgY29uc3QgZGlmZiA9IE1hdGguYWJzKGNvbnRlbnRDZW50ZXIgLSBhbmNob3JDZW50ZXIpO1xuICAgICAgICBpZiAoZGlmZiA+IDEgfHwgZGlmZiA9PT0gMCB8fCBNYXRoLnJvdW5kKGRpZmYpID09PSAwKSB7XG4gICAgICAgICAgICBjb25zdCBuZXdNYXJnaW4gPSBjb250ZW50Q2VudGVyIC0gYW5jaG9yQ2VudGVyICsgKGNhbGxvdXRTaXplIC8gMik7XG4gICAgICAgICAgICBjYWxsb3V0LnN0eWxlW29mZnNldFByb3BlcnR5XSA9IGAkey1uZXdNYXJnaW59cHhgO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNhbGxvdXRTdHlsZXMgPSB0aGlzLmNhbGxvdXRTdHlsZXMocG9zaXRpb24sIGNhbGxvdXRTaXplLCBpc0ZsaXApO1xuICAgICAgICBPYmplY3Qua2V5cyhjYWxsb3V0U3R5bGVzKS5mb3JFYWNoKChzdHlsZSkgPT4ge1xuICAgICAgICAgICAgY2FsbG91dC5zdHlsZVtzdHlsZV0gPSBjYWxsb3V0U3R5bGVzW3N0eWxlXTtcbiAgICAgICAgfSk7XG4gICAgfVxufTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdhdHRyLmRpcicpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpXG5dLCBUb29sdGlwQ29udGVudENvbXBvbmVudC5wcm90b3R5cGUsIFwiZGlyZWN0aW9uXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBPdXRwdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgRXZlbnRFbWl0dGVyKVxuXSwgVG9vbHRpcENvbnRlbnRDb21wb25lbnQucHJvdG90eXBlLCBcImNsb3NlXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBIb3N0QmluZGluZygnY2xhc3MnKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW10pXG5dLCBUb29sdGlwQ29udGVudENvbXBvbmVudC5wcm90b3R5cGUsIFwiY3NzQ2xhc3Nlc1wiLCBudWxsKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdjbGFzcy5rLXRvb2x0aXAtY2xvc2FibGUnKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgQm9vbGVhbiksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtdKVxuXSwgVG9vbHRpcENvbnRlbnRDb21wb25lbnQucHJvdG90eXBlLCBcImNsYXNzTmFtZVwiLCBudWxsKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdzdHlsZS5wb3NpdGlvbicpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbXSlcbl0sIFRvb2x0aXBDb250ZW50Q29tcG9uZW50LnByb3RvdHlwZSwgXCJjc3NQb3NpdGlvblwiLCBudWxsKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdzdHlsZS53aWR0aC5weCcpLFxuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE51bWJlcilcbl0sIFRvb2x0aXBDb250ZW50Q29tcG9uZW50LnByb3RvdHlwZSwgXCJ0b29sdGlwV2lkdGhcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdzdHlsZS5oZWlnaHQucHgnKSxcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBOdW1iZXIpXG5dLCBUb29sdGlwQ29udGVudENvbXBvbmVudC5wcm90b3R5cGUsIFwidG9vbHRpcEhlaWdodFwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgVGVtcGxhdGVSZWYpXG5dLCBUb29sdGlwQ29udGVudENvbXBvbmVudC5wcm90b3R5cGUsIFwidGl0bGVUZW1wbGF0ZVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgRWxlbWVudFJlZilcbl0sIFRvb2x0aXBDb250ZW50Q29tcG9uZW50LnByb3RvdHlwZSwgXCJhbmNob3JcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEJvb2xlYW4pXG5dLCBUb29sdGlwQ29udGVudENvbXBvbmVudC5wcm90b3R5cGUsIFwiY2xvc2FibGVcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFRlbXBsYXRlUmVmKVxuXSwgVG9vbHRpcENvbnRlbnRDb21wb25lbnQucHJvdG90eXBlLCBcInRlbXBsYXRlUmVmXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpXG5dLCBUb29sdGlwQ29udGVudENvbXBvbmVudC5wcm90b3R5cGUsIFwidGVtcGxhdGVTdHJpbmdcIiwgdm9pZCAwKTtcblRvb2x0aXBDb250ZW50Q29tcG9uZW50ID0gX19kZWNvcmF0ZShbXG4gICAgQ29tcG9uZW50KHtcbiAgICAgICAgc2VsZWN0b3I6ICdrZW5kby10b29sdGlwJyxcbiAgICAgICAgdGVtcGxhdGU6IGBcbiAgICAgICAgPG5nLWNvbnRhaW5lciBrZW5kb1Rvb2x0aXBMb2NhbGl6ZWRNZXNzYWdlc1xuICAgICAgICAgICAgaTE4bi1jbG9zZVRpdGxlPVwia2VuZG8udG9vbHRpcC5jbG9zZVRpdGxlfFRoZSB0aXRsZSBvZiB0aGUgY2xvc2UgYnV0dG9uXCJcbiAgICAgICAgICAgIGNsb3NlVGl0bGU9XCJDbG9zZVwiXG4gICAgICAgID5cbiAgICAgICAgPC9uZy1jb250YWluZXI+XG5cbiAgICAgICAgPGRpdiBjbGFzcz1cImstdG9vbHRpcC1jb250ZW50XCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiay10b29sdGlwLXRpdGxlXCIgKm5nSWY9XCJ0aXRsZVRlbXBsYXRlXCI+XG4gICAgICAgICAgICAgICAgPG5nLXRlbXBsYXRlXG4gICAgICAgICAgICAgICAgICAgIFtuZ0lmXT1cInRpdGxlVGVtcGxhdGVcIlxuICAgICAgICAgICAgICAgICAgICBbbmdUZW1wbGF0ZU91dGxldF09XCJ0aXRsZVRlbXBsYXRlXCJcbiAgICAgICAgICAgICAgICAgICAgW25nVGVtcGxhdGVPdXRsZXRDb250ZXh0XT1cInsgJGltcGxpY2l0OiBhbmNob3IsIGFuY2hvcjogYW5jaG9yIH1cIj5cbiAgICAgICAgICAgICAgICA8L25nLXRlbXBsYXRlPlxuICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgIDxuZy10ZW1wbGF0ZVxuICAgICAgICAgICAgICAgIFtuZ0lmXT1cInRlbXBsYXRlUmVmXCJcbiAgICAgICAgICAgICAgICBbbmdUZW1wbGF0ZU91dGxldF09XCJ0ZW1wbGF0ZVJlZlwiXG4gICAgICAgICAgICAgICAgW25nVGVtcGxhdGVPdXRsZXRDb250ZXh0XT1cInsgJGltcGxpY2l0OiBhbmNob3IsIGFuY2hvcjogYW5jaG9yIH1cIj5cbiAgICAgICAgICAgIDwvbmctdGVtcGxhdGU+XG4gICAgICAgICAgICA8bmctdGVtcGxhdGVcbiAgICAgICAgICAgICAgICBbbmdJZl09XCJ0ZW1wbGF0ZVN0cmluZ1wiPlxuICAgICAgICAgICAgICAgIHt7IHRlbXBsYXRlU3RyaW5nIH19XG4gICAgICAgICAgICA8L25nLXRlbXBsYXRlPlxuICAgICAgICA8L2Rpdj5cblxuICAgICAgICA8ZGl2ICpuZ0lmPVwiY2xvc2FibGVcIiBjbGFzcz1cImstdG9vbHRpcC1idXR0b25cIiAoY2xpY2spPVwib25DbG9zZUNsaWNrKCRldmVudClcIj5cbiAgICAgICAgICAgIDxhIGhyZWY9XCIjXCIgY2xhc3M9XCJrLWljb24gay1pLWNsb3NlXCIgW2F0dHIudGl0bGVdPVwiY2xvc2VCdXR0b25UaXRsZVwiPjwvYT5cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgPGRpdiBjbGFzcz1cImstY2FsbG91dFwiICpuZ0lmPVwiY2FsbG91dFwiIFtuZ0NsYXNzXT1cImNhbGxvdXRQb3NpdGlvbkNsYXNzKClcIj48L2Rpdj5cbiAgICBgLFxuICAgICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgICAgIExvY2FsaXphdGlvblNlcnZpY2UsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcHJvdmlkZTogTDEwTl9QUkVGSVgsXG4gICAgICAgICAgICAgICAgdXNlVmFsdWU6ICdrZW5kby50b29sdGlwJ1xuICAgICAgICAgICAgfVxuICAgICAgICBdXG4gICAgfSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtFbGVtZW50UmVmLFxuICAgICAgICBMb2NhbGl6YXRpb25TZXJ2aWNlXSlcbl0sIFRvb2x0aXBDb250ZW50Q29tcG9uZW50KTtcblxuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBbS2VuZG8gVUkgVG9vbHRpcCBkaXJlY3RpdmUgZm9yIEFuZ3VsYXJdKHslIHNsdWcgb3ZlcnZpZXdfdG9vbHRpcCAlfSkuXG4gKiBVc2VkIHRvIGRpc3BsYXkgYWRkaXRpb25hbCBpbmZvcm1hdGlvbiB0aGF0IGlzIHJlbGF0ZWQgdG8gYW4gZWxlbWVudC5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgdHMtbm8tcnVuXG4gKiA8ZGl2IGtlbmRvVG9vbHRpcD5cbiAqICAgIDxhIHRpdGxlPVwiVG9vbHRpcCB0aXRsZVwiIGhyZWY9XCJmb29cIj5mb288L2E+XG4gKiA8L2Rpdj5cbiAqIGBgYFxuICovXG5sZXQgVG9vbHRpcERpcmVjdGl2ZSA9IGNsYXNzIFRvb2x0aXBEaXJlY3RpdmUge1xuICAgIGNvbnN0cnVjdG9yKHRvb2x0aXBXcmFwcGVyLCBuZ1pvbmUsIHJlbmRlcmVyLCBwb3B1cFNlcnZpY2UsIHNldHRpbmdzLCBsZWdhY3lTZXR0aW5ncykge1xuICAgICAgICB0aGlzLnRvb2x0aXBXcmFwcGVyID0gdG9vbHRpcFdyYXBwZXI7XG4gICAgICAgIHRoaXMubmdab25lID0gbmdab25lO1xuICAgICAgICB0aGlzLnJlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgICAgIHRoaXMucG9wdXBTZXJ2aWNlID0gcG9wdXBTZXJ2aWNlO1xuICAgICAgICAvKipcbiAgICAgICAgICogU3BlY2lmaWVzIGEgc2VsZWN0b3IgZm9yIGVsZW1lbnRzIHdpdGhpbiBhIGNvbnRhaW5lciB3aGljaCB3aWxsIGRpc3BsYXkgYSB0b29sdGlwXG4gICAgICAgICAqIChbc2VlIGV4YW1wbGVdKHslIHNsdWcgYW5jaG9yZWxlbWVudHNfdG9vbHRpcCAlfSkpLiBUaGUgcG9zc2libGUgdmFsdWVzIGluY2x1ZGUgYW55XG4gICAgICAgICAqIERPTSBgc2VsZWN0b3JgLiBUaGUgZGVmYXVsdCB2YWx1ZSBpcyBgW3RpdGxlXWAuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmZpbHRlciA9ICdbdGl0bGVdJztcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNwZWNpZmllcyB0aGUgcG9zaXRpb24gb2YgdGhlIFRvb2x0aXAgdGhhdCBpcyByZWxhdGl2ZSB0byB0aGVcbiAgICAgICAgICogYW5jaG9yIGVsZW1lbnQgKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBwb3NpdGlvbmluZ190b29sdGlwICV9KSkuXG4gICAgICAgICAqXG4gICAgICAgICAqIFRoZSBwb3NzaWJsZSB2YWx1ZXMgYXJlOlxuICAgICAgICAgKiAqIGB0b3BgIChkZWZhdWx0KVxuICAgICAgICAgKiAqIGBib3R0b21gXG4gICAgICAgICAqICogYGxlZnRgXG4gICAgICAgICAqICogYHJpZ2h0YFxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9ICd0b3AnO1xuICAgICAgICAvKipcbiAgICAgICAgICogU3BlY2lmaWVzIHRoZSBkZWxheSBpbiBtaWxsaXNlY29uZHMgYmVmb3JlIHRoZSBUb29sdGlwIGlzIHNob3duLlxuICAgICAgICAgKiAqIGAxMDBgIChkZWZhdWx0KSBtaWxsaXNlY29uZHMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNob3dBZnRlciA9IDEwMDtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNwZWNpZmllcyBpZiB0aGUg0KJvb2x0aXAgd2lsbCBkaXNwbGF5IGEgY2FsbG91dCBhcnJvdy5cbiAgICAgICAgICpcbiAgICAgICAgICogVGhlIHBvc3NpYmxlIHZhbHVlcyBhcmU6XG4gICAgICAgICAqICogYHRydWVgIChkZWZhdWx0KVxuICAgICAgICAgKiAqIGBmYWxzZWBcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY2FsbG91dCA9IHRydWU7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTcGVjaWZpZXMgaWYgdGhlINCib29sdGlwIHdpbGwgZGlzcGxheSBhICoqQ2xvc2UqKiBidXR0b25cbiAgICAgICAgICogKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBjbG9zYWJsZV90b29sdGlwICV9KSkuXG4gICAgICAgICAqXG4gICAgICAgICAqIFRoZSBwb3NzaWJsZSB2YWx1ZXMgYXJlOlxuICAgICAgICAgKiAqIGB0cnVlYFxuICAgICAgICAgKiAqIGBmYWxzZWBcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY2xvc2FibGUgPSBmYWxzZTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNwZWNpZmllcyB0aGUgb2Zmc2V0IGluIHBpeGVscyBiZXR3ZWVuIHRoZSBUb29sdGlwIGFuZCB0aGUgYW5jaG9yLiBEZWZhdWx0cyB0byBgNmAgcGl4ZWxzLlxuICAgICAgICAgKiBJZiB0aGUgYGNhbGxvdXRgIHByb3BlcnR5IGlzIHNldCB0byBgdHJ1ZWAsIHRoZSBvZmZzZXQgaXMgcmVuZGVyZWQgZnJvbSB0aGUgY2FsbG91dCBhcnJvdy5cbiAgICAgICAgICogSWYgdGhlIGBjYWxsb3V0YCBwcm9wZXJ0eSBpcyBzZXQgdG8gYGZhbHNlYCwgdGhlIG9mZnNldCBpcyByZW5kZXJlZCBmcm9tIHRoZSBjb250ZW50IG9mIHRoZSBUb29sdGlwLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5vZmZzZXQgPSA2O1xuICAgICAgICB0aGlzLmFuY2hvciA9IG51bGw7XG4gICAgICAgIHRoaXMudmFsaWRQb3NpdGlvbnMgPSBbJ3RvcCcsICdib3R0b20nLCAncmlnaHQnLCAnbGVmdCddO1xuICAgICAgICB0aGlzLnZhbGlkU2hvd09wdGlvbnMgPSBbJ2hvdmVyJywgJ2NsaWNrJywgJ25vbmUnXTtcbiAgICAgICAgdmFsaWRhdGVQYWNrYWdlKHBhY2thZ2VNZXRhZGF0YSk7XG4gICAgICAgIE9iamVjdC5hc3NpZ24odGhpcywgc2V0dGluZ3MsIGxlZ2FjeVNldHRpbmdzKTtcbiAgICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgd3JhcHBlciA9IHRoaXMudG9vbHRpcFdyYXBwZXIubmF0aXZlRWxlbWVudDtcbiAgICAgICAgICAgIHRoaXMuYW5jaG9yVGl0bGVTdWJzY3JpcHRpb24gPSBmcm9tRXZlbnQod3JhcHBlciwgJ21vdXNlb3ZlcicpXG4gICAgICAgICAgICAgICAgLnBpcGUoZmlsdGVyKCgpID0+IHRoaXMuZmlsdGVyICE9PSAnJykpXG4gICAgICAgICAgICAgICAgLnN1YnNjcmliZSgoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZpbHRlckVsZW1lbnQgPSBjbG9zZXN0QnlTZWxlY3RvcihlLnRhcmdldCwgdGhpcy5maWx0ZXIpO1xuICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGlkZUVsZW1lbnRUaXRsZSh7IG5hdGl2ZUVsZW1lbnQ6IGZpbHRlckVsZW1lbnQgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLm1vdXNlT3ZlclN1YnNjcmlwdGlvbiA9IGZyb21FdmVudCh3cmFwcGVyLCAnbW91c2VvdmVyJylcbiAgICAgICAgICAgICAgICAucGlwZShkZWJvdW5jZVRpbWUoMTAwKSwgZmlsdGVyKCgpID0+IHRoaXMuZmlsdGVyICE9PSAnJykpXG4gICAgICAgICAgICAgICAgLnN1YnNjcmliZShlID0+IHRoaXMub25Nb3VzZU92ZXIoZSkpO1xuICAgICAgICAgICAgdGhpcy5tb3VzZU91dFN1YnNjcmlwdGlvbiA9IGZyb21FdmVudCh3cmFwcGVyLCAnbW91c2VvdXQnKVxuICAgICAgICAgICAgICAgIC5waXBlKGRlYm91bmNlVGltZSgxMDApKVxuICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUoZSA9PiB0aGlzLm9uTW91c2VPdXQoZSkpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgY29udGVudCBvZiB0aGUgVG9vbHRpcCBhcyBhIHRlbXBsYXRlIHJlZmVyZW5jZVxuICAgICAqIChbc2VlIGV4YW1wbGVdKHslIHNsdWcgdGVtcGxhdGVzX3Rvb2x0aXAgJX0pKS5cbiAgICAgKi9cbiAgICBzZXQgdG9vbHRpcFRlbXBsYXRlKHZhbHVlKSB7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSB2YWx1ZTtcbiAgICB9XG4gICAgZ2V0IHRvb2x0aXBUZW1wbGF0ZSgpIHsgcmV0dXJuIHRoaXMudGVtcGxhdGU7IH1cbiAgICAvKipcbiAgICAgKiBTaG93cyB0aGUgVG9vbHRpcC5cbiAgICAgKiBAcGFyYW0gYW5jaG9yJm1kYXNoOyBFbGVtZW50UmVmfEVsZW1lbnQuXG4gICAgICogU3BlY2lmaWVzIHRoZSBlbGVtZW50IHRoYXQgd2lsbCBiZSB1c2VkIGFzIGFuIGFuY2hvci4gVGhlIFRvb2x0aXAgb3BlbnMgcmVsYXRpdmUgdG8gdGhhdCBlbGVtZW50LlxuICAgICAqL1xuICAgIHNob3coYW5jaG9yKSB7XG4gICAgICAgIGlmICh0aGlzLnBvcHVwUmVmKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGFuY2hvciBpbnN0YW5jZW9mIEVsZW1lbnQpIHtcbiAgICAgICAgICAgIGFuY2hvciA9IHsgbmF0aXZlRWxlbWVudDogYW5jaG9yIH07XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hbmNob3IgPSBhbmNob3I7XG4gICAgICAgIGlmICh0aGlzLnNob3dPbiA9PT0gJ2hvdmVyJykge1xuICAgICAgICAgICAgaWYgKHRoaXMucG9wdXBSZWYpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5zaG93VGltZW91dCk7XG4gICAgICAgICAgICB0aGlzLnNob3dUaW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQoKCkgPT4gdGhpcy5zaG93Q29udGVudCh0aGlzLmFuY2hvciksIHRoaXMuc2hvd0FmdGVyKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaGlkZUVsZW1lbnRUaXRsZSh0aGlzLmFuY2hvcik7XG4gICAgICAgICAgICB0aGlzLnNob3dDb250ZW50KHRoaXMuYW5jaG9yKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBIaWRlcyB0aGUgVG9vbHRpcC5cbiAgICAgKi9cbiAgICBoaWRlKCkge1xuICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5zaG93VGltZW91dCk7XG4gICAgICAgIGNvbnN0IGFuY2hvciA9IHRoaXMuYW5jaG9yICYmIHRoaXMuYW5jaG9yLm5hdGl2ZUVsZW1lbnQ7XG4gICAgICAgIGlmIChhbmNob3IgJiYgYW5jaG9yLmdldEF0dHJpYnV0ZSgnZGF0YS10aXRsZScpKSB7XG4gICAgICAgICAgICBpZiAoIWFuY2hvci5nZXRBdHRyaWJ1dGUoJ3RpdGxlJykgJiYgYW5jaG9yLmhhc0F0dHJpYnV0ZSgndGl0bGUnKSkge1xuICAgICAgICAgICAgICAgIGFuY2hvci5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgYW5jaG9yLmdldEF0dHJpYnV0ZSgnZGF0YS10aXRsZScpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFuY2hvci5zZXRBdHRyaWJ1dGUoJ2RhdGEtdGl0bGUnLCAnJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucG9wdXBNb3VzZU91dFN1YnNjcmlwdGlvbikge1xuICAgICAgICAgICAgdGhpcy5wb3B1cE1vdXNlT3V0U3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY2xvc2VDbGlja1N1YnNjcmlwdGlvbikge1xuICAgICAgICAgICAgdGhpcy5jbG9zZUNsaWNrU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jbG9zZVBvcHVwKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRvZ2dsZSB2aXNpYmlsaXR5IG9mIHRoZSBUb29sdGlwLlxuICAgICAqXG4gICAgICogQHBhcmFtIGFuY2hvciZtZGFzaDsgRWxlbWVudFJlZnxFbGVtZW50LiBTcGVjaWZpZXMgdGhlIGVsZW1lbnQgdGhhdCB3aWxsIGJlIHVzZWQgYXMgYW4gYW5jaG9yLlxuICAgICAqIEBwYXJhbSBzaG93Jm1kYXNoOyBPcHRpb25hbC4gQm9vbGVhbi4gU3BlY2lmaWVzIGlmIHRoZSBUb29sdGlwIHdpbGwgYmUgcmVuZGVyZWQuXG4gICAgICovXG4gICAgdG9nZ2xlKGFuY2hvciwgc2hvdykge1xuICAgICAgICBjb25zdCBwcmV2aW91c0FuY2hvciA9IHRoaXMuYW5jaG9yICYmIHRoaXMuYW5jaG9yLm5hdGl2ZUVsZW1lbnQ7XG4gICAgICAgIGlmIChhbmNob3IgaW5zdGFuY2VvZiBFbGVtZW50KSB7XG4gICAgICAgICAgICBhbmNob3IgPSB7IG5hdGl2ZUVsZW1lbnQ6IGFuY2hvciB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChwcmV2aW91c0FuY2hvciAhPT0gYW5jaG9yLm5hdGl2ZUVsZW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMuaGlkZSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwcmV2aW91c0FuY2hvciA9PT0gYW5jaG9yLm5hdGl2ZUVsZW1lbnQgJiYgdGhpcy5zaG93T24gPT09ICdjbGljaycpIHtcbiAgICAgICAgICAgIHRoaXMuaGlkZSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2Ygc2hvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHNob3cgPSAhdGhpcy5wb3B1cFJlZjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2hvdykge1xuICAgICAgICAgICAgdGhpcy5zaG93KGFuY2hvcik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmhpZGUoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgaWYgKHRoaXMuc2hvd09uID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2hvd09uID0gJ2hvdmVyJztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnZlcmlmeVByb3BlcnRpZXMoKTtcbiAgICB9XG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlcykge1xuICAgICAgICBpZiAoY2hhbmdlcy5zaG93T24pIHtcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlQ2xpY2soKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBuZ0FmdGVyVmlld0NoZWNrZWQoKSB7XG4gICAgICAgIGlmICghdGhpcy5wb3B1cFJlZikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmFuY2hvciAmJlxuICAgICAgICAgICAgIWhhc1BhcmVudCh0aGlzLmFuY2hvci5uYXRpdmVFbGVtZW50IHx8IHRoaXMuYW5jaG9yLCB0aGlzLnRvb2x0aXBXcmFwcGVyLm5hdGl2ZUVsZW1lbnQpKSB7XG4gICAgICAgICAgICB0aGlzLmFuY2hvciA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmhpZGUoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBudWxsO1xuICAgICAgICB0aGlzLmFuY2hvclRpdGxlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIHRoaXMubW91c2VPdmVyU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIHRoaXMubW91c2VPdXRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgaWYgKHRoaXMubW91c2VDbGlja1N1YnNjcmlwdGlvbikge1xuICAgICAgICAgICAgdGhpcy5tb3VzZUNsaWNrU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucG9wdXBQb3NpdGlvbkNoYW5nZVN1YnNjcmlwdGlvbikge1xuICAgICAgICAgICAgdGhpcy5wb3B1cFBvc2l0aW9uQ2hhbmdlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucG9wdXBNb3VzZU91dFN1YnNjcmlwdGlvbikge1xuICAgICAgICAgICAgdGhpcy5wb3B1cE1vdXNlT3V0U3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2hvd0NvbnRlbnQoYW5jaG9yUmVmKSB7XG4gICAgICAgIGlmICghYW5jaG9yUmVmLm5hdGl2ZUVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLXRpdGxlJykgJiYgIXRoaXMudGVtcGxhdGUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5vcGVuUG9wdXAoYW5jaG9yUmVmKTtcbiAgICAgICAgICAgIHRoaXMuYmluZENvbnRlbnQodGhpcy5wb3B1cFJlZi5jb250ZW50LCBhbmNob3JSZWYpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5wb3B1cFJlZi5wb3B1cEFuY2hvclZpZXdwb3J0TGVhdmVcbiAgICAgICAgICAgIC5waXBlKHRha2UoMSkpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKCgpID0+IHRoaXMuaGlkZSgpKTtcbiAgICB9XG4gICAgYmluZENvbnRlbnQoY29udGVudENvbXBvbmVudCwgYW5jaG9yUmVmKSB7XG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBjb250ZW50Q29tcG9uZW50Lmluc3RhbmNlO1xuICAgICAgICB0aGlzLmNsb3NlQ2xpY2tTdWJzY3JpcHRpb24gPSBjb250ZW50LmNsb3NlXG4gICAgICAgICAgICAuc3Vic2NyaWJlKCgpID0+IHsgdGhpcy5oaWRlKCk7IH0pO1xuICAgICAgICBpZiAoIXRoaXMudGVtcGxhdGUpIHtcbiAgICAgICAgICAgIGNvbnRlbnQudGVtcGxhdGVTdHJpbmcgPSB0aGlzLmFuY2hvci5uYXRpdmVFbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS10aXRsZScpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29udGVudC50ZW1wbGF0ZVJlZiA9IHRoaXMudGVtcGxhdGU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMudGl0bGVUZW1wbGF0ZSkge1xuICAgICAgICAgICAgY29udGVudC50aXRsZVRlbXBsYXRlID0gdGhpcy50aXRsZVRlbXBsYXRlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnRlbnQuY2xvc2VUaXRsZSA9IHRoaXMuY2xvc2VUaXRsZTtcbiAgICAgICAgY29udGVudC5hbmNob3IgPSBhbmNob3JSZWY7XG4gICAgICAgIGNvbnRlbnQuY2FsbG91dCA9IHRoaXMuY2FsbG91dDtcbiAgICAgICAgY29udGVudC5jbG9zYWJsZSA9IHRoaXMuY2xvc2FibGU7XG4gICAgICAgIGNvbnRlbnQucG9zaXRpb24gPSB0aGlzLnBvc2l0aW9uO1xuICAgICAgICBjb250ZW50LnRvb2x0aXBXaWR0aCA9IHRoaXMudG9vbHRpcFdpZHRoO1xuICAgICAgICBjb250ZW50LnRvb2x0aXBIZWlnaHQgPSB0aGlzLnRvb2x0aXBIZWlnaHQ7XG4gICAgICAgIHRoaXMucG9wdXBSZWYuY29udGVudC5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgfVxuICAgIGhpZGVFbGVtZW50VGl0bGUoZWxlbWVudFJlZikge1xuICAgICAgICBjb25zdCBlbGVtZW50ID0gZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50O1xuICAgICAgICBpZiAoZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ3RpdGxlJykpIHtcbiAgICAgICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLXRpdGxlJywgZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ3RpdGxlJykpO1xuICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgJycpO1xuICAgICAgICB9XG4gICAgfVxuICAgIG9wZW5Qb3B1cChhbmNob3JSZWYpIHtcbiAgICAgICAgY29uc3QgYWxpZ25TZXR0aW5ncyA9IGFsaWduKHRoaXMucG9zaXRpb24sIHRoaXMub2Zmc2V0KTtcbiAgICAgICAgY29uc3QgYW5jaG9yQWxpZ24gPSBhbGlnblNldHRpbmdzLmFuY2hvckFsaWduO1xuICAgICAgICBjb25zdCBwb3B1cEFsaWduID0gYWxpZ25TZXR0aW5ncy5wb3B1cEFsaWduO1xuICAgICAgICBjb25zdCBwb3B1cE1hcmdpbiA9IGFsaWduU2V0dGluZ3MucG9wdXBNYXJnaW47XG4gICAgICAgIHRoaXMucG9wdXBSZWYgPSB0aGlzLnBvcHVwU2VydmljZS5vcGVuKHtcbiAgICAgICAgICAgIGFuY2hvcjogYW5jaG9yUmVmLFxuICAgICAgICAgICAgYW5jaG9yQWxpZ24sXG4gICAgICAgICAgICBhbmltYXRlOiBmYWxzZSxcbiAgICAgICAgICAgIGNvbnRlbnQ6IFRvb2x0aXBDb250ZW50Q29tcG9uZW50LFxuICAgICAgICAgICAgY29sbGlzaW9uOiBjb2xsaXNpb24odGhpcy5jb2xsaXNpb24sIHRoaXMucG9zaXRpb24pLFxuICAgICAgICAgICAgbWFyZ2luOiBwb3B1cE1hcmdpbixcbiAgICAgICAgICAgIHBvcHVwQWxpZ24sXG4gICAgICAgICAgICBwb3B1cENsYXNzOiAnay1wb3B1cC10cmFuc3BhcmVudCdcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5wb3B1cFJlZi5wb3B1cEVsZW1lbnQsICdrLXRvb2x0aXAtd3JhcHBlcicpO1xuICAgICAgICBpZiAodGhpcy50b29sdGlwQ2xhc3MpIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5wb3B1cFJlZi5wb3B1cEVsZW1lbnQsIHRoaXMudG9vbHRpcENsYXNzKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwb3B1cEluc3RhbmNlID0gdGhpcy5wb3B1cFJlZi5jb250ZW50Lmluc3RhbmNlO1xuICAgICAgICBpZiAocG9wdXBJbnN0YW5jZS5jYWxsb3V0KSB7XG4gICAgICAgICAgICB0aGlzLnBvcHVwUG9zaXRpb25DaGFuZ2VTdWJzY3JpcHRpb24gPSB0aGlzLnBvcHVwUmVmLnBvcHVwUG9zaXRpb25DaGFuZ2VcbiAgICAgICAgICAgICAgICAuc3Vic2NyaWJlKCh7IGZsaXAgfSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGlzRmxpcCA9IGZsaXAuaG9yaXpvbnRhbCA9PT0gdHJ1ZSB8fCBmbGlwLnZlcnRpY2FsID09PSB0cnVlO1xuICAgICAgICAgICAgICAgIHBvcHVwSW5zdGFuY2UudXBkYXRlQ2FsbG91dFBvc2l0aW9uKHRoaXMucG9zaXRpb24sIGlzRmxpcCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zaG93T24gPT09ICdob3ZlcicpIHtcbiAgICAgICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBwb3B1cCA9IHRoaXMucG9wdXBSZWYucG9wdXBFbGVtZW50O1xuICAgICAgICAgICAgICAgIHRoaXMucG9wdXBNb3VzZU91dFN1YnNjcmlwdGlvbiA9IGZyb21FdmVudChwb3B1cCwgJ21vdXNlb3V0JylcbiAgICAgICAgICAgICAgICAgICAgLnN1YnNjcmliZSgoZSkgPT4gdGhpcy5vbk1vdXNlT3V0KGUpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNsb3NlUG9wdXAoKSB7XG4gICAgICAgIGlmICh0aGlzLnBvcHVwUmVmKSB7XG4gICAgICAgICAgICB0aGlzLnBvcHVwUmVmLmNsb3NlKCk7XG4gICAgICAgICAgICB0aGlzLnBvcHVwUmVmID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5wb3B1cFBvc2l0aW9uQ2hhbmdlU3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLnBvcHVwUG9zaXRpb25DaGFuZ2VTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzdWJzY3JpYmVDbGljaygpIHtcbiAgICAgICAgaWYgKHRoaXMubW91c2VDbGlja1N1YnNjcmlwdGlvbikge1xuICAgICAgICAgICAgdGhpcy5tb3VzZUNsaWNrU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2hvd09uID09PSAnY2xpY2snKSB7XG4gICAgICAgICAgICB0aGlzLm1vdXNlQ2xpY2tTdWJzY3JpcHRpb24gPSBmcm9tRXZlbnQoZG9jdW1lbnQsICdjbGljaycpXG4gICAgICAgICAgICAgICAgLnBpcGUoZmlsdGVyKCgpID0+IHRoaXMuZmlsdGVyICE9PSAnJykpXG4gICAgICAgICAgICAgICAgLnN1YnNjcmliZShlID0+IHRoaXMub25Nb3VzZUNsaWNrKGUsIHRoaXMudG9vbHRpcFdyYXBwZXIubmF0aXZlRWxlbWVudCkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIG9uTW91c2VDbGljayhlLCB3cmFwcGVyKSB7XG4gICAgICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0O1xuICAgICAgICBjb25zdCBmaWx0ZXJFbGVtZW50ID0gY2xvc2VzdEJ5U2VsZWN0b3IodGFyZ2V0LCB0aGlzLmZpbHRlcik7XG4gICAgICAgIGNvbnN0IHBvcHVwID0gdGhpcy5wb3B1cFJlZiAmJiB0aGlzLnBvcHVwUmVmLnBvcHVwRWxlbWVudDtcbiAgICAgICAgaWYgKHBvcHVwKSB7XG4gICAgICAgICAgICBpZiAocG9wdXAuY29udGFpbnModGFyZ2V0KSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmNsb3NhYmxlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh3cmFwcGVyLmNvbnRhaW5zKHRhcmdldCkgJiYgZmlsdGVyRWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy50b2dnbGUoZmlsdGVyRWxlbWVudCwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocG9wdXApIHtcbiAgICAgICAgICAgIHRoaXMuaGlkZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIG9uTW91c2VPdmVyKGUpIHtcbiAgICAgICAgY29uc3QgZmlsdGVyRWxlbWVudCA9IGNsb3Nlc3RCeVNlbGVjdG9yKGUudGFyZ2V0LCB0aGlzLmZpbHRlcik7XG4gICAgICAgIGlmICh0aGlzLnNob3dPbiAhPT0gJ2hvdmVyJykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChmaWx0ZXJFbGVtZW50KSB7XG4gICAgICAgICAgICB0aGlzLnRvZ2dsZShmaWx0ZXJFbGVtZW50LCB0cnVlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBvbk1vdXNlT3V0KGUpIHtcbiAgICAgICAgaWYgKHRoaXMuc2hvd09uICE9PSAnaG92ZXInKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY2xvc2FibGUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwb3B1cCA9IHRoaXMucG9wdXBSZWYgJiYgdGhpcy5wb3B1cFJlZi5wb3B1cEVsZW1lbnQ7XG4gICAgICAgIGNvbnN0IHJlbGF0ZWRUYXJnZXQgPSBlLnJlbGF0ZWRUYXJnZXQ7XG4gICAgICAgIGlmIChyZWxhdGVkVGFyZ2V0ICYmIHRoaXMuYW5jaG9yICYmIGNvbnRhaW5zKHRoaXMuYW5jaG9yLm5hdGl2ZUVsZW1lbnQsIHJlbGF0ZWRUYXJnZXQpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlbGF0ZWRUYXJnZXQgJiYgY29udGFpbnMocG9wdXAsIHJlbGF0ZWRUYXJnZXQpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgfVxuICAgIHZlcmlmeVByb3BlcnRpZXMoKSB7XG4gICAgICAgIGlmICghaXNEZXZNb2RlKCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWNvbnRhaW5zSXRlbSh0aGlzLnZhbGlkUG9zaXRpb25zLCB0aGlzLnBvc2l0aW9uKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHZhbHVlIHByb3ZpZGVkIGZvciBwb3NpdGlvbiBwcm9wZXJ0eS5UaGUgYXZhaWxhYmxlIG9wdGlvbnMgYXJlICd0b3AnLCAnYm90dG9tJywgJ2xlZnQnLCBvciAncmlnaHQnLmApO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY29udGFpbnNJdGVtKHRoaXMudmFsaWRTaG93T3B0aW9ucywgdGhpcy5zaG93T24pKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgdmFsdWUgcHJvdmlkZWQgZm9yIHNob3dPbiBwcm9wZXJ0eS5UaGUgYXZhaWxhYmxlIG9wdGlvbnMgYXJlICdob3Zlcicgb3IgJ25vbmUnLmApO1xuICAgICAgICB9XG4gICAgfVxufTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFN0cmluZylcbl0sIFRvb2x0aXBEaXJlY3RpdmUucHJvdG90eXBlLCBcImZpbHRlclwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKVxuXSwgVG9vbHRpcERpcmVjdGl2ZS5wcm90b3R5cGUsIFwicG9zaXRpb25cIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFRlbXBsYXRlUmVmKVxuXSwgVG9vbHRpcERpcmVjdGl2ZS5wcm90b3R5cGUsIFwidGl0bGVUZW1wbGF0ZVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKVxuXSwgVG9vbHRpcERpcmVjdGl2ZS5wcm90b3R5cGUsIFwic2hvd09uXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBOdW1iZXIpXG5dLCBUb29sdGlwRGlyZWN0aXZlLnByb3RvdHlwZSwgXCJzaG93QWZ0ZXJcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEJvb2xlYW4pXG5dLCBUb29sdGlwRGlyZWN0aXZlLnByb3RvdHlwZSwgXCJjYWxsb3V0XCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBCb29sZWFuKVxuXSwgVG9vbHRpcERpcmVjdGl2ZS5wcm90b3R5cGUsIFwiY2xvc2FibGVcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE51bWJlcilcbl0sIFRvb2x0aXBEaXJlY3RpdmUucHJvdG90eXBlLCBcIm9mZnNldFwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgTnVtYmVyKVxuXSwgVG9vbHRpcERpcmVjdGl2ZS5wcm90b3R5cGUsIFwidG9vbHRpcFdpZHRoXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBOdW1iZXIpXG5dLCBUb29sdGlwRGlyZWN0aXZlLnByb3RvdHlwZSwgXCJ0b29sdGlwSGVpZ2h0XCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpXG5dLCBUb29sdGlwRGlyZWN0aXZlLnByb3RvdHlwZSwgXCJ0b29sdGlwQ2xhc3NcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE9iamVjdClcbl0sIFRvb2x0aXBEaXJlY3RpdmUucHJvdG90eXBlLCBcImNvbGxpc2lvblwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKVxuXSwgVG9vbHRpcERpcmVjdGl2ZS5wcm90b3R5cGUsIFwiY2xvc2VUaXRsZVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgVGVtcGxhdGVSZWYpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbVGVtcGxhdGVSZWZdKVxuXSwgVG9vbHRpcERpcmVjdGl2ZS5wcm90b3R5cGUsIFwidG9vbHRpcFRlbXBsYXRlXCIsIG51bGwpO1xuVG9vbHRpcERpcmVjdGl2ZSA9IF9fZGVjb3JhdGUoW1xuICAgIERpcmVjdGl2ZSh7XG4gICAgICAgIHNlbGVjdG9yOiAnW2tlbmRvVG9vbHRpcF0nLFxuICAgICAgICBleHBvcnRBczogJ2tlbmRvVG9vbHRpcCdcbiAgICB9KSxcbiAgICBfX3BhcmFtKDQsIE9wdGlvbmFsKCkpLFxuICAgIF9fcGFyYW0oNSwgT3B0aW9uYWwoKSksIF9fcGFyYW0oNSwgSW5qZWN0KFRPT0xUSVBfU0VUVElOR1MpKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW0VsZW1lbnRSZWYsXG4gICAgICAgIE5nWm9uZSxcbiAgICAgICAgUmVuZGVyZXIyLFxuICAgICAgICBQb3B1cFNlcnZpY2UsXG4gICAgICAgIFRvb2x0aXBTZXR0aW5ncyxcbiAgICAgICAgVG9vbHRpcFNldHRpbmdzXSlcbl0sIFRvb2x0aXBEaXJlY3RpdmUpO1xuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgRVJST1JTID0ge1xuICAgIHBvcG92ZXI6IGBJbnZhbGlkIHZhbHVlIHByb3ZpZGVkIGZvciB0aGUgJ3BvcG92ZXInIHByb3BlcnR5LiBUaGUgYWNjZXB0ZWQgZGF0YSB0eXBlcyBhcmUgJ1BvcG92ZXJDb21wb25lbnQnIG9yICdQb3BvdmVyRm4nLmAsXG4gICAgdGVtcGxhdGVEYXRhOiBgdGVtcGxhdGVEYXRhIG11c3QgYmUgYSBmdW5jdGlvbiwgYnV0IHJlY2VpdmVkYCxcbiAgICBzaG93T246IGBJbnZhbGlkIHZhbHVlIHByb3ZpZGVkIGZvciB0aGUgJ3Nob3dPbicgcHJvcGVydHkuIFRoZSBhdmFpbGFibGUgb3B0aW9ucyBhcmUgJ2NsaWNrJywgJ2hvdmVyJywgJ2ZvY3VzJyBvciAnbm9uZScuYFxufTtcblxuLyoqXG4gKiBSZXByZXNlbnRzIGEgdGVtcGxhdGUgdGhhdCBkZWZpbmVzIHRoZSBjb250ZW50IG9mIHRoZSBQb3BvdmVyIHRpdGxlLlxuICpcbiAqIFRvIGRlZmluZSB0aGUgdGVtcGxhdGUsIG5lc3QgYW4gYDxuZy10ZW1wbGF0ZT5gIHRhZ1xuICogd2l0aCB0aGUgYGtlbmRvUG9wb3ZlclRpdGxlVGVtcGxhdGVgIGRpcmVjdGl2ZSBpbnNpZGUgdGhlIGA8a2VuZG8tcG9wb3Zlcj5gIHRhZy5cbiAqL1xubGV0IFBvcG92ZXJUaXRsZVRlbXBsYXRlRGlyZWN0aXZlID0gY2xhc3MgUG9wb3ZlclRpdGxlVGVtcGxhdGVEaXJlY3RpdmUge1xuICAgIGNvbnN0cnVjdG9yKHRlbXBsYXRlUmVmKSB7XG4gICAgICAgIHRoaXMudGVtcGxhdGVSZWYgPSB0ZW1wbGF0ZVJlZjtcbiAgICB9XG59O1xuUG9wb3ZlclRpdGxlVGVtcGxhdGVEaXJlY3RpdmUgPSBfX2RlY29yYXRlKFtcbiAgICBEaXJlY3RpdmUoe1xuICAgICAgICBzZWxlY3RvcjogJ1trZW5kb1BvcG92ZXJUaXRsZVRlbXBsYXRlXSdcbiAgICB9KSxcbiAgICBfX3BhcmFtKDAsIE9wdGlvbmFsKCkpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbVGVtcGxhdGVSZWZdKVxuXSwgUG9wb3ZlclRpdGxlVGVtcGxhdGVEaXJlY3RpdmUpO1xuXG4vKipcbiAqIFJlcHJlc2VudHMgYSB0ZW1wbGF0ZSB0aGF0IGRlZmluZXMgdGhlIGNvbnRlbnQgb2YgdGhlIFBvcG92ZXIgYm9keS5cbiAqXG4gKiBUbyBkZWZpbmUgdGhlIHRlbXBsYXRlLCBuZXN0IGFuIGA8bmctdGVtcGxhdGU+YCB0YWdcbiAqIHdpdGggdGhlIGBrZW5kb1BvcG92ZXJCb2R5VGVtcGxhdGVgIGRpcmVjdGl2ZSBpbnNpZGUgdGhlIGA8a2VuZG8tcG9wb3Zlcj5gIHRhZy5cbiAqL1xubGV0IFBvcG92ZXJCb2R5VGVtcGxhdGVEaXJlY3RpdmUgPSBjbGFzcyBQb3BvdmVyQm9keVRlbXBsYXRlRGlyZWN0aXZlIHtcbiAgICBjb25zdHJ1Y3Rvcih0ZW1wbGF0ZVJlZikge1xuICAgICAgICB0aGlzLnRlbXBsYXRlUmVmID0gdGVtcGxhdGVSZWY7XG4gICAgfVxufTtcblBvcG92ZXJCb2R5VGVtcGxhdGVEaXJlY3RpdmUgPSBfX2RlY29yYXRlKFtcbiAgICBEaXJlY3RpdmUoe1xuICAgICAgICBzZWxlY3RvcjogJ1trZW5kb1BvcG92ZXJCb2R5VGVtcGxhdGVdJ1xuICAgIH0pLFxuICAgIF9fcGFyYW0oMCwgT3B0aW9uYWwoKSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtUZW1wbGF0ZVJlZl0pXG5dLCBQb3BvdmVyQm9keVRlbXBsYXRlRGlyZWN0aXZlKTtcblxuLyoqXG4gKiBSZXByZXNlbnRzIGEgdGVtcGxhdGUgdGhhdCBkZWZpbmVzIHRoZSBjb250ZW50IG9mIHRoZSBQb3BvdmVyIGFjdGlvbnMuXG4gKlxuICogVG8gZGVmaW5lIHRoZSB0ZW1wbGF0ZSwgbmVzdCBhbiBgPG5nLXRlbXBsYXRlPmAgdGFnXG4gKiB3aXRoIHRoZSBga2VuZG9Qb3BvdmVyQWN0aW9uc1RlbXBsYXRlYCBkaXJlY3RpdmUgaW5zaWRlIHRoZSBgPGtlbmRvLXBvcG92ZXI+YCB0YWcuXG4gKi9cbmxldCBQb3BvdmVyQWN0aW9uc1RlbXBsYXRlRGlyZWN0aXZlID0gY2xhc3MgUG9wb3ZlckFjdGlvbnNUZW1wbGF0ZURpcmVjdGl2ZSB7XG4gICAgY29uc3RydWN0b3IodGVtcGxhdGVSZWYpIHtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZVJlZiA9IHRlbXBsYXRlUmVmO1xuICAgIH1cbn07XG5Qb3BvdmVyQWN0aW9uc1RlbXBsYXRlRGlyZWN0aXZlID0gX19kZWNvcmF0ZShbXG4gICAgRGlyZWN0aXZlKHtcbiAgICAgICAgc2VsZWN0b3I6ICdba2VuZG9Qb3BvdmVyQWN0aW9uc1RlbXBsYXRlXSdcbiAgICB9KSxcbiAgICBfX3BhcmFtKDAsIE9wdGlvbmFsKCkpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbVGVtcGxhdGVSZWZdKVxuXSwgUG9wb3ZlckFjdGlvbnNUZW1wbGF0ZURpcmVjdGl2ZSk7XG5cbi8qKlxuICogUmVwcmVzZW50cyB0aGUgW0tlbmRvIFVJIFBvcG92ZXIgY29tcG9uZW50IGZvciBBbmd1bGFyXSh7JSBzbHVnIG92ZXJ2aWV3X3BvcG92ZXIgJX0pLlxuICogVXNlZCB0byBkaXNwbGF5IGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gdGhhdCBpcyByZWxhdGVkIHRvIGEgdGFyZ2V0IGVsZW1lbnQuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHRzLW5vLXJ1blxuICogPGtlbmRvLXBvcG92ZXI+XG4gKiAgICA8bmctdGVtcGxhdGUga2VuZG9Qb3BvdmVyVGl0bGVUZW1wbGF0ZT5Gb28gVGl0bGU8L25nLXRlbXBsYXRlPlxuICogICAgPG5nLXRlbXBsYXRlIGtlbmRvUG9wb3ZlckJvZHlUZW1wbGF0ZT5Gb28gQm9keTwvbmctdGVtcGxhdGU+XG4gKiAgICA8bmctdGVtcGxhdGUga2VuZG9Qb3BvdmVyQWN0aW9uc1RlbXBsYXRlPkZvbyBBY3Rpb25zPC9uZy10ZW1wbGF0ZT5cbiAqIDwva2VuZG8tcG9wb3Zlcj5cbiAqIGBgYFxuICovXG5sZXQgUG9wb3ZlckNvbXBvbmVudCA9IGNsYXNzIFBvcG92ZXJDb21wb25lbnQge1xuICAgIGNvbnN0cnVjdG9yKGxvY2FsaXphdGlvbikge1xuICAgICAgICB0aGlzLmxvY2FsaXphdGlvbiA9IGxvY2FsaXphdGlvbjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNwZWNpZmllcyB0aGUgcG9zaXRpb24gb2YgdGhlIFBvcG92ZXIgaW4gcmVsYXRpb24gdG8gaXRzIGFuY2hvciBlbGVtZW50LiBbU2VlIGV4YW1wbGVdKHslIHNsdWcgcG9zaXRpb25pbmdfcG9wb3ZlciAlfSlcbiAgICAgICAgICpcbiAgICAgICAgICogVGhlIHBvc3NpYmxlIG9wdGlvbnMgYXJlOlxuICAgICAgICAgKiBgdG9wYFxuICAgICAgICAgKiBgYm90dG9tYFxuICAgICAgICAgKiBgcmlnaHRgIChEZWZhdWx0KVxuICAgICAgICAgKiBgbGVmdGBcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucG9zaXRpb24gPSAncmlnaHQnO1xuICAgICAgICAvKipcbiAgICAgICAgICogRGV0ZXJtaW5lcyB3aGV0aGVyIGEgY2FsbG91dCB3aWxsIGJlIHJlbmRlcmVkIGFsb25nIHRoZSBQb3BvdmVyLiBbU2VlIGV4YW1wbGVdKHslIHNsdWcgY2FsbG91dF9wb3BvdmVyICV9KVxuICAgICAgICAgKlxuICAgICAgICAgKiBAZGVmYXVsdCB0cnVlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNhbGxvdXQgPSB0cnVlO1xuICAgICAgICAvKipcbiAgICAgICAgICogRW5hYmxlcyBhbmQgY29uZmlndXJlcyB0aGUgUG9wb3ZlciBhbmltYXRpb24uIFtTZWUgZXhhbXBsZV0oeyUgc2x1ZyBhbmltYXRpb25zX3BvcG92ZXIgJX0pXG4gICAgICAgICAqXG4gICAgICAgICAqIFRoZSBwb3NzaWJsZSBvcHRpb25zIGFyZTpcbiAgICAgICAgICpcbiAgICAgICAgICogKiBgYm9vbGVhbmAmbWRhc2g7RW5hYmxlcyB0aGUgZGVmYXVsdCBhbmltYXRpb25cbiAgICAgICAgICogKiBgUG9wb3ZlckFuaW1hdGlvbmAmbWRhc2g7QSBjb25maWd1cmF0aW9uIG9iamVjdCB3aGljaCBhbGxvd3Mgc2V0dGluZyB0aGUgYGRpcmVjdGlvbmAsIGBkdXJhdGlvbmAgYW5kIGB0eXBlYCBvZiB0aGUgYW5pbWF0aW9uLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5hbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBoaWRkZW5cbiAgICAgICAgICogRGV0ZXJtaW5lcyB0aGUgdmlzaWJpbGl0eSBvZiB0aGUgUG9wb3Zlci5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgYmVmb3JlIHRoZSBQb3BvdmVyIGlzIGFib3V0IHRvIGJlIHNob3duIChbc2VlIGV4YW1wbGVdKHslIHNsdWcgZXZlbnRzX3BvcG92ZXIgJX0pKS5cbiAgICAgICAgICogVGhlIGV2ZW50IGlzIHByZXZlbnRhYmxlLiBJZiBjYW5jZWxlZCwgdGhlIFBvcG92ZXIgd2lsbCBub3QgYmUgZGlzcGxheWVkLiBbU2VlIGV4YW1wbGVdKHslIHNsdWcgZXZlbnRzX3BvcG92ZXIgJX0pXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNob3cgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyBhZnRlciB0aGUgUG9wb3ZlciBoYXMgYmVlbiBzaG93biBhbmQgdGhlIGFuaW1hdGlvbiBoYXMgZW5kZWQuIFtTZWUgZXhhbXBsZV0oeyUgc2x1ZyBldmVudHNfcG9wb3ZlciAlfSlcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2hvd24gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyB3aGVuIHRoZSBQb3BvdmVyIGlzIGFib3V0IHRvIGJlIGhpZGRlbiAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIGV2ZW50c19wb3BvdmVyICV9KSkuXG4gICAgICAgICAqIFRoZSBldmVudCBpcyBwcmV2ZW50YWJsZS4gSWYgY2FuY2VsZWQsIHRoZSBQb3BvdmVyIHdpbGwgcmVtYWluIHZpc2libGUuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmhpZGUgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyBhZnRlciB0aGUgUG9wb3ZlciBoYXMgYmVlbiBoaWRkZW4gYW5kIHRoZSBhbmltYXRpb24gaGFzIGVuZGVkLiBbU2VlIGV4YW1wbGVdKHslIHNsdWcgZXZlbnRzX3BvcG92ZXIgJX0pXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmhpZGRlbiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5fb2Zmc2V0ID0gNjtcbiAgICAgICAgdGhpcy5fd2lkdGggPSAnYXV0byc7XG4gICAgICAgIHRoaXMuX2hlaWdodCA9ICdhdXRvJztcbiAgICAgICAgdGhpcy5zdWJzID0gbmV3IFN1YnNjcmlwdGlvbigpO1xuICAgICAgICAvKipcbiAgICAgICAgICogQGhpZGRlblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5fdGVtcGxhdGVEYXRhID0gKCkgPT4gbnVsbDtcbiAgICAgICAgdmFsaWRhdGVQYWNrYWdlKHBhY2thZ2VNZXRhZGF0YSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNwZWNpZmllcyB0aGUgZGlzdGFuY2UgZnJvbSB0aGUgUG9wb3ZlciB0byBpdHMgYW5jaG9yIGVsZW1lbnQgaW4gcGl4ZWxzLlxuICAgICAqXG4gICAgICogQGRlZmF1bHQgYDZgXG4gICAgICovXG4gICAgc2V0IG9mZnNldCh2YWx1ZSkge1xuICAgICAgICB0aGlzLl9vZmZzZXQgPSB2YWx1ZTtcbiAgICB9XG4gICAgZ2V0IG9mZnNldCgpIHtcbiAgICAgICAgY29uc3QgY2FsbG91dEJ1ZmZlciA9IDE0O1xuICAgICAgICByZXR1cm4gdGhpcy5jYWxsb3V0XG4gICAgICAgICAgICA/IGNhbGxvdXRCdWZmZXIgKyB0aGlzLl9vZmZzZXRcbiAgICAgICAgICAgIDogdGhpcy5fb2Zmc2V0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmVzIHRoZSB3aWR0aCBvZiB0aGUgcG9wb3Zlci4gTnVtZXJpYyB2YWx1ZXMgYXJlIHRyZWF0ZWQgYXMgcGl4ZWxzLlxuICAgICAqIEBkZWZhdWx0ICdhdXRvJ1xuICAgICAqL1xuICAgIHNldCB3aWR0aCh2YWx1ZSkge1xuICAgICAgICB0aGlzLl93aWR0aCA9IHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgPyBgJHt2YWx1ZX1weGAgOiB2YWx1ZTtcbiAgICB9XG4gICAgZ2V0IHdpZHRoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fd2lkdGg7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgdGhlIGhlaWdodCBvZiB0aGUgcG9wb3Zlci4gTnVtZXJpYyB2YWx1ZXMgYXJlIHRyZWF0ZWQgYXMgcGl4ZWxzLlxuICAgICAqIEBkZWZhdWx0ICdhdXRvJ1xuICAgICAqL1xuICAgIHNldCBoZWlnaHQodmFsdWUpIHtcbiAgICAgICAgdGhpcy5faGVpZ2h0ID0gdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyA/IGAke3ZhbHVlfXB4YCA6IHZhbHVlO1xuICAgIH1cbiAgICBnZXQgaGVpZ2h0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faGVpZ2h0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEZWZpbmVzIGEgY2FsbGJhY2sgZnVuY3Rpb24gd2hpY2ggcmV0dXJucyBjdXN0b20gZGF0YSBwYXNzZWQgdG8gdGhlIFBvcG92ZXIgdGVtcGxhdGVzLlxuICAgICAqIEl0IGV4cG9zZXMgdGhlIGN1cnJlbnQgYW5jaG9yIGVsZW1lbnQgYXMgYW4gYXJndW1lbnQuIFtTZWUgZXhhbXBsZV0oeyUgc2x1ZyB0ZW1wbGF0ZXNfcG9wb3ZlciAlfSN0b2MtcG9wb3ZlcmRhdGFjYWxsYmFjaylcbiAgICAgKi9cbiAgICBzZXQgdGVtcGxhdGVEYXRhKGZuKSB7XG4gICAgICAgIGlmIChpc0Rldk1vZGUgJiYgdHlwZW9mIGZuICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7RVJST1JTLnRlbXBsYXRlRGF0YX0gJHtKU09OLnN0cmluZ2lmeShmbil9LmApO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3RlbXBsYXRlRGF0YSA9IGZuO1xuICAgIH1cbiAgICBnZXQgdGVtcGxhdGVEYXRhKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdGVtcGxhdGVEYXRhO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgZ2V0IGlzSGlkZGVuKCkge1xuICAgICAgICByZXR1cm4gIXRoaXMudmlzaWJsZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIGdldCBoYXNBdHRyaWJ1dGVIaWRkZW4oKSB7XG4gICAgICAgIHJldHVybiAhdGhpcy52aXNpYmxlO1xuICAgIH1cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5zdWJzLmFkZCh0aGlzLmxvY2FsaXphdGlvbi5jaGFuZ2VzLnN1YnNjcmliZSgoeyBydGwgfSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBydGwgPyAncnRsJyA6ICdsdHInO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICB0aGlzLnN1YnMudW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIGdldENhbGxvdXRQb3NpdGlvbigpIHtcbiAgICAgICAgc3dpdGNoICh0aGlzLnBvc2l0aW9uKSB7XG4gICAgICAgICAgICBjYXNlICd0b3AnOiByZXR1cm4geyAnay1jYWxsb3V0LXMnOiB0cnVlIH07XG4gICAgICAgICAgICBjYXNlICdib3R0b20nOiByZXR1cm4geyAnay1jYWxsb3V0LW4nOiB0cnVlIH07XG4gICAgICAgICAgICBjYXNlICdsZWZ0JzogcmV0dXJuIHsgJ2stY2FsbG91dC1lJzogdHJ1ZSB9O1xuICAgICAgICAgICAgY2FzZSAncmlnaHQnOiByZXR1cm4geyAnay1jYWxsb3V0LXcnOiB0cnVlIH07XG4gICAgICAgICAgICBkZWZhdWx0OiByZXR1cm4geyAnay1jYWxsb3V0LXMnOiB0cnVlIH07XG4gICAgICAgIH1cbiAgICB9XG59O1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKVxuXSwgUG9wb3ZlckNvbXBvbmVudC5wcm90b3R5cGUsIFwicG9zaXRpb25cIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE51bWJlciksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtOdW1iZXJdKVxuXSwgUG9wb3ZlckNvbXBvbmVudC5wcm90b3R5cGUsIFwib2Zmc2V0XCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdEJpbmRpbmcoJ3N0eWxlLndpZHRoJyksXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgT2JqZWN0KSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW09iamVjdF0pXG5dLCBQb3BvdmVyQ29tcG9uZW50LnByb3RvdHlwZSwgXCJ3aWR0aFwiLCBudWxsKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdzdHlsZS5oZWlnaHQnKSxcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBPYmplY3QpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbT2JqZWN0XSlcbl0sIFBvcG92ZXJDb21wb25lbnQucHJvdG90eXBlLCBcImhlaWdodFwiLCBudWxsKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdhdHRyLmRpcicpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpXG5dLCBQb3BvdmVyQ29tcG9uZW50LnByb3RvdHlwZSwgXCJkaXJlY3Rpb25cIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFN0cmluZylcbl0sIFBvcG92ZXJDb21wb25lbnQucHJvdG90eXBlLCBcInRpdGxlXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpXG5dLCBQb3BvdmVyQ29tcG9uZW50LnByb3RvdHlwZSwgXCJzdWJ0aXRsZVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKVxuXSwgUG9wb3ZlckNvbXBvbmVudC5wcm90b3R5cGUsIFwiYm9keVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgQm9vbGVhbilcbl0sIFBvcG92ZXJDb21wb25lbnQucHJvdG90eXBlLCBcImNhbGxvdXRcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE9iamVjdClcbl0sIFBvcG92ZXJDb21wb25lbnQucHJvdG90eXBlLCBcImFuaW1hdGlvblwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgRnVuY3Rpb24pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbRnVuY3Rpb25dKVxuXSwgUG9wb3ZlckNvbXBvbmVudC5wcm90b3R5cGUsIFwidGVtcGxhdGVEYXRhXCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdEJpbmRpbmcoJ2NsYXNzLmstaGlkZGVuJyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEJvb2xlYW4pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbXSlcbl0sIFBvcG92ZXJDb21wb25lbnQucHJvdG90eXBlLCBcImlzSGlkZGVuXCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdEJpbmRpbmcoJ2F0dHIuYXJpYS1oaWRkZW4nKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgQm9vbGVhbiksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtdKVxuXSwgUG9wb3ZlckNvbXBvbmVudC5wcm90b3R5cGUsIFwiaGFzQXR0cmlidXRlSGlkZGVuXCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgT3V0cHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEV2ZW50RW1pdHRlcilcbl0sIFBvcG92ZXJDb21wb25lbnQucHJvdG90eXBlLCBcInNob3dcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIE91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBFdmVudEVtaXR0ZXIpXG5dLCBQb3BvdmVyQ29tcG9uZW50LnByb3RvdHlwZSwgXCJzaG93blwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgT3V0cHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEV2ZW50RW1pdHRlcilcbl0sIFBvcG92ZXJDb21wb25lbnQucHJvdG90eXBlLCBcImhpZGVcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIE91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBFdmVudEVtaXR0ZXIpXG5dLCBQb3BvdmVyQ29tcG9uZW50LnByb3RvdHlwZSwgXCJoaWRkZW5cIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIENvbnRlbnRDaGlsZChQb3BvdmVyVGl0bGVUZW1wbGF0ZURpcmVjdGl2ZSwgeyBzdGF0aWM6IGZhbHNlIH0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBQb3BvdmVyVGl0bGVUZW1wbGF0ZURpcmVjdGl2ZSlcbl0sIFBvcG92ZXJDb21wb25lbnQucHJvdG90eXBlLCBcInRpdGxlVGVtcGxhdGVcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIENvbnRlbnRDaGlsZChQb3BvdmVyQm9keVRlbXBsYXRlRGlyZWN0aXZlLCB7IHN0YXRpYzogZmFsc2UgfSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFBvcG92ZXJCb2R5VGVtcGxhdGVEaXJlY3RpdmUpXG5dLCBQb3BvdmVyQ29tcG9uZW50LnByb3RvdHlwZSwgXCJib2R5VGVtcGxhdGVcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIENvbnRlbnRDaGlsZChQb3BvdmVyQWN0aW9uc1RlbXBsYXRlRGlyZWN0aXZlLCB7IHN0YXRpYzogZmFsc2UgfSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFBvcG92ZXJBY3Rpb25zVGVtcGxhdGVEaXJlY3RpdmUpXG5dLCBQb3BvdmVyQ29tcG9uZW50LnByb3RvdHlwZSwgXCJhY3Rpb25zVGVtcGxhdGVcIiwgdm9pZCAwKTtcblBvcG92ZXJDb21wb25lbnQgPSBfX2RlY29yYXRlKFtcbiAgICBDb21wb25lbnQoe1xuICAgICAgICBzZWxlY3RvcjogJ2tlbmRvLXBvcG92ZXInLFxuICAgICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgICAgIExvY2FsaXphdGlvblNlcnZpY2UsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcHJvdmlkZTogTDEwTl9QUkVGSVgsXG4gICAgICAgICAgICAgICAgdXNlVmFsdWU6ICdrZW5kby5wb3BvdmVyJ1xuICAgICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICB0ZW1wbGF0ZTogYFxuICAgIDxkaXYgKm5nSWY9XCJ2aXNpYmxlXCIgcm9sZT1cInRvb2x0aXBcIiBjbGFzcz1cImstcG9wb3ZlclwiIFtuZ1N0eWxlXT1cInsnd2lkdGgucHgnOiB3aWR0aCwgJ2hlaWdodC5weCc6IGhlaWdodH1cIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImstcG9wb3Zlci1jYWxsb3V0XCIgW25nQ2xhc3NdPVwiZ2V0Q2FsbG91dFBvc2l0aW9uKClcIiAqbmdJZj1cImNhbGxvdXRcIj48L2Rpdj5cblxuICAgICAgICA8ZGl2ICpuZ0lmPVwidGl0bGVUZW1wbGF0ZSB8fCB0aXRsZVwiIGNsYXNzPVwiay1wb3BvdmVyLWhlYWRlclwiPlxuICAgICAgICAgICAgPG5nLXRlbXBsYXRlICpuZ0lmPVwidGl0bGVUZW1wbGF0ZVwiXG4gICAgICAgICAgICAgICAgW25nVGVtcGxhdGVPdXRsZXRdPVwidGl0bGVUZW1wbGF0ZT8udGVtcGxhdGVSZWZcIlxuICAgICAgICAgICAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0Q29udGV4dF09XCJ7ICRpbXBsaWNpdDogYW5jaG9yLCBkYXRhOiBjb250ZXh0RGF0YSB9XCI+XG4gICAgICAgICAgICA8L25nLXRlbXBsYXRlPlxuICAgICAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cInRpdGxlICYmICF0aXRsZVRlbXBsYXRlXCI+XG4gICAgICAgICAgICAgICAge3sgdGl0bGUgfX1cbiAgICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICA8L2Rpdj5cblxuICAgICAgICA8ZGl2ICpuZ0lmPVwiYm9keVRlbXBsYXRlIHx8IGJvZHlcIiBjbGFzcz1cImstcG9wb3Zlci1ib2R5XCI+XG4gICAgICAgICAgICA8bmctdGVtcGxhdGUgKm5nSWY9XCJib2R5VGVtcGxhdGVcIlxuICAgICAgICAgICAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0XT1cImJvZHlUZW1wbGF0ZT8udGVtcGxhdGVSZWZcIlxuICAgICAgICAgICAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0Q29udGV4dF09XCJ7ICRpbXBsaWNpdDogYW5jaG9yLCBkYXRhOiBjb250ZXh0RGF0YSB9XCI+XG4gICAgICAgICAgICA8L25nLXRlbXBsYXRlPlxuICAgICAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImJvZHkgJiYgIWJvZHlUZW1wbGF0ZVwiPlxuICAgICAgICAgICAgICAgIHt7IGJvZHkgfX1cbiAgICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICA8L2Rpdj5cblxuICAgICAgICA8ZGl2ICpuZ0lmPVwiYWN0aW9uc1RlbXBsYXRlXCIgY2xhc3M9XCJrLXBvcG92ZXItYWN0aW9ucyBrLWFjdGlvbnMgay1oc3RhY2sgay1qdXN0aWZ5LWNvbnRlbnQtYmV0d2VlblwiPlxuICAgICAgICAgICAgPG5nLXRlbXBsYXRlICpuZ0lmPVwiYWN0aW9uc1RlbXBsYXRlXCJcbiAgICAgICAgICAgICAgICBbbmdUZW1wbGF0ZU91dGxldF09XCJhY3Rpb25zVGVtcGxhdGU/LnRlbXBsYXRlUmVmXCJcbiAgICAgICAgICAgICAgICBbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwieyAkaW1wbGljaXQ6IGFuY2hvciwgZGF0YTogY29udGV4dERhdGEgfVwiPlxuICAgICAgICAgICAgPC9uZy10ZW1wbGF0ZT5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgYFxuICAgIH0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbTG9jYWxpemF0aW9uU2VydmljZV0pXG5dLCBQb3BvdmVyQ29tcG9uZW50KTtcblxuLyoqXG4gKiBBcmd1bWVudHMgZm9yIHRoZSBgc2hvd2AgZXZlbnQuIFRoZSBgc2hvd2AgZXZlbnQgZmlyZXMgd2hlbiBhIHBvcG92ZXIgaXMgYWJvdXRcbiAqIHRvIGJlIG9wZW5lZC4gSWYgeW91IGNhbmNlbCB0aGUgZXZlbnQsIHRoZSBvcGVuaW5nIGlzIHByZXZlbnRlZC5cbiAqL1xuY2xhc3MgUG9wb3ZlclNob3dFdmVudCBleHRlbmRzIFByZXZlbnRhYmxlRXZlbnQge1xuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKiBDb25zdHJ1Y3RzIHRoZSBldmVudCBhcmd1bWVudHMgZm9yIHRoZSBgc2hvd2AgZXZlbnQuXG4gICAgICogQHBhcmFtIGFuY2hvciAtIFRoZSBob3N0IGVsZW1lbnQgcmVsYXRlZCB0byB0aGUgcG9wb3Zlci5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihhbmNob3IpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5hbmNob3IgPSBhbmNob3I7XG4gICAgfVxufVxuLyoqXG4gKiBBcmd1bWVudHMgZm9yIHRoZSBgaGlkZWAgZXZlbnQuIFRoZSBgaGlkZWAgZXZlbnQgZmlyZXMgd2hlbiBhIHBvcG92ZXIgaXMgYWJvdXRcbiAqIHRvIGJlIGNsb3NlZC4gSWYgeW91IGNhbmNlbCB0aGUgZXZlbnQsIHRoZSBwb3BvdmVyIHN0YXlzIG9wZW4uXG4gKi9cbmNsYXNzIFBvcG92ZXJIaWRlRXZlbnQgZXh0ZW5kcyBQcmV2ZW50YWJsZUV2ZW50IHtcbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICogQ29uc3RydWN0cyB0aGUgZXZlbnQgYXJndW1lbnRzIGZvciB0aGUgYGhpZGVgIGV2ZW50LlxuICAgICAqIEBwYXJhbSBhbmNob3IgLSBUaGUgaG9zdCBlbGVtZW50IHJlbGF0ZWQgdG8gdGhlIHBvcG92ZXIuXG4gICAgICogQHBhcmFtIHBvcG92ZXIgLSBUaGUgcG9wb3ZlciBlbGVtZW50LlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGFuY2hvciwgcG9wb3Zlcikge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLmFuY2hvciA9IGFuY2hvcjtcbiAgICAgICAgdGhpcy5wb3BvdmVyID0gcG9wb3ZlcjtcbiAgICB9XG59XG4vKipcbiAqIEFyZ3VtZW50cyBmb3IgdGhlIGBzaG93bmAgZXZlbnQuIFRoZSBgc2hvd25gIGV2ZW50IGZpcmVzIGFmdGVyIHRoZSBwb3BvdmVyIGhhcyBvcGVuZWQgYW5kIGl0cyBvcGVuaW5nIGFuaW1hdGlvbiBoYXMgZmluaXNoZWQuXG4gKi9cbmNsYXNzIFBvcG92ZXJTaG93bkV2ZW50IHtcbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICogQ29uc3RydWN0cyB0aGUgZXZlbnQgYXJndW1lbnRzIGZvciB0aGUgYHNob3duYCBldmVudC5cbiAgICAgKiBAcGFyYW0gYW5jaG9yIC0gVGhlIGhvc3QgZWxlbWVudCByZWxhdGVkIHRvIHRoZSBwb3BvdmVyLlxuICAgICAqIEBwYXJhbSBwb3BvdmVyIC0gVGhlIHBvcG92ZXIgZWxlbWVudC5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihhbmNob3IsIHBvcG92ZXIpIHtcbiAgICAgICAgdGhpcy5hbmNob3IgPSBhbmNob3I7XG4gICAgICAgIHRoaXMucG9wb3ZlciA9IHBvcG92ZXI7XG4gICAgfVxufVxuLyoqXG4gKiBBcmd1bWVudHMgZm9yIHRoZSBgaGlkZGVuYCBldmVudC4gVGhlIGBoaWRkZW5gIGV2ZW50IGZpcmVzIGFmdGVyIHRoZSBwb3BvdmVyIGhhcyBjbG9zZWQgYW5kIGl0cyBjbG9zaW5nIGFuaW1hdGlvbiBoYXMgZmluaXNoZWQuXG4gKi9cbmNsYXNzIFBvcG92ZXJIaWRkZW5FdmVudCB7XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqIENvbnN0cnVjdHMgdGhlIGV2ZW50IGFyZ3VtZW50cyBmb3IgdGhlIGBoaWRkZW5gIGV2ZW50LlxuICAgICAqIEBwYXJhbSBhbmNob3IgLSBUaGUgaG9zdCBlbGVtZW50IHJlbGF0ZWQgdG8gdGhlIHBvcG92ZXIuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoYW5jaG9yKSB7XG4gICAgICAgIHRoaXMuYW5jaG9yID0gYW5jaG9yO1xuICAgIH1cbn1cblxuY29uc3QgdmFsaWRTaG93T3B0aW9ucyA9IFsnaG92ZXInLCAnY2xpY2snLCAnbm9uZScsICdmb2N1cyddO1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNsYXNzIFBvcG92ZXJEaXJlY3RpdmVzQmFzZSB7XG4gICAgY29uc3RydWN0b3Iobmdab25lLCBwb3B1cFNlcnZpY2UsIHJlbmRlcmVyKSB7XG4gICAgICAgIHRoaXMubmdab25lID0gbmdab25lO1xuICAgICAgICB0aGlzLnBvcHVwU2VydmljZSA9IHBvcHVwU2VydmljZTtcbiAgICAgICAgdGhpcy5yZW5kZXJlciA9IHJlbmRlcmVyO1xuICAgICAgICB0aGlzLnN1YnMgPSBuZXcgU3Vic2NyaXB0aW9uKCk7XG4gICAgICAgIHRoaXMuX3Nob3dPbiA9ICdjbGljayc7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNwZWNpZmllcyB0aGUgcG9wb3ZlciBpbnN0YW5jZSB0aGF0IHdpbGwgYmUgcmVuZGVyZWQuXG4gICAgICogQWNjZXB0cyBhIFtgUG9wb3ZlckNvbXBvbmVudGBdKHslIHNsdWcgYXBpX3Rvb2x0aXBfcG9wb3ZlcmNvbXBvbmVudCAlfSkgaW5zdGFuY2Ugb3JcbiAgICAgKiBhIFtgUG9wb3ZlckZuYF0oeyUgc2x1ZyBhcGlfdG9vbHRpcF9wb3BvdmVyZm4gJX0pIGNhbGxiYWNrIHdoaWNoIHJldHVybnMgYSBbYFBvcG92ZXJDb21wb25lbnRgXSh7JSBzbHVnIGFwaV90b29sdGlwX3BvcG92ZXJjb21wb25lbnQgJX0pIGluc3RhbmNlXG4gICAgICogZGVwZW5kaW5nIG9uIHRoZSBjdXJyZW50IGFuY2hvciBlbGVtZW50LlxuICAgICAqXG4gICAgICogW1NlZSBleGFtcGxlXSh7JSBzbHVnIHRlbXBsYXRlc19wb3BvdmVyICV9I3RvYy1wb3BvdmVyY2FsbGJhY2spXG4gICAgICovXG4gICAgc2V0IHBvcG92ZXIodmFsdWUpIHtcbiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgUG9wb3ZlckNvbXBvbmVudCB8fCB0eXBlb2YgdmFsdWUgPT09IGBmdW5jdGlvbmApIHtcbiAgICAgICAgICAgIHRoaXMuX3BvcG92ZXIgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChpc0Rldk1vZGUpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoRVJST1JTLnBvcG92ZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBwb3BvdmVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcG9wb3ZlcjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIGV2ZW50IG9uIHdoaWNoIHRoZSBQb3BvdmVyIHdpbGwgYmUgc2hvd25cbiAgICAgKlxuICAgICAqIFRoZSBzdXBwb3J0ZWQgdmFsdWVzIGFyZTpcbiAgICAgKiAtIGBjbGlja2AgKGRlZmF1bHQpICZtZGFzaDtUaGUgUG9wb3ZlciB3aWxsIGJlIHNob3duIHdoZW4gaXRzIGBhbmNob3JgIGVsZW1lbnQgaXMgY2xpY2tlZC5cbiAgICAgKiAtIGBob3ZlcmAmbWRhc2g7VGhlIFBvcG92ZXIgd2lsbCBiZSBzaG93biB3aGVuIGl0cyBgYW5jaG9yYCBlbGVtZW50IGlzIGhvdmVyZWQuXG4gICAgICogLSBgZm9jdXNgJm1kYXNoO1RoZSBQb3BvdmVyIHdpbGwgYmUgc2hvd24gd2hlbiBpdHMgYGFuY2hvcmAgZWxlbWVudCBpcyBmb2N1c2VkLlxuICAgICAqIC0gYG5vbmVgJm1kYXNoO1RoZSBQb3BvdmVyIHdpbGwgbm90IGJlIHNob3duIG9uIHVzZXIgaW50ZXJhY3Rpb24uIEl0IGNvdWxkIGJlIHJlbmRlcmVkIHZpYSB0aGUgUG9wb3ZlciBBUEkgbWV0aG9kcy5cbiAgICAgKi9cbiAgICBzZXQgc2hvd09uKHZhbHVlKSB7XG4gICAgICAgIGlmIChpc0Rldk1vZGUgJiYgIWNvbnRhaW5zSXRlbSh2YWxpZFNob3dPcHRpb25zLCB2YWx1ZSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihFUlJPUlMuc2hvd09uKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9zaG93T24gPSB2YWx1ZTtcbiAgICB9XG4gICAgZ2V0IHNob3dPbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Nob3dPbjtcbiAgICB9XG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgICAgICBpZiAoIWlzRG9jdW1lbnRBdmFpbGFibGUoKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5zaG93T24pIHtcbiAgICAgICAgICAgICAgICBjYXNlICdob3Zlcic6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlVG9FdmVudHMoW3tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnbW91c2VlbnRlcicsIGhhbmRsZXI6IHRoaXMubW91c2VlbnRlckhhbmRsZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnbW91c2VsZWF2ZScsIGhhbmRsZXI6IHRoaXMubW91c2VsZWF2ZUhhbmRsZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1dKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnZm9jdXMnOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN1YnNjcmliZVRvRXZlbnRzKFt7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2ZvY3VzJywgaGFuZGxlcjogdGhpcy5mb2N1c0hhbmRsZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnYmx1cicsIGhhbmRsZXI6IHRoaXMuYmx1ckhhbmRsZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1dKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnY2xpY2snOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN1YnNjcmliZUNsaWNrKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuY2xvc2VQb3B1cCgpO1xuICAgICAgICBpZiAodGhpcy5kaXNwb3NlSG92ZXJPdmVyTGlzdGVuZXIpIHtcbiAgICAgICAgICAgIHRoaXMuZGlzcG9zZUhvdmVyT3Zlckxpc3RlbmVyKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuZGlzcG9zZUhvdmVyT3V0TGlzdGVuZXIpIHtcbiAgICAgICAgICAgIHRoaXMuZGlzcG9zZUhvdmVyT3V0TGlzdGVuZXIoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5kaXNwb3NlQ2xpY2tMaXN0ZW5lcikge1xuICAgICAgICAgICAgdGhpcy5kaXNwb3NlQ2xpY2tMaXN0ZW5lcigpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9mb2N1c0luc2lkZVN1Yikge1xuICAgICAgICAgICAgdGhpcy5fZm9jdXNJbnNpZGVTdWIudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5faGlkZVN1Yikge1xuICAgICAgICAgICAgdGhpcy5faGlkZVN1Yi51bnN1YnNjcmliZSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnN1YnMpIHtcbiAgICAgICAgICAgIHRoaXMuc3Vicy51bnN1YnNjcmliZSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9wb3B1cE9wZW5TdWIpIHtcbiAgICAgICAgICAgIHRoaXMuX3BvcHVwT3BlblN1Yi51bnN1YnNjcmliZSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9wb3B1cENsb3NlU3ViKSB7XG4gICAgICAgICAgICB0aGlzLl9wb3B1cENsb3NlU3ViLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogSGlkZXMgdGhlIFBvcG92ZXIgKFtTZWUgZXhhbXBsZV0oeyUgc2x1ZyBwcm9ncmFtbWF0aWNjb250cm9sX3BvcG92ZXIgJX0pKS5cbiAgICAgKi9cbiAgICBoaWRlKCkge1xuICAgICAgICB0aGlzLmNsb3NlUG9wdXAoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIGNsb3NlUG9wdXAoKSB7XG4gICAgICAgIGlmICh0aGlzLnBvcHVwUmVmKSB7XG4gICAgICAgICAgICB0aGlzLnBvcHVwUmVmLmNsb3NlKCk7XG4gICAgICAgICAgICB0aGlzLnBvcHVwUmVmID0gbnVsbDtcbiAgICAgICAgICAgIGlmICh0aGlzLmRpc3Bvc2VQb3B1cEhvdmVyT3V0TGlzdGVuZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc3Bvc2VQb3B1cEhvdmVyT3V0TGlzdGVuZXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmRpc3Bvc2VQb3B1cEhvdmVySW5MaXN0ZW5lcikge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzcG9zZVBvcHVwSG92ZXJJbkxpc3RlbmVyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5kaXNwb3NlUG9wdXBGb2N1c091dExpc3RlbmVyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXNwb3NlUG9wdXBGb2N1c091dExpc3RlbmVyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIG9wZW5Qb3B1cChhbmNob3IpIHtcbiAgICAgICAgY29uc3QgX2FuY2hvciA9IGFuY2hvciBpbnN0YW5jZW9mIEVsZW1lbnRSZWYgPyBhbmNob3IubmF0aXZlRWxlbWVudCA6IGFuY2hvcjtcbiAgICAgICAgY29uc3QgcG9wb3ZlckNvbXAgPSB0aGlzLnBvcG92ZXIgaW5zdGFuY2VvZiBQb3BvdmVyQ29tcG9uZW50ID8gdGhpcy5wb3BvdmVyIDogdGhpcy5wb3BvdmVyKF9hbmNob3IpO1xuICAgICAgICBjb25zdCBhbGlnblNldHRpbmdzID0gYWxpZ24ocG9wb3ZlckNvbXAucG9zaXRpb24sIHBvcG92ZXJDb21wLm9mZnNldCk7XG4gICAgICAgIGNvbnN0IGFuY2hvckFsaWduID0gYWxpZ25TZXR0aW5ncy5hbmNob3JBbGlnbjtcbiAgICAgICAgY29uc3QgcG9wdXBBbGlnbiA9IGFsaWduU2V0dGluZ3MucG9wdXBBbGlnbjtcbiAgICAgICAgY29uc3QgcG9wdXBNYXJnaW4gPSBhbGlnblNldHRpbmdzLnBvcHVwTWFyZ2luO1xuICAgICAgICBjb25zdCBfYW5pbWF0aW9uID0gcG9wb3ZlckNvbXAuYW5pbWF0aW9uO1xuICAgICAgICB0aGlzLnBvcHVwUmVmID0gdGhpcy5wb3B1cFNlcnZpY2Uub3Blbih7XG4gICAgICAgICAgICBhbmNob3I6IHsgbmF0aXZlRWxlbWVudDogX2FuY2hvciB9LFxuICAgICAgICAgICAgYW5pbWF0ZTogX2FuaW1hdGlvbixcbiAgICAgICAgICAgIGNvbnRlbnQ6IFBvcG92ZXJDb21wb25lbnQsXG4gICAgICAgICAgICBwb3B1cEFsaWduLFxuICAgICAgICAgICAgYW5jaG9yQWxpZ24sXG4gICAgICAgICAgICBtYXJnaW46IHBvcHVwTWFyZ2luLFxuICAgICAgICAgICAgcG9wdXBDbGFzczogJ2stcG9wdXAtdHJhbnNwYXJlbnQnLFxuICAgICAgICAgICAgY29sbGlzaW9uOiB7IGhvcml6b250YWw6ICdmaXQnLCB2ZXJ0aWNhbDogJ2ZpdCcgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5hcHBseVNldHRpbmdzKHRoaXMucG9wdXBSZWYuY29udGVudCwgcG9wb3ZlckNvbXAsIGFuY2hvcik7XG4gICAgICAgIHRoaXMubW9uaXRvclBvcHVwKCk7XG4gICAgICAgIHRoaXMuaW5pdGlhbGl6ZUNvbXBsZXRpb25FdmVudHMocG9wb3ZlckNvbXAsIF9hbmNob3IpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgaXNQcmV2ZW50ZWQoYW5jaG9yRWxlbWVudCwgc2hvdykge1xuICAgICAgICBjb25zdCBwb3BvdmVyQ29tcCA9IHRoaXMucG9wb3ZlciBpbnN0YW5jZW9mIFBvcG92ZXJDb21wb25lbnQgPyB0aGlzLnBvcG92ZXIgOiB0aGlzLnBvcG92ZXIoYW5jaG9yRWxlbWVudCk7XG4gICAgICAgIGxldCBldmVudEFyZ3M7XG4gICAgICAgIGV2ZW50QXJncyA9IHRoaXMuaW5pdGlhbGl6ZUV2ZW50cyhwb3BvdmVyQ29tcCwgZXZlbnRBcmdzLCBzaG93LCBhbmNob3JFbGVtZW50KTtcbiAgICAgICAgcmV0dXJuIGV2ZW50QXJncy5pc0RlZmF1bHRQcmV2ZW50ZWQoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIG1vbml0b3JQb3B1cCgpIHtcbiAgICAgICAgaWYgKHRoaXMuc2hvd09uID09PSAnaG92ZXInKSB7XG4gICAgICAgICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcG9wdXAgPSB0aGlzLnBvcHVwUmVmLnBvcHVwRWxlbWVudDtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc3Bvc2VQb3B1cEhvdmVySW5MaXN0ZW5lciA9IHRoaXMucmVuZGVyZXIubGlzdGVuKHBvcHVwLCAnbW91c2VlbnRlcicsIF8gPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm5nWm9uZS5ydW4oXyA9PiB0aGlzLl9wb3BvdmVyU2VydmljZS5lbWl0UG9wb3ZlclN0YXRlKHRydWUpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc3Bvc2VQb3B1cEhvdmVyT3V0TGlzdGVuZXIgPSB0aGlzLnJlbmRlcmVyLmxpc3Rlbihwb3B1cCwgJ21vdXNlbGVhdmUnLCBfID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uZ1pvbmUucnVuKF8gPT4gdGhpcy5fcG9wb3ZlclNlcnZpY2UuZW1pdFBvcG92ZXJTdGF0ZShmYWxzZSkpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2hvd09uID09PSAnZm9jdXMnKSB7XG4gICAgICAgICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcG9wdXAgPSB0aGlzLnBvcHVwUmVmLnBvcHVwRWxlbWVudDtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc3Bvc2VQb3B1cEZvY3VzT3V0TGlzdGVuZXIgPSB0aGlzLnJlbmRlcmVyLmxpc3Rlbihwb3B1cCwgJ2ZvY3Vzb3V0JywgKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNJbnNpZGVQb3BvdmVyID0gY2xvc2VzdChlLnJlbGF0ZWRUYXJnZXQsIChub2RlKSA9PiBub2RlLmNsYXNzTGlzdCAmJiBub2RlLmNsYXNzTGlzdC5jb250YWlucygnay1wb3BvdmVyJykpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWlzSW5zaWRlUG9wb3Zlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5uZ1pvbmUucnVuKF8gPT4gdGhpcy5fcG9wb3ZlclNlcnZpY2UuZW1pdEZvY3VzSW5zaWRlUG9wb3ZlcihmYWxzZSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhcHBseVNldHRpbmdzKGNvbnRlbnRDb21wb25lbnQsIHBvcG92ZXIsIGFuY2hvcikge1xuICAgICAgICBjb25zdCBjb250ZW50ID0gY29udGVudENvbXBvbmVudC5pbnN0YW5jZTtcbiAgICAgICAgY29uc3QgX2FuY2hvciA9IGFuY2hvciBpbnN0YW5jZW9mIEVsZW1lbnRSZWYgPyBhbmNob3IubmF0aXZlRWxlbWVudCA6IGFuY2hvcjtcbiAgICAgICAgY29udGVudC52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgY29udGVudC5hbmNob3IgPSBfYW5jaG9yO1xuICAgICAgICBjb250ZW50LnBvc2l0aW9uID0gcG9wb3Zlci5wb3NpdGlvbjtcbiAgICAgICAgY29udGVudC5vZmZzZXQgPSBwb3BvdmVyLm9mZnNldDtcbiAgICAgICAgY29udGVudC53aWR0aCA9IHBvcG92ZXIud2lkdGg7XG4gICAgICAgIGNvbnRlbnQuaGVpZ2h0ID0gcG9wb3Zlci5oZWlnaHQ7XG4gICAgICAgIGNvbnRlbnQudGl0bGUgPSBwb3BvdmVyLnRpdGxlO1xuICAgICAgICBjb250ZW50LmJvZHkgPSBwb3BvdmVyLmJvZHk7XG4gICAgICAgIGNvbnRlbnQuY2FsbG91dCA9IHBvcG92ZXIuY2FsbG91dDtcbiAgICAgICAgY29udGVudC5hbmltYXRpb24gPSBwb3BvdmVyLmFuaW1hdGlvbjtcbiAgICAgICAgY29udGVudC5jb250ZXh0RGF0YSA9IHBvcG92ZXIudGVtcGxhdGVEYXRhKF9hbmNob3IpO1xuICAgICAgICBjb250ZW50LnRpdGxlVGVtcGxhdGUgPSBwb3BvdmVyLnRpdGxlVGVtcGxhdGU7XG4gICAgICAgIGNvbnRlbnQuYm9keVRlbXBsYXRlID0gcG9wb3Zlci5ib2R5VGVtcGxhdGU7XG4gICAgICAgIGNvbnRlbnQuYWN0aW9uc1RlbXBsYXRlID0gcG9wb3Zlci5hY3Rpb25zVGVtcGxhdGU7XG4gICAgICAgIHRoaXMucG9wdXBSZWYuY29udGVudC5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBpbml0aWFsaXplRXZlbnRzKHBvcG92ZXJDb21wLCBldmVudEFyZ3MsIHNob3csIGFuY2hvckVsZW1lbnQpIHtcbiAgICAgICAgaWYgKHNob3cpIHtcbiAgICAgICAgICAgIGV2ZW50QXJncyA9IG5ldyBQb3BvdmVyU2hvd0V2ZW50KGFuY2hvckVsZW1lbnQpO1xuICAgICAgICAgICAgaWYgKHRoaXMuc2hvdWxkRW1pdEV2ZW50KCEhdGhpcy5wb3B1cFJlZiwgJ3Nob3cnLCBwb3BvdmVyQ29tcCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4gcG9wb3ZlckNvbXAuc2hvdy5lbWl0KGV2ZW50QXJncykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZXZlbnRBcmdzID0gbmV3IFBvcG92ZXJIaWRlRXZlbnQoYW5jaG9yRWxlbWVudCwgdGhpcy5wb3B1cFJlZik7XG4gICAgICAgICAgICBpZiAodGhpcy5zaG91bGRFbWl0RXZlbnQoISF0aGlzLnBvcHVwUmVmLCAnaGlkZScsIHBvcG92ZXJDb21wKSkge1xuICAgICAgICAgICAgICAgIHRoaXMubmdab25lLnJ1bigoKSA9PiBwb3BvdmVyQ29tcC5oaWRlLmVtaXQoZXZlbnRBcmdzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGV2ZW50QXJncztcbiAgICB9XG4gICAgaW5pdGlhbGl6ZUNvbXBsZXRpb25FdmVudHMocG9wb3ZlckNvbXAsIF9hbmNob3IpIHtcbiAgICAgICAgaWYgKHRoaXMuc2hvdWxkRW1pdENvbXBsZXRpb25FdmVudHMoJ3Nob3duJywgcG9wb3ZlckNvbXApKSB7XG4gICAgICAgICAgICB0aGlzLnBvcHVwUmVmLnBvcHVwT3Blbi5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50QXJncyA9IG5ldyBQb3BvdmVyU2hvd25FdmVudChfYW5jaG9yLCB0aGlzLnBvcHVwUmVmKTtcbiAgICAgICAgICAgICAgICBwb3BvdmVyQ29tcC5zaG93bi5lbWl0KGV2ZW50QXJncyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zaG91bGRFbWl0Q29tcGxldGlvbkV2ZW50cygnaGlkZGVuJywgcG9wb3ZlckNvbXApKSB7XG4gICAgICAgICAgICB0aGlzLnBvcHVwUmVmLnBvcHVwQ2xvc2Uuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLm5nWm9uZS5ydW4oXyA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50QXJncyA9IG5ldyBQb3BvdmVySGlkZGVuRXZlbnQoX2FuY2hvcik7XG4gICAgICAgICAgICAgICAgICAgIHBvcG92ZXJDb21wLmhpZGRlbi5lbWl0KGV2ZW50QXJncyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzaG91bGRFbWl0RXZlbnQoaGFzUG9wdXAsIGV2ZW50LCBwb3BvdmVyQ29tcCkge1xuICAgICAgICBpZiAoKGV2ZW50ID09PSAnc2hvdycgJiYgIWhhc1BvcHVwICYmIGhhc09ic2VydmVycyhwb3BvdmVyQ29tcFtldmVudF0pKVxuICAgICAgICAgICAgfHwgKGV2ZW50ID09PSAnaGlkZScgJiYgaGFzUG9wdXAgJiYgaGFzT2JzZXJ2ZXJzKHBvcG92ZXJDb21wW2V2ZW50XSkpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHNob3VsZEVtaXRDb21wbGV0aW9uRXZlbnRzKGV2ZW50LCBwb3BvdmVyQ29tcCkge1xuICAgICAgICBpZiAoKGhhc09ic2VydmVycyhwb3BvdmVyQ29tcFtldmVudF0pICYmICF0aGlzLl9wb3B1cE9wZW5TdWIpXG4gICAgICAgICAgICB8fCAoaGFzT2JzZXJ2ZXJzKHBvcG92ZXJDb21wW2V2ZW50XSkgJiYgIXRoaXMuX3BvcHVwQ2xvc2VTdWIpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufVxuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgT2JqZWN0KSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW09iamVjdF0pXG5dLCBQb3BvdmVyRGlyZWN0aXZlc0Jhc2UucHJvdG90eXBlLCBcInBvcG92ZXJcIiwgbnVsbCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbU3RyaW5nXSlcbl0sIFBvcG92ZXJEaXJlY3RpdmVzQmFzZS5wcm90b3R5cGUsIFwic2hvd09uXCIsIG51bGwpO1xuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xubGV0IFBvcG92ZXJTZXJ2aWNlID0gY2xhc3MgUG9wb3ZlclNlcnZpY2Uge1xuICAgIGNvbnN0cnVjdG9yKG5nWm9uZSkge1xuICAgICAgICB0aGlzLm5nWm9uZSA9IG5nWm9uZTtcbiAgICAgICAgdGhpcy5fcG9pbnRlck92ZXJQb3B1cCA9IG5ldyBCZWhhdmlvclN1YmplY3QobnVsbCk7XG4gICAgICAgIHRoaXMuX3BvaW50ZXJPdmVyQW5jaG9yID0gbmV3IEJlaGF2aW9yU3ViamVjdChudWxsKTtcbiAgICAgICAgdGhpcy5fZm9jdXNJbnNpZGVQb3BvdmVyID0gbmV3IEJlaGF2aW9yU3ViamVjdChudWxsKTtcbiAgICAgICAgdGhpcy5faGlkZVBvcG92ZXIgPSBuZXcgU3ViamVjdCgpO1xuICAgICAgICB0aGlzLnN1YnMgPSBuZXcgU3Vic2NyaXB0aW9uKCk7XG4gICAgICAgIHRoaXMubW9uaXRvcigpO1xuICAgIH1cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5zdWJzLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICAgIGdldCBpc1BvcG92ZXJIb3ZlcmVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcG9pbnRlck92ZXJQb3B1cC5hc09ic2VydmFibGUoKTtcbiAgICB9XG4gICAgZW1pdFBvcG92ZXJTdGF0ZShpc0hvdmVyZWQpIHtcbiAgICAgICAgdGhpcy5uZ1pvbmUucnVuKF8gPT4gdGhpcy5fcG9pbnRlck92ZXJQb3B1cC5uZXh0KGlzSG92ZXJlZCkpO1xuICAgIH1cbiAgICBnZXQgaXNBbmNob3JIb3ZlcmVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcG9pbnRlck92ZXJBbmNob3IuYXNPYnNlcnZhYmxlKCk7XG4gICAgfVxuICAgIGVtaXRBbmNob3JTdGF0ZShpc0hvdmVyZWQsIGFuY2hvcikge1xuICAgICAgICB0aGlzLl9pc09yaWdpbiA9IHRoaXMub3JpZ2luQW5jaG9yID09PSBhbmNob3I7XG4gICAgICAgIHRoaXMuY3VycmVudEFuY2hvciA9IGFuY2hvcjtcbiAgICAgICAgaWYgKGlzSG92ZXJlZCkge1xuICAgICAgICAgICAgdGhpcy5vcmlnaW5BbmNob3IgPSBhbmNob3I7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5uZ1pvbmUucnVuKF8gPT4gdGhpcy5fcG9pbnRlck92ZXJBbmNob3IubmV4dChpc0hvdmVyZWQpKTtcbiAgICB9XG4gICAgZ2V0IGlzRm9jdXNJbnNpZGVQb3BvdmVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZm9jdXNJbnNpZGVQb3BvdmVyLmFzT2JzZXJ2YWJsZSgpO1xuICAgIH1cbiAgICBlbWl0Rm9jdXNJbnNpZGVQb3BvdmVyKGlzRm9jdXNlZCkge1xuICAgICAgICB0aGlzLm5nWm9uZS5ydW4oXyA9PiB0aGlzLl9mb2N1c0luc2lkZVBvcG92ZXIubmV4dChpc0ZvY3VzZWQpKTtcbiAgICAgICAgdGhpcy5fZm9jdXNJbnNpZGVQb3BvdmVyLm5leHQobnVsbCk7XG4gICAgfVxuICAgIGdldCBoaWRlUG9wb3ZlcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2hpZGVQb3BvdmVyLmFzT2JzZXJ2YWJsZSgpO1xuICAgIH1cbiAgICBtb25pdG9yKCkge1xuICAgICAgICB0aGlzLnN1YnMuYWRkKGNvbWJpbmVMYXRlc3QodGhpcy5pc1BvcG92ZXJIb3ZlcmVkLCB0aGlzLmlzQW5jaG9ySG92ZXJlZCkucGlwZShcbiAgICAgICAgLy8gYGF1ZGl0VGltZWAgaXMgdXNlZCBiZWNhdXNlIHRoZSBgbW91c2VsZWF2ZWAgZXZlbnQgaXMgZW1pdHRlZCBiZWZvcmUgYG1vdXNlZW50ZXJgXG4gICAgICAgIC8vIGkuZS4gdGhlcmUgaXMgYSBtaWxsaXNlY29uZCBpbiB3aGljaCB0aGUgcG9pbnRlciBsZWF2ZXMgdGhlIGZpcnN0IHRhcmdldCAoZS5nLiBhbmNob3IpIGFuZCBoYXNuJ3QgcmVhY2hlZCB0aGUgc2Vjb25kIG9uZSAoZS5nLiBwb3B1cClcbiAgICAgICAgLy8gcmVzdWx0aW5nIGluIGJvdGggb2JzZXJ2YWJsZXMgZW1pdHRpbmcgYGZhbHNlYFxuICAgICAgICBhdWRpdFRpbWUoMjApKS5zdWJzY3JpYmUodmFsID0+IHtcbiAgICAgICAgICAgIGNvbnN0IFtpc1BvcG92ZXJIb3ZlcmVkLCBpc0FuY2hvckhvdmVyZWRdID0gdmFsO1xuICAgICAgICAgICAgdGhpcy5faGlkZVBvcG92ZXIubmV4dChbaXNQb3BvdmVySG92ZXJlZCwgaXNBbmNob3JIb3ZlcmVkLCB0aGlzLl9pc09yaWdpbiwgdGhpcy5jdXJyZW50QW5jaG9yXSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG59O1xuUG9wb3ZlclNlcnZpY2UgPSBfX2RlY29yYXRlKFtcbiAgICBJbmplY3RhYmxlKCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtOZ1pvbmVdKVxuXSwgUG9wb3ZlclNlcnZpY2UpO1xuXG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIFtga2VuZG9Qb3BvdmVyQ29udGFpbmVyYF0oeyUgc2x1ZyBjb25maWd1cmF0aW9uX3BvcG92ZXIgJX0jdG9jLWNvbnRhaW5lcmRpcmVjdGl2ZSkgZGlyZWN0aXZlLlxuICogSXQgaXMgdXNlZCB0byBmaWx0ZXIgYW5kIHRhcmdldCBtdWx0aXBsZSBlbGVtZW50cywgd2hpY2ggc2hvdWxkIGRpc3BsYXkgYSBwb3BvdmVyIG9uIGludGVyYWN0aW9uLlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGB0cy1uby1ydW5cbiAqIDxkaXYga2VuZG9Qb3BvdmVyQ29udGFpbmVyIFtwb3BvdmVyXT1cIm15UG9wb3ZlclwiIGZpbHRlcj1cIi5oYXMtcG9wb3ZlclwiPlxuICogICAgIDxidXR0b24gY2xhc3M9XCJoYXMtcG9wb3ZlclwiPlNob3cgUG9wb3ZlcjwvYnV0dG9uPlxuICogICAgIDxidXR0b24+QnV0dG9uIFdpdGhvdXQgUG9wb3ZlcjwvYnV0dG9uPlxuICogICAgIDxidXR0b24gY2xhc3M9XCJoYXMtcG9wb3ZlclwiPlNob3cgUG9wb3ZlcjwvYnV0dG9uPlxuICogPC9kaXY+XG4gKiBgYGBcbiAqL1xubGV0IFBvcG92ZXJDb250YWluZXJEaXJlY3RpdmUgPSBjbGFzcyBQb3BvdmVyQ29udGFpbmVyRGlyZWN0aXZlIGV4dGVuZHMgUG9wb3ZlckRpcmVjdGl2ZXNCYXNlIHtcbiAgICBjb25zdHJ1Y3Rvcih3cmFwcGVyRWwsIG5nWm9uZSwgcG9wdXBTZXJ2aWNlLCByZW5kZXJlciwgcG9wb3ZlclNlcnZpY2UpIHtcbiAgICAgICAgc3VwZXIobmdab25lLCBwb3B1cFNlcnZpY2UsIHJlbmRlcmVyKTtcbiAgICAgICAgdGhpcy53cmFwcGVyRWwgPSB3cmFwcGVyRWw7XG4gICAgICAgIHRoaXMubmdab25lID0gbmdab25lO1xuICAgICAgICB0aGlzLnBvcHVwU2VydmljZSA9IHBvcHVwU2VydmljZTtcbiAgICAgICAgdGhpcy5yZW5kZXJlciA9IHJlbmRlcmVyO1xuICAgICAgICB0aGlzLnBvcG92ZXJTZXJ2aWNlID0gcG9wb3ZlclNlcnZpY2U7XG4gICAgICAgIHRoaXMubW91c2VlbnRlckhhbmRsZXIgPSAoYW5jaG9yKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xWaXNpYmlsaXR5KGFuY2hvciwgdHJ1ZSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMubW91c2VsZWF2ZUhhbmRsZXIgPSAoYXJncykgPT4ge1xuICAgICAgICAgICAgY29uc3QgYW5jaG9yID0gYXJncy5hbmNob3I7XG4gICAgICAgICAgICBpZiAodGhpcy5pc1ByZXZlbnRlZChhbmNob3IsIGZhbHNlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGhpcy5faGlkZVN1Yikge1xuICAgICAgICAgICAgICAgIHRoaXMuX2hpZGVTdWIgPSB0aGlzLnBvcG92ZXJTZXJ2aWNlLmhpZGVQb3BvdmVyLnN1YnNjcmliZSgodmFsKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IFtpc1BvcG92ZXJIb3ZlcmVkLCAsIGlzT3JpZ2luQW5jaG9yLCBjdXJyZW50QW5jaG9yXSA9IHZhbDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc1BvcG92ZXJIb3ZlcmVkICYmICFpc09yaWdpbkFuY2hvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzT3JpZ2luQW5jaG9yICYmIGN1cnJlbnRBbmNob3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3coY3VycmVudEFuY2hvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5mb2N1c0hhbmRsZXIgPSAoYW5jaG9yKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xWaXNpYmlsaXR5KGFuY2hvciwgdHJ1ZSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYmx1ckhhbmRsZXIgPSAoYXJncykgPT4ge1xuICAgICAgICAgICAgY29uc3QgYW5jaG9yID0gYXJncy5hbmNob3I7XG4gICAgICAgICAgICBjb25zdCBldmVudCA9IGFyZ3MuZG9tRXZlbnQ7XG4gICAgICAgICAgICBpZiAodGhpcy5pc1ByZXZlbnRlZChhbmNob3IsIGZhbHNlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGZyb20gYW5jaG9yIHRvIHBvcHVwIGZvY3VzIGNoZWNrXG4gICAgICAgICAgICBjb25zdCBpc0ZvY3VzSW5zaWRlID0gISFjbG9zZXN0KGV2ZW50LnJlbGF0ZWRUYXJnZXQsIChub2RlKSA9PiBub2RlLmNsYXNzTGlzdCAmJiBub2RlLmNsYXNzTGlzdC5jb250YWlucygnay1wb3BvdmVyJykpO1xuICAgICAgICAgICAgaWYgKCFpc0ZvY3VzSW5zaWRlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXMuX2ZvY3VzSW5zaWRlU3ViKSB7XG4gICAgICAgICAgICAgICAgLy8gaW5zaWRlIHBvcHVwIGZvY3VzIGNoZWNrXG4gICAgICAgICAgICAgICAgdGhpcy5fZm9jdXNJbnNpZGVTdWIgPSB0aGlzLnBvcG92ZXJTZXJ2aWNlLmlzRm9jdXNJbnNpZGVQb3BvdmVyLnBpcGUoZmlsdGVyKHYgPT4gdiAhPT0gbnVsbCkpLnN1YnNjcmliZSgodmFsKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdmFsICYmICFpc0ZvY3VzSW5zaWRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9wb3BvdmVyU2VydmljZSA9IHRoaXMucG9wb3ZlclNlcnZpY2U7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNob3dzIHRoZSBQb3BvdmVyLlxuICAgICAqXG4gICAgICogQHBhcmFtIGFuY2hvciZtZGFzaDtTcGVjaWZpZXMgdGhlIGVsZW1lbnQgdGhhdCB3aWxsIGJlIHVzZWQgYXMgYW4gYW5jaG9yLiBUaGUgUG9wb3ZlciBvcGVucyByZWxhdGl2ZSB0byB0aGF0IGVsZW1lbnQuIFtTZWUgZXhhbXBsZV0oeyUgc2x1ZyBwcm9ncmFtbWF0aWNjb250cm9sX3BvcG92ZXIgJX0pXG4gICAgICovXG4gICAgc2hvdyhhbmNob3IpIHtcbiAgICAgICAgaWYgKHRoaXMucG9wdXBSZWYpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5vcGVuUG9wdXAoYW5jaG9yKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucG9wdXBSZWYucG9wdXBBbmNob3JWaWV3cG9ydExlYXZlXG4gICAgICAgICAgICAucGlwZSh0YWtlKDEpKVxuICAgICAgICAgICAgLnN1YnNjcmliZSgoKSA9PiB0aGlzLmhpZGUoKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRvZ2dsZXMgdGhlIHZpc2liaWxpdHkgb2YgdGhlIFBvcG92ZXIuIFtTZWUgZXhhbXBsZV0oeyUgc2x1ZyBwcm9ncmFtbWF0aWNjb250cm9sX3BvcG92ZXIgJX0pXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYW5jaG9yJm1kYXNoO1NwZWNpZmllcyB0aGUgZWxlbWVudCB0aGF0IHdpbGwgYmUgdXNlZCBhcyBhbiBhbmNob3IuIFRoZSBQb3BvdmVyIG9wZW5zIHJlbGF0aXZlIHRvIHRoYXQgZWxlbWVudC5cbiAgICAgKi9cbiAgICB0b2dnbGUoYW5jaG9yKSB7XG4gICAgICAgIGNvbnN0IHByZXZpb3VzQW5jaG9yID0gdGhpcy5wb3B1cFJlZiAmJiB0aGlzLnBvcHVwUmVmLmNvbnRlbnQuaW5zdGFuY2UuYW5jaG9yO1xuICAgICAgICBpZiAodGhpcy5wb3B1cFJlZikge1xuICAgICAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICAgICAgICBpZiAocHJldmlvdXNBbmNob3IgIT09IGFuY2hvcikge1xuICAgICAgICAgICAgICAgIHRoaXMuc2hvdyhhbmNob3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zaG93KGFuY2hvcik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc3Vic2NyaWJlQ2xpY2soKSB7XG4gICAgICAgIGlmICh0aGlzLmRpc3Bvc2VDbGlja0xpc3RlbmVyKSB7XG4gICAgICAgICAgICB0aGlzLmRpc3Bvc2VDbGlja0xpc3RlbmVyKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5kaXNwb3NlQ2xpY2tMaXN0ZW5lciA9IHRoaXMucmVuZGVyZXIubGlzdGVuKGRvY3VtZW50LCAnY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZmlsdGVyRWxlbWVudCA9IGNsb3Nlc3RCeVNlbGVjdG9yKGUudGFyZ2V0LCB0aGlzLmZpbHRlcik7XG4gICAgICAgICAgICB0aGlzLmNsaWNrSGFuZGxlcihmaWx0ZXJFbGVtZW50LCBlKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN1YnNjcmliZVRvRXZlbnRzKGFycikge1xuICAgICAgICBjb25zdCBmaWx0ZXJlZEVsZW1lbnRzID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuZmlsdGVyKSk7XG4gICAgICAgIGZpbHRlcmVkRWxlbWVudHMuZm9yRWFjaCgoZWwpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc3Vicy5hZGQodGhpcy5yZW5kZXJlci5saXN0ZW4oZWwsIGFyclswXS5uYW1lLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5wb3BvdmVyU2VydmljZS5lbWl0QW5jaG9yU3RhdGUodHJ1ZSwgZWwpO1xuICAgICAgICAgICAgICAgIGFyclswXS5oYW5kbGVyKGVsKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIHRoaXMuc3Vicy5hZGQodGhpcy5yZW5kZXJlci5saXN0ZW4oZWwsIGFyclsxXS5uYW1lLCAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucG9wb3ZlclNlcnZpY2UuZW1pdEFuY2hvclN0YXRlKGZhbHNlLCBudWxsKTtcbiAgICAgICAgICAgICAgICBhcnJbMV0uaGFuZGxlcih7IGFuY2hvcjogZWwsIGRvbUV2ZW50OiBlIH0pO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgY2xpY2tIYW5kbGVyKGFuY2hvciwgZXZlbnQpIHtcbiAgICAgICAgY29uc3QgaXNJbnNpZGVQb3B1cCA9ICEhY2xvc2VzdChldmVudC50YXJnZXQsIChub2RlKSA9PiBub2RlLmNsYXNzTGlzdCAmJiBub2RlLmNsYXNzTGlzdC5jb250YWlucygnay1wb3B1cCcpKTtcbiAgICAgICAgY29uc3QgcG9wdXBSZWZBbmNob3IgPSB0aGlzLnBvcHVwUmVmICYmIHRoaXMucG9wdXBSZWYuY29udGVudC5pbnN0YW5jZS5hbmNob3I7XG4gICAgICAgIGxldCBpc09yaWdpbkFuY2hvciA9ICEhY2xvc2VzdChldmVudC50YXJnZXQsIChub2RlKSA9PiBub2RlID09PSAocG9wdXBSZWZBbmNob3IgPyBwb3B1cFJlZkFuY2hvciA6IGFuY2hvcikpO1xuICAgICAgICBpZiAodGhpcy5zaG93T24gIT09ICdjbGljaycgfHwgaXNJbnNpZGVQb3B1cCB8fCAodGhpcy5wb3B1cFJlZiAmJiBpc09yaWdpbkFuY2hvcikpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWFuY2hvciAmJiB0aGlzLnBvcHVwUmVmKSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xWaXNpYmlsaXR5KGFuY2hvciwgZmFsc2UpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc09yaWdpbkFuY2hvcikge1xuICAgICAgICAgICAgdGhpcy5jb250cm9sVmlzaWJpbGl0eShhbmNob3IsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMucG9wdXBSZWYpIHtcbiAgICAgICAgICAgIHRoaXMuY29udHJvbFZpc2liaWxpdHkoYW5jaG9yLCBmYWxzZSk7XG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xWaXNpYmlsaXR5KGFuY2hvciwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29udHJvbFZpc2liaWxpdHkoYW5jaG9yLCBzaG93KSB7XG4gICAgICAgIGlmICh0aGlzLmlzUHJldmVudGVkKGFuY2hvciwgc2hvdykpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBzaG93ID8gdGhpcy5zaG93KGFuY2hvcikgOiB0aGlzLmhpZGUoKTtcbiAgICB9XG59O1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKVxuXSwgUG9wb3ZlckNvbnRhaW5lckRpcmVjdGl2ZS5wcm90b3R5cGUsIFwiZmlsdGVyXCIsIHZvaWQgMCk7XG5Qb3BvdmVyQ29udGFpbmVyRGlyZWN0aXZlID0gX19kZWNvcmF0ZShbXG4gICAgRGlyZWN0aXZlKHtcbiAgICAgICAgc2VsZWN0b3I6ICdba2VuZG9Qb3BvdmVyQ29udGFpbmVyXScsXG4gICAgICAgIGV4cG9ydEFzOiAna2VuZG9Qb3BvdmVyQ29udGFpbmVyJyxcbiAgICAgICAgcHJvdmlkZXJzOiBbUG9wb3ZlclNlcnZpY2VdXG4gICAgfSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtFbGVtZW50UmVmLFxuICAgICAgICBOZ1pvbmUsXG4gICAgICAgIFBvcHVwU2VydmljZSxcbiAgICAgICAgUmVuZGVyZXIyLFxuICAgICAgICBQb3BvdmVyU2VydmljZV0pXG5dLCBQb3BvdmVyQ29udGFpbmVyRGlyZWN0aXZlKTtcblxuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBbYGtlbmRvUG9wb3ZlckFuY2hvcmBdKHslIHNsdWcgY29uZmlndXJhdGlvbl9wb3BvdmVyICV9I3RvYy1hbmNob3JkaXJlY3RpdmUpIGRpcmVjdGl2ZS5cbiAqIEl0IGlzIHVzZWQgdG8gdGFyZ2V0IGFuIGVsZW1lbnQsIHdoaWNoIHNob3VsZCBkaXNwbGF5IGEgcG9wb3ZlciBvbiBpbnRlcmFjdGlvbi5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgdHMtbm8tcnVuXG4gKiA8YnV0dG9uIGtlbmRvUG9wb3ZlckFuY2hvciBbcG9wb3Zlcl09XCJteVBvcG92ZXJcIj5TaG93IFBvcG92ZXI8L2J1dHRvbj5cbiAqIGBgYFxuICovXG5sZXQgUG9wb3ZlckFuY2hvckRpcmVjdGl2ZSA9IGNsYXNzIFBvcG92ZXJBbmNob3JEaXJlY3RpdmUgZXh0ZW5kcyBQb3BvdmVyRGlyZWN0aXZlc0Jhc2Uge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RFbCwgbmdab25lLCBwb3B1cFNlcnZpY2UsIHJlbmRlcmVyLCBwb3BvdmVyU2VydmljZSkge1xuICAgICAgICBzdXBlcihuZ1pvbmUsIHBvcHVwU2VydmljZSwgcmVuZGVyZXIpO1xuICAgICAgICB0aGlzLmhvc3RFbCA9IGhvc3RFbDtcbiAgICAgICAgdGhpcy5uZ1pvbmUgPSBuZ1pvbmU7XG4gICAgICAgIHRoaXMucG9wdXBTZXJ2aWNlID0gcG9wdXBTZXJ2aWNlO1xuICAgICAgICB0aGlzLnJlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgICAgIHRoaXMucG9wb3ZlclNlcnZpY2UgPSBwb3BvdmVyU2VydmljZTtcbiAgICAgICAgdGhpcy5tb3VzZWVudGVySGFuZGxlciA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY29udHJvbFZpc2liaWxpdHkodGhpcy5ob3N0RWwubmF0aXZlRWxlbWVudCwgdHJ1ZSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMubW91c2VsZWF2ZUhhbmRsZXIgPSAoKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5pc1ByZXZlbnRlZCh0aGlzLmhvc3RFbC5uYXRpdmVFbGVtZW50LCBmYWxzZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXMuX2hpZGVTdWIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9oaWRlU3ViID0gdGhpcy5wb3BvdmVyU2VydmljZS5oaWRlUG9wb3Zlci5zdWJzY3JpYmUoKHZhbCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBbaXNQb3BvdmVySG92ZXJlZCwgaXNBbmNob3JIb3ZlcmVkXSA9IHZhbDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc1BvcG92ZXJIb3ZlcmVkICYmICFpc0FuY2hvckhvdmVyZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZm9jdXNIYW5kbGVyID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jb250cm9sVmlzaWJpbGl0eSh0aGlzLmhvc3RFbC5uYXRpdmVFbGVtZW50LCB0cnVlKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5ibHVySGFuZGxlciA9IChhcmdzKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBldmVudCA9IGFyZ3MuZG9tRXZlbnQ7XG4gICAgICAgICAgICBpZiAodGhpcy5pc1ByZXZlbnRlZCh0aGlzLmhvc3RFbC5uYXRpdmVFbGVtZW50LCBmYWxzZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBmcm9tIGFuY2hvciB0byBwb3B1cCBmb2N1cyBjaGVja1xuICAgICAgICAgICAgY29uc3QgaXNGb2N1c0luc2lkZSA9ICEhY2xvc2VzdChldmVudC5yZWxhdGVkVGFyZ2V0LCAobm9kZSkgPT4gbm9kZS5jbGFzc0xpc3QgJiYgbm9kZS5jbGFzc0xpc3QuY29udGFpbnMoJ2stcG9wb3ZlcicpKTtcbiAgICAgICAgICAgIGlmICghaXNGb2N1c0luc2lkZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuaGlkZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0aGlzLl9mb2N1c0luc2lkZVN1Yikge1xuICAgICAgICAgICAgICAgIC8vIGluc2lkZSBwb3B1cCBmb2N1cyBjaGVja1xuICAgICAgICAgICAgICAgIHRoaXMuX2ZvY3VzSW5zaWRlU3ViID0gdGhpcy5wb3BvdmVyU2VydmljZS5pc0ZvY3VzSW5zaWRlUG9wb3Zlci5waXBlKGZpbHRlcih2ID0+IHYgIT09IG51bGwpKS5zdWJzY3JpYmUoKHZhbCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXZhbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5fcG9wb3ZlclNlcnZpY2UgPSB0aGlzLnBvcG92ZXJTZXJ2aWNlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTaG93cyB0aGUgUG9wb3Zlci4gW1NlZSBleGFtcGxlXSh7JSBzbHVnIHByb2dyYW1tYXRpY2NvbnRyb2xfcG9wb3ZlciAlfSlcbiAgICAgKi9cbiAgICBzaG93KCkge1xuICAgICAgICBpZiAodGhpcy5wb3B1cFJlZikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubmdab25lLnJ1bigoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm9wZW5Qb3B1cCh0aGlzLmhvc3RFbCk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnBvcHVwUmVmLnBvcHVwQW5jaG9yVmlld3BvcnRMZWF2ZVxuICAgICAgICAgICAgLnBpcGUodGFrZSgxKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKCkgPT4gdGhpcy5oaWRlKCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUb2dnbGVzIHRoZSB2aXNpYmlsaXR5IG9mIHRoZSBQb3BvdmVyLiBbU2VlIGV4YW1wbGVdKHslIHNsdWcgcHJvZ3JhbW1hdGljY29udHJvbF9wb3BvdmVyICV9KVxuICAgICAqL1xuICAgIHRvZ2dsZSgpIHtcbiAgICAgICAgaWYgKHRoaXMucG9wdXBSZWYpIHtcbiAgICAgICAgICAgIHRoaXMuaGlkZSgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zaG93KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc3Vic2NyaWJlVG9FdmVudHMoYXJyKSB7XG4gICAgICAgIHRoaXMuc3Vicy5hZGQodGhpcy5yZW5kZXJlci5saXN0ZW4odGhpcy5ob3N0RWwubmF0aXZlRWxlbWVudCwgYXJyWzBdLm5hbWUsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMucG9wb3ZlclNlcnZpY2UuZW1pdEFuY2hvclN0YXRlKHRydWUsIHRoaXMuaG9zdEVsLm5hdGl2ZUVsZW1lbnQpO1xuICAgICAgICAgICAgYXJyWzBdLmhhbmRsZXIoKTtcbiAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLnN1YnMuYWRkKHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMuaG9zdEVsLm5hdGl2ZUVsZW1lbnQsIGFyclsxXS5uYW1lLCAoZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5wb3BvdmVyU2VydmljZS5lbWl0QW5jaG9yU3RhdGUoZmFsc2UsIG51bGwpO1xuICAgICAgICAgICAgYXJyWzFdLmhhbmRsZXIoeyBkb21FdmVudDogZSB9KTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBzdWJzY3JpYmVDbGljaygpIHtcbiAgICAgICAgaWYgKHRoaXMuZGlzcG9zZUNsaWNrTGlzdGVuZXIpIHtcbiAgICAgICAgICAgIHRoaXMuZGlzcG9zZUNsaWNrTGlzdGVuZXIoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRpc3Bvc2VDbGlja0xpc3RlbmVyID0gdGhpcy5yZW5kZXJlci5saXN0ZW4oZG9jdW1lbnQsICdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm9uQ2xpY2soZSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgb25DbGljayhldmVudCkge1xuICAgICAgICBjb25zdCBpc0luc2lkZVBvcHVwID0gISFjbG9zZXN0KGV2ZW50LnRhcmdldCwgKG5vZGUpID0+IG5vZGUuY2xhc3NMaXN0ICYmIG5vZGUuY2xhc3NMaXN0LmNvbnRhaW5zKCdrLXBvcHVwJykpO1xuICAgICAgICBsZXQgaXNBbmNob3IgPSAhIWNsb3Nlc3QoZXZlbnQudGFyZ2V0LCAobm9kZSkgPT4gbm9kZSA9PT0gdGhpcy5ob3N0RWwubmF0aXZlRWxlbWVudCk7XG4gICAgICAgIGlmIChpc0luc2lkZVBvcHVwIHx8ICh0aGlzLnBvcHVwUmVmICYmIGlzQW5jaG9yKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc0FuY2hvcikge1xuICAgICAgICAgICAgLy8gb24gb3BlbmluZ1xuICAgICAgICAgICAgdGhpcy5jb250cm9sVmlzaWJpbGl0eSh0aGlzLmhvc3RFbC5uYXRpdmVFbGVtZW50LCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIG9uIGNsb3NpbmdcbiAgICAgICAgICAgIHRoaXMuY29udHJvbFZpc2liaWxpdHkodGhpcy5ob3N0RWwubmF0aXZlRWxlbWVudCwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnRyb2xWaXNpYmlsaXR5KGFuY2hvciwgc2hvdykge1xuICAgICAgICBpZiAodGhpcy5pc1ByZXZlbnRlZChhbmNob3IsIHNob3cpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgc2hvdyA/IHRoaXMuc2hvdygpIDogdGhpcy5oaWRlKCk7XG4gICAgfVxufTtcblBvcG92ZXJBbmNob3JEaXJlY3RpdmUgPSBfX2RlY29yYXRlKFtcbiAgICBEaXJlY3RpdmUoe1xuICAgICAgICBzZWxlY3RvcjogJ1trZW5kb1BvcG92ZXJBbmNob3JdJyxcbiAgICAgICAgZXhwb3J0QXM6ICdrZW5kb1BvcG92ZXJBbmNob3InLFxuICAgICAgICBwcm92aWRlcnM6IFtQb3BvdmVyU2VydmljZV1cbiAgICB9KSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW0VsZW1lbnRSZWYsXG4gICAgICAgIE5nWm9uZSxcbiAgICAgICAgUG9wdXBTZXJ2aWNlLFxuICAgICAgICBSZW5kZXJlcjIsXG4gICAgICAgIFBvcG92ZXJTZXJ2aWNlXSlcbl0sIFBvcG92ZXJBbmNob3JEaXJlY3RpdmUpO1xuXG52YXIgTG9jYWxpemVkTWVzc2FnZXNEaXJlY3RpdmVfMTtcbi8qKlxuICogQGhpZGRlblxuICovXG5sZXQgTG9jYWxpemVkTWVzc2FnZXNEaXJlY3RpdmUgPSBMb2NhbGl6ZWRNZXNzYWdlc0RpcmVjdGl2ZV8xID0gY2xhc3MgTG9jYWxpemVkTWVzc2FnZXNEaXJlY3RpdmUgZXh0ZW5kcyBDb21wb25lbnRNZXNzYWdlcyB7XG4gICAgY29uc3RydWN0b3Ioc2VydmljZSkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLnNlcnZpY2UgPSBzZXJ2aWNlO1xuICAgIH1cbn07XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpXG5dLCBMb2NhbGl6ZWRNZXNzYWdlc0RpcmVjdGl2ZS5wcm90b3R5cGUsIFwiY2xvc2VUaXRsZVwiLCB2b2lkIDApO1xuTG9jYWxpemVkTWVzc2FnZXNEaXJlY3RpdmUgPSBMb2NhbGl6ZWRNZXNzYWdlc0RpcmVjdGl2ZV8xID0gX19kZWNvcmF0ZShbXG4gICAgRGlyZWN0aXZlKHtcbiAgICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcHJvdmlkZTogQ29tcG9uZW50TWVzc2FnZXMsXG4gICAgICAgICAgICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gTG9jYWxpemVkTWVzc2FnZXNEaXJlY3RpdmVfMSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgc2VsZWN0b3I6IGBba2VuZG9Ub29sdGlwTG9jYWxpemVkTWVzc2FnZXNdYFxuICAgIH0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbTG9jYWxpemF0aW9uU2VydmljZV0pXG5dLCBMb2NhbGl6ZWRNZXNzYWdlc0RpcmVjdGl2ZSk7XG5cbmNvbnN0IENPTVBPTkVOVF9ESVJFQ1RJVkVTID0gW1Rvb2x0aXBEaXJlY3RpdmUsIFRvb2x0aXBDb250ZW50Q29tcG9uZW50LCBMb2NhbGl6ZWRNZXNzYWdlc0RpcmVjdGl2ZV07XG5jb25zdCBDT01QT05FTlRfTU9EVUxFUyA9IFtQb3B1cE1vZHVsZV07XG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIFtOZ01vZHVsZV0oe3sgc2l0ZS5kYXRhLnVybHMuYW5ndWxhclsnbmdtb2R1bGVhcGknXSB9fSlcbiAqIGRlZmluaXRpb24gZm9yIHRoZSBUb29sdGlwIGNvbXBvbmVudC5cbiAqXG4gKiBUaGUgcGFja2FnZSBleHBvcnRzOlxuICogLSBgS2VuZG9Ub29sdGlwRGlyZWN0aXZlYCZtZGFzaDtUaGUgVG9vbHRpcCBkaXJlY3RpdmUgY2xhc3MuXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiBgYGB0cy1uby1ydW5cbiAqIC8vIEltcG9ydCB0aGUgVG9vbHRpcCBtb2R1bGVcbiAqIGltcG9ydCB7IFRvb2x0aXBNb2R1bGUgfSBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tYW5ndWxhci10b29sdGlwJztcbiAqXG4gKiAvLyBUaGUgYnJvd3NlciBwbGF0Zm9ybSB3aXRoIGEgY29tcGlsZXJcbiAqIGltcG9ydCB7IHBsYXRmb3JtQnJvd3NlckR5bmFtaWMgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyLWR5bmFtaWMnO1xuICpcbiAqIGltcG9ydCB7IE5nTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG4gKlxuICogLy8gSW1wb3J0IHRoZSBhcHAgY29tcG9uZW50XG4gKiBfQE5nTW9kdWxle3tcbiAqICAgIGRlY2xhcmF0aW9uczogW0FwcENvbXBvbmVudF0sIC8vIGRlY2xhcmUgYXBwIGNvbXBvbmVudFxuICogICAgaW1wb3J0czogICAgICBbQnJvd3Nlck1vZHVsZSwgVG9vbHRpcE1vZHVsZV0sIC8vIGltcG9ydCBUb29sdGlwTW9kdWxlIG1vZHVsZVxuICogICAgYm9vdHN0cmFwOiAgICBbQXBwQ29tcG9uZW50XVxuICogfX1cbiAqIGV4cG9ydCBjbGFzcyBBcHBNb2R1bGUge31cbiAqXG4gKiAvLyBDb21waWxlIGFuZCBsYXVuY2ggdGhlIG1vZHVsZVxuICogcGxhdGZvcm1Ccm93c2VyRHluYW1pYygpLmJvb3RzdHJhcE1vZHVsZShBcHBNb2R1bGUpO1xuICogYGBgXG4gKi9cbmxldCBUb29sdGlwTW9kdWxlID0gY2xhc3MgVG9vbHRpcE1vZHVsZSB7XG59O1xuVG9vbHRpcE1vZHVsZSA9IF9fZGVjb3JhdGUoW1xuICAgIE5nTW9kdWxlKHtcbiAgICAgICAgZGVjbGFyYXRpb25zOiBbQ09NUE9ORU5UX0RJUkVDVElWRVNdLFxuICAgICAgICBlbnRyeUNvbXBvbmVudHM6IFtUb29sdGlwQ29udGVudENvbXBvbmVudF0sXG4gICAgICAgIGltcG9ydHM6IFtDb21tb25Nb2R1bGUsIC4uLkNPTVBPTkVOVF9NT0RVTEVTXSxcbiAgICAgICAgZXhwb3J0czogW0NPTVBPTkVOVF9ESVJFQ1RJVkVTXVxuICAgIH0pXG5dLCBUb29sdGlwTW9kdWxlKTtcblxuY29uc3QgRElSRUNUSVZFUyA9IFtcbiAgICBQb3BvdmVyQWN0aW9uc1RlbXBsYXRlRGlyZWN0aXZlLFxuICAgIFBvcG92ZXJCb2R5VGVtcGxhdGVEaXJlY3RpdmUsXG4gICAgUG9wb3ZlclRpdGxlVGVtcGxhdGVEaXJlY3RpdmUsXG4gICAgUG9wb3ZlckFuY2hvckRpcmVjdGl2ZSxcbiAgICBQb3BvdmVyQ29udGFpbmVyRGlyZWN0aXZlXG5dO1xuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBbTmdNb2R1bGVdKHt7IHNpdGUuZGF0YS51cmxzLmFuZ3VsYXJbJ25nbW9kdWxlYXBpJ10gfX0pXG4gKiBkZWZpbml0aW9uIGZvciB0aGUgUG9wb3ZlciBjb21wb25lbnQuXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiBgYGB0cy1uby1ydW5cbiAqIGltcG9ydCB7IFBvcG92ZXJNb2R1bGUgfSBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tYW5ndWxhci10b29sdGlwJztcbiAqXG4gKiBpbXBvcnQgeyBwbGF0Zm9ybUJyb3dzZXJEeW5hbWljIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlci1keW5hbWljJztcbiAqIGltcG9ydCB7IE5nTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG4gKlxuICogaW1wb3J0IHsgQXBwQ29tcG9uZW50IH0gZnJvbSAnLi9hcHAuY29tcG9uZW50JztcbiAqXG4gKiBfQE5nTW9kdWxlKHtcbiAqICAgICBkZWNsYXJhdGlvbnM6IFtBcHBDb21wb25lbnRdLFxuICogICAgIGltcG9ydHM6ICAgICAgW0Jyb3dzZXJNb2R1bGUsIFBvcG92ZXJNb2R1bGVdLFxuICogICAgIGJvb3RzdHJhcDogICAgW0FwcENvbXBvbmVudF1cbiAqIH0pXG4gKiBleHBvcnQgY2xhc3MgQXBwTW9kdWxlIHt9XG4gKlxuICogcGxhdGZvcm1Ccm93c2VyRHluYW1pYygpLmJvb3RzdHJhcE1vZHVsZShBcHBNb2R1bGUpO1xuICpcbiAqIGBgYFxuICovXG5sZXQgUG9wb3Zlck1vZHVsZSA9IGNsYXNzIFBvcG92ZXJNb2R1bGUge1xufTtcblBvcG92ZXJNb2R1bGUgPSBfX2RlY29yYXRlKFtcbiAgICBOZ01vZHVsZSh7XG4gICAgICAgIGRlY2xhcmF0aW9uczogW1xuICAgICAgICAgICAgLi4uRElSRUNUSVZFUyxcbiAgICAgICAgICAgIFBvcG92ZXJDb21wb25lbnRcbiAgICAgICAgXSxcbiAgICAgICAgZW50cnlDb21wb25lbnRzOiBbUG9wb3ZlckNvbXBvbmVudF0sXG4gICAgICAgIGV4cG9ydHM6IFsuLi5ESVJFQ1RJVkVTLCBQb3BvdmVyQ29tcG9uZW50XSxcbiAgICAgICAgaW1wb3J0czogW1xuICAgICAgICAgICAgQ29tbW9uTW9kdWxlLFxuICAgICAgICAgICAgUG9wdXBNb2R1bGVcbiAgICAgICAgXVxuICAgIH0pXG5dLCBQb3BvdmVyTW9kdWxlKTtcblxuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBbTmdNb2R1bGVdKHt7IHNpdGUuZGF0YS51cmxzLmFuZ3VsYXJbJ25nbW9kdWxlYXBpJ10gfX0pXG4gKiBkZWZpbml0aW9uIGZvciB0aGUgVG9vbHRpcHMgY29tcG9uZW50cy5cbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqIGBgYHRzLW5vLXJ1blxuICogaW1wb3J0IHsgVG9vbHRpcHNNb2R1bGUgfSBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tYW5ndWxhci10b29sdGlwJztcbiAqXG4gKiAvLyBUaGUgYnJvd3NlciBwbGF0Zm9ybSB3aXRoIGEgY29tcGlsZXJcbiAqIGltcG9ydCB7IHBsYXRmb3JtQnJvd3NlckR5bmFtaWMgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyLWR5bmFtaWMnO1xuICpcbiAqIGltcG9ydCB7IE5nTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG4gKlxuICogLy8gSW1wb3J0IHRoZSBhcHAgY29tcG9uZW50XG4gKiBfQE5nTW9kdWxle3tcbiAqICAgIGRlY2xhcmF0aW9uczogW0FwcENvbXBvbmVudF0sIC8vIGRlY2xhcmUgYXBwIGNvbXBvbmVudFxuICogICAgaW1wb3J0czogICAgICBbQnJvd3Nlck1vZHVsZSwgVG9vbHRpcHNNb2R1bGVdLCAvLyBpbXBvcnQgVG9vbHRpcHNNb2R1bGUgbW9kdWxlXG4gKiAgICBib290c3RyYXA6ICAgIFtBcHBDb21wb25lbnRdXG4gKiB9fVxuICogZXhwb3J0IGNsYXNzIEFwcE1vZHVsZSB7fVxuICpcbiAqIC8vIENvbXBpbGUgYW5kIGxhdW5jaCB0aGUgbW9kdWxlXG4gKiBwbGF0Zm9ybUJyb3dzZXJEeW5hbWljKCkuYm9vdHN0cmFwTW9kdWxlKEFwcE1vZHVsZSk7XG4gKiBgYGBcbiAqL1xubGV0IFRvb2x0aXBzTW9kdWxlID0gY2xhc3MgVG9vbHRpcHNNb2R1bGUge1xufTtcblRvb2x0aXBzTW9kdWxlID0gX19kZWNvcmF0ZShbXG4gICAgTmdNb2R1bGUoe1xuICAgICAgICBleHBvcnRzOiBbVG9vbHRpcE1vZHVsZSwgUG9wb3Zlck1vZHVsZV1cbiAgICB9KVxuXSwgVG9vbHRpcHNNb2R1bGUpO1xuXG4vLyBUb29sdGlwXG5cbi8qKlxuICogR2VuZXJhdGVkIGJ1bmRsZSBpbmRleC4gRG8gbm90IGVkaXQuXG4gKi9cblxuZXhwb3J0IHsgTG9jYWxpemVkTWVzc2FnZXNEaXJlY3RpdmUsIFBvcG92ZXJEaXJlY3RpdmVzQmFzZSwgUG9wb3ZlclNlcnZpY2UsIFRvb2x0aXBDb250ZW50Q29tcG9uZW50LCBUb29sdGlwRGlyZWN0aXZlLCBUb29sdGlwU2V0dGluZ3MsIFRPT0xUSVBfU0VUVElOR1MsIFBvcG92ZXJDb21wb25lbnQsIFBvcG92ZXJDb250YWluZXJEaXJlY3RpdmUsIFBvcG92ZXJBbmNob3JEaXJlY3RpdmUsIFBvcG92ZXJUaXRsZVRlbXBsYXRlRGlyZWN0aXZlLCBQb3BvdmVyQm9keVRlbXBsYXRlRGlyZWN0aXZlLCBQb3BvdmVyQWN0aW9uc1RlbXBsYXRlRGlyZWN0aXZlLCBQb3BvdmVyU2hvd0V2ZW50LCBQb3BvdmVyU2hvd25FdmVudCwgUG9wb3ZlckhpZGVFdmVudCwgUG9wb3ZlckhpZGRlbkV2ZW50LCBUb29sdGlwTW9kdWxlLCBQb3BvdmVyTW9kdWxlLCBUb29sdGlwc01vZHVsZSB9O1xuIl19