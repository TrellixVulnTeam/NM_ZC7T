/**-----------------------------------------------------------------------------------------
* Copyright © 2021 Progress Software Corporation. All rights reserved.
* Licensed under commercial license. See LICENSE.md in the project root for more information
*-------------------------------------------------------------------------------------------*/
import { __decorate, __metadata, __param } from 'tslib';
import { EventEmitter, TemplateRef, Input, Output, HostBinding, Component, ElementRef, InjectionToken, Inject, Optional, NgZone, ContentChildren, QueryList, ViewChildren, ViewChild, Renderer2, ChangeDetectorRef, Injectable, isDevMode, ComponentFactoryResolver, Directive, Host, HostListener, ContentChild, ViewContainerRef, forwardRef, NgModule } from '@angular/core';
import { trigger, state, style, transition, animate } from '@angular/animations';
import { Subscription, Subject, merge, of } from 'rxjs';
import { take, filter, map, share, tap, switchMap, takeUntil } from 'rxjs/operators';
import { LocalizationService, L10N_PREFIX, RTL, MessageService, ComponentMessages } from '@progress/kendo-angular-l10n';
import { validatePackage } from '@progress/kendo-licensing';
import { DraggableDirective, isChanged, isDocumentAvailable, DraggableModule } from '@progress/kendo-angular-common';
import { offset, scrollPosition, positionWithScroll, getDocumentElement, getWindowViewPort } from '@progress/kendo-popup-common';
import { Button } from '@progress/kendo-angular-buttons';
import { CommonModule } from '@angular/common';

/**
 * @hidden
 */
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/common';
import * as ɵngcc2 from '@progress/kendo-angular-l10n';
import * as ɵngcc3 from '@progress/kendo-angular-common';

function DialogActionsComponent_ng_content_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵprojection(0, 0, ["*ngIf", "!actions"]);
} }
function DialogActionsComponent_ng_container_1_button_1_Template(rf, ctx) { if (rf & 1) {
    const _r6 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 2);
    ɵngcc0.ɵɵlistener("click", function DialogActionsComponent_ng_container_1_button_1_Template_button_click_0_listener($event) { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r6); const action_r4 = restoredCtx.$implicit; const ctx_r5 = ɵngcc0.ɵɵnextContext(2); return ctx_r5.onButtonClick(action_r4, $event); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const action_r4 = ctx.$implicit;
    const ctx_r3 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("ngClass", ctx_r3.buttonClass(action_r4));
    ɵngcc0.ɵɵattribute("aria-label", action_r4.text);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", action_r4.text, " ");
} }
function DialogActionsComponent_ng_container_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, DialogActionsComponent_ng_container_1_button_1_Template, 2, 3, "button", 1);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r1.actions);
} }
function DialogActionsComponent_2_ng_template_0_Template(rf, ctx) { }
function DialogActionsComponent_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, DialogActionsComponent_2_ng_template_0_Template, 0, 0, "ng-template", 3);
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r2.actions);
} }
const _c0 = ["*"];
function DialogComponent_kendo_dialog_titlebar_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "kendo-dialog-titlebar", 7);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("closeTitle", ctx_r0.closeTitle)("id", ctx_r0.titleId);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ctx_r0.title);
} }
function DialogComponent_ng_content_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵprojection(0, 0, ["*ngIf", "!title"]);
} }
function DialogComponent_ng_content_6_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵprojection(0, 1, ["*ngIf", "!contentTemplate"]);
} }
function DialogComponent_7_ng_template_0_Template(rf, ctx) { }
function DialogComponent_7_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, DialogComponent_7_ng_template_0_Template, 0, 0, "ng-template", 8);
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r3.contentTemplate);
} }
function DialogComponent_ng_content_8_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵprojection(0, 2, ["*ngIf", "!actions"]);
} }
function DialogComponent_kendo_dialog_actions_9_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "kendo-dialog-actions", 9);
} if (rf & 2) {
    const ctx_r5 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("actions", ctx_r5.actions)("layout", ctx_r5.actionsLayout);
} }
const _c5 = [[["kendo-dialog-titlebar"]], "*", [["kendo-dialog-actions"]]];
const _c6 = ["kendo-dialog-titlebar", "*", "kendo-dialog-actions"];
function WindowTitleBarComponent_ng_content_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵprojection(0, 0, ["*ngIf", "!template"]);
} }
function WindowTitleBarComponent_1_ng_template_0_Template(rf, ctx) { }
const _c7 = function (a0) { return { "$implicit": a0 }; };
function WindowTitleBarComponent_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, WindowTitleBarComponent_1_ng_template_0_Template, 0, 0, "ng-template", 1);
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r1.template)("ngTemplateOutletContext", ɵngcc0.ɵɵpureFunction1(2, _c7, ctx_r1.service));
} }
function WindowComponent_kendo_window_titlebar_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "kendo-window-titlebar", 5)(1, "div", 6);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "div", 7);
    ɵngcc0.ɵɵelement(4, "button", 8)(5, "button", 9)(6, "button", 10)(7, "button", 11);
    ɵngcc0.ɵɵelementEnd()();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("template", ctx_r0.titleBarTemplate);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ctx_r0.title);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵattribute("title", ctx_r0.minimizeButtonTitle)("aria-label", ctx_r0.minimizeButtonTitle);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵattribute("title", ctx_r0.maximizeButtonTitle)("aria-label", ctx_r0.maximizeButtonTitle);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵattribute("title", ctx_r0.restoreButtonTitle)("aria-label", ctx_r0.restoreButtonTitle);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵattribute("title", ctx_r0.closeButtonTitle)("aria-label", ctx_r0.closeButtonTitle);
} }
function WindowComponent_ng_content_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵprojection(0, 0, ["*ngIf", "!showDefaultTitleBar"]);
} }
function WindowComponent_div_4_ng_content_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵprojection(0, 1, ["*ngIf", "!contentTemplate"]);
} }
function WindowComponent_div_4_2_ng_template_0_Template(rf, ctx) { }
function WindowComponent_div_4_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, WindowComponent_div_4_2_ng_template_0_Template, 0, 0, "ng-template", 13);
} if (rf & 2) {
    const ctx_r5 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r5.contentTemplate);
} }
function WindowComponent_div_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 12);
    ɵngcc0.ɵɵtemplate(1, WindowComponent_div_4_ng_content_1_Template, 1, 0, "ng-content", 2);
    ɵngcc0.ɵɵtemplate(2, WindowComponent_div_4_2_Template, 1, 1, null, 2);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("hidden", ctx_r2.state === "minimized" && ctx_r2.keepContent);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !ctx_r2.contentTemplate);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r2.contentTemplate);
} }
function WindowComponent_ng_template_5_div_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "div", 15);
} if (rf & 2) {
    const dir_r8 = ctx.$implicit;
    ɵngcc0.ɵɵproperty("direction", dir_r8);
} }
function WindowComponent_ng_template_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, WindowComponent_ng_template_5_div_0_Template, 1, 1, "div", 14);
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r3.resizeDirections);
} }
const _c16 = [[["kendo-window-titlebar"]], "*"];
const _c17 = ["kendo-window-titlebar", "*"];
const isPresent = (value) => value !== null && value !== undefined;
/**
 * @hidden
 */
const isTruthy = (value) => !!value;
const toClassList = (classNames) => String(classNames).trim().split(' ');
const focusableRegex = /^(?:a|input|select|textarea|button|object)$/i;
/**
 * @hidden
 */
var Keys;
(function (Keys) {
    Keys[Keys["esc"] = 27] = "esc";
    Keys[Keys["tab"] = 9] = "tab";
    Keys[Keys["enter"] = 13] = "enter";
    Keys[Keys["space"] = 32] = "space";
    Keys[Keys["ctrl"] = 17] = "ctrl";
    Keys[Keys["shift"] = 16] = "shift";
    Keys[Keys["left"] = 37] = "left";
    Keys[Keys["up"] = 38] = "up";
    Keys[Keys["right"] = 39] = "right";
    Keys[Keys["down"] = 40] = "down";
})(Keys || (Keys = {}));
/**
 * @hidden
 */
const DIALOG_ELEMENTS_HANDLING_ESC_KEY = 'k-dialog-wrapper k-dialog-buttongroup k-dialog-action';
/**
 * @hidden
 */
const DIALOG_ELEMENTS_HANDLING_ARROWS = 'k-dialog-buttongroup';
/**
 * @hidden
 */
const WINDOW_CLASSES = 'k-window';
/**
 * @hidden
 */
const hasClasses = (element, classNames) => {
    const namesList = toClassList(classNames);
    return Boolean(toClassList(element.className).find((className) => namesList.indexOf(className) >= 0));
};
/**
 * @hidden
 */
const isVisible = (element) => {
    const rect = element.getBoundingClientRect();
    return !!(rect.width && rect.height) && window.getComputedStyle(element).visibility !== 'hidden';
};
/**
 * @hidden
 */
const isFocusable = (element, checkVisibility = true) => {
    if (element.tagName) {
        const tagName = element.tagName.toLowerCase();
        const tabIndex = element.getAttribute('tabIndex');
        const validTabIndex = tabIndex !== null && !isNaN(tabIndex) && tabIndex > -1;
        let focusable = false;
        if (focusableRegex.test(tagName)) {
            focusable = !element.disabled;
        }
        else {
            focusable = validTabIndex;
        }
        return focusable && (!checkVisibility || isVisible(element));
    }
    return false;
};
/**
 * @hidden
 */
const setHTMLAttributes = (attributes, renderer, element) => {
    for (const attribute in attributes) {
        if (attribute) {
            renderer.setAttribute(element, attribute, attributes[attribute]);
        }
    }
};
/**
 * Receives CSS class declarations either as an object, string or array and returns an array of the class names.
 *
 * @hidden
 */
const parseCSSClassNames = (value) => {
    if (isObject(value)) {
        return parseObjectClassNames(value);
    }
    if (isString(value)) {
        return parseStringClassNames(value);
    }
    if (Array.isArray(value)) {
        return parseArrayClassNames(value);
    }
};
const parseObjectClassNames = (value) => {
    const classes = [];
    Object.keys(value).forEach(className => {
        const currentClassName = splitStringToArray(className);
        if (value[className] && currentClassName[0]) {
            classes.push(...currentClassName);
        }
    });
    return classes;
};
const parseStringClassNames = (value) => {
    const classes = [];
    const classesArray = splitStringToArray(value);
    classesArray.forEach(className => {
        classes.push(className);
    });
    return classes;
};
const parseArrayClassNames = (value) => {
    const classes = [];
    value.forEach((className) => {
        const current = splitStringToArray(className);
        if (current[0]) {
            classes.push(...current);
        }
    });
    return classes;
};
/**
 * @hidden
 */
const focusableSelector = [
    'a[href]',
    'area[href]',
    'input:not([disabled])',
    'select:not([disabled])',
    'textarea:not([disabled])',
    'button:not([disabled])',
    'iframe',
    'object',
    'embed',
    '*[tabindex]',
    '*[contenteditable]'
].join(',');
/**
 * @hidden
 */
const preventDefault = ({ originalEvent: event }) => {
    event.stopPropagation();
    event.preventDefault();
};
/**
 * @hidden
 */
const RESIZE_DIRECTIONS = ['n', 'e', 's', 'w', 'se', 'sw', 'ne', 'nw'];
/**
 * @hidden
 */
const OFFSET_STYLES = ['top', 'left', 'width', 'height'];
/**
 * @hidden
 */
const isString = (value) => value instanceof String || typeof value === 'string';
/**
 * @hidden
 */
const isObject = (value) => isPresent(value) && !Array.isArray(value) && typeof value === 'object';
/**
 * @hidden
 */
const isNumber = (value) => typeof value === 'number' && isFinite(value);
/**
 * @hidden
 */
const createValueWithUnit = (value) => value + (isNumber(value) ? 'px' : '');
/**
 * @hidden
 */
const splitStringToArray = (value) => value.trim().replace(/\s+/g, " ").split(' ');
/**
 * @hidden
 */
const findPrimaryButton = (buttons) => {
    for (let i = buttons.length - 1; i >= 0; i--) {
        const classList = buttons[i].classList;
        for (let j = 0; j < classList.length; j++) {
            if (classList[j].endsWith('-primary')) {
                return buttons[i];
            }
        }
    }
};

/**
 * Specifies the action buttons of the Dialog
 * ([see example]({% slug actionbuttons_dialog %})).
 */
let DialogActionsComponent = class DialogActionsComponent {
    constructor(el) {
        this.el = el;
        /**
         * Specifies the possible layout of the action buttons.
         */
        this.layout = 'stretched';
        /**
         * Fires when the user clicks an action button.
         */
        this.action = new EventEmitter();
        this.buttonGroupClassName = true;
    }
    get className() {
        return this.layout === 'stretched';
    }
    /**
     * @hidden
     */
    actionTemplate() {
        return this.actions instanceof TemplateRef;
    }
    /**
     * @hidden
     */
    onButtonClick(action, _e) {
        this.action.emit(action);
    }
    /**
     * @hidden
     */
    buttonClass(action) {
        let classes = ['k-button k-button-md k-rounded-md'];
        const fillMode = action.fillMode ? action.fillMode : 'solid';
        const themeColor = action.themeColor ? action.themeColor : 'base';
        const cssClasses = action.cssClass ? parseCSSClassNames(action.cssClass) : [];
        classes.push(`k-button-${fillMode} k-button-${fillMode}-${themeColor}`);
        if (cssClasses.length > 0) {
            classes = classes.concat(cssClasses);
        }
        return classes.join(' ');
    }
};
DialogActionsComponent.ɵfac = function DialogActionsComponent_Factory(t) { return new (t || DialogActionsComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef)); };
DialogActionsComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: DialogActionsComponent, selectors: [["kendo-dialog-actions"]], hostVars: 6, hostBindings: function DialogActionsComponent_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵclassProp("k-dialog-buttongroup", ctx.buttonGroupClassName)("k-actions", ctx.buttonGroupClassName)("k-actions-stretched", ctx.className);
    } }, inputs: { layout: "layout", actions: "actions" }, outputs: { action: "action" }, ngContentSelectors: _c0, decls: 3, vars: 3, consts: [[4, "ngIf"], ["type", "button", 3, "ngClass", "click", 4, "ngFor", "ngForOf"], ["type", "button", 3, "ngClass", "click"], [3, "ngTemplateOutlet"]], template: function DialogActionsComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef();
        ɵngcc0.ɵɵtemplate(0, DialogActionsComponent_ng_content_0_Template, 1, 0, "ng-content", 0);
        ɵngcc0.ɵɵtemplate(1, DialogActionsComponent_ng_container_1_Template, 2, 1, "ng-container", 0);
        ɵngcc0.ɵɵtemplate(2, DialogActionsComponent_2_Template, 1, 1, null, 0);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngIf", !ctx.actions);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.actionTemplate());
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.actionTemplate());
    } }, directives: [ɵngcc1.NgIf, ɵngcc1.NgForOf, ɵngcc1.NgClass, ɵngcc1.NgTemplateOutlet], encapsulation: 2 });
__decorate([
    Input(),
    __metadata("design:type", Object)
], DialogActionsComponent.prototype, "actions", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], DialogActionsComponent.prototype, "layout", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], DialogActionsComponent.prototype, "action", void 0);
__decorate([
    HostBinding('class.k-dialog-buttongroup'),
    HostBinding('class.k-actions'),
    __metadata("design:type", Boolean)
], DialogActionsComponent.prototype, "buttonGroupClassName", void 0);
__decorate([
    HostBinding('class.k-actions-stretched'),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [])
], DialogActionsComponent.prototype, "className", null);
DialogActionsComponent = __decorate([ __metadata("design:paramtypes", [ElementRef])
], DialogActionsComponent);

/**
 * @hidden
 */
class PreventableEvent {
    constructor() {
        this.prevented = false;
    }
    /**
     * Prevents the default action for a specified event.
     * In this way, the source component suppresses the built-in behavior that follows the event.
     */
    preventDefault() {
        this.prevented = true;
    }
    /**
     * If the event is prevented by any of its subscribers, returns `true`.
     *
     * @returns `true` if the default action was prevented. Otherwise, returns `false`.
     */
    isDefaultPrevented() {
        return this.prevented;
    }
}

/**
 * @hidden
 */
const DIALOG_LOCALIZATION_SERVICE = new InjectionToken('Dialog LocalizationService');

/**
 * @hidden
 */
let TitleBarLocalizationService = class TitleBarLocalizationService extends LocalizationService {
    constructor(prefix, messageService, rtl, dialogLocalization) {
        super(prefix, messageService, rtl);
        this.dialogLocalization = dialogLocalization;
    }
    get(shortKey) {
        if (this.dialogLocalization) {
            return this.dialogLocalization.get(shortKey);
        }
        return super.get(shortKey);
    }
};
TitleBarLocalizationService.ɵfac = function TitleBarLocalizationService_Factory(t) { return new (t || TitleBarLocalizationService)(ɵngcc0.ɵɵinject(L10N_PREFIX), ɵngcc0.ɵɵinject(ɵngcc2.MessageService, 8), ɵngcc0.ɵɵinject(RTL, 8), ɵngcc0.ɵɵinject(DIALOG_LOCALIZATION_SERVICE, 8)); };
TitleBarLocalizationService.ɵprov = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjectable({ token: TitleBarLocalizationService, factory: function (t) { return TitleBarLocalizationService.ɵfac(t); } });
TitleBarLocalizationService = __decorate([
    __param(0, Inject(L10N_PREFIX)),
    __param(1, Optional()),
    __param(2, Optional()), __param(2, Inject(RTL)),
    __param(3, Optional()), __param(3, Inject(DIALOG_LOCALIZATION_SERVICE)),
    __metadata("design:paramtypes", [String, MessageService, Boolean, LocalizationService])
], TitleBarLocalizationService);

/**
 * Represents the [Kendo UI DialogTitleBar component for Angular]({% slug api_dialog_dialogtitlebarcomponent %}).
 *
 * It is used as part of the Dialog content when the component is created dynamically by using an [Angular service]({% slug service_dialog %}).
 */
let DialogTitleBarComponent = class DialogTitleBarComponent {
    constructor(zone, hostElement, localizationService) {
        this.zone = zone;
        this.hostElement = hostElement;
        this.localizationService = localizationService;
        /**
         * Fires when the close button of the title-bar is clicked.
         */
        this.close = new EventEmitter();
    }
    get className() {
        return true;
    }
    get closeButtonTitle() {
        return this.closeTitle || this.localizationService.get('closeTitle');
    }
    ngAfterViewInit() {
        this.zone.onStable.pipe(take(1)).subscribe(() => {
            const element = this.hostElement.nativeElement.querySelector('.k-dialog-title');
            element.setAttribute('id', this.id);
        });
    }
    /**
     * @hidden
     */
    onCloseClick(e) {
        e.preventDefault();
        const eventArgs = new PreventableEvent();
        this.close.emit(eventArgs);
    }
};
DialogTitleBarComponent.ɵfac = function DialogTitleBarComponent_Factory(t) { return new (t || DialogTitleBarComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService, 8)); };
DialogTitleBarComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: DialogTitleBarComponent, selectors: [["kendo-dialog-titlebar"]], hostVars: 4, hostBindings: function DialogTitleBarComponent_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵclassProp("k-window-titlebar", ctx.className)("k-dialog-titlebar", ctx.className);
    } }, inputs: { id: "id", closeTitle: "closeTitle" }, outputs: { close: "close" }, features: [ɵngcc0.ɵɵProvidersFeature([
            TitleBarLocalizationService,
            {
                provide: LocalizationService,
                useExisting: TitleBarLocalizationService
            },
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.dialog'
            }
        ])], ngContentSelectors: _c0, decls: 6, vars: 2, consts: function () { let i18n_1; if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
        /**
         * @desc The title of the close button
         * @meaning kendo.dialog.closeTitle
         */
        const MSG_EXTERNAL_7499923323865444383$$DIST_FESM2015_INDEX_JS_2 = goog.getMsg("Close");
        i18n_1 = MSG_EXTERNAL_7499923323865444383$$DIST_FESM2015_INDEX_JS_2;
    }
    else {
        i18n_1 = $localize `:kendo.dialog.closeTitle|The title of the close button␟9b2bd34897f127e69e5f02f64692fca98a5a7572␟7499923323865444383:Close`;
    } return [["kendoDialogTitleBarLocalizedMessages", "", "closeTitle", i18n_1], [1, "k-window-title", "k-dialog-title"], [1, "k-window-actions", "k-dialog-actions"], ["role", "button", 1, "k-button", "k-button-md", "k-rounded-md", "k-button-flat", "k-button-flat-base", "k-icon-button", "k-window-action", "k-dialog-action", "k-dialog-close", 3, "click"], [1, "k-button-icon", "k-icon", "k-i-x"]]; }, template: function DialogTitleBarComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef();
        ɵngcc0.ɵɵelementContainerStart(0, 0);
        ɵngcc0.ɵɵelementStart(1, "div", 1);
        ɵngcc0.ɵɵprojection(2);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(3, "div", 2)(4, "button", 3);
        ɵngcc0.ɵɵlistener("click", function DialogTitleBarComponent_Template_button_click_4_listener($event) { return ctx.onCloseClick($event); });
        ɵngcc0.ɵɵelement(5, "span", 4);
        ɵngcc0.ɵɵelementEnd()();
        ɵngcc0.ɵɵelementContainerEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵattribute("title", ctx.closeButtonTitle)("aria-label", ctx.closeButtonTitle);
    } }, directives: function () { return [LocalizedMessagesDirective]; }, encapsulation: 2 });
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], DialogTitleBarComponent.prototype, "close", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], DialogTitleBarComponent.prototype, "id", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], DialogTitleBarComponent.prototype, "closeTitle", void 0);
__decorate([
    HostBinding('class.k-window-titlebar'),
    HostBinding('class.k-dialog-titlebar'),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [])
], DialogTitleBarComponent.prototype, "className", null);
DialogTitleBarComponent = __decorate([ __param(2, Optional()),
    __metadata("design:paramtypes", [NgZone, ElementRef, LocalizationService])
], DialogTitleBarComponent);

/**
 * @hidden
 */
const packageMetadata = {
    name: '@progress/kendo-angular-dialog',
    productName: 'Kendo UI for Angular',
    productCodes: ['KENDOUIANGULAR', 'KENDOUICOMPLETE'],
    publishDate: 1646217112,
    version: '',
    licensingDocsUrl: 'https://www.telerik.com/kendo-angular-ui/my-license/?utm_medium=product&utm_source=kendoangular&utm_campaign=kendo-ui-angular-purchase-license-keys-warning'
};

/**
 * The settings for the Dialog actions when the Dialog is opened through `DialogService`
 * ([see example]({% slug api_dialog_dialogservice %}#toc-open)).
 */
class DialogAction {
}
/**
 * Indicates that the **Close** button is clicked. Used when the results from
 * the Dialogs that are opened through `DialogService` are filtered
 * ([see example]({% slug api_dialog_dialogservice %}#toc-open)).
 */
class DialogCloseResult {
}
/**
 * The settings that can be used when the Dialog is opened through `DialogService`.
 * ([see example]({% slug api_dialog_dialogservice %}#toc-open)).
 */
class DialogSettings {
}
/**
 * Holds references to the object instance and published events of the Dialog.
 * Controls the Dialogs that were opened through the `DialogService`
 * ([see example]({% slug api_dialog_dialogservice %}#toc-open)).
 */
class DialogRef {
}

/**
 * Represents the [Kendo UI Dialog component for Angular]({% slug overview_dialog_dialogs %}).
 */
let DialogComponent = class DialogComponent {
    constructor(wrapper, renderer, localization, cdr, ngZone) {
        this.wrapper = wrapper;
        this.renderer = renderer;
        this.cdr = cdr;
        this.ngZone = ngZone;
        /**
         * Specifies the layout of the action buttons in the Dialog.
         * This option is only applicable if the action buttons are specified through the `actions` options.
         *
         * @default 'stretched'
         */
        this.actionsLayout = 'stretched';
        /**
         * @hidden
         */
        this.titleId = null;
        /**
         * @hidden
         */
        this.contentId = null;
        /**
         * Fires when the user clicks an action button of the Dialog.
         * The event is fired only when the action buttons are specified through the `actions` options.
         */
        this.action = new EventEmitter();
        /**
         * Fires when the user clicks the **Close** button of the Dialog or the **ESC** key.
         */
        this.close = new EventEmitter();
        this.tabIndex = 0;
        this.subscriptions = [];
        this.domSubs = new Subscription();
        validatePackage(packageMetadata);
        this.direction = localization.rtl ? 'rtl' : 'ltr';
        this.subscriptions.push(localization.changes.subscribe(({ rtl }) => (this.direction = rtl ? 'rtl' : 'ltr')));
        this.titleId = this.generateTitleId();
        this.contentId = this.generateContentId();
    }
    /**
     * @hidden
     */
    set htmlAttributes(attributes) {
        setHTMLAttributes(attributes, this.renderer, this.wrapper.nativeElement);
        const el = this.wrapper.nativeElement;
        const dir = el.getAttribute('dir');
        const tIndex = el.getAttribute('tabindex');
        if (this.direction !== dir && dir) {
            this.direction = dir;
        }
        if (this.tabIndex !== tIndex && tIndex) {
            this.tabIndex = tIndex;
        }
        this._htmlAttributes = attributes;
    }
    get htmlAttributes() {
        return this._htmlAttributes;
    }
    /**
     * @hidden
     */
    set cssClass(classes) {
        this.setServiceClasses(this._cssClass, classes);
        this._cssClass = classes;
    }
    get cssClass() {
        return this._cssClass;
    }
    get dir() {
        return this.direction;
    }
    ngAfterContentInit() {
        this.bubble('close', this.titlebarContent.first);
        this.renderer.setAttribute(this.wrapper.nativeElement.querySelector('.k-dialog'), 'aria-describedby', this.contentId);
        if (this.titlebarContent.first) {
            this.titlebarContent.first.id = this.titleId;
        }
        else {
            this.subscriptions.push(this.titlebarContent.changes.subscribe(() => {
                if (isPresent(this.titlebarContent.first)) {
                    this.titlebarContent.first.id = this.titleId;
                    this.ngZone.onStable.pipe(take(1)).subscribe(() => {
                        this.bubble('close', this.titlebarContent.first);
                        this.renderer.setAttribute(this.wrapper.nativeElement.querySelector('.k-dialog'), 'aria-labelledby', this.titleId);
                    });
                }
            }));
        }
    }
    ngAfterViewInit() {
        this.handleInitialFocus();
        this.bubble('close', this.titlebarView.first);
        this.bubble('action', this.actionsView);
        if (this.titlebarView.first || this.titlebarContent.first) {
            //Needed for Dialogs created via service
            this.renderer.setAttribute(this.wrapper.nativeElement.querySelector('.k-dialog'), 'aria-labelledby', this.titleId);
        }
        else {
            this.subscriptions.push(this.titlebarView.changes.subscribe(() => {
                if (isPresent(this.titlebarView.first)) {
                    this.titlebarView.first.id = this.titleId;
                    this.ngZone.onStable.pipe(take(1)).subscribe(() => {
                        this.bubble('close', this.titlebarView.first);
                        this.renderer.setAttribute(this.wrapper.nativeElement.querySelector('.k-dialog'), 'aria-labelledby', this.titleId);
                    });
                }
            }));
        }
        this.initDomEvents();
    }
    ngOnInit() {
        this.renderer.removeAttribute(this.wrapper.nativeElement, 'title');
        this.cdr.detectChanges();
    }
    ngOnDestroy() {
        this.subscriptions.forEach(s => s.unsubscribe());
        this.subscriptions = [];
        if (this.domSubs) {
            this.domSubs.unsubscribe();
        }
    }
    /**
     * Focuses the wrapper of the Dialog component.
     */
    focus() {
        const wrapper = this.wrapper.nativeElement;
        if (isPresent(wrapper)) {
            wrapper.focus();
        }
    }
    initDomEvents() {
        if (!this.wrapper) {
            return;
        }
        this.ngZone.runOutsideAngular(() => {
            this.domSubs.add(this.renderer.listen(this.wrapper.nativeElement, 'keydown', (ev) => {
                this.onKeyDown(ev);
            }));
        });
    }
    onKeyDown(event) {
        const target = event.target;
        const parent = target.parentElement;
        if (hasClasses(target, DIALOG_ELEMENTS_HANDLING_ESC_KEY) || hasClasses(parent, DIALOG_ELEMENTS_HANDLING_ESC_KEY)) {
            if (event.keyCode === Keys.esc) {
                this.ngZone.run(() => {
                    this.close.emit(new DialogCloseResult());
                });
            }
        }
        if (hasClasses(target, 'k-button') && hasClasses(parent, DIALOG_ELEMENTS_HANDLING_ARROWS) &&
            (event.keyCode === Keys.left || event.keyCode === Keys.right)) {
            this.ngZone.run(() => {
                this.handleActionButtonFocus(parent, event.keyCode);
            });
        }
        if (event.keyCode === Keys.tab) {
            this.ngZone.run(() => {
                this.keepFocusWithinComponent(target, event);
            });
        }
    }
    setServiceClasses(prevValue, value) {
        const el = this.wrapper.nativeElement;
        if (prevValue) {
            parseCSSClassNames(prevValue).forEach(className => {
                this.renderer.removeClass(el, className);
            });
        }
        if (value) {
            parseCSSClassNames(value).forEach(className => {
                this.renderer.addClass(el, className);
            });
        }
    }
    /**
     * @hidden
     */
    handleInitialFocus() {
        const wrapper = this.wrapper.nativeElement;
        const primaryButton = this.findPrimary(wrapper);
        if (this.autoFocusedElement) {
            const initiallyFocusedElement = wrapper.querySelector(this.autoFocusedElement);
            if (initiallyFocusedElement) {
                initiallyFocusedElement.focus();
            }
        }
        else if (this.shouldFocusPrimary(primaryButton)) {
            primaryButton.focus();
        }
        else {
            wrapper.focus();
        }
    }
    /**
     * @hidden
     */
    findPrimary(wrapper) {
        const actionBtns = wrapper.querySelectorAll('.k-actions .k-button');
        return findPrimaryButton(actionBtns);
    }
    /**
     * @hidden
     */
    handleActionButtonFocus(parent, key) {
        const focusableActionButtons = this.getAllFocusableChildren(parent);
        for (let i = 0; i < focusableActionButtons.length; i++) {
            const current = focusableActionButtons[i];
            if (current === document.activeElement) {
                if (key === Keys.left && i > 0) {
                    focusableActionButtons[i - 1].focus();
                    break;
                }
                if (key === Keys.right && i < focusableActionButtons.length - 1) {
                    focusableActionButtons[i + 1].focus();
                    break;
                }
            }
        }
    }
    /**
     * @hidden
     */
    keepFocusWithinComponent(target, event) {
        const wrapper = this.wrapper.nativeElement;
        const [firstFocusable, lastFocusable] = this.getFirstAndLastFocusable(wrapper);
        const tabAfterLastFocusable = !event.shiftKey && target === lastFocusable;
        const shiftTabAfterFirstFocusable = event.shiftKey && target === firstFocusable;
        if (tabAfterLastFocusable) {
            event.preventDefault();
            firstFocusable.focus();
        }
        if (shiftTabAfterFirstFocusable) {
            event.preventDefault();
            lastFocusable.focus();
        }
    }
    /**
     * @hidden
     */
    shouldFocusPrimary(el) {
        return isPresent(el) && isFocusable(el);
    }
    /**
     * @hidden
     */
    getAllFocusableChildren(parent) {
        return parent.querySelectorAll(focusableSelector);
    }
    /**
     * @hidden
     */
    getFirstAndLastFocusable(parent) {
        const all = this.getAllFocusableChildren(parent);
        const firstFocusable = all.length > 0 ? all[0] : parent;
        const lastFocusable = all.length > 0 ? all[all.length - 1] : parent;
        return [firstFocusable, lastFocusable];
    }
    /**
     * @hidden
     */
    generateTitleId() {
        return 'kendo-dialog-title-' + Math.ceil(Math.random() * 1000000).toString();
    }
    /**
     * @hidden
     */
    generateContentId() {
        return 'kendo-dialog-content-' + Math.ceil(Math.random() * 1000000).toString();
    }
    get wrapperClass() {
        return true;
    }
    get styles() {
        const styles = {};
        if (this.width) {
            styles.width = createValueWithUnit(this.width);
        }
        if (this.height) {
            styles.height = createValueWithUnit(this.height);
        }
        if (this.minWidth) {
            styles.minWidth = createValueWithUnit(this.minWidth);
        }
        if (this.maxWidth) {
            styles.maxWidth = createValueWithUnit(this.maxWidth);
        }
        if (this.minHeight) {
            styles.minHeight = createValueWithUnit(this.minHeight);
        }
        if (this.maxHeight) {
            styles.maxHeight = createValueWithUnit(this.maxHeight);
        }
        return styles;
    }
    bubble(eventName, component) {
        if (component) {
            const emit = e => this[eventName].emit(e);
            const s = component[eventName].subscribe(emit);
            this.subscriptions.push(s);
        }
    }
};
DialogComponent.ɵfac = function DialogComponent_Factory(t) { return new (t || DialogComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
DialogComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: DialogComponent, selectors: [["kendo-dialog"]], contentQueries: function DialogComponent_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
        ɵngcc0.ɵɵcontentQuery(dirIndex, DialogTitleBarComponent, 4);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.titlebarContent = _t);
    } }, viewQuery: function DialogComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(DialogActionsComponent, 5);
        ɵngcc0.ɵɵviewQuery(DialogTitleBarComponent, 5);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.actionsView = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.titlebarView = _t);
    } }, hostVars: 4, hostBindings: function DialogComponent_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵattribute("tabIndex", ctx.tabIndex)("dir", ctx.dir);
        ɵngcc0.ɵɵclassProp("k-dialog-wrapper", ctx.wrapperClass);
    } }, inputs: { actionsLayout: "actionsLayout", actions: "actions", autoFocusedElement: "autoFocusedElement", title: "title", width: "width", minWidth: "minWidth", maxWidth: "maxWidth", height: "height", minHeight: "minHeight", maxHeight: "maxHeight" }, outputs: { action: "action", close: "close" }, exportAs: ["kendoDialog"], features: [ɵngcc0.ɵɵProvidersFeature([
            LocalizationService,
            {
                provide: DIALOG_LOCALIZATION_SERVICE,
                useExisting: LocalizationService
            },
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.dialog'
            }
        ])], ngContentSelectors: _c6, decls: 10, vars: 10, consts: function () { let i18n_3; if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
        /**
         * @desc The title of the close button
         * @meaning kendo.dialog.closeTitle
         */
        const MSG_EXTERNAL_7499923323865444383$$DIST_FESM2015_INDEX_JS_4 = goog.getMsg("Close");
        i18n_3 = MSG_EXTERNAL_7499923323865444383$$DIST_FESM2015_INDEX_JS_4;
    }
    else {
        i18n_3 = $localize `:kendo.dialog.closeTitle|The title of the close button␟9b2bd34897f127e69e5f02f64692fca98a5a7572␟7499923323865444383:Close`;
    } return [["kendoDialogLocalizedMessages", "", "closeTitle", i18n_3], [1, "k-overlay"], ["role", "dialog", "aria-modal", "true", 1, "k-window", "k-dialog", 3, "ngStyle"], [3, "closeTitle", "id", 4, "ngIf"], [4, "ngIf"], [1, "k-content", "k-window-content", "k-dialog-content", 3, "id"], [3, "actions", "layout", 4, "ngIf"], [3, "closeTitle", "id"], [3, "ngTemplateOutlet"], [3, "actions", "layout"]]; }, template: function DialogComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef(_c5);
        ɵngcc0.ɵɵelementContainerStart(0, 0);
        ɵngcc0.ɵɵelement(1, "div", 1);
        ɵngcc0.ɵɵelementStart(2, "div", 2);
        ɵngcc0.ɵɵtemplate(3, DialogComponent_kendo_dialog_titlebar_3_Template, 2, 3, "kendo-dialog-titlebar", 3);
        ɵngcc0.ɵɵtemplate(4, DialogComponent_ng_content_4_Template, 1, 0, "ng-content", 4);
        ɵngcc0.ɵɵelementStart(5, "div", 5);
        ɵngcc0.ɵɵtemplate(6, DialogComponent_ng_content_6_Template, 1, 0, "ng-content", 4);
        ɵngcc0.ɵɵtemplate(7, DialogComponent_7_Template, 1, 1, null, 4);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(8, DialogComponent_ng_content_8_Template, 1, 0, "ng-content", 4);
        ɵngcc0.ɵɵtemplate(9, DialogComponent_kendo_dialog_actions_9_Template, 1, 2, "kendo-dialog-actions", 6);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementContainerEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("@overlayAppear", undefined);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngStyle", ctx.styles)("@dialogSlideInAppear", undefined);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.title);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.title);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("id", ctx.contentId);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.contentTemplate);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.contentTemplate);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.actions);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.actions);
    } }, directives: function () { return [LocalizedMessagesDirective, ɵngcc1.NgStyle, ɵngcc1.NgIf, DialogTitleBarComponent, ɵngcc1.NgTemplateOutlet, DialogActionsComponent]; }, encapsulation: 2, data: { animation: [
            trigger('overlayAppear', [
                state('in', style({ opacity: 1 })),
                transition('void => *', [style({ opacity: 0.1 }), animate('.3s cubic-bezier(.2, .6, .4, 1)')])
            ]),
            trigger('dialogSlideInAppear', [
                state('in', style({ transform: 'translate(0, 0)' })),
                transition('void => *', [style({ transform: 'translate(0, -10%)' }), animate('.3s cubic-bezier(.2, 1, .2, 1)')])
            ])
        ] } });
__decorate([
    Input(),
    __metadata("design:type", Array)
], DialogComponent.prototype, "actions", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], DialogComponent.prototype, "actionsLayout", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], DialogComponent.prototype, "autoFocusedElement", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], DialogComponent.prototype, "title", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], DialogComponent.prototype, "width", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], DialogComponent.prototype, "minWidth", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], DialogComponent.prototype, "maxWidth", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], DialogComponent.prototype, "height", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], DialogComponent.prototype, "minHeight", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], DialogComponent.prototype, "maxHeight", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], DialogComponent.prototype, "action", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], DialogComponent.prototype, "close", void 0);
__decorate([
    HostBinding('attr.dir'),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [])
], DialogComponent.prototype, "dir", null);
__decorate([
    HostBinding('attr.tabIndex'),
    __metadata("design:type", Number)
], DialogComponent.prototype, "tabIndex", void 0);
__decorate([
    ContentChildren(DialogTitleBarComponent, { descendants: false }),
    __metadata("design:type", QueryList)
], DialogComponent.prototype, "titlebarContent", void 0);
__decorate([
    ViewChildren(DialogTitleBarComponent),
    __metadata("design:type", QueryList)
], DialogComponent.prototype, "titlebarView", void 0);
__decorate([
    ViewChild(DialogActionsComponent, { static: false }),
    __metadata("design:type", DialogActionsComponent)
], DialogComponent.prototype, "actionsView", void 0);
__decorate([
    HostBinding('class.k-dialog-wrapper'),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [])
], DialogComponent.prototype, "wrapperClass", null);
DialogComponent = __decorate([ __metadata("design:paramtypes", [ElementRef,
        Renderer2,
        LocalizationService,
        ChangeDetectorRef,
        NgZone])
], DialogComponent);

/**
 * The base class  which will be extended by a component that is provided as content through `content`
 * ([see example]({% slug service_dialog %}#toc-passing-title-content-and-actions-as-a-single-component)).
 */
class DialogContentBase {
    constructor(dialog) {
        this.dialog = dialog;
    }
    /**
     * @hidden
     */
    ngAfterViewInit() {
        if (this.dialogTitleBar) {
            // when opening component inside dialog with service AND the component has defined its own titlebar
            this.dialogTitleBar.close.pipe(filter((e) => !e.isDefaultPrevented())).subscribe(() => {
                this.dialog.close();
            });
        }
        if (this.dialogActions) {
            if (this.dialogActions.actions) {
                this.dialogActions.action.subscribe(action => this.dialog.dialog.instance.action.emit(action));
            }
        }
    }
}
DialogContentBase.ɵfac = function DialogContentBase_Factory(t) { ɵngcc0.ɵɵinvalidFactory(); };
DialogContentBase.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: DialogContentBase, viewQuery: function DialogContentBase_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(DialogTitleBarComponent, 5);
        ɵngcc0.ɵɵviewQuery(DialogActionsComponent, 5);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.dialogTitleBar = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.dialogActions = _t.first);
    } } });
__decorate([
    ViewChild(DialogTitleBarComponent, { static: false }),
    __metadata("design:type", DialogTitleBarComponent)
], DialogContentBase.prototype, "dialogTitleBar", void 0);
__decorate([
    ViewChild(DialogActionsComponent, { static: false }),
    __metadata("design:type", DialogActionsComponent)
], DialogContentBase.prototype, "dialogActions", void 0);

var DialogContainerService_1;
/**
 * @hidden
 */
let DialogContainerService = DialogContainerService_1 = class DialogContainerService {
    set container(container) {
        DialogContainerService_1.container = container;
    }
    get container() {
        return DialogContainerService_1.container;
    }
};
DialogContainerService.ɵfac = function DialogContainerService_Factory(t) { return new (t || DialogContainerService)(); };
DialogContainerService.ɵprov = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjectable({ token: DialogContainerService, factory: function (t) { return DialogContainerService.ɵfac(t); } });
DialogContainerService.container = null;

const isNotComponent = (component) => isString(component) || component instanceof TemplateRef;
class DialogInjector {
    constructor(getDialogRef, parentInjector) {
        this.getDialogRef = getDialogRef;
        this.parentInjector = parentInjector;
    }
    get(token, notFoundValue) {
        if (token === DialogRef) {
            return this.getDialogRef();
        }
        return this.parentInjector.get(token, notFoundValue);
    }
}
/**
 * A service for opening Dialog windows dynamically
 * ([see example]({% slug service_dialog %})).
 */
let DialogService = class DialogService {
    constructor(
    /**
     * @hidden
     */
    resolver, containerService) {
        this.resolver = resolver;
        this.containerService = containerService;
    }
    /**
     * Opens a Dialog window. Requires an element in the application that uses the
     * [`kendoDialogContainer`]({% slug api_dialog_dialogcontainerdirective %}) directive.
     * Created Dialogs will be mounted in the DOM directly after that element.
     *
     * @param {DialogAction} options - The options that define the Dialog.
     * @returns {DialogRef} - A reference to the Dialog object and the convenience properties.
     *
     * @example
     *
     * ```ts-no-run
     * _@Component({
     *   selector: 'my-app',
     *   template: `
     *     <button kendoButton (click)="open()">Harmless button</button>
     *     <div kendoDialogContainer></div>
     *   `
     * })
     * export class AppComponent {
     *     constructor( private dialogService: DialogService ) {}
     *
     *     public open() {
     *         var dialog = this.dialogService.open({
     *           title: "Please confirm",
     *           content: "Are you sure?",
     *           actions: [
     *             { text: "No" },
     *             { text: "Yes", themeColor: 'primary' }
     *           ]
     *         });
     *
     *         dialog.result.subscribe((result) => {
     *           if (result instanceof DialogCloseResult) {
     *             console.log("close");
     *           } else {
     *             console.log("action", result);
     *           }
     *         });
     *     }
     * }
     * ```
     *
     */
    open(options) {
        const factory = this.resolver.resolveComponentFactory(DialogComponent);
        const container = options.appendTo || this.containerService.container;
        if (!container) {
            throw new Error(`
Cannot attach dialog to the page.
Add an element that uses the kendoDialogContainer directive, or set the 'appendTo' property.
See https://www.telerik.com/kendo-angular-ui/components/dialogs/dialog/service/.
          `);
        }
        // create DialogRef to (1) pass as result, (2) provide through injector
        const dialogRef = {
            close: () => {
                /* noop */
            },
            content: null,
            dialog: null,
            result: null
        };
        return this.initializeDialog(options.content, factory, container, dialogRef, options);
    }
    initializeDialog(component, factory, container, dialogRef, options) {
        const content = this.contentFrom(component, container, dialogRef);
        const dialog = container.createComponent(factory, undefined, undefined, content.nodes);
        dialogRef.dialog = dialog;
        dialog.changeDetectorRef.markForCheck();
        // copy @Input options to dialog instance
        this.applyOptions(dialog.instance, options);
        // create close handler and result stream
        const apiClose = new Subject();
        const close = (e) => {
            if (e instanceof PreventableEvent) {
                e = new DialogCloseResult();
            }
            apiClose.next(e || new DialogCloseResult());
            if (content.componentRef) {
                content.componentRef.destroy();
            }
            dialog.destroy();
        };
        const result = merge(apiClose, 
        // triggered when the titlebar or actions are defined in DialogSettings
        merge(dialog.instance.close, dialog.instance.action).pipe(map(e => (e instanceof PreventableEvent ? new DialogCloseResult() : e)), filter(e => {
            if (options.preventAction) {
                // add dialogRef only when using component
                const dialogRefParameter = isNotComponent(component) ? undefined : dialogRef;
                return !options.preventAction(e, dialogRefParameter);
            }
            return true;
        }))).pipe(take(1), 
        // Takes care for multiple subscriptions:
        // We subscribe internaly and the user may subscribe to get a close result - dialog.result.subscribe().
        // This causes multiple subscriptions to the same source and thus multiple emissions. share() solves that.
        share());
        result.subscribe(close);
        dialogRef.close = close;
        dialogRef.result = result;
        if (component && isDevMode()) {
            const hasContentTitle = content.nodes[0] && content.nodes[0].length > 0;
            const hasContentActions = content.nodes[2] && content.nodes[2].length > 0;
            const multipleTitles = options.title && hasContentTitle;
            const multipleActions = options.actions && hasContentActions;
            if (component.prototype instanceof DialogContentBase) {
                // content component extends DialogContentBase
                if (multipleTitles || multipleActions) {
                    console.warn(`
                    Multiple Title and/or Actions configurations detected.
                    When using a component as content, provide the title and actions either in the component's markup
                    or via the title and actions properties of the DialogSettings object, but not both.
                    See https://www.telerik.com/kendo-angular-ui/components/dialogs/dialog/service/#toc-passing-title-content-and-actions-as-a-single-component'`);
                }
            }
            else {
                if (hasContentTitle || hasContentActions) {
                    console.warn(`
                    When Title and/or Actions markup is provided in content component's template,
                    the component needs to inherit the DialogContentBase class to ensure that close and result events are properly hooked.
                    See https://www.telerik.com/kendo-angular-ui/components/dialogs/dialog/service/#toc-passing-title-content-and-actions-as-a-single-component'`);
                }
            }
        }
        return dialogRef;
    }
    applyOptions(instance, options) {
        instance.title = options.title;
        instance.actions = options.actions;
        instance.actionsLayout = options.actionsLayout || 'stretched';
        instance.width = options.width;
        instance.minWidth = options.minWidth;
        instance.maxWidth = options.maxWidth;
        instance.height = options.height;
        instance.minHeight = options.minHeight;
        instance.maxHeight = options.maxHeight;
        instance.autoFocusedElement = options.autoFocusedElement;
        instance.closeTitle = options.closeTitle;
        instance.cssClass = options.cssClass;
        instance.htmlAttributes = options.htmlAttributes;
        if (options.content instanceof TemplateRef) {
            instance.contentTemplate = options.content;
        }
    }
    contentFrom(content, container, dialogRef) {
        const renderer = container.injector.get(Renderer2);
        let nodes = [];
        let titleNodes = [];
        let actionNodes = [];
        let componentRef = null;
        if (typeof content === 'string') {
            nodes = [renderer.createText(content)];
        }
        else if (content && !(content instanceof TemplateRef)) {
            // Component
            const injector = new DialogInjector(() => dialogRef, container.injector);
            const factory = this.resolver.resolveComponentFactory(content);
            componentRef = container.createComponent(factory, undefined, injector);
            titleNodes = Array.from(componentRef.location.nativeElement.querySelectorAll('kendo-dialog-titlebar'));
            nodes = [componentRef.location.nativeElement];
            actionNodes = Array.from(componentRef.location.nativeElement.querySelectorAll('kendo-dialog-actions'));
            dialogRef.content = componentRef;
        }
        return {
            componentRef,
            nodes: [
                titleNodes,
                nodes,
                actionNodes // <ng-content select="kendo-dialog-actions">
            ]
        };
    }
};
DialogService.ɵfac = function DialogService_Factory(t) { return new (t || DialogService)(ɵngcc0.ɵɵinject(ɵngcc0.ComponentFactoryResolver), ɵngcc0.ɵɵinject(DialogContainerService)); };
DialogService.ɵprov = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjectable({ token: DialogService, factory: function (t) { return DialogService.ɵfac(t); } });
DialogService = __decorate([ __param(1, Inject(DialogContainerService)),
    __metadata("design:paramtypes", [ComponentFactoryResolver,
        DialogContainerService])
], DialogService);

/**
 * @hidden
 */
let newZIndex = 10002;
/**
 * @hidden
 */
const DEFAULT_OPTIONS = {
    draggable: true,
    height: null,
    left: null,
    minHeight: 100,
    minWidth: 120,
    position: 'absolute',
    resizable: true,
    state: 'default',
    top: null,
    width: null
};
/**
 * @hidden
 */
const createMoveStream = (el, ev) => mouseDown => {
    return el.kendoDrag
        .pipe(takeUntil(el.kendoRelease.pipe(tap(() => { ev.emit(); }))), map(({ pageX, pageY }) => ({
        originalX: mouseDown.pageX,
        originalY: mouseDown.pageY,
        pageX,
        pageY
    })));
};
/**
 * @hidden
 */
let DragResizeService = class DragResizeService {
    constructor(ngZone) {
        this.ngZone = ngZone;
        this.close = new EventEmitter();
        this.focus = new EventEmitter();
        this.change = new EventEmitter();
        this.stateChange = new EventEmitter();
        this.dragStart = new EventEmitter();
        this.dragEnd = new EventEmitter();
        this.resizeStart = new EventEmitter();
        this.resizeEnd = new EventEmitter();
        this.options = Object.assign({}, DEFAULT_OPTIONS);
        this.lastAction = null;
        this.subscriptions = new Subscription();
        this.dragSubscription = new Subscription();
    }
    ngOnDestroy() {
        if (this.subscriptions) {
            this.subscriptions.unsubscribe();
        }
        if (this.dragSubscription) {
            this.dragSubscription.unsubscribe();
        }
    }
    init(el) {
        const state$$1 = this.options.state;
        let options = this.options;
        this.window = el;
        if (state$$1 !== 'default') {
            this.restoreOptions = Object.assign({}, options);
        }
        if (state$$1 === 'minimized') {
            options.height = 0;
            options.minHeight = 0;
        }
        if (state$$1 === 'maximized') {
            options.position = 'fixed';
        }
    }
    onDrag(el) {
        this.subscriptions.add(this.ngZone.runOutsideAngular(() => {
            let startPosition;
            let dragStarted;
            this.dragSubscription = el.kendoPress
                .pipe(tap((ev) => {
                if (!ev.isTouch) {
                    preventDefault(ev);
                }
                this.focus.emit();
                startPosition = this.currentPosition();
                dragStarted = false;
            }), switchMap(createMoveStream(el, this.dragEnd)))
                .subscribe(({ pageX, pageY, originalX, originalY }) => {
                if (!dragStarted) {
                    this.ensureWidth();
                    this.dragStart.emit();
                    dragStarted = true;
                }
                this.handleDrag({
                    originalX, originalY,
                    pageX, pageY, startPosition
                });
            });
        }));
    }
    handleDrag({ originalX, originalY, pageX, pageY, startPosition }) {
        this.options.left = startPosition.x + pageX - originalX;
        this.options.top = startPosition.y + pageY - originalY;
        if (this.options.state === 'minimized' && isPresent(this.restoreOptions)) {
            this.restoreOptions.left = this.options.left;
            this.restoreOptions.top = this.options.top;
        }
        this.change.emit({
            left: startPosition.x + pageX - originalX,
            top: startPosition.y + pageY - originalY
        });
    }
    onResize(handle, direction) {
        this.subscriptions.add(this.ngZone.runOutsideAngular(() => {
            let startOffsetAndPosition;
            let resizeStarted = false;
            handle.kendoPress.pipe(tap((ev) => {
                preventDefault(ev);
                this.focus.emit();
                startOffsetAndPosition = this.currentOffsetAndPosition();
                resizeStarted = false;
            }), switchMap(createMoveStream(handle, this.resizeEnd)))
                .subscribe(({ pageX, pageY, originalX, originalY }) => {
                if (!resizeStarted) {
                    this.resizeStart.emit(direction);
                    resizeStarted = true;
                }
                let deltaX = pageX - originalX;
                let deltaY = pageY - originalY;
                this.handleResize(startOffsetAndPosition, direction, deltaX, deltaY);
            });
        }));
    }
    handleResize(initial, dir, deltaX, deltaY) {
        const old = this.options;
        let ev = {};
        if (dir.indexOf('e') >= 0) {
            const newWidth = initial.width + deltaX;
            if (newWidth !== old.width && newWidth >= old.minWidth) {
                ev.width = newWidth;
            }
        }
        if (dir.indexOf('n') >= 0) {
            const newHeight = initial.height - deltaY;
            const newTop = initial.y + deltaY;
            if (newHeight !== old.height && newHeight >= old.minHeight && newTop !== old.top) {
                ev.height = newHeight;
                ev.top = newTop;
            }
        }
        if (dir.indexOf('s') >= 0) {
            const newHeight = initial.height + deltaY;
            if (newHeight !== old.height && newHeight >= old.minHeight) {
                ev.height = newHeight;
            }
        }
        if (dir.indexOf('w') >= 0) {
            const newLeft = initial.x + deltaX;
            const newWidth = initial.width - deltaX;
            if (newWidth !== old.width && newWidth >= old.minWidth && newLeft !== old.left) {
                ev.width = newWidth;
                ev.left = newLeft;
            }
        }
        if (isPresent(ev.width) || isPresent(ev.height)) {
            OFFSET_STYLES.forEach((style$$1) => {
                if (isPresent(ev[style$$1])) {
                    this.options[style$$1] = ev[style$$1];
                }
            });
            this.change.emit(ev);
        }
    }
    restoreAction() {
        this.lastAction = 'restore';
        this.defaultState();
    }
    defaultState() {
        if (isPresent(this.restoreOptions)) {
            this.options = Object.assign({}, this.restoreOptions);
        }
        this.options.state = 'default';
        this.stateChange.emit('default');
    }
    storeOptions() {
        this.restoreOptions = Object.assign({}, this.options);
    }
    maximizeAction() {
        this.lastAction = 'maximize';
        this.maximizeState();
    }
    maximizeState() {
        this.storeOptions();
        const wnd = this.windowViewPort;
        this.options = Object.assign({}, this.options, {
            height: wnd.height,
            left: 0,
            position: 'fixed',
            state: 'maximized',
            top: 0,
            width: wnd.width
        });
        this.stateChange.emit('maximized');
    }
    minimizeAction() {
        this.lastAction = 'minimize';
        this.minimizeState();
    }
    minimizeState() {
        this.storeOptions();
        this.options = Object.assign({}, this.options, {
            height: null,
            minHeight: 0,
            state: 'minimized'
        });
        this.stateChange.emit('minimized');
    }
    /**
     * Handles manual changes of the 'state' property.
     * Required to distinguish them from action clicks.
     */
    applyManualState() {
        const state$$1 = this.options.state;
        switch (state$$1) {
            case 'default':
                this.clearHeight();
                this.defaultState();
                break;
            case 'maximized':
                this.clearHeight();
                this.maximizeState();
                break;
            case 'minimized':
                this.minimizeState();
                break;
            default:
                break;
        }
    }
    closeAction() {
        this.close.emit();
    }
    ensureWidth() {
        const windowOffset = offset(this.window.nativeElement);
        if (!isPresent(this.options.width)) {
            this.options.width = windowOffset.width;
            this.change.emit({ width: windowOffset.width });
        }
    }
    clearHeight() {
        if (this.options.height === 0) {
            delete this.options.height;
        }
        if (this.options.minHeight === 0) {
            delete this.options.minHeight;
        }
    }
    center() {
        if (this.options.state === 'maximized') {
            return;
        }
        let scroll = scrollPosition(this.window.nativeElement);
        let wnd = this.windowViewPort;
        let wrapper = offset(this.window.nativeElement);
        let ev = {};
        if (!isPresent(this.options.left)) {
            this.options.left = scroll.x + Math.max(0, (wnd.width - wrapper.width) / 2);
            ev.left = this.options.left;
        }
        if (!isPresent(this.options.top)) {
            this.options.top = scroll.y + Math.max(0, (wnd.height - wrapper.height) / 2);
            ev.top = this.options.top;
        }
        this.change.emit(ev);
    }
    currentOffsetAndPosition() {
        const o = this.options;
        const off = offset(this.window.nativeElement);
        return Object.assign({}, this.currentPosition(), {
            height: o.height ? o.height : off.height,
            width: o.width ? o.width : off.width
        });
    }
    currentPosition() {
        const o = this.options;
        if (!o.top || !o.left) {
            this.setPosition();
        }
        return {
            x: this.options.left,
            y: this.options.top
        };
    }
    setPosition() {
        const wrapper = positionWithScroll(this.window.nativeElement, getDocumentElement(this.window.nativeElement));
        this.options.left = wrapper.left;
        this.options.top = wrapper.top;
    }
    setRestoreOption(style$$1, value) {
        if (isPresent(this.restoreOptions)) {
            this.restoreOptions[style$$1] = value;
        }
    }
    get nextPossibleZIndex() {
        return newZIndex;
    }
    get nextZIndex() {
        return newZIndex++;
    }
    get windowViewPort() {
        return getWindowViewPort(this.window.nativeElement);
    }
};
DragResizeService.ɵfac = function DragResizeService_Factory(t) { return new (t || DragResizeService)(ɵngcc0.ɵɵinject(ɵngcc0.NgZone)); };
DragResizeService.ɵprov = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjectable({ token: DragResizeService, factory: function (t) { return DragResizeService.ɵfac(t); } });
DragResizeService = __decorate([ __metadata("design:paramtypes", [NgZone])
], DragResizeService);

/**
 * @hidden
 */
let ResizeHandleDirective = class ResizeHandleDirective {
    constructor(draggable, el, renderer, service) {
        this.draggable = draggable;
        this.el = el;
        this.renderer = renderer;
        this.service = service;
        this.subscriptions = new Subscription();
    }
    get hostClass() {
        return true;
    }
    ngOnInit() {
        this.setDisplay();
        this.renderer.addClass(this.el.nativeElement, 'k-resize-' + this.direction);
        this.subscriptions.add(of(this.draggable).subscribe(handle => {
            this.service.onResize(handle, this.direction);
        }));
        this.subscriptions.add(this.service.resizeStart.subscribe((dir) => {
            if (dir !== this.direction) {
                this.setDisplay('none');
            }
        }));
        this.subscriptions.add(this.service.dragStart.subscribe(() => {
            this.setDisplay('none');
        }));
        this.subscriptions.add(merge(this.service.resizeEnd, this.service.dragEnd).subscribe(() => {
            this.setDisplay('block');
        }));
        this.subscriptions.add(this.service.stateChange.subscribe((state$$1) => {
            this.setDisplay(state$$1 === 'default' ? 'block' : 'none');
        }));
    }
    ngOnDestroy() {
        this.subscriptions.unsubscribe();
    }
    setDisplay(value = 'block') {
        this.renderer.setStyle(this.el.nativeElement, 'display', this.service.options.state === 'default' ? value : 'none');
    }
};
ResizeHandleDirective.ɵfac = function ResizeHandleDirective_Factory(t) { return new (t || ResizeHandleDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc3.DraggableDirective, 1), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(DragResizeService)); };
ResizeHandleDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: ResizeHandleDirective, selectors: [["", "kendoWindowResizeHandle", ""]], hostVars: 2, hostBindings: function ResizeHandleDirective_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵclassProp("k-resize-handle", ctx.hostClass);
    } }, inputs: { direction: "direction" } });
__decorate([
    Input(),
    __metadata("design:type", String)
], ResizeHandleDirective.prototype, "direction", void 0);
__decorate([
    HostBinding('class.k-resize-handle'),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [])
], ResizeHandleDirective.prototype, "hostClass", null);
ResizeHandleDirective = __decorate([ __param(0, Host()),
    __metadata("design:paramtypes", [DraggableDirective,
        ElementRef,
        Renderer2,
        DragResizeService])
], ResizeHandleDirective);

let WindowTitleBarComponent = class WindowTitleBarComponent {
    constructor(el, service, ngZone) {
        this.el = el;
        this.ngZone = ngZone;
        this.service = service;
    }
    ngOnInit() {
        this.dragDirective = new DraggableDirective(this.el, this.ngZone);
        this.dragDirective.ngOnInit();
        if (this.isDraggable) {
            this.subscribeDrag();
        }
        this.subscribeStateChange();
    }
    ngOnDestroy() {
        this.dragDirective.ngOnDestroy();
        this.unsubscribeDrag();
        this.unsubscribeState();
    }
    /**
     * @hidden
     */
    subscribeDrag() {
        this.unsubscribeDrag();
        this.dragSubscription = of(this.dragDirective).subscribe(titleBar => {
            this.service.onDrag(titleBar);
        });
    }
    /**
     * @hidden
     */
    subscribeStateChange() {
        this.stateSubscription = this.service.stateChange.subscribe((state$$1) => {
            if (this.service.options.draggable) {
                if (state$$1 === 'maximized') {
                    this.unsubscribeDrag();
                }
                else {
                    this.subscribeDrag();
                }
            }
        });
    }
    /**
     * @hidden
     */
    unsubscribeDrag() {
        if (this.dragSubscription) {
            this.service.dragSubscription.unsubscribe();
            this.dragSubscription.unsubscribe();
            this.dragSubscription = null;
        }
    }
    /**
     * @hidden
     */
    unsubscribeState() {
        if (this.stateSubscription) {
            this.stateSubscription.unsubscribe();
            this.stateSubscription = null;
        }
    }
    get className() {
        return true;
    }
    get touchAction() {
        if (this.isDraggable) {
            return 'none';
        }
    }
    /**
     * @hidden
     */
    handle(ev) {
        const target = ev.target;
        const state$$1 = this.service.options.state;
        if (!hasClasses(target, 'k-icon') && !isFocusable(target, false) && this.service.options.resizable) {
            if (state$$1 === 'default') {
                this.service.maximizeAction();
            }
            else if (state$$1 === 'maximized') {
                this.service.restoreAction();
            }
        }
    }
    get isDraggable() {
        const options = this.service.options;
        return options.draggable && options.state !== 'maximized';
    }
};
WindowTitleBarComponent.ɵfac = function WindowTitleBarComponent_Factory(t) { return new (t || WindowTitleBarComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(DragResizeService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
WindowTitleBarComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: WindowTitleBarComponent, selectors: [["kendo-window-titlebar"]], hostVars: 6, hostBindings: function WindowTitleBarComponent_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("dblclick", function WindowTitleBarComponent_dblclick_HostBindingHandler($event) { return ctx.handle($event); });
    } if (rf & 2) {
        ɵngcc0.ɵɵstyleProp("touch-action", ctx.touchAction);
        ɵngcc0.ɵɵclassProp("k-window-titlebar", ctx.className)("k-dialog-titlebar", ctx.className);
    } }, inputs: { template: "template" }, ngContentSelectors: _c0, decls: 2, vars: 2, consts: [[4, "ngIf"], [3, "ngTemplateOutlet", "ngTemplateOutletContext"]], template: function WindowTitleBarComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef();
        ɵngcc0.ɵɵtemplate(0, WindowTitleBarComponent_ng_content_0_Template, 1, 0, "ng-content", 0);
        ɵngcc0.ɵɵtemplate(1, WindowTitleBarComponent_1_Template, 1, 4, null, 0);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngIf", !ctx.template);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.template);
    } }, directives: [ɵngcc1.NgIf, ɵngcc1.NgTemplateOutlet], encapsulation: 2 });
__decorate([
    Input(),
    __metadata("design:type", TemplateRef)
], WindowTitleBarComponent.prototype, "template", void 0);
__decorate([
    HostBinding('class.k-window-titlebar'),
    HostBinding('class.k-dialog-titlebar'),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [])
], WindowTitleBarComponent.prototype, "className", null);
__decorate([
    HostBinding('style.touch-action'),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [])
], WindowTitleBarComponent.prototype, "touchAction", null);
__decorate([
    HostListener('dblclick', ['$event']),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", void 0)
], WindowTitleBarComponent.prototype, "handle", null);
WindowTitleBarComponent = __decorate([ __metadata("design:paramtypes", [ElementRef, DragResizeService, NgZone])
], WindowTitleBarComponent);

/**
 * @hidden
 */
let NavigationService = class NavigationService {
    constructor(window, ngZone) {
        this.window = window;
        this.ngZone = ngZone;
    }
    process(ev) {
        const key = ev.keyCode;
        switch (key) {
            case Keys.up:
            case Keys.down:
            case Keys.left:
            case Keys.right: {
                ev.preventDefault();
                this.ngZone.run(() => {
                    this.handleArrow(key, ev);
                });
                break;
            }
            case Keys.esc:
                this.ngZone.run(() => {
                    this.handleEscape();
                });
                break;
            default:
                break;
        }
    }
    handleArrow(key, ev) {
        const options = this.window.options;
        if (ev.altKey) {
            this.handleStateChange(key, options.state);
            return;
        }
        if ((ev.ctrlKey || ev.metaKey) && options.state === 'default') {
            this.handleResize(key);
        }
        else {
            this.handleDrag(key);
        }
    }
    handleEscape() {
        this.window.closeAction();
    }
    handleDrag(key) {
        let options = this.window.options;
        if (!options.draggable) {
            return;
        }
        const offset$$1 = this.window.currentOffsetAndPosition();
        let restoreOptions = this.window.restoreOptions;
        let ev = {};
        let delta = 10;
        if (key === Keys.left || key === Keys.up) {
            delta *= -1;
        }
        switch (key) {
            case Keys.left:
            case Keys.right: {
                ev.left = offset$$1.x + delta;
                options.left = ev.left;
                break;
            }
            case Keys.up:
            case Keys.down: {
                ev.top = offset$$1.y + delta;
                options.top = ev.top;
                break;
            }
            default:
                break;
        }
        if (options.state === 'minimized' && isPresent(restoreOptions)) {
            restoreOptions.left = options.left;
            restoreOptions.top = options.top;
        }
        this.window.change.emit(ev);
    }
    handleResize(key) {
        const options = this.window.options;
        if (!options.resizable) {
            return;
        }
        const offset$$1 = this.window.currentOffsetAndPosition();
        let newWidth;
        let newHeight;
        let ev = {};
        let delta = 10;
        if (key === Keys.left || key === Keys.up) {
            delta *= -1;
        }
        switch (key) {
            case Keys.left:
            case Keys.right: {
                newWidth = offset$$1.width + delta;
                if (newWidth !== options.width && newWidth >= options.minWidth) {
                    ev.width = newWidth;
                }
                break;
            }
            case Keys.up:
            case Keys.down: {
                newHeight = offset$$1.height + delta;
                if (newHeight !== options.height && newHeight >= options.minHeight) {
                    ev.height = newHeight;
                }
                break;
            }
            default:
                break;
        }
        if (isPresent(ev.width) || isPresent(ev.height)) {
            OFFSET_STYLES.forEach((style$$1) => {
                if (isPresent(ev[style$$1])) {
                    this.window.options[style$$1] = ev[style$$1];
                }
            });
            this.window.change.emit(ev);
        }
    }
    handleStateChange(key, state$$1) {
        if ((state$$1 === 'minimized' && key === Keys.up) ||
            (state$$1 === 'maximized' && key === Keys.down)) {
            this.window.restoreAction();
            return;
        }
        if (state$$1 === 'default') {
            if (key === Keys.up) {
                this.window.maximizeAction();
            }
            else if (key === Keys.down) {
                this.window.minimizeAction();
            }
        }
    }
};
NavigationService.ɵfac = function NavigationService_Factory(t) { return new (t || NavigationService)(ɵngcc0.ɵɵinject(DragResizeService), ɵngcc0.ɵɵinject(ɵngcc0.NgZone)); };
NavigationService.ɵprov = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjectable({ token: NavigationService, factory: function (t) { return NavigationService.ɵfac(t); } });
NavigationService = __decorate([ __metadata("design:paramtypes", [DragResizeService,
        NgZone])
], NavigationService);

/**
 * Represents the [Kendo UI Window component for Angular]({% slug overview_window_dialogs %}).
 */
let WindowComponent = class WindowComponent {
    constructor(el, renderer, service, navigation, ngZone, localization) {
        this.el = el;
        this.renderer = renderer;
        this.service = service;
        this.navigation = navigation;
        this.ngZone = ngZone;
        this.localization = localization;
        /**
         * Specifies if the content of the component is persisted in the DOM when minimized.
         * @default false
         */
        this.keepContent = false;
        /**
         * Fires when the user starts to move the Window.
         */
        this.dragStart = new EventEmitter();
        /**
         * Fires when the Window was moved by the user.
         */
        this.dragEnd = new EventEmitter();
        /**
         * Fires when the user starts to resize the Window.
         */
        this.resizeStart = new EventEmitter();
        /**
         * Fires when the Window was resized by the user.
         */
        this.resizeEnd = new EventEmitter();
        /**
         * Fires when the user closes the Window.
         */
        this.close = new EventEmitter();
        /**
         * Fires when the `width` property of the component was updated. The event is triggered only after the resizing
         * has ended. The event data contains the new width. Allows a two-way binding of the `width` property.
         */
        this.widthChange = new EventEmitter();
        /**
         * Fires when the `height` property of the component was updated. The event is triggered only after the resizing
         * has ended. The event data contains the new height. Allows a two-way binding of the `height` property.
         */
        this.heightChange = new EventEmitter();
        /**
         * Fires when the `top` property of the component was updated. The event is triggered only after the dragging
         * and resizing have ended. The event data contains the new top offset. Allows a two-way binding of the `top` property.
         */
        this.topChange = new EventEmitter();
        /**
         * Fires when the `left` property of the component was updated. The event is triggered only after the dragging
         * and resizing have ended. The event data contains the new left offset. Allows a two-way binding of the `left` property.
         */
        this.leftChange = new EventEmitter();
        /**
         * Fires when the `state` property of the component was updated. The event data contains the new state. Allows a
         * two-way binding of the `state` property.
         */
        this.stateChange = new EventEmitter();
        /**
         * @hidden
         */
        this.messages = {};
        this.tabIndex = 0;
        this.draged = false;
        this.resized = false;
        this.windowSubscription = new Subscription();
        this.domSubs = new Subscription();
        validatePackage(packageMetadata);
        this.direction = this.localization.rtl ? 'rtl' : 'ltr';
        this.localizationChangeSubscription = this.localization.changes
            .subscribe(({ rtl }) => this.direction = rtl ? 'rtl' : 'ltr');
        this.resizeDirections = RESIZE_DIRECTIONS;
        this.subscribeEvents();
    }
    /**
     * Specifies whether the user will be able to drag the component.
     * @default true
     */
    set draggable(value) {
        this.options.draggable = value;
    }
    get draggable() {
        return this.options.draggable;
    }
    /**
     * Specifies whether the user will be able to resize the component.
     * @default true
     */
    set resizable(value) {
        this.options.resizable = value;
    }
    get resizable() {
        return this.options.resizable;
    }
    /**
     * @hidden
     */
    set cssClass(classes) {
        this.setServiceClasses(this._cssClass, classes);
        this._cssClass = classes;
    }
    get cssClass() {
        return this._cssClass;
    }
    /**
     * @hidden
     */
    set htmlAttributes(attributes) {
        setHTMLAttributes(attributes, this.renderer, this.el.nativeElement);
        const el = this.el.nativeElement;
        const dir = el.getAttribute('dir');
        const tIndex = el.getAttribute('tabindex');
        if (this.direction !== dir) {
            this.direction = dir;
        }
        if (this.tabIndex !== tIndex) {
            this.tabIndex = tIndex;
        }
        this._htmlAttributes = attributes;
    }
    get htmlAttributes() {
        return this._htmlAttributes;
    }
    /**
     * Specifies the initial state of the component.
     * If not specified, the value is set to `default`.
     *
     * The possible values are:
     * * `minimized`
     * * `maximized`
     * * `default`
     */
    set state(value) {
        this.options.state = value;
    }
    get state() {
        return this.options.state;
    }
    /**
     * Specifies the minimum width of the component.
     * The `minWidth` property has to be set in pixels.
     * @default 120
     */
    set minWidth(value) {
        this.setOption('minWidth', value);
    }
    get minWidth() {
        return this.options.minWidth;
    }
    /**
     * Specifies the minimum height of the Window.
     * The `minHeight` property has to be set in pixels.
     * @default 100
     */
    set minHeight(value) {
        this.setOption('minHeight', value);
    }
    get minHeight() {
        return this.options.minHeight;
    }
    /**
     * Specifies the width of the Window.
     * The `width` property has to be set in pixels.
     */
    set width(value) {
        this.setOption('width', value);
    }
    get width() {
        return this.options.width;
    }
    /**
     * Specifies the height of the Window.
     * The `height` property has to be set in pixels.
     */
    set height(value) {
        this.setOption('height', value);
    }
    get height() {
        return this.options.height;
    }
    /**
     * Specifies the initial top offset of the Window.
     * The `top` property has to be set in pixels.
     */
    set top(value) {
        this.setOption('top', value);
    }
    get top() {
        return this.options.top;
    }
    /**
     * Specifies the initial left offset of the Window.
     * Numeric values are treated as pixels.
     */
    set left(value) {
        this.setOption('left', value);
    }
    get left() {
        return this.options.left;
    }
    get closeButtonTitle() {
        if (this.messages && this.messages.closeTitle) {
            return this.messages.closeTitle;
        }
        return this.localization.get('closeTitle');
    }
    get restoreButtonTitle() {
        if (this.messages && this.messages.restoreTitle) {
            return this.messages.restoreTitle;
        }
        return this.localization.get('restoreTitle');
    }
    get maximizeButtonTitle() {
        if (this.messages && this.messages.maximizeTitle) {
            return this.messages.maximizeTitle;
        }
        return this.localization.get('maximizeTitle');
    }
    get minimizeButtonTitle() {
        if (this.messages && this.messages.minimizeTitle) {
            return this.messages.minimizeTitle;
        }
        return this.localization.get('minimizeTitle');
    }
    get hostClasses() {
        return true;
    }
    get dir() {
        return this.direction;
    }
    ngAfterViewInit() {
        this.setNextZIndex();
        this.handleInitialFocus();
        this.ngZone.runOutsideAngular(() => Promise.resolve(null).then(() => this.setInitialOffset()));
        this.initDomEvents();
    }
    ngOnInit() {
        this.renderer.removeAttribute(this.el.nativeElement, 'title');
        this.service.init(this.el);
    }
    ngOnChanges(changes) {
        OFFSET_STYLES.forEach((style$$1) => {
            if (isChanged(style$$1, changes)) {
                this.setStyle(style$$1, this.options[style$$1]);
            }
        });
        if (isChanged('draggable', changes)) {
            const titleBar = isPresent(this.titleBarContent) ? this.titleBarContent : this.titleBarView;
            if (isTruthy(changes.draggable.currentValue)) {
                titleBar.subscribeDrag();
            }
            else {
                titleBar.unsubscribeDrag();
            }
        }
        if (isChanged('state', changes)) {
            if (isPresent(this.service.lastAction)) {
                this.service.lastAction = null;
            }
            else {
                this.service.applyManualState();
                this.updateAllOffset();
            }
        }
    }
    ngOnDestroy() {
        if (this.windowSubscription) {
            this.windowSubscription.unsubscribe();
        }
        if (this.domSubs) {
            this.domSubs.unsubscribe();
        }
        this.localizationChangeSubscription.unsubscribe();
    }
    /**
     * Focuses the wrapper of the Window component.
     */
    focus() {
        const wrapper = this.el.nativeElement;
        if (isPresent(wrapper)) {
            wrapper.focus();
        }
    }
    /**
     * Brings the current Window component on top of other Window components on the page.
     */
    bringToFront() {
        this.setNextZIndex();
    }
    /**
     * Manually updates the `width` or `height` option of the Window.
     * The required style will be applied to the Window wrapper element and the
     * corresponding property of the component instance will be updated.
     * This method is intended to be used for sizing dynamically created components using the
     * [`WindowService`]({% slug api_dialog_windowservice %})
     * @param {WindowDimensionSetting} dimension - The option that will be updated
     * @param {number} value - The value set in pixels
     */
    setDimension(dimension, value) {
        this.setOption(dimension, value);
        this.setStyle(dimension, value);
    }
    /**
     * Manually updates the `top` or `left` offset of the Window.
     * The required style will be applied to the Window wrapper element and the
     * corresponding property of the component instance will be updated.
     * This method is intended to be used for positioning dynamically created components using the
     * [`WindowService`]({% slug api_dialog_windowservice %})
     * @param {WindowOffsetSetting} offset - The option that will be updated
     * @param {number} value - The value set in pixels
     */
    setOffset(offset$$1, value) {
        this.setOption(offset$$1, value);
        this.setStyle(offset$$1, value);
    }
    get showDefaultTitleBar() {
        return !isPresent(this.titleBarContent);
    }
    get styleMinWidth() {
        return this.minWidth + 'px';
    }
    get styleMinHeight() {
        return this.minHeight + 'px';
    }
    get stylePosition() {
        return this.options.position;
    }
    get wrapperMaximizedClass() {
        return this.state === 'maximized';
    }
    get wrapperMinimizedClass() {
        return this.state === 'minimized';
    }
    /**
     * @hidden
     */
    onComponentFocus() {
        this.renderer.addClass(this.el.nativeElement, 'k-focus');
        this.setNextZIndex();
    }
    /**
     * @hidden
     */
    onComponentBlur() {
        this.renderer.removeClass(this.el.nativeElement, 'k-focus');
    }
    subscribeEvents() {
        if (!isDocumentAvailable()) {
            return;
        }
        this.windowSubscription.add(this.service.focus.subscribe(() => {
            this.el.nativeElement.focus();
        }));
        this.windowSubscription.add(this.service.dragStart.subscribe(() => {
            this.draged = true;
            this.ngZone.run(() => {
                this.dragStart.emit();
            });
        }));
        this.windowSubscription.add(this.service.dragEnd.subscribe(() => {
            if (this.draged) {
                this.draged = false;
                this.ngZone.run(() => {
                    this.dragEnd.emit();
                });
            }
        }));
        this.windowSubscription.add(this.service.close.subscribe(() => {
            this.close.emit();
        }));
        this.windowSubscription.add(this.service.resizeStart.subscribe(() => {
            this.resized = true;
            this.ngZone.run(() => {
                this.resizeStart.emit();
            });
        }));
        this.windowSubscription.add(this.service.resizeEnd.subscribe(() => {
            if (this.resized) {
                this.resized = false;
                this.ngZone.run(() => {
                    this.resizeEnd.emit();
                });
            }
        }));
        this.windowSubscription.add(this.service.change.subscribe((ev) => {
            OFFSET_STYLES.forEach((style$$1) => {
                if (isPresent(ev[style$$1])) {
                    this.setStyle(style$$1, ev[style$$1]);
                    if (this.state !== 'maximized') {
                        const emitter = this[style$$1 + 'Change'];
                        if (emitter.observers.length) {
                            this.ngZone.run(() => {
                                emitter.emit(ev[style$$1]);
                            });
                        }
                    }
                }
            });
        }));
        this.windowSubscription.add(this.service.stateChange.subscribe((state$$1) => {
            if (isPresent(this.service.lastAction)) {
                this.updateAllOffset();
                this.stateChange.emit(state$$1);
            }
        }));
    }
    initDomEvents() {
        if (!this.el) {
            return;
        }
        this.ngZone.runOutsideAngular(() => {
            this.domSubs.add(this.renderer.listen(this.el.nativeElement, 'keydown', (ev) => {
                this.onKeyDown(ev);
            }));
        });
    }
    onKeyDown(event) {
        if (hasClasses(event.target, WINDOW_CLASSES)) {
            this.navigation.process(event);
        }
    }
    setServiceClasses(prevValue, value) {
        const el = this.el.nativeElement;
        if (prevValue) {
            parseCSSClassNames(prevValue).forEach(className => {
                this.renderer.removeClass(el, className);
            });
        }
        if (value) {
            parseCSSClassNames(value).forEach(className => {
                this.renderer.addClass(el, className);
            });
        }
    }
    setNextZIndex() {
        const currentZIndex = this.el.nativeElement.style['z-index'];
        const nextPossibleZIndex = this.service.nextPossibleZIndex;
        if (!currentZIndex || (nextPossibleZIndex - currentZIndex > 1)) {
            this.renderer.setStyle(this.el.nativeElement, "z-index", this.service.nextZIndex);
        }
    }
    setInitialOffset() {
        if (this.state !== 'maximized') {
            this.updateAllOffset();
            if (!isPresent(this.left) || !isPresent(this.top)) {
                this.service.center();
            }
        }
        else {
            const viewPort = this.service.windowViewPort;
            this.setStyle('width', viewPort.width);
            this.setStyle('height', viewPort.height);
            this.setStyle('top', 0);
            this.setStyle('left', 0);
        }
    }
    updateAllOffset() {
        OFFSET_STYLES.forEach((style$$1) => {
            if (isPresent(this[style$$1])) {
                this.setStyle(style$$1, this[style$$1]);
            }
            else {
                this.removeStyle(style$$1);
            }
        });
    }
    setStyle(style$$1, value) {
        this.renderer.setStyle(this.el.nativeElement, style$$1, value + 'px');
    }
    removeStyle(style$$1) {
        this.renderer.removeStyle(this.el.nativeElement, style$$1);
    }
    get options() {
        return this.service.options;
    }
    setOption(style$$1, value) {
        if (typeof value !== 'number' && typeof value !== 'string') {
            return;
        }
        const parsedValue = (typeof value === 'number') ? value : parseInt(value, 10);
        this.options[style$$1] = parsedValue;
        this.service.setRestoreOption(style$$1, parsedValue);
    }
    handleInitialFocus() {
        const wrapper = this.el.nativeElement;
        if (this.autoFocusedElement) {
            const initiallyFocusedElement = wrapper.querySelector(this.autoFocusedElement);
            if (initiallyFocusedElement) {
                initiallyFocusedElement.focus();
            }
        }
        else {
            this.focus();
        }
    }
};
WindowComponent.ɵfac = function WindowComponent_Factory(t) { return new (t || WindowComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(DragResizeService), ɵngcc0.ɵɵdirectiveInject(NavigationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService)); };
WindowComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: WindowComponent, selectors: [["kendo-window"]], contentQueries: function WindowComponent_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
        ɵngcc0.ɵɵcontentQuery(dirIndex, WindowTitleBarComponent, 5);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.titleBarContent = _t.first);
    } }, viewQuery: function WindowComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(WindowTitleBarComponent, 5);
        ɵngcc0.ɵɵviewQuery(ResizeHandleDirective, 5);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.titleBarView = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.resizeHandles = _t);
    } }, hostVars: 14, hostBindings: function WindowComponent_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("focus", function WindowComponent_focus_HostBindingHandler() { return ctx.onComponentFocus(); })("blur", function WindowComponent_blur_HostBindingHandler() { return ctx.onComponentBlur(); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("tabIndex", ctx.tabIndex)("dir", ctx.dir);
        ɵngcc0.ɵɵstyleProp("min-width", ctx.styleMinWidth)("min-height", ctx.styleMinHeight)("position", ctx.stylePosition);
        ɵngcc0.ɵɵclassProp("k-window", ctx.hostClasses)("k-window-maximized", ctx.wrapperMaximizedClass)("k-window-minimized", ctx.wrapperMinimizedClass);
    } }, inputs: { keepContent: "keepContent", draggable: "draggable", resizable: "resizable", state: "state", minWidth: "minWidth", minHeight: "minHeight", width: "width", height: "height", top: "top", left: "left", autoFocusedElement: "autoFocusedElement", title: "title" }, outputs: { dragStart: "dragStart", dragEnd: "dragEnd", resizeStart: "resizeStart", resizeEnd: "resizeEnd", close: "close", widthChange: "widthChange", heightChange: "heightChange", topChange: "topChange", leftChange: "leftChange", stateChange: "stateChange" }, exportAs: ["kendoWindow"], features: [ɵngcc0.ɵɵProvidersFeature([
            DragResizeService,
            NavigationService,
            LocalizationService,
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.window'
            }
        ]), ɵngcc0.ɵɵNgOnChangesFeature], ngContentSelectors: _c17, decls: 6, vars: 4, consts: function () { let i18n_8; if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
        /**
         * @desc The title of the close button
         * @meaning kendo.window.closeTitle
         */
        const MSG_EXTERNAL_2849207436137160812$$DIST_FESM2015_INDEX_JS_9 = goog.getMsg("Close");
        i18n_8 = MSG_EXTERNAL_2849207436137160812$$DIST_FESM2015_INDEX_JS_9;
    }
    else {
        i18n_8 = $localize `:kendo.window.closeTitle|The title of the close button␟bb50cb526949482fc976fd868573ab283580ee69␟2849207436137160812:Close`;
    } let i18n_10; if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
        /**
         * @desc The title of the restore button
         * @meaning kendo.window.restoreTitle
         */
        const MSG_EXTERNAL_3443120027481340803$$DIST_FESM2015_INDEX_JS_11 = goog.getMsg("Restore");
        i18n_10 = MSG_EXTERNAL_3443120027481340803$$DIST_FESM2015_INDEX_JS_11;
    }
    else {
        i18n_10 = $localize `:kendo.window.restoreTitle|The title of the restore button␟9a9ce231f0396e40adcfa80bfa76e546e0085be0␟3443120027481340803:Restore`;
    } let i18n_12; if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
        /**
         * @desc The title of the maximize button
         * @meaning kendo.window.maximizeTitle
         */
        const MSG_EXTERNAL_7793415109119115257$$DIST_FESM2015_INDEX_JS_13 = goog.getMsg("Maximize");
        i18n_12 = MSG_EXTERNAL_7793415109119115257$$DIST_FESM2015_INDEX_JS_13;
    }
    else {
        i18n_12 = $localize `:kendo.window.maximizeTitle|The title of the maximize button␟42bc654ef8767c5df5277aa88941b94f8d373b4d␟7793415109119115257:Maximize`;
    } let i18n_14; if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
        /**
         * @desc The title of the minimize button
         * @meaning kendo.window.minimizeTitle
         */
        const MSG_EXTERNAL_7581084655285341827$$DIST_FESM2015_INDEX_JS_15 = goog.getMsg("Minimize");
        i18n_14 = MSG_EXTERNAL_7581084655285341827$$DIST_FESM2015_INDEX_JS_15;
    }
    else {
        i18n_14 = $localize `:kendo.window.minimizeTitle|The title of the minimize button␟7ca9f9b41a23760f7f74e91ee4c76d5a5f4a706c␟7581084655285341827:Minimize`;
    } return [["kendoWindowLocalizedMessages", "", "closeTitle", i18n_8, "restoreTitle", i18n_10, "maximizeTitle", i18n_12, "minimizeTitle", i18n_14], [3, "template", 4, "ngIf"], [4, "ngIf"], ["class", "k-content k-window-content", 3, "hidden", 4, "ngIf"], [3, "ngIf"], [3, "template"], [1, "k-window-title"], [1, "k-window-actions"], ["kendoWindowMinimizeAction", ""], ["kendoWindowMaximizeAction", ""], ["kendoWindowRestoreAction", ""], ["kendoWindowCloseAction", ""], [1, "k-content", "k-window-content", 3, "hidden"], [3, "ngTemplateOutlet"], ["kendoWindowResizeHandle", "", "kendoDraggable", "", 3, "direction", 4, "ngFor", "ngForOf"], ["kendoWindowResizeHandle", "", "kendoDraggable", "", 3, "direction"]]; }, template: function WindowComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef(_c16);
        ɵngcc0.ɵɵelementContainerStart(0, 0)(1);
        ɵngcc0.ɵɵtemplate(2, WindowComponent_kendo_window_titlebar_2_Template, 8, 10, "kendo-window-titlebar", 1);
        ɵngcc0.ɵɵtemplate(3, WindowComponent_ng_content_3_Template, 1, 0, "ng-content", 2);
        ɵngcc0.ɵɵtemplate(4, WindowComponent_div_4_Template, 3, 3, "div", 3);
        ɵngcc0.ɵɵtemplate(5, WindowComponent_ng_template_5_Template, 1, 1, "ng-template", 4);
        ɵngcc0.ɵɵelementContainerEnd()();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showDefaultTitleBar);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.showDefaultTitleBar);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.state !== "minimized" || ctx.keepContent);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.resizable);
    } }, directives: function () { return [LocalizedMessagesDirective, ɵngcc1.NgIf, WindowTitleBarComponent, WindowMinimizeActionDirective, WindowMaximizeActionDirective, WindowRestoreActionDirective, WindowCloseActionDirective, ɵngcc1.NgTemplateOutlet, ɵngcc1.NgForOf, ResizeHandleDirective, ɵngcc3.DraggableDirective]; }, encapsulation: 2 });
__decorate([
    Input(),
    __metadata("design:type", String)
], WindowComponent.prototype, "autoFocusedElement", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], WindowComponent.prototype, "title", void 0);
__decorate([
    Input(),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [Boolean])
], WindowComponent.prototype, "draggable", null);
__decorate([
    Input(),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [Boolean])
], WindowComponent.prototype, "resizable", null);
__decorate([
    Input(),
    __metadata("design:type", Boolean)
], WindowComponent.prototype, "keepContent", void 0);
__decorate([
    Input(),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [String])
], WindowComponent.prototype, "state", null);
__decorate([
    Input(),
    __metadata("design:type", Number),
    __metadata("design:paramtypes", [Number])
], WindowComponent.prototype, "minWidth", null);
__decorate([
    Input(),
    __metadata("design:type", Number),
    __metadata("design:paramtypes", [Number])
], WindowComponent.prototype, "minHeight", null);
__decorate([
    Input(),
    __metadata("design:type", Number),
    __metadata("design:paramtypes", [Number])
], WindowComponent.prototype, "width", null);
__decorate([
    Input(),
    __metadata("design:type", Number),
    __metadata("design:paramtypes", [Number])
], WindowComponent.prototype, "height", null);
__decorate([
    Input(),
    __metadata("design:type", Number),
    __metadata("design:paramtypes", [Number])
], WindowComponent.prototype, "top", null);
__decorate([
    Input(),
    __metadata("design:type", Number),
    __metadata("design:paramtypes", [Number])
], WindowComponent.prototype, "left", null);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], WindowComponent.prototype, "dragStart", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], WindowComponent.prototype, "dragEnd", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], WindowComponent.prototype, "resizeStart", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], WindowComponent.prototype, "resizeEnd", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], WindowComponent.prototype, "close", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], WindowComponent.prototype, "widthChange", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], WindowComponent.prototype, "heightChange", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], WindowComponent.prototype, "topChange", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], WindowComponent.prototype, "leftChange", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], WindowComponent.prototype, "stateChange", void 0);
__decorate([
    HostBinding('attr.tabIndex'),
    __metadata("design:type", Number)
], WindowComponent.prototype, "tabIndex", void 0);
__decorate([
    HostBinding('class.k-window'),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [])
], WindowComponent.prototype, "hostClasses", null);
__decorate([
    HostBinding('attr.dir'),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [])
], WindowComponent.prototype, "dir", null);
__decorate([
    ViewChild(WindowTitleBarComponent, { static: false }),
    __metadata("design:type", WindowTitleBarComponent)
], WindowComponent.prototype, "titleBarView", void 0);
__decorate([
    ContentChild(WindowTitleBarComponent, { static: false }),
    __metadata("design:type", WindowTitleBarComponent)
], WindowComponent.prototype, "titleBarContent", void 0);
__decorate([
    ViewChildren(ResizeHandleDirective),
    __metadata("design:type", QueryList)
], WindowComponent.prototype, "resizeHandles", void 0);
__decorate([
    HostBinding('style.minWidth'),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [])
], WindowComponent.prototype, "styleMinWidth", null);
__decorate([
    HostBinding('style.minHeight'),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [])
], WindowComponent.prototype, "styleMinHeight", null);
__decorate([
    HostBinding('style.position'),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [])
], WindowComponent.prototype, "stylePosition", null);
__decorate([
    HostBinding('class.k-window-maximized'),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [])
], WindowComponent.prototype, "wrapperMaximizedClass", null);
__decorate([
    HostBinding('class.k-window-minimized'),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [])
], WindowComponent.prototype, "wrapperMinimizedClass", null);
__decorate([
    HostListener('focus'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], WindowComponent.prototype, "onComponentFocus", null);
__decorate([
    HostListener('blur'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], WindowComponent.prototype, "onComponentBlur", null);
WindowComponent = __decorate([ __metadata("design:paramtypes", [ElementRef,
        Renderer2,
        DragResizeService,
        NavigationService,
        NgZone,
        LocalizationService])
], WindowComponent);

let WindowMaximizeActionDirective = class WindowMaximizeActionDirective extends Button {
    constructor(el, renderer, _service, localization, ngZone) {
        super(el, renderer, null, localization, ngZone);
        this.buttonType = 'button';
        this.window = _service;
        this.fillMode = 'flat';
        this.icon = 'window-maximize';
    }
    /**
     * @hidden
     */
    onClick() {
        if (!this.isDisabled) {
            this.window.maximizeAction();
        }
    }
    get visible() {
        return this.window.options.state === 'default' ? 'inline-flex' : 'none';
    }
};
WindowMaximizeActionDirective.ɵfac = function WindowMaximizeActionDirective_Factory(t) { return new (t || WindowMaximizeActionDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(DragResizeService, 8), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
WindowMaximizeActionDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: WindowMaximizeActionDirective, selectors: [["button", "kendoWindowMaximizeAction", ""]], hostVars: 3, hostBindings: function WindowMaximizeActionDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function WindowMaximizeActionDirective_click_HostBindingHandler() { return ctx.onClick(); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("type", ctx.buttonType);
        ɵngcc0.ɵɵstyleProp("display", ctx.visible);
    } }, inputs: { window: "window" }, exportAs: ["kendoWindowMaximizeAction"], features: [ɵngcc0.ɵɵProvidersFeature([
            LocalizationService,
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.button'
            }
        ]), ɵngcc0.ɵɵInheritDefinitionFeature] });
__decorate([
    Input(),
    __metadata("design:type", Object)
], WindowMaximizeActionDirective.prototype, "window", void 0);
__decorate([
    HostBinding('attr.type'),
    __metadata("design:type", String)
], WindowMaximizeActionDirective.prototype, "buttonType", void 0);
__decorate([
    HostListener('click'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], WindowMaximizeActionDirective.prototype, "onClick", null);
__decorate([
    HostBinding('style.display'),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [])
], WindowMaximizeActionDirective.prototype, "visible", null);
WindowMaximizeActionDirective = __decorate([ __param(2, Optional()),
    __metadata("design:paramtypes", [ElementRef,
        Renderer2,
        DragResizeService,
        LocalizationService,
        NgZone])
], WindowMaximizeActionDirective);

let WindowMinimizeActionDirective = class WindowMinimizeActionDirective extends Button {
    constructor(el, renderer, _service, localization, ngZone) {
        super(el, renderer, null, localization, ngZone);
        this.buttonType = 'button';
        this.window = _service;
        this.fillMode = 'flat';
        this.icon = 'window-minimize';
    }
    /**
     * @hidden
     */
    onClick() {
        if (!this.isDisabled) {
            this.window.minimizeAction();
        }
    }
    get visible() {
        return this.window.options.state === 'default' ? 'inline-flex' : 'none';
    }
};
WindowMinimizeActionDirective.ɵfac = function WindowMinimizeActionDirective_Factory(t) { return new (t || WindowMinimizeActionDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(DragResizeService, 8), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
WindowMinimizeActionDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: WindowMinimizeActionDirective, selectors: [["button", "kendoWindowMinimizeAction", ""]], hostVars: 3, hostBindings: function WindowMinimizeActionDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function WindowMinimizeActionDirective_click_HostBindingHandler() { return ctx.onClick(); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("type", ctx.buttonType);
        ɵngcc0.ɵɵstyleProp("display", ctx.visible);
    } }, inputs: { window: "window" }, exportAs: ["kendoWindowMinimizeAction"], features: [ɵngcc0.ɵɵProvidersFeature([
            LocalizationService,
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.button'
            }
        ]), ɵngcc0.ɵɵInheritDefinitionFeature] });
__decorate([
    Input(),
    __metadata("design:type", Object)
], WindowMinimizeActionDirective.prototype, "window", void 0);
__decorate([
    HostBinding('attr.type'),
    __metadata("design:type", String)
], WindowMinimizeActionDirective.prototype, "buttonType", void 0);
__decorate([
    HostListener('click'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], WindowMinimizeActionDirective.prototype, "onClick", null);
__decorate([
    HostBinding('style.display'),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [])
], WindowMinimizeActionDirective.prototype, "visible", null);
WindowMinimizeActionDirective = __decorate([ __param(2, Optional()),
    __metadata("design:paramtypes", [ElementRef,
        Renderer2,
        DragResizeService,
        LocalizationService,
        NgZone])
], WindowMinimizeActionDirective);

let WindowCloseActionDirective = class WindowCloseActionDirective extends Button {
    constructor(el, renderer, _service, localization, ngZone) {
        super(el, renderer, null, localization, ngZone);
        this.buttonType = 'button';
        this.window = _service;
        this.fillMode = 'flat';
        this.icon = 'close';
    }
    /**
     * @hidden
     */
    onClick() {
        if (!this.isDisabled) {
            this.window.closeAction();
        }
    }
};
WindowCloseActionDirective.ɵfac = function WindowCloseActionDirective_Factory(t) { return new (t || WindowCloseActionDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(DragResizeService, 8), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
WindowCloseActionDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: WindowCloseActionDirective, selectors: [["button", "kendoWindowCloseAction", ""]], hostVars: 1, hostBindings: function WindowCloseActionDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function WindowCloseActionDirective_click_HostBindingHandler() { return ctx.onClick(); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("type", ctx.buttonType);
    } }, inputs: { window: "window" }, exportAs: ["kendoWindowCloseAction"], features: [ɵngcc0.ɵɵProvidersFeature([
            LocalizationService,
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.button'
            }
        ]), ɵngcc0.ɵɵInheritDefinitionFeature] });
__decorate([
    Input(),
    __metadata("design:type", Object)
], WindowCloseActionDirective.prototype, "window", void 0);
__decorate([
    HostBinding('attr.type'),
    __metadata("design:type", String)
], WindowCloseActionDirective.prototype, "buttonType", void 0);
__decorate([
    HostListener('click'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], WindowCloseActionDirective.prototype, "onClick", null);
WindowCloseActionDirective = __decorate([ __param(2, Optional()),
    __metadata("design:paramtypes", [ElementRef,
        Renderer2,
        DragResizeService,
        LocalizationService,
        NgZone])
], WindowCloseActionDirective);

let WindowRestoreActionDirective = class WindowRestoreActionDirective extends Button {
    constructor(el, renderer, _service, localization, ngZone) {
        super(el, renderer, null, localization, ngZone);
        this.buttonType = 'button';
        this.window = _service;
        this.fillMode = 'flat';
        this.icon = 'window-restore';
    }
    /**
     * @hidden
     */
    onClick() {
        if (!this.isDisabled) {
            this.window.restoreAction();
        }
    }
    get visible() {
        return this.window.options.state === 'default' ? 'none' : 'inline-flex';
    }
};
WindowRestoreActionDirective.ɵfac = function WindowRestoreActionDirective_Factory(t) { return new (t || WindowRestoreActionDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(DragResizeService, 8), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
WindowRestoreActionDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: WindowRestoreActionDirective, selectors: [["button", "kendoWindowRestoreAction", ""]], hostVars: 3, hostBindings: function WindowRestoreActionDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function WindowRestoreActionDirective_click_HostBindingHandler() { return ctx.onClick(); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("type", ctx.buttonType);
        ɵngcc0.ɵɵstyleProp("display", ctx.visible);
    } }, inputs: { window: "window" }, exportAs: ["kendoWindowRestoreAction"], features: [ɵngcc0.ɵɵProvidersFeature([
            LocalizationService,
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.button'
            }
        ]), ɵngcc0.ɵɵInheritDefinitionFeature] });
__decorate([
    Input(),
    __metadata("design:type", Object)
], WindowRestoreActionDirective.prototype, "window", void 0);
__decorate([
    HostBinding('attr.type'),
    __metadata("design:type", String)
], WindowRestoreActionDirective.prototype, "buttonType", void 0);
__decorate([
    HostListener('click'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], WindowRestoreActionDirective.prototype, "onClick", null);
__decorate([
    HostBinding('style.display'),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [])
], WindowRestoreActionDirective.prototype, "visible", null);
WindowRestoreActionDirective = __decorate([ __param(2, Optional()),
    __metadata("design:paramtypes", [ElementRef,
        Renderer2,
        DragResizeService,
        LocalizationService,
        NgZone])
], WindowRestoreActionDirective);

/**
 * The settings for the Window actions when the Window is opened through `WindowService`
 * ([see example]({% slug api_dialog_windowservice %}#toc-open)).
 */
class WindowSettings {
}
/**
 * Indicates that the **Close** button of a Window that is opened through `WindowService` is clicked.
 */
class WindowCloseResult {
}
/**
 * Holds references to the object instance of the Window.
 * Controls the Windows that were opened through `WindowService`
 * ([see example]({% slug api_dialog_windowservice %}#toc-open)).
 */
class WindowRef {
}

var WindowContainerService_1;
/**
 * @hidden
 */
let WindowContainerService = WindowContainerService_1 = class WindowContainerService {
    set container(container) {
        WindowContainerService_1.container = container;
    }
    get container() {
        return WindowContainerService_1.container;
    }
};
WindowContainerService.ɵfac = function WindowContainerService_Factory(t) { return new (t || WindowContainerService)(); };
WindowContainerService.ɵprov = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjectable({ token: WindowContainerService, factory: function (t) { return WindowContainerService.ɵfac(t); } });
WindowContainerService.container = null;

const isNotComponent$1 = (component) => isString(component) || component instanceof TemplateRef;
class WindowInjector {
    constructor(getWindowRef, parentInjector) {
        this.getWindowRef = getWindowRef;
        this.parentInjector = parentInjector;
    }
    get(token, notFoundValue) {
        if (token === WindowRef) {
            return this.getWindowRef();
        }
        return this.parentInjector.get(token, notFoundValue);
    }
}
/**
 * A service for opening Windows dynamically
 * ([see example]({% slug service_window %})).
 */
let WindowService = class WindowService {
    constructor(
    /**
     * @hidden
     */
    resolver, containerService) {
        this.resolver = resolver;
        this.containerService = containerService;
    }
    /**
     * Opens a Window component.
     *
     * @param {WindowSettings} settings - The settings that define the Window.
     * @returns {WindowRef} - A reference to the Window object.
     *
     * @example
     *
     * ```ts-no-run
     * _@Component({
     *   selector: 'my-app',
     *   template: `
     *     <button kendoButton (click)="open()">Open window</button>
     *     <div kendoWindowContainer></div>
     *   `
     * })
     * export class AppComponent {
     *     constructor( private windowService: WindowService ) {}
     *
     *     public open() {
     *         var window = this.windowService.open({
     *           title: "My window",
     *           content: "My content!"
     *         });
     *
     *         window.result.subscribe((result) => {
     *           if (result instanceof WindowCloseResult) {
     *             console.log("Window was closed");
     *           }
     *         });
     *     }
     * }
     * ```
     *
     */
    open(settings) {
        const factory = this.resolver.resolveComponentFactory(WindowComponent);
        const container = settings.appendTo || this.containerService.container;
        if (!container) {
            throw new Error(`Cannot attach window to the page.
                Add an element that uses the kendoWindowContainer directive, or set the 'appendTo' property.
                See https://www.telerik.com/kendo-angular-ui/components/dialogs/window/service/
            `);
        }
        const windowRef = {
            close: () => { },
            content: null,
            result: null,
            window: null
        };
        const content = this.contentFrom(settings.content, container, windowRef);
        const window = container.createComponent(factory, undefined, undefined, content.nodes);
        windowRef.window = window;
        this.applyOptions(window.instance, settings);
        const apiClose = new Subject();
        const close = (e) => {
            apiClose.next(e || new WindowCloseResult());
            if (content.componentRef) {
                content.componentRef.destroy();
            }
            window.destroy();
        };
        const result = merge(apiClose, window.instance.close.pipe(map(e => (e ? e : new WindowCloseResult())), filter((e) => {
            if (settings.preventClose) {
                // add windowRef only when using component
                const windowRefParameter = isNotComponent$1(settings.content) ? undefined : windowRef;
                return !settings.preventClose(e, windowRefParameter);
            }
            return true;
        }))).pipe(take(1), 
        // Takes care for multiple subscriptions:
        // We subscribe internally and the user may subscribe to get a close result - window.result.subscribe().
        // This causes multiple subscriptions to the same source and thus multiple emissions. share() solves that.
        share());
        result.subscribe(close);
        windowRef.close = close;
        windowRef.result = result;
        window.changeDetectorRef.markForCheck();
        return windowRef;
    }
    applyOptions(instance, options) {
        if (isPresent(options.htmlAttributes)) {
            instance.htmlAttributes = options.htmlAttributes;
        }
        if (isPresent(options.cssClass)) {
            instance.cssClass = options.cssClass;
        }
        if (isPresent(options.title)) {
            instance.title = options.title;
        }
        if (isPresent(options.keepContent)) {
            instance.keepContent = options.keepContent;
        }
        if (isPresent(options.width)) {
            instance.width = options.width;
        }
        if (isPresent(options.minWidth)) {
            instance.minWidth = options.minWidth;
        }
        if (isPresent(options.height)) {
            instance.height = options.height;
        }
        if (isPresent(options.minHeight)) {
            instance.minHeight = options.minHeight;
        }
        if (isPresent(options.left)) {
            instance.left = options.left;
        }
        if (isPresent(options.top)) {
            instance.top = options.top;
        }
        if (isPresent(options.draggable)) {
            instance.draggable = options.draggable;
        }
        if (isPresent(options.resizable)) {
            instance.resizable = options.resizable;
        }
        if (isPresent(options.messages && options.messages.closeTitle)) {
            instance.messages.closeTitle = options.messages.closeTitle;
        }
        if (isPresent(options.messages && options.messages.restoreTitle)) {
            instance.messages.restoreTitle = options.messages.restoreTitle;
        }
        if (isPresent(options.messages && options.messages.maximizeTitle)) {
            instance.messages.maximizeTitle = options.messages.maximizeTitle;
        }
        if (isPresent(options.messages && options.messages.minimizeTitle)) {
            instance.messages.minimizeTitle = options.messages.minimizeTitle;
        }
        if (isPresent(options.autoFocusedElement)) {
            instance.autoFocusedElement = options.autoFocusedElement;
        }
        if (isPresent(options.state)) {
            instance.state = options.state;
            if (options.state === 'minimized') {
                instance.keepContent = true;
            }
        }
        if (options.content instanceof TemplateRef) {
            instance.contentTemplate = options.content;
        }
        if (options.titleBarContent instanceof TemplateRef) {
            instance.titleBarTemplate = options.titleBarContent;
        }
    }
    contentFrom(content, container, windowRef) {
        const renderer = container.injector.get(Renderer2);
        let nodes = [];
        let componentRef = null;
        if (typeof content === 'string') {
            nodes = [renderer.createText(content)];
        }
        else if (content && !(content instanceof TemplateRef)) {
            const injector = new WindowInjector(() => windowRef, container.injector);
            const factory = this.resolver.resolveComponentFactory(content);
            componentRef = container.createComponent(factory, undefined, injector);
            nodes = [componentRef.location.nativeElement];
            windowRef.content = componentRef;
        }
        return {
            componentRef,
            nodes: [
                [],
                nodes // Content
            ]
        };
    }
};
WindowService.ɵfac = function WindowService_Factory(t) { return new (t || WindowService)(ɵngcc0.ɵɵinject(ɵngcc0.ComponentFactoryResolver), ɵngcc0.ɵɵinject(WindowContainerService)); };
WindowService.ɵprov = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjectable({ token: WindowService, factory: function (t) { return WindowService.ɵfac(t); } });
WindowService = __decorate([ __param(1, Inject(WindowContainerService)),
    __metadata("design:paramtypes", [ComponentFactoryResolver,
        WindowContainerService])
], WindowService);

/**
 * Provides an insertion point for the Dialogs which are created through the
 * Dialog service ([see example]({% slug api_dialog_dialogservice %}#toc-open)).
 * Created Dialogs will be mounted after that element.
 *
 * @example
 * ```html-no-run
 * <div kendoDialogContainer></div>
 * ```
 */
let DialogContainerDirective = class DialogContainerDirective {
    constructor(container, service) {
        service.container = container;
    }
};
DialogContainerDirective.ɵfac = function DialogContainerDirective_Factory(t) { return new (t || DialogContainerDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ViewContainerRef), ɵngcc0.ɵɵdirectiveInject(DialogContainerService)); };
DialogContainerDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: DialogContainerDirective, selectors: [["", "kendoDialogContainer", ""]] });
DialogContainerDirective = __decorate([ __metadata("design:paramtypes", [ViewContainerRef,
        DialogContainerService])
], DialogContainerDirective);

/**
 * @hidden
 */
class Messages extends ComponentMessages {
}
Messages.ɵfac = /*@__PURE__*/ function () { let ɵMessages_BaseFactory; return function Messages_Factory(t) { return (ɵMessages_BaseFactory || (ɵMessages_BaseFactory = ɵngcc0.ɵɵgetInheritedFactory(Messages)))(t || Messages); }; }();
Messages.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: Messages, inputs: { closeTitle: "closeTitle", restoreTitle: "restoreTitle", maximizeTitle: "maximizeTitle", minimizeTitle: "minimizeTitle" }, features: [ɵngcc0.ɵɵInheritDefinitionFeature] });
__decorate([
    Input(),
    __metadata("design:type", String)
], Messages.prototype, "closeTitle", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], Messages.prototype, "restoreTitle", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], Messages.prototype, "maximizeTitle", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], Messages.prototype, "minimizeTitle", void 0);

var LocalizedMessagesDirective_1;
/**
 * @hidden
 */
let LocalizedMessagesDirective = LocalizedMessagesDirective_1 = class LocalizedMessagesDirective extends Messages {
    constructor(service) {
        super();
        this.service = service;
    }
};
LocalizedMessagesDirective.ɵfac = function LocalizedMessagesDirective_Factory(t) { return new (t || LocalizedMessagesDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService)); };
LocalizedMessagesDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: LocalizedMessagesDirective, selectors: [["", "kendoDialogLocalizedMessages", ""], ["", "kendoWindowLocalizedMessages", ""], ["", "kendoDialogTitleBarLocalizedMessages", ""]], features: [ɵngcc0.ɵɵProvidersFeature([
            {
                provide: Messages,
                useExisting: forwardRef(() => LocalizedMessagesDirective_1)
            }
        ]), ɵngcc0.ɵɵInheritDefinitionFeature] });
LocalizedMessagesDirective = LocalizedMessagesDirective_1 = __decorate([ __metadata("design:paramtypes", [LocalizationService])
], LocalizedMessagesDirective);

var CustomMessagesComponent_1;
/**
 * Custom component messages override default component messages
 * ([see example]({% slug globalization_dialogs %}#toc-localization)).
 */
let CustomMessagesComponent = CustomMessagesComponent_1 = class CustomMessagesComponent extends Messages {
    constructor(service) {
        super();
        this.service = service;
    }
    get override() {
        return true;
    }
};
CustomMessagesComponent.ɵfac = function CustomMessagesComponent_Factory(t) { return new (t || CustomMessagesComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService)); };
CustomMessagesComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: CustomMessagesComponent, selectors: [["kendo-dialog-messages"], ["kendo-window-messages"]], features: [ɵngcc0.ɵɵProvidersFeature([
            {
                provide: Messages,
                useExisting: forwardRef(() => CustomMessagesComponent_1) // tslint:disable-line:no-forward-ref
            }
        ]), ɵngcc0.ɵɵInheritDefinitionFeature], decls: 0, vars: 0, template: function CustomMessagesComponent_Template(rf, ctx) { }, encapsulation: 2 });
CustomMessagesComponent = CustomMessagesComponent_1 = __decorate([ __metadata("design:paramtypes", [LocalizationService])
], CustomMessagesComponent);

/**
 * @hidden
 */
const SHARED_DIRECTIVES = [
    DialogActionsComponent,
    CustomMessagesComponent,
    LocalizedMessagesDirective
];
/**
 * @hidden
 */
let SharedModule = class SharedModule {
};
SharedModule.ɵfac = function SharedModule_Factory(t) { return new (t || SharedModule)(); };
SharedModule.ɵmod = /*@__PURE__*/ ɵngcc0.ɵɵdefineNgModule({ type: SharedModule });
SharedModule.ɵinj = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjector({ imports: [[CommonModule], CommonModule] });

/**
 * @hidden
 */
const DIALOG_DIRECTIVES = [
    DialogComponent,
    DialogTitleBarComponent
];
/**
 * Represents the [NgModule]({{ site.data.urls.angular['ngmoduleapi'] }})
 * definition for the Dialog component that includes all Dialog components and directives.
 * Imports `DialogModule` into the [root module]({{ site.data.urls.angular['ngmodules'] }}#angular-modularity)
 * of your application or into any other sub-module that will use the Dialog component.
 *
 * @example
 * ```ts-no-run
 * import { NgModule } from '@angular/core';
 * import { BrowserModule } from '@angular/platform-browser';
 * import { DialogModule } from '@progress/kendo-angular-dialog';
 * import { AppComponent } from './app.component';
 *
 * _@NgModule({
 *     bootstrap:    [AppComponent],
 *     declarations: [AppComponent],
 *     imports:      [BrowserModule, DialogModule]
 * })
 * export class AppModule {
 * }
 * ```
 */
let DialogModule = class DialogModule {
};
DialogModule.ɵfac = function DialogModule_Factory(t) { return new (t || DialogModule)(); };
DialogModule.ɵmod = /*@__PURE__*/ ɵngcc0.ɵɵdefineNgModule({ type: DialogModule });
DialogModule.ɵinj = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjector({ providers: [DialogContainerService, DialogService], imports: [[SharedModule]] });

/**
 * Provides an insertion point for the Windows which are created through the
 * Window service ([see example]({% slug api_dialog_windowservice %}#toc-open)).
 * Created Windows will be mounted after that element.
 *
 * @example
 * ```html-no-run
 * <div kendoWindowContainer></div>
 * ```
 */
let WindowContainerDirective = class WindowContainerDirective {
    constructor(container, service) {
        service.container = container;
    }
};
WindowContainerDirective.ɵfac = function WindowContainerDirective_Factory(t) { return new (t || WindowContainerDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ViewContainerRef), ɵngcc0.ɵɵdirectiveInject(WindowContainerService)); };
WindowContainerDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: WindowContainerDirective, selectors: [["", "kendoWindowContainer", ""]] });
WindowContainerDirective = __decorate([ __metadata("design:paramtypes", [ViewContainerRef,
        WindowContainerService])
], WindowContainerDirective);

const WINDOW_DIRECTIVES = [
    ResizeHandleDirective,
    WindowComponent,
    WindowTitleBarComponent,
    WindowCloseActionDirective,
    WindowMinimizeActionDirective,
    WindowMaximizeActionDirective,
    WindowRestoreActionDirective
];
const ENTRY_COMPONENTS = [
    WindowComponent,
    WindowTitleBarComponent
];
const exportedModules = [
    WindowComponent,
    WindowCloseActionDirective,
    WindowMinimizeActionDirective,
    WindowMaximizeActionDirective,
    WindowRestoreActionDirective,
    WindowTitleBarComponent
];
/**
 * Represents the [NgModule]({{ site.data.urls.angular['ngmoduleapi'] }})
 * definition for the Window component. Imports `WindowModule` into the
 * [root module]({{ site.data.urls.angular['ngmodules'] }}#angular-modularity)
 * of your application or into any other sub-module that will use the Window component.
 *
 * @example
 * ```ts-no-run
 * import { NgModule } from '@angular/core';
 * import { BrowserModule } from '@angular/platform-browser';
 * import { WindowModule } from '@progress/kendo-angular-window';
 * import { AppComponent } from './app.component';
 *
 * _@NgModule({
 *     bootstrap:    [AppComponent],
 *     declarations: [AppComponent],
 *     imports:      [BrowserModule, WindowModule]
 * })
 * export class AppModule {
 * }
 * ```
 */
let WindowModule = class WindowModule {
};
WindowModule.ɵfac = function WindowModule_Factory(t) { return new (t || WindowModule)(); };
WindowModule.ɵmod = /*@__PURE__*/ ɵngcc0.ɵɵdefineNgModule({ type: WindowModule });
WindowModule.ɵinj = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjector({ providers: [WindowContainerService, WindowService], imports: [[SharedModule, DraggableModule]] });

/**
 * Represents the [NgModule]({{ site.data.urls.angular['ngmoduleapi'] }})
 * definition for the Dialogs components.
 *
 * @example
 *
 * ```ts-no-run
 * import { DialogsModule } from '@progress/kendo-angular-dialog';
 *
 * import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';
 * import { NgModule } from '@angular/core';
 *
 * import { AppComponent } from './app.component';
 *
 * _@NgModule({
 *     declarations: [AppComponent],
 *     imports:      [BrowserModule, DialogsModule],
 *     bootstrap:    [AppComponent]
 * })
 * export class AppModule {}
 *
 * platformBrowserDynamic().bootstrapModule(AppModule);
 *
 * ```
 */
let DialogsModule = class DialogsModule {
};
DialogsModule.ɵfac = function DialogsModule_Factory(t) { return new (t || DialogsModule)(); };
DialogsModule.ɵmod = /*@__PURE__*/ ɵngcc0.ɵɵdefineNgModule({ type: DialogsModule });
DialogsModule.ɵinj = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjector({ imports: [DialogModule, WindowModule] });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DialogActionsComponent, [{
        type: Component,
        args: [{
                selector: 'kendo-dialog-actions',
                template: `
        <ng-content *ngIf="!actions"></ng-content>
        <ng-container *ngIf="!actionTemplate()">
            <button
                type="button"
                [ngClass]="buttonClass(action)"
                (click)="onButtonClick(action, $event)"
                *ngFor="let action of actions"
                [attr.aria-label]="action.text"
            >
                {{ action.text }}
            </button>
        </ng-container>
        <ng-template [ngTemplateOutlet]="actions" *ngIf="actionTemplate()"></ng-template>
    `
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }]; }, { layout: [{
            type: Input
        }], action: [{
            type: Output
        }], buttonGroupClassName: [{
            type: HostBinding,
            args: ['class.k-dialog-buttongroup']
        }, {
            type: HostBinding,
            args: ['class.k-actions']
        }], className: [{
            type: HostBinding,
            args: ['class.k-actions-stretched']
        }], actions: [{
            type: Input
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DialogTitleBarComponent, [{
        type: Component,
        args: [{
                selector: 'kendo-dialog-titlebar',
                providers: [
                    TitleBarLocalizationService,
                    {
                        provide: LocalizationService,
                        useExisting: TitleBarLocalizationService
                    },
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.dialog'
                    }
                ],
                template: `
         <ng-container
            kendoDialogTitleBarLocalizedMessages
            i18n-closeTitle="kendo.dialog.closeTitle|The title of the close button"
            closeTitle="Close"
        >
            <div class="k-window-title k-dialog-title">
                <ng-content></ng-content>
            </div>

            <div class="k-window-actions k-dialog-actions">
                <button
                    role="button"
                    [attr.title]="closeButtonTitle"
                    [attr.aria-label]="closeButtonTitle"
                    class="k-button k-button-md k-rounded-md k-button-flat k-button-flat-base k-icon-button k-window-action k-dialog-action k-dialog-close"
                    (click)="onCloseClick($event)"
                >
                    <span class="k-button-icon k-icon k-i-x"></span>
                </button>
            </div>
        </ng-container>
    `
            }]
    }], function () { return [{ type: ɵngcc0.NgZone }, { type: ɵngcc0.ElementRef }, { type: ɵngcc2.LocalizationService, decorators: [{
                type: Optional
            }] }]; }, { close: [{
            type: Output
        }], className: [{
            type: HostBinding,
            args: ['class.k-window-titlebar']
        }, {
            type: HostBinding,
            args: ['class.k-dialog-titlebar']
        }], id: [{
            type: Input
        }], closeTitle: [{
            type: Input
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DialogComponent, [{
        type: Component,
        args: [{
                animations: [
                    trigger('overlayAppear', [
                        state('in', style({ opacity: 1 })),
                        transition('void => *', [style({ opacity: 0.1 }), animate('.3s cubic-bezier(.2, .6, .4, 1)')])
                    ]),
                    trigger('dialogSlideInAppear', [
                        state('in', style({ transform: 'translate(0, 0)' })),
                        transition('void => *', [style({ transform: 'translate(0, -10%)' }), animate('.3s cubic-bezier(.2, 1, .2, 1)')])
                    ])
                ],
                exportAs: 'kendoDialog',
                providers: [
                    LocalizationService,
                    {
                        provide: DIALOG_LOCALIZATION_SERVICE,
                        useExisting: LocalizationService
                    },
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.dialog'
                    }
                ],
                selector: 'kendo-dialog',
                template: `
        <ng-container
            kendoDialogLocalizedMessages
            i18n-closeTitle="kendo.dialog.closeTitle|The title of the close button"
            closeTitle="Close"
        >
        <div class="k-overlay" @overlayAppear></div>

        <div class="k-window k-dialog" role="dialog" aria-modal="true" [ngStyle]="styles" @dialogSlideInAppear>
            <kendo-dialog-titlebar *ngIf="title" [closeTitle]="closeTitle" [id]="titleId">{{ title }}</kendo-dialog-titlebar>
            <ng-content select="kendo-dialog-titlebar" *ngIf="!title"></ng-content>

            <div [id]="contentId" class="k-content k-window-content k-dialog-content">
                <ng-content *ngIf="!contentTemplate"></ng-content>
                <ng-template [ngTemplateOutlet]="contentTemplate" *ngIf="contentTemplate"></ng-template>
            </div>

            <ng-content select="kendo-dialog-actions" *ngIf="!actions"></ng-content>
            <kendo-dialog-actions *ngIf="actions" [actions]="actions" [layout]="actionsLayout"> </kendo-dialog-actions>
        </div>
    </ng-container>
    `
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: ɵngcc2.LocalizationService }, { type: ɵngcc0.ChangeDetectorRef }, { type: ɵngcc0.NgZone }]; }, { actionsLayout: [{
            type: Input
        }], action: [{
            type: Output
        }], close: [{
            type: Output
        }], tabIndex: [{
            type: HostBinding,
            args: ['attr.tabIndex']
        }], dir: [{
            type: HostBinding,
            args: ['attr.dir']
        }], wrapperClass: [{
            type: HostBinding,
            args: ['class.k-dialog-wrapper']
        }], actions: [{
            type: Input
        }], autoFocusedElement: [{
            type: Input
        }], title: [{
            type: Input
        }], width: [{
            type: Input
        }], minWidth: [{
            type: Input
        }], maxWidth: [{
            type: Input
        }], height: [{
            type: Input
        }], minHeight: [{
            type: Input
        }], maxHeight: [{
            type: Input
        }], titlebarContent: [{
            type: ContentChildren,
            args: [DialogTitleBarComponent, { descendants: false }]
        }], titlebarView: [{
            type: ViewChildren,
            args: [DialogTitleBarComponent]
        }], actionsView: [{
            type: ViewChild,
            args: [DialogActionsComponent, { static: false }]
        }] }); })();

(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DialogContainerService, [{
        type: Injectable
    }], null, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DialogService, [{
        type: Injectable
    }], function () { return [{ type: ɵngcc0.ComponentFactoryResolver }, { type: DialogContainerService, decorators: [{
                type: Inject,
                args: [DialogContainerService]
            }] }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DragResizeService, [{
        type: Injectable
    }], function () { return [{ type: ɵngcc0.NgZone }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ResizeHandleDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoWindowResizeHandle]'
            }]
    }], function () { return [{ type: ɵngcc3.DraggableDirective, decorators: [{
                type: Host
            }] }, { type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: DragResizeService }]; }, { hostClass: [{
            type: HostBinding,
            args: ['class.k-resize-handle']
        }], direction: [{
            type: Input
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(WindowTitleBarComponent, [{
        type: Component,
        args: [{
                selector: 'kendo-window-titlebar',
                template: `
    <ng-content *ngIf="!template"></ng-content>
    <ng-template
      [ngTemplateOutlet]="template"
      [ngTemplateOutletContext]="{'$implicit': service}" *ngIf="template">
    </ng-template>
  `
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: DragResizeService }, { type: ɵngcc0.NgZone }]; }, { className: [{
            type: HostBinding,
            args: ['class.k-window-titlebar']
        }, {
            type: HostBinding,
            args: ['class.k-dialog-titlebar']
        }], touchAction: [{
            type: HostBinding,
            args: ['style.touch-action']
        }], 
    /**
     * @hidden
     */
    handle: [{
            type: HostListener,
            args: ['dblclick', ['$event']]
        }], template: [{
            type: Input
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(NavigationService, [{
        type: Injectable
    }], function () { return [{ type: DragResizeService }, { type: ɵngcc0.NgZone }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(WindowComponent, [{
        type: Component,
        args: [{
                exportAs: 'kendoWindow',
                providers: [
                    DragResizeService,
                    NavigationService,
                    LocalizationService,
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.window'
                    }
                ],
                selector: 'kendo-window',
                template: `
        <ng-container kendoWindowLocalizedMessages
            i18n-closeTitle="kendo.window.closeTitle|The title of the close button"
            closeTitle="Close"

            i18n-restoreTitle="kendo.window.restoreTitle|The title of the restore button"
            restoreTitle="Restore"

            i18n-maximizeTitle="kendo.window.maximizeTitle|The title of the maximize button"
            maximizeTitle="Maximize"

            i18n-minimizeTitle="kendo.window.minimizeTitle|The title of the minimize button"
            minimizeTitle="Minimize"
        >
        <ng-container>

        <kendo-window-titlebar *ngIf="showDefaultTitleBar" [template]="titleBarTemplate">
            <div class="k-window-title">{{ title }}</div>
            <div class="k-window-actions">
                <button kendoWindowMinimizeAction  [attr.title]="minimizeButtonTitle" [attr.aria-label]="minimizeButtonTitle"></button>
                <button kendoWindowMaximizeAction [attr.title]="maximizeButtonTitle" [attr.aria-label]="maximizeButtonTitle"></button>
                <button kendoWindowRestoreAction [attr.title]="restoreButtonTitle" [attr.aria-label]="restoreButtonTitle"></button>
                <button kendoWindowCloseAction [attr.title]="closeButtonTitle" [attr.aria-label]="closeButtonTitle"></button>
            </div>
        </kendo-window-titlebar>
        <ng-content select="kendo-window-titlebar" *ngIf="!showDefaultTitleBar"></ng-content>

        <div *ngIf="state !== 'minimized' || keepContent"
            [hidden]="state === 'minimized' && keepContent"
            class="k-content k-window-content"
        >
            <ng-content *ngIf="!contentTemplate"></ng-content>
            <ng-template [ngTemplateOutlet]="contentTemplate" *ngIf="contentTemplate"></ng-template>
        </div>

        <ng-template [ngIf]='resizable'>
            <div *ngFor='let dir of resizeDirections'
                [direction]="dir"
                kendoWindowResizeHandle
                kendoDraggable>
            </div>
        </ng-template>
    `
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: DragResizeService }, { type: NavigationService }, { type: ɵngcc0.NgZone }, { type: ɵngcc2.LocalizationService }]; }, { keepContent: [{
            type: Input
        }], dragStart: [{
            type: Output
        }], dragEnd: [{
            type: Output
        }], resizeStart: [{
            type: Output
        }], resizeEnd: [{
            type: Output
        }], close: [{
            type: Output
        }], widthChange: [{
            type: Output
        }], heightChange: [{
            type: Output
        }], topChange: [{
            type: Output
        }], leftChange: [{
            type: Output
        }], stateChange: [{
            type: Output
        }], tabIndex: [{
            type: HostBinding,
            args: ['attr.tabIndex']
        }], draggable: [{
            type: Input
        }], resizable: [{
            type: Input
        }], state: [{
            type: Input
        }], minWidth: [{
            type: Input
        }], minHeight: [{
            type: Input
        }], width: [{
            type: Input
        }], height: [{
            type: Input
        }], top: [{
            type: Input
        }], left: [{
            type: Input
        }], hostClasses: [{
            type: HostBinding,
            args: ['class.k-window']
        }], dir: [{
            type: HostBinding,
            args: ['attr.dir']
        }], styleMinWidth: [{
            type: HostBinding,
            args: ['style.minWidth']
        }], styleMinHeight: [{
            type: HostBinding,
            args: ['style.minHeight']
        }], stylePosition: [{
            type: HostBinding,
            args: ['style.position']
        }], wrapperMaximizedClass: [{
            type: HostBinding,
            args: ['class.k-window-maximized']
        }], wrapperMinimizedClass: [{
            type: HostBinding,
            args: ['class.k-window-minimized']
        }], 
    /**
     * @hidden
     */
    onComponentFocus: [{
            type: HostListener,
            args: ['focus']
        }], 
    /**
     * @hidden
     */
    onComponentBlur: [{
            type: HostListener,
            args: ['blur']
        }], autoFocusedElement: [{
            type: Input
        }], title: [{
            type: Input
        }], titleBarView: [{
            type: ViewChild,
            args: [WindowTitleBarComponent, { static: false }]
        }], titleBarContent: [{
            type: ContentChild,
            args: [WindowTitleBarComponent, { static: false }]
        }], resizeHandles: [{
            type: ViewChildren,
            args: [ResizeHandleDirective]
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(WindowMaximizeActionDirective, [{
        type: Directive,
        args: [{
                exportAs: 'kendoWindowMaximizeAction',
                providers: [
                    LocalizationService,
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.button'
                    }
                ],
                selector: 'button[kendoWindowMaximizeAction]' // tslint:disable-line
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: DragResizeService, decorators: [{
                type: Optional
            }] }, { type: ɵngcc2.LocalizationService }, { type: ɵngcc0.NgZone }]; }, { buttonType: [{
            type: HostBinding,
            args: ['attr.type']
        }], window: [{
            type: Input
        }], 
    /**
     * @hidden
     */
    onClick: [{
            type: HostListener,
            args: ['click']
        }], visible: [{
            type: HostBinding,
            args: ['style.display']
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(WindowMinimizeActionDirective, [{
        type: Directive,
        args: [{
                exportAs: 'kendoWindowMinimizeAction',
                providers: [
                    LocalizationService,
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.button'
                    }
                ],
                selector: 'button[kendoWindowMinimizeAction]' // tslint:disable-line
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: DragResizeService, decorators: [{
                type: Optional
            }] }, { type: ɵngcc2.LocalizationService }, { type: ɵngcc0.NgZone }]; }, { buttonType: [{
            type: HostBinding,
            args: ['attr.type']
        }], window: [{
            type: Input
        }], 
    /**
     * @hidden
     */
    onClick: [{
            type: HostListener,
            args: ['click']
        }], visible: [{
            type: HostBinding,
            args: ['style.display']
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(WindowCloseActionDirective, [{
        type: Directive,
        args: [{
                exportAs: 'kendoWindowCloseAction',
                providers: [
                    LocalizationService,
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.button'
                    }
                ],
                selector: 'button[kendoWindowCloseAction]' // tslint:disable-line
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: DragResizeService, decorators: [{
                type: Optional
            }] }, { type: ɵngcc2.LocalizationService }, { type: ɵngcc0.NgZone }]; }, { buttonType: [{
            type: HostBinding,
            args: ['attr.type']
        }], window: [{
            type: Input
        }], 
    /**
     * @hidden
     */
    onClick: [{
            type: HostListener,
            args: ['click']
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(WindowRestoreActionDirective, [{
        type: Directive,
        args: [{
                exportAs: 'kendoWindowRestoreAction',
                providers: [
                    LocalizationService,
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.button'
                    }
                ],
                selector: 'button[kendoWindowRestoreAction]' // tslint:disable-line
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: DragResizeService, decorators: [{
                type: Optional
            }] }, { type: ɵngcc2.LocalizationService }, { type: ɵngcc0.NgZone }]; }, { buttonType: [{
            type: HostBinding,
            args: ['attr.type']
        }], window: [{
            type: Input
        }], 
    /**
     * @hidden
     */
    onClick: [{
            type: HostListener,
            args: ['click']
        }], visible: [{
            type: HostBinding,
            args: ['style.display']
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(WindowContainerService, [{
        type: Injectable
    }], null, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(WindowService, [{
        type: Injectable
    }], function () { return [{ type: ɵngcc0.ComponentFactoryResolver }, { type: WindowContainerService, decorators: [{
                type: Inject,
                args: [WindowContainerService]
            }] }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DialogContainerDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoDialogContainer]'
            }]
    }], function () { return [{ type: ɵngcc0.ViewContainerRef }, { type: DialogContainerService }]; }, null); })();

(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(LocalizedMessagesDirective, [{
        type: Directive,
        args: [{
                providers: [
                    {
                        provide: Messages,
                        useExisting: forwardRef(() => LocalizedMessagesDirective_1)
                    }
                ],
                selector: `
    [kendoDialogLocalizedMessages],
    [kendoWindowLocalizedMessages],
    [kendoDialogTitleBarLocalizedMessages]
  `
            }]
    }], function () { return [{ type: ɵngcc2.LocalizationService }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(CustomMessagesComponent, [{
        type: Component,
        args: [{
                providers: [
                    {
                        provide: Messages,
                        useExisting: forwardRef(() => CustomMessagesComponent_1) // tslint:disable-line:no-forward-ref
                    }
                ],
                selector: 'kendo-dialog-messages, kendo-window-messages',
                template: ``
            }]
    }], function () { return [{ type: ɵngcc2.LocalizationService }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(SharedModule, [{
        type: NgModule,
        args: [{
                declarations: [SHARED_DIRECTIVES],
                exports: [SHARED_DIRECTIVES, CommonModule],
                imports: [CommonModule]
            }]
    }], null, null); })();
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(SharedModule, { declarations: function () { return [DialogActionsComponent, CustomMessagesComponent, LocalizedMessagesDirective]; }, imports: function () { return [CommonModule]; }, exports: function () { return [DialogActionsComponent, CustomMessagesComponent, LocalizedMessagesDirective, CommonModule]; } }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DialogModule, [{
        type: NgModule,
        args: [{
                declarations: [DIALOG_DIRECTIVES, DialogContainerDirective],
                entryComponents: [DIALOG_DIRECTIVES],
                exports: [DIALOG_DIRECTIVES, SHARED_DIRECTIVES, DialogContainerDirective],
                imports: [SharedModule],
                providers: [DialogContainerService, DialogService]
            }]
    }], null, null); })();
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(DialogModule, { declarations: [DialogComponent, DialogTitleBarComponent, DialogContainerDirective], imports: [SharedModule], exports: [DialogComponent, DialogTitleBarComponent, DialogActionsComponent, CustomMessagesComponent, LocalizedMessagesDirective, DialogContainerDirective] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(WindowContainerDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoWindowContainer]'
            }]
    }], function () { return [{ type: ɵngcc0.ViewContainerRef }, { type: WindowContainerService }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(WindowModule, [{
        type: NgModule,
        args: [{
                declarations: [WINDOW_DIRECTIVES, WindowContainerDirective],
                entryComponents: [ENTRY_COMPONENTS],
                exports: [exportedModules, SHARED_DIRECTIVES, WindowContainerDirective],
                imports: [SharedModule, DraggableModule],
                providers: [WindowContainerService, WindowService]
            }]
    }], null, null); })();
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(WindowModule, { declarations: function () { return [ResizeHandleDirective, WindowComponent, WindowTitleBarComponent, WindowCloseActionDirective, WindowMinimizeActionDirective, WindowMaximizeActionDirective, WindowRestoreActionDirective, WindowContainerDirective]; }, imports: function () { return [SharedModule, DraggableModule]; }, exports: function () { return [WindowComponent, WindowCloseActionDirective, WindowMinimizeActionDirective, WindowMaximizeActionDirective, WindowRestoreActionDirective, WindowTitleBarComponent, DialogActionsComponent, CustomMessagesComponent, LocalizedMessagesDirective, WindowContainerDirective]; } }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DialogsModule, [{
        type: NgModule,
        args: [{
                exports: [DialogModule, WindowModule]
            }]
    }], null, null); })();
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(DialogsModule, { exports: [DialogModule, WindowModule] }); })();


/**
 * Generated bundle index. Do not edit.
 */

export { DIALOG_DIRECTIVES, DialogContainerDirective, DialogContainerService, CustomMessagesComponent, DIALOG_LOCALIZATION_SERVICE, LocalizedMessagesDirective, Messages, TitleBarLocalizationService, SHARED_DIRECTIVES, SharedModule, DragResizeService, NavigationService, WindowContainerDirective, WindowContainerService, ResizeHandleDirective, DialogComponent, DialogTitleBarComponent, DialogContentBase, DialogActionsComponent, DialogService, DialogCloseResult, DialogRef, DialogSettings, DialogAction, WindowComponent, WindowTitleBarComponent, WindowMaximizeActionDirective, WindowMinimizeActionDirective, WindowCloseActionDirective, WindowRestoreActionDirective, WindowSettings, WindowRef, WindowCloseResult, WindowService, DialogModule, WindowModule, DialogsModule };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7O2lIQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FtQkc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7MkxBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OzsrRkFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQXNDRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7ZUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFnREc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O1dBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OzRLQUFFO0FBQ0Ysd0NBRzJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O2lKQUFFO0FBQ0YsNEJBRUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7NkpBQUU7QUFDRixnQ0FFRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7K0NBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FJRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7O2lGQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBV0c7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs2SkFBRTtBQUNGLGdDQUVHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7d1ZBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQXlERztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7OztrREFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNENBWUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7a0RBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQVlHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7a0RBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBWUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7a0RBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQVlHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7NEtBQUU7QUFDRix3Q0FHMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztpSkFBRTtBQUNGLDRCQUVHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OzBKQUFFO0FBQ0YsdUNBSUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs4UEFBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztrREFBRTtBQUNGLHdFQWNHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7eUpBQUU7QUFDRixrRUFXRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O3VHQU9pQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7NklBU2lCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzswSkFBRTtBQUNGLHVDQUlHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OEpBU2lCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFLa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlc0NvbnRlbnQiOlsiLyoqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiogQ29weXJpZ2h0IMKpIDIwMjEgUHJvZ3Jlc3MgU29mdHdhcmUgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4qIExpY2Vuc2VkIHVuZGVyIGNvbW1lcmNpYWwgbGljZW5zZS4gU2VlIExJQ0VOU0UubWQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbW9yZSBpbmZvcm1hdGlvblxuKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuaW1wb3J0IHsgX19kZWNvcmF0ZSwgX19tZXRhZGF0YSwgX19wYXJhbSB9IGZyb20gJ3RzbGliJztcbmltcG9ydCB7IEV2ZW50RW1pdHRlciwgVGVtcGxhdGVSZWYsIElucHV0LCBPdXRwdXQsIEhvc3RCaW5kaW5nLCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIEluamVjdGlvblRva2VuLCBJbmplY3QsIE9wdGlvbmFsLCBOZ1pvbmUsIENvbnRlbnRDaGlsZHJlbiwgUXVlcnlMaXN0LCBWaWV3Q2hpbGRyZW4sIFZpZXdDaGlsZCwgUmVuZGVyZXIyLCBDaGFuZ2VEZXRlY3RvclJlZiwgSW5qZWN0YWJsZSwgaXNEZXZNb2RlLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIERpcmVjdGl2ZSwgSG9zdCwgSG9zdExpc3RlbmVyLCBDb250ZW50Q2hpbGQsIFZpZXdDb250YWluZXJSZWYsIGZvcndhcmRSZWYsIE5nTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyB0cmlnZ2VyLCBzdGF0ZSwgc3R5bGUsIHRyYW5zaXRpb24sIGFuaW1hdGUgfSBmcm9tICdAYW5ndWxhci9hbmltYXRpb25zJztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiwgU3ViamVjdCwgbWVyZ2UsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyB0YWtlLCBmaWx0ZXIsIG1hcCwgc2hhcmUsIHRhcCwgc3dpdGNoTWFwLCB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBMb2NhbGl6YXRpb25TZXJ2aWNlLCBMMTBOX1BSRUZJWCwgUlRMLCBNZXNzYWdlU2VydmljZSwgQ29tcG9uZW50TWVzc2FnZXMgfSBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tYW5ndWxhci1sMTBuJztcbmltcG9ydCB7IHZhbGlkYXRlUGFja2FnZSB9IGZyb20gJ0Bwcm9ncmVzcy9rZW5kby1saWNlbnNpbmcnO1xuaW1wb3J0IHsgRHJhZ2dhYmxlRGlyZWN0aXZlLCBpc0NoYW5nZWQsIGlzRG9jdW1lbnRBdmFpbGFibGUsIERyYWdnYWJsZU1vZHVsZSB9IGZyb20gJ0Bwcm9ncmVzcy9rZW5kby1hbmd1bGFyLWNvbW1vbic7XG5pbXBvcnQgeyBvZmZzZXQsIHNjcm9sbFBvc2l0aW9uLCBwb3NpdGlvbldpdGhTY3JvbGwsIGdldERvY3VtZW50RWxlbWVudCwgZ2V0V2luZG93Vmlld1BvcnQgfSBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tcG9wdXAtY29tbW9uJztcbmltcG9ydCB7IEJ1dHRvbiB9IGZyb20gJ0Bwcm9ncmVzcy9rZW5kby1hbmd1bGFyLWJ1dHRvbnMnO1xuaW1wb3J0IHsgQ29tbW9uTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcblxuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IGlzUHJlc2VudCA9ICh2YWx1ZSkgPT4gdmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09IHVuZGVmaW5lZDtcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBpc1RydXRoeSA9ICh2YWx1ZSkgPT4gISF2YWx1ZTtcbmNvbnN0IHRvQ2xhc3NMaXN0ID0gKGNsYXNzTmFtZXMpID0+IFN0cmluZyhjbGFzc05hbWVzKS50cmltKCkuc3BsaXQoJyAnKTtcbmNvbnN0IGZvY3VzYWJsZVJlZ2V4ID0gL14oPzphfGlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b258b2JqZWN0KSQvaTtcbi8qKlxuICogQGhpZGRlblxuICovXG52YXIgS2V5cztcbihmdW5jdGlvbiAoS2V5cykge1xuICAgIEtleXNbS2V5c1tcImVzY1wiXSA9IDI3XSA9IFwiZXNjXCI7XG4gICAgS2V5c1tLZXlzW1widGFiXCJdID0gOV0gPSBcInRhYlwiO1xuICAgIEtleXNbS2V5c1tcImVudGVyXCJdID0gMTNdID0gXCJlbnRlclwiO1xuICAgIEtleXNbS2V5c1tcInNwYWNlXCJdID0gMzJdID0gXCJzcGFjZVwiO1xuICAgIEtleXNbS2V5c1tcImN0cmxcIl0gPSAxN10gPSBcImN0cmxcIjtcbiAgICBLZXlzW0tleXNbXCJzaGlmdFwiXSA9IDE2XSA9IFwic2hpZnRcIjtcbiAgICBLZXlzW0tleXNbXCJsZWZ0XCJdID0gMzddID0gXCJsZWZ0XCI7XG4gICAgS2V5c1tLZXlzW1widXBcIl0gPSAzOF0gPSBcInVwXCI7XG4gICAgS2V5c1tLZXlzW1wicmlnaHRcIl0gPSAzOV0gPSBcInJpZ2h0XCI7XG4gICAgS2V5c1tLZXlzW1wiZG93blwiXSA9IDQwXSA9IFwiZG93blwiO1xufSkoS2V5cyB8fCAoS2V5cyA9IHt9KSk7XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgRElBTE9HX0VMRU1FTlRTX0hBTkRMSU5HX0VTQ19LRVkgPSAnay1kaWFsb2ctd3JhcHBlciBrLWRpYWxvZy1idXR0b25ncm91cCBrLWRpYWxvZy1hY3Rpb24nO1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IERJQUxPR19FTEVNRU5UU19IQU5ETElOR19BUlJPV1MgPSAnay1kaWFsb2ctYnV0dG9uZ3JvdXAnO1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IFdJTkRPV19DTEFTU0VTID0gJ2std2luZG93Jztcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBoYXNDbGFzc2VzID0gKGVsZW1lbnQsIGNsYXNzTmFtZXMpID0+IHtcbiAgICBjb25zdCBuYW1lc0xpc3QgPSB0b0NsYXNzTGlzdChjbGFzc05hbWVzKTtcbiAgICByZXR1cm4gQm9vbGVhbih0b0NsYXNzTGlzdChlbGVtZW50LmNsYXNzTmFtZSkuZmluZCgoY2xhc3NOYW1lKSA9PiBuYW1lc0xpc3QuaW5kZXhPZihjbGFzc05hbWUpID49IDApKTtcbn07XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgaXNWaXNpYmxlID0gKGVsZW1lbnQpID0+IHtcbiAgICBjb25zdCByZWN0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICByZXR1cm4gISEocmVjdC53aWR0aCAmJiByZWN0LmhlaWdodCkgJiYgd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWxlbWVudCkudmlzaWJpbGl0eSAhPT0gJ2hpZGRlbic7XG59O1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IGlzRm9jdXNhYmxlID0gKGVsZW1lbnQsIGNoZWNrVmlzaWJpbGl0eSA9IHRydWUpID0+IHtcbiAgICBpZiAoZWxlbWVudC50YWdOYW1lKSB7XG4gICAgICAgIGNvbnN0IHRhZ05hbWUgPSBlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgY29uc3QgdGFiSW5kZXggPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgndGFiSW5kZXgnKTtcbiAgICAgICAgY29uc3QgdmFsaWRUYWJJbmRleCA9IHRhYkluZGV4ICE9PSBudWxsICYmICFpc05hTih0YWJJbmRleCkgJiYgdGFiSW5kZXggPiAtMTtcbiAgICAgICAgbGV0IGZvY3VzYWJsZSA9IGZhbHNlO1xuICAgICAgICBpZiAoZm9jdXNhYmxlUmVnZXgudGVzdCh0YWdOYW1lKSkge1xuICAgICAgICAgICAgZm9jdXNhYmxlID0gIWVsZW1lbnQuZGlzYWJsZWQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBmb2N1c2FibGUgPSB2YWxpZFRhYkluZGV4O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmb2N1c2FibGUgJiYgKCFjaGVja1Zpc2liaWxpdHkgfHwgaXNWaXNpYmxlKGVsZW1lbnQpKTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufTtcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBzZXRIVE1MQXR0cmlidXRlcyA9IChhdHRyaWJ1dGVzLCByZW5kZXJlciwgZWxlbWVudCkgPT4ge1xuICAgIGZvciAoY29uc3QgYXR0cmlidXRlIGluIGF0dHJpYnV0ZXMpIHtcbiAgICAgICAgaWYgKGF0dHJpYnV0ZSkge1xuICAgICAgICAgICAgcmVuZGVyZXIuc2V0QXR0cmlidXRlKGVsZW1lbnQsIGF0dHJpYnV0ZSwgYXR0cmlidXRlc1thdHRyaWJ1dGVdKTtcbiAgICAgICAgfVxuICAgIH1cbn07XG4vKipcbiAqIFJlY2VpdmVzIENTUyBjbGFzcyBkZWNsYXJhdGlvbnMgZWl0aGVyIGFzIGFuIG9iamVjdCwgc3RyaW5nIG9yIGFycmF5IGFuZCByZXR1cm5zIGFuIGFycmF5IG9mIHRoZSBjbGFzcyBuYW1lcy5cbiAqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IHBhcnNlQ1NTQ2xhc3NOYW1lcyA9ICh2YWx1ZSkgPT4ge1xuICAgIGlmIChpc09iamVjdCh2YWx1ZSkpIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlT2JqZWN0Q2xhc3NOYW1lcyh2YWx1ZSk7XG4gICAgfVxuICAgIGlmIChpc1N0cmluZyh2YWx1ZSkpIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlU3RyaW5nQ2xhc3NOYW1lcyh2YWx1ZSk7XG4gICAgfVxuICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICByZXR1cm4gcGFyc2VBcnJheUNsYXNzTmFtZXModmFsdWUpO1xuICAgIH1cbn07XG5jb25zdCBwYXJzZU9iamVjdENsYXNzTmFtZXMgPSAodmFsdWUpID0+IHtcbiAgICBjb25zdCBjbGFzc2VzID0gW107XG4gICAgT2JqZWN0LmtleXModmFsdWUpLmZvckVhY2goY2xhc3NOYW1lID0+IHtcbiAgICAgICAgY29uc3QgY3VycmVudENsYXNzTmFtZSA9IHNwbGl0U3RyaW5nVG9BcnJheShjbGFzc05hbWUpO1xuICAgICAgICBpZiAodmFsdWVbY2xhc3NOYW1lXSAmJiBjdXJyZW50Q2xhc3NOYW1lWzBdKSB7XG4gICAgICAgICAgICBjbGFzc2VzLnB1c2goLi4uY3VycmVudENsYXNzTmFtZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gY2xhc3Nlcztcbn07XG5jb25zdCBwYXJzZVN0cmluZ0NsYXNzTmFtZXMgPSAodmFsdWUpID0+IHtcbiAgICBjb25zdCBjbGFzc2VzID0gW107XG4gICAgY29uc3QgY2xhc3Nlc0FycmF5ID0gc3BsaXRTdHJpbmdUb0FycmF5KHZhbHVlKTtcbiAgICBjbGFzc2VzQXJyYXkuZm9yRWFjaChjbGFzc05hbWUgPT4ge1xuICAgICAgICBjbGFzc2VzLnB1c2goY2xhc3NOYW1lKTtcbiAgICB9KTtcbiAgICByZXR1cm4gY2xhc3Nlcztcbn07XG5jb25zdCBwYXJzZUFycmF5Q2xhc3NOYW1lcyA9ICh2YWx1ZSkgPT4ge1xuICAgIGNvbnN0IGNsYXNzZXMgPSBbXTtcbiAgICB2YWx1ZS5mb3JFYWNoKChjbGFzc05hbWUpID0+IHtcbiAgICAgICAgY29uc3QgY3VycmVudCA9IHNwbGl0U3RyaW5nVG9BcnJheShjbGFzc05hbWUpO1xuICAgICAgICBpZiAoY3VycmVudFswXSkge1xuICAgICAgICAgICAgY2xhc3Nlcy5wdXNoKC4uLmN1cnJlbnQpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGNsYXNzZXM7XG59O1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IGZvY3VzYWJsZVNlbGVjdG9yID0gW1xuICAgICdhW2hyZWZdJyxcbiAgICAnYXJlYVtocmVmXScsXG4gICAgJ2lucHV0Om5vdChbZGlzYWJsZWRdKScsXG4gICAgJ3NlbGVjdDpub3QoW2Rpc2FibGVkXSknLFxuICAgICd0ZXh0YXJlYTpub3QoW2Rpc2FibGVkXSknLFxuICAgICdidXR0b246bm90KFtkaXNhYmxlZF0pJyxcbiAgICAnaWZyYW1lJyxcbiAgICAnb2JqZWN0JyxcbiAgICAnZW1iZWQnLFxuICAgICcqW3RhYmluZGV4XScsXG4gICAgJypbY29udGVudGVkaXRhYmxlXSdcbl0uam9pbignLCcpO1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IHByZXZlbnREZWZhdWx0ID0gKHsgb3JpZ2luYWxFdmVudDogZXZlbnQgfSkgPT4ge1xuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG59O1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IFJFU0laRV9ESVJFQ1RJT05TID0gWyduJywgJ2UnLCAncycsICd3JywgJ3NlJywgJ3N3JywgJ25lJywgJ253J107XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgT0ZGU0VUX1NUWUxFUyA9IFsndG9wJywgJ2xlZnQnLCAnd2lkdGgnLCAnaGVpZ2h0J107XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgaXNTdHJpbmcgPSAodmFsdWUpID0+IHZhbHVlIGluc3RhbmNlb2YgU3RyaW5nIHx8IHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZyc7XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgaXNPYmplY3QgPSAodmFsdWUpID0+IGlzUHJlc2VudCh2YWx1ZSkgJiYgIUFycmF5LmlzQXJyYXkodmFsdWUpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCc7XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgaXNOdW1iZXIgPSAodmFsdWUpID0+IHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgJiYgaXNGaW5pdGUodmFsdWUpO1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IGNyZWF0ZVZhbHVlV2l0aFVuaXQgPSAodmFsdWUpID0+IHZhbHVlICsgKGlzTnVtYmVyKHZhbHVlKSA/ICdweCcgOiAnJyk7XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3Qgc3BsaXRTdHJpbmdUb0FycmF5ID0gKHZhbHVlKSA9PiB2YWx1ZS50cmltKCkucmVwbGFjZSgvXFxzKy9nLCBcIiBcIikuc3BsaXQoJyAnKTtcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBmaW5kUHJpbWFyeUJ1dHRvbiA9IChidXR0b25zKSA9PiB7XG4gICAgZm9yIChsZXQgaSA9IGJ1dHRvbnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgY29uc3QgY2xhc3NMaXN0ID0gYnV0dG9uc1tpXS5jbGFzc0xpc3Q7XG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgY2xhc3NMaXN0Lmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBpZiAoY2xhc3NMaXN0W2pdLmVuZHNXaXRoKCctcHJpbWFyeScpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGJ1dHRvbnNbaV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG4vKipcbiAqIFNwZWNpZmllcyB0aGUgYWN0aW9uIGJ1dHRvbnMgb2YgdGhlIERpYWxvZ1xuICogKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBhY3Rpb25idXR0b25zX2RpYWxvZyAlfSkpLlxuICovXG5sZXQgRGlhbG9nQWN0aW9uc0NvbXBvbmVudCA9IGNsYXNzIERpYWxvZ0FjdGlvbnNDb21wb25lbnQge1xuICAgIGNvbnN0cnVjdG9yKGVsKSB7XG4gICAgICAgIHRoaXMuZWwgPSBlbDtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNwZWNpZmllcyB0aGUgcG9zc2libGUgbGF5b3V0IG9mIHRoZSBhY3Rpb24gYnV0dG9ucy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubGF5b3V0ID0gJ3N0cmV0Y2hlZCc7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyB3aGVuIHRoZSB1c2VyIGNsaWNrcyBhbiBhY3Rpb24gYnV0dG9uLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5hY3Rpb24gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMuYnV0dG9uR3JvdXBDbGFzc05hbWUgPSB0cnVlO1xuICAgIH1cbiAgICBnZXQgY2xhc3NOYW1lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5sYXlvdXQgPT09ICdzdHJldGNoZWQnO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgYWN0aW9uVGVtcGxhdGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFjdGlvbnMgaW5zdGFuY2VvZiBUZW1wbGF0ZVJlZjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIG9uQnV0dG9uQ2xpY2soYWN0aW9uLCBfZSkge1xuICAgICAgICB0aGlzLmFjdGlvbi5lbWl0KGFjdGlvbik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBidXR0b25DbGFzcyhhY3Rpb24pIHtcbiAgICAgICAgbGV0IGNsYXNzZXMgPSBbJ2stYnV0dG9uIGstYnV0dG9uLW1kIGstcm91bmRlZC1tZCddO1xuICAgICAgICBjb25zdCBmaWxsTW9kZSA9IGFjdGlvbi5maWxsTW9kZSA/IGFjdGlvbi5maWxsTW9kZSA6ICdzb2xpZCc7XG4gICAgICAgIGNvbnN0IHRoZW1lQ29sb3IgPSBhY3Rpb24udGhlbWVDb2xvciA/IGFjdGlvbi50aGVtZUNvbG9yIDogJ2Jhc2UnO1xuICAgICAgICBjb25zdCBjc3NDbGFzc2VzID0gYWN0aW9uLmNzc0NsYXNzID8gcGFyc2VDU1NDbGFzc05hbWVzKGFjdGlvbi5jc3NDbGFzcykgOiBbXTtcbiAgICAgICAgY2xhc3Nlcy5wdXNoKGBrLWJ1dHRvbi0ke2ZpbGxNb2RlfSBrLWJ1dHRvbi0ke2ZpbGxNb2RlfS0ke3RoZW1lQ29sb3J9YCk7XG4gICAgICAgIGlmIChjc3NDbGFzc2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNsYXNzZXMgPSBjbGFzc2VzLmNvbmNhdChjc3NDbGFzc2VzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2xhc3Nlcy5qb2luKCcgJyk7XG4gICAgfVxufTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE9iamVjdClcbl0sIERpYWxvZ0FjdGlvbnNDb21wb25lbnQucHJvdG90eXBlLCBcImFjdGlvbnNcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFN0cmluZylcbl0sIERpYWxvZ0FjdGlvbnNDb21wb25lbnQucHJvdG90eXBlLCBcImxheW91dFwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgT3V0cHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEV2ZW50RW1pdHRlcilcbl0sIERpYWxvZ0FjdGlvbnNDb21wb25lbnQucHJvdG90eXBlLCBcImFjdGlvblwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdEJpbmRpbmcoJ2NsYXNzLmstZGlhbG9nLWJ1dHRvbmdyb3VwJyksXG4gICAgSG9zdEJpbmRpbmcoJ2NsYXNzLmstYWN0aW9ucycpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBCb29sZWFuKVxuXSwgRGlhbG9nQWN0aW9uc0NvbXBvbmVudC5wcm90b3R5cGUsIFwiYnV0dG9uR3JvdXBDbGFzc05hbWVcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdjbGFzcy5rLWFjdGlvbnMtc3RyZXRjaGVkJyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEJvb2xlYW4pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbXSlcbl0sIERpYWxvZ0FjdGlvbnNDb21wb25lbnQucHJvdG90eXBlLCBcImNsYXNzTmFtZVwiLCBudWxsKTtcbkRpYWxvZ0FjdGlvbnNDb21wb25lbnQgPSBfX2RlY29yYXRlKFtcbiAgICBDb21wb25lbnQoe1xuICAgICAgICBzZWxlY3RvcjogJ2tlbmRvLWRpYWxvZy1hY3Rpb25zJyxcbiAgICAgICAgdGVtcGxhdGU6IGBcbiAgICAgICAgPG5nLWNvbnRlbnQgKm5nSWY9XCIhYWN0aW9uc1wiPjwvbmctY29udGVudD5cbiAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cIiFhY3Rpb25UZW1wbGF0ZSgpXCI+XG4gICAgICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgICAgICAgdHlwZT1cImJ1dHRvblwiXG4gICAgICAgICAgICAgICAgW25nQ2xhc3NdPVwiYnV0dG9uQ2xhc3MoYWN0aW9uKVwiXG4gICAgICAgICAgICAgICAgKGNsaWNrKT1cIm9uQnV0dG9uQ2xpY2soYWN0aW9uLCAkZXZlbnQpXCJcbiAgICAgICAgICAgICAgICAqbmdGb3I9XCJsZXQgYWN0aW9uIG9mIGFjdGlvbnNcIlxuICAgICAgICAgICAgICAgIFthdHRyLmFyaWEtbGFiZWxdPVwiYWN0aW9uLnRleHRcIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIHt7IGFjdGlvbi50ZXh0IH19XG4gICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgIDxuZy10ZW1wbGF0ZSBbbmdUZW1wbGF0ZU91dGxldF09XCJhY3Rpb25zXCIgKm5nSWY9XCJhY3Rpb25UZW1wbGF0ZSgpXCI+PC9uZy10ZW1wbGF0ZT5cbiAgICBgXG4gICAgfSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtFbGVtZW50UmVmXSlcbl0sIERpYWxvZ0FjdGlvbnNDb21wb25lbnQpO1xuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY2xhc3MgUHJldmVudGFibGVFdmVudCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMucHJldmVudGVkID0gZmFsc2U7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFByZXZlbnRzIHRoZSBkZWZhdWx0IGFjdGlvbiBmb3IgYSBzcGVjaWZpZWQgZXZlbnQuXG4gICAgICogSW4gdGhpcyB3YXksIHRoZSBzb3VyY2UgY29tcG9uZW50IHN1cHByZXNzZXMgdGhlIGJ1aWx0LWluIGJlaGF2aW9yIHRoYXQgZm9sbG93cyB0aGUgZXZlbnQuXG4gICAgICovXG4gICAgcHJldmVudERlZmF1bHQoKSB7XG4gICAgICAgIHRoaXMucHJldmVudGVkID0gdHJ1ZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSWYgdGhlIGV2ZW50IGlzIHByZXZlbnRlZCBieSBhbnkgb2YgaXRzIHN1YnNjcmliZXJzLCByZXR1cm5zIGB0cnVlYC5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIGB0cnVlYCBpZiB0aGUgZGVmYXVsdCBhY3Rpb24gd2FzIHByZXZlbnRlZC4gT3RoZXJ3aXNlLCByZXR1cm5zIGBmYWxzZWAuXG4gICAgICovXG4gICAgaXNEZWZhdWx0UHJldmVudGVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wcmV2ZW50ZWQ7XG4gICAgfVxufVxuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgRElBTE9HX0xPQ0FMSVpBVElPTl9TRVJWSUNFID0gbmV3IEluamVjdGlvblRva2VuKCdEaWFsb2cgTG9jYWxpemF0aW9uU2VydmljZScpO1xuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xubGV0IFRpdGxlQmFyTG9jYWxpemF0aW9uU2VydmljZSA9IGNsYXNzIFRpdGxlQmFyTG9jYWxpemF0aW9uU2VydmljZSBleHRlbmRzIExvY2FsaXphdGlvblNlcnZpY2Uge1xuICAgIGNvbnN0cnVjdG9yKHByZWZpeCwgbWVzc2FnZVNlcnZpY2UsIHJ0bCwgZGlhbG9nTG9jYWxpemF0aW9uKSB7XG4gICAgICAgIHN1cGVyKHByZWZpeCwgbWVzc2FnZVNlcnZpY2UsIHJ0bCk7XG4gICAgICAgIHRoaXMuZGlhbG9nTG9jYWxpemF0aW9uID0gZGlhbG9nTG9jYWxpemF0aW9uO1xuICAgIH1cbiAgICBnZXQoc2hvcnRLZXkpIHtcbiAgICAgICAgaWYgKHRoaXMuZGlhbG9nTG9jYWxpemF0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kaWFsb2dMb2NhbGl6YXRpb24uZ2V0KHNob3J0S2V5KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3VwZXIuZ2V0KHNob3J0S2V5KTtcbiAgICB9XG59O1xuVGl0bGVCYXJMb2NhbGl6YXRpb25TZXJ2aWNlID0gX19kZWNvcmF0ZShbXG4gICAgX19wYXJhbSgwLCBJbmplY3QoTDEwTl9QUkVGSVgpKSxcbiAgICBfX3BhcmFtKDEsIE9wdGlvbmFsKCkpLFxuICAgIF9fcGFyYW0oMiwgT3B0aW9uYWwoKSksIF9fcGFyYW0oMiwgSW5qZWN0KFJUTCkpLFxuICAgIF9fcGFyYW0oMywgT3B0aW9uYWwoKSksIF9fcGFyYW0oMywgSW5qZWN0KERJQUxPR19MT0NBTElaQVRJT05fU0VSVklDRSkpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbU3RyaW5nLCBNZXNzYWdlU2VydmljZSwgQm9vbGVhbiwgTG9jYWxpemF0aW9uU2VydmljZV0pXG5dLCBUaXRsZUJhckxvY2FsaXphdGlvblNlcnZpY2UpO1xuXG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIFtLZW5kbyBVSSBEaWFsb2dUaXRsZUJhciBjb21wb25lbnQgZm9yIEFuZ3VsYXJdKHslIHNsdWcgYXBpX2RpYWxvZ19kaWFsb2d0aXRsZWJhcmNvbXBvbmVudCAlfSkuXG4gKlxuICogSXQgaXMgdXNlZCBhcyBwYXJ0IG9mIHRoZSBEaWFsb2cgY29udGVudCB3aGVuIHRoZSBjb21wb25lbnQgaXMgY3JlYXRlZCBkeW5hbWljYWxseSBieSB1c2luZyBhbiBbQW5ndWxhciBzZXJ2aWNlXSh7JSBzbHVnIHNlcnZpY2VfZGlhbG9nICV9KS5cbiAqL1xubGV0IERpYWxvZ1RpdGxlQmFyQ29tcG9uZW50ID0gY2xhc3MgRGlhbG9nVGl0bGVCYXJDb21wb25lbnQge1xuICAgIGNvbnN0cnVjdG9yKHpvbmUsIGhvc3RFbGVtZW50LCBsb2NhbGl6YXRpb25TZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMuem9uZSA9IHpvbmU7XG4gICAgICAgIHRoaXMuaG9zdEVsZW1lbnQgPSBob3N0RWxlbWVudDtcbiAgICAgICAgdGhpcy5sb2NhbGl6YXRpb25TZXJ2aWNlID0gbG9jYWxpemF0aW9uU2VydmljZTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gdGhlIGNsb3NlIGJ1dHRvbiBvZiB0aGUgdGl0bGUtYmFyIGlzIGNsaWNrZWQuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNsb3NlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIH1cbiAgICBnZXQgY2xhc3NOYW1lKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgZ2V0IGNsb3NlQnV0dG9uVGl0bGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNsb3NlVGl0bGUgfHwgdGhpcy5sb2NhbGl6YXRpb25TZXJ2aWNlLmdldCgnY2xvc2VUaXRsZScpO1xuICAgIH1cbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgICAgIHRoaXMuem9uZS5vblN0YWJsZS5waXBlKHRha2UoMSkpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5ob3N0RWxlbWVudC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5rLWRpYWxvZy10aXRsZScpO1xuICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2lkJywgdGhpcy5pZCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgb25DbG9zZUNsaWNrKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBjb25zdCBldmVudEFyZ3MgPSBuZXcgUHJldmVudGFibGVFdmVudCgpO1xuICAgICAgICB0aGlzLmNsb3NlLmVtaXQoZXZlbnRBcmdzKTtcbiAgICB9XG59O1xuX19kZWNvcmF0ZShbXG4gICAgT3V0cHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEV2ZW50RW1pdHRlcilcbl0sIERpYWxvZ1RpdGxlQmFyQ29tcG9uZW50LnByb3RvdHlwZSwgXCJjbG9zZVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKVxuXSwgRGlhbG9nVGl0bGVCYXJDb21wb25lbnQucHJvdG90eXBlLCBcImlkXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpXG5dLCBEaWFsb2dUaXRsZUJhckNvbXBvbmVudC5wcm90b3R5cGUsIFwiY2xvc2VUaXRsZVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdEJpbmRpbmcoJ2NsYXNzLmstd2luZG93LXRpdGxlYmFyJyksXG4gICAgSG9zdEJpbmRpbmcoJ2NsYXNzLmstZGlhbG9nLXRpdGxlYmFyJyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEJvb2xlYW4pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbXSlcbl0sIERpYWxvZ1RpdGxlQmFyQ29tcG9uZW50LnByb3RvdHlwZSwgXCJjbGFzc05hbWVcIiwgbnVsbCk7XG5EaWFsb2dUaXRsZUJhckNvbXBvbmVudCA9IF9fZGVjb3JhdGUoW1xuICAgIENvbXBvbmVudCh7XG4gICAgICAgIHNlbGVjdG9yOiAna2VuZG8tZGlhbG9nLXRpdGxlYmFyJyxcbiAgICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgICAgICBUaXRsZUJhckxvY2FsaXphdGlvblNlcnZpY2UsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcHJvdmlkZTogTG9jYWxpemF0aW9uU2VydmljZSxcbiAgICAgICAgICAgICAgICB1c2VFeGlzdGluZzogVGl0bGVCYXJMb2NhbGl6YXRpb25TZXJ2aWNlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHByb3ZpZGU6IEwxME5fUFJFRklYLFxuICAgICAgICAgICAgICAgIHVzZVZhbHVlOiAna2VuZG8uZGlhbG9nJ1xuICAgICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICB0ZW1wbGF0ZTogYFxuICAgICAgICAgPG5nLWNvbnRhaW5lclxuICAgICAgICAgICAga2VuZG9EaWFsb2dUaXRsZUJhckxvY2FsaXplZE1lc3NhZ2VzXG4gICAgICAgICAgICBpMThuLWNsb3NlVGl0bGU9XCJrZW5kby5kaWFsb2cuY2xvc2VUaXRsZXxUaGUgdGl0bGUgb2YgdGhlIGNsb3NlIGJ1dHRvblwiXG4gICAgICAgICAgICBjbG9zZVRpdGxlPVwiQ2xvc2VcIlxuICAgICAgICA+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiay13aW5kb3ctdGl0bGUgay1kaWFsb2ctdGl0bGVcIj5cbiAgICAgICAgICAgICAgICA8bmctY29udGVudD48L25nLWNvbnRlbnQ+XG4gICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImstd2luZG93LWFjdGlvbnMgay1kaWFsb2ctYWN0aW9uc1wiPlxuICAgICAgICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgICAgICAgICAgcm9sZT1cImJ1dHRvblwiXG4gICAgICAgICAgICAgICAgICAgIFthdHRyLnRpdGxlXT1cImNsb3NlQnV0dG9uVGl0bGVcIlxuICAgICAgICAgICAgICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cImNsb3NlQnV0dG9uVGl0bGVcIlxuICAgICAgICAgICAgICAgICAgICBjbGFzcz1cImstYnV0dG9uIGstYnV0dG9uLW1kIGstcm91bmRlZC1tZCBrLWJ1dHRvbi1mbGF0IGstYnV0dG9uLWZsYXQtYmFzZSBrLWljb24tYnV0dG9uIGstd2luZG93LWFjdGlvbiBrLWRpYWxvZy1hY3Rpb24gay1kaWFsb2ctY2xvc2VcIlxuICAgICAgICAgICAgICAgICAgICAoY2xpY2spPVwib25DbG9zZUNsaWNrKCRldmVudClcIlxuICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJrLWJ1dHRvbi1pY29uIGstaWNvbiBrLWkteFwiPjwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICBgXG4gICAgfSksXG4gICAgX19wYXJhbSgyLCBPcHRpb25hbCgpKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW05nWm9uZSwgRWxlbWVudFJlZiwgTG9jYWxpemF0aW9uU2VydmljZV0pXG5dLCBEaWFsb2dUaXRsZUJhckNvbXBvbmVudCk7XG5cbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBwYWNrYWdlTWV0YWRhdGEgPSB7XG4gICAgbmFtZTogJ0Bwcm9ncmVzcy9rZW5kby1hbmd1bGFyLWRpYWxvZycsXG4gICAgcHJvZHVjdE5hbWU6ICdLZW5kbyBVSSBmb3IgQW5ndWxhcicsXG4gICAgcHJvZHVjdENvZGVzOiBbJ0tFTkRPVUlBTkdVTEFSJywgJ0tFTkRPVUlDT01QTEVURSddLFxuICAgIHB1Ymxpc2hEYXRlOiAxNjQ2MjE3MTEyLFxuICAgIHZlcnNpb246ICcnLFxuICAgIGxpY2Vuc2luZ0RvY3NVcmw6ICdodHRwczovL3d3dy50ZWxlcmlrLmNvbS9rZW5kby1hbmd1bGFyLXVpL215LWxpY2Vuc2UvP3V0bV9tZWRpdW09cHJvZHVjdCZ1dG1fc291cmNlPWtlbmRvYW5ndWxhciZ1dG1fY2FtcGFpZ249a2VuZG8tdWktYW5ndWxhci1wdXJjaGFzZS1saWNlbnNlLWtleXMtd2FybmluZydcbn07XG5cbi8qKlxuICogVGhlIHNldHRpbmdzIGZvciB0aGUgRGlhbG9nIGFjdGlvbnMgd2hlbiB0aGUgRGlhbG9nIGlzIG9wZW5lZCB0aHJvdWdoIGBEaWFsb2dTZXJ2aWNlYFxuICogKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBhcGlfZGlhbG9nX2RpYWxvZ3NlcnZpY2UgJX0jdG9jLW9wZW4pKS5cbiAqL1xuY2xhc3MgRGlhbG9nQWN0aW9uIHtcbn1cbi8qKlxuICogSW5kaWNhdGVzIHRoYXQgdGhlICoqQ2xvc2UqKiBidXR0b24gaXMgY2xpY2tlZC4gVXNlZCB3aGVuIHRoZSByZXN1bHRzIGZyb21cbiAqIHRoZSBEaWFsb2dzIHRoYXQgYXJlIG9wZW5lZCB0aHJvdWdoIGBEaWFsb2dTZXJ2aWNlYCBhcmUgZmlsdGVyZWRcbiAqIChbc2VlIGV4YW1wbGVdKHslIHNsdWcgYXBpX2RpYWxvZ19kaWFsb2dzZXJ2aWNlICV9I3RvYy1vcGVuKSkuXG4gKi9cbmNsYXNzIERpYWxvZ0Nsb3NlUmVzdWx0IHtcbn1cbi8qKlxuICogVGhlIHNldHRpbmdzIHRoYXQgY2FuIGJlIHVzZWQgd2hlbiB0aGUgRGlhbG9nIGlzIG9wZW5lZCB0aHJvdWdoIGBEaWFsb2dTZXJ2aWNlYC5cbiAqIChbc2VlIGV4YW1wbGVdKHslIHNsdWcgYXBpX2RpYWxvZ19kaWFsb2dzZXJ2aWNlICV9I3RvYy1vcGVuKSkuXG4gKi9cbmNsYXNzIERpYWxvZ1NldHRpbmdzIHtcbn1cbi8qKlxuICogSG9sZHMgcmVmZXJlbmNlcyB0byB0aGUgb2JqZWN0IGluc3RhbmNlIGFuZCBwdWJsaXNoZWQgZXZlbnRzIG9mIHRoZSBEaWFsb2cuXG4gKiBDb250cm9scyB0aGUgRGlhbG9ncyB0aGF0IHdlcmUgb3BlbmVkIHRocm91Z2ggdGhlIGBEaWFsb2dTZXJ2aWNlYFxuICogKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBhcGlfZGlhbG9nX2RpYWxvZ3NlcnZpY2UgJX0jdG9jLW9wZW4pKS5cbiAqL1xuY2xhc3MgRGlhbG9nUmVmIHtcbn1cblxuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBbS2VuZG8gVUkgRGlhbG9nIGNvbXBvbmVudCBmb3IgQW5ndWxhcl0oeyUgc2x1ZyBvdmVydmlld19kaWFsb2dfZGlhbG9ncyAlfSkuXG4gKi9cbmxldCBEaWFsb2dDb21wb25lbnQgPSBjbGFzcyBEaWFsb2dDb21wb25lbnQge1xuICAgIGNvbnN0cnVjdG9yKHdyYXBwZXIsIHJlbmRlcmVyLCBsb2NhbGl6YXRpb24sIGNkciwgbmdab25lKSB7XG4gICAgICAgIHRoaXMud3JhcHBlciA9IHdyYXBwZXI7XG4gICAgICAgIHRoaXMucmVuZGVyZXIgPSByZW5kZXJlcjtcbiAgICAgICAgdGhpcy5jZHIgPSBjZHI7XG4gICAgICAgIHRoaXMubmdab25lID0gbmdab25lO1xuICAgICAgICAvKipcbiAgICAgICAgICogU3BlY2lmaWVzIHRoZSBsYXlvdXQgb2YgdGhlIGFjdGlvbiBidXR0b25zIGluIHRoZSBEaWFsb2cuXG4gICAgICAgICAqIFRoaXMgb3B0aW9uIGlzIG9ubHkgYXBwbGljYWJsZSBpZiB0aGUgYWN0aW9uIGJ1dHRvbnMgYXJlIHNwZWNpZmllZCB0aHJvdWdoIHRoZSBgYWN0aW9uc2Agb3B0aW9ucy5cbiAgICAgICAgICpcbiAgICAgICAgICogQGRlZmF1bHQgJ3N0cmV0Y2hlZCdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYWN0aW9uc0xheW91dCA9ICdzdHJldGNoZWQnO1xuICAgICAgICAvKipcbiAgICAgICAgICogQGhpZGRlblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50aXRsZUlkID0gbnVsbDtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBoaWRkZW5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY29udGVudElkID0gbnVsbDtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gdGhlIHVzZXIgY2xpY2tzIGFuIGFjdGlvbiBidXR0b24gb2YgdGhlIERpYWxvZy5cbiAgICAgICAgICogVGhlIGV2ZW50IGlzIGZpcmVkIG9ubHkgd2hlbiB0aGUgYWN0aW9uIGJ1dHRvbnMgYXJlIHNwZWNpZmllZCB0aHJvdWdoIHRoZSBgYWN0aW9uc2Agb3B0aW9ucy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYWN0aW9uID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiB0aGUgdXNlciBjbGlja3MgdGhlICoqQ2xvc2UqKiBidXR0b24gb2YgdGhlIERpYWxvZyBvciB0aGUgKipFU0MqKiBrZXkuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNsb3NlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLnRhYkluZGV4ID0gMDtcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zID0gW107XG4gICAgICAgIHRoaXMuZG9tU3VicyA9IG5ldyBTdWJzY3JpcHRpb24oKTtcbiAgICAgICAgdmFsaWRhdGVQYWNrYWdlKHBhY2thZ2VNZXRhZGF0YSk7XG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gbG9jYWxpemF0aW9uLnJ0bCA/ICdydGwnIDogJ2x0cic7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKGxvY2FsaXphdGlvbi5jaGFuZ2VzLnN1YnNjcmliZSgoeyBydGwgfSkgPT4gKHRoaXMuZGlyZWN0aW9uID0gcnRsID8gJ3J0bCcgOiAnbHRyJykpKTtcbiAgICAgICAgdGhpcy50aXRsZUlkID0gdGhpcy5nZW5lcmF0ZVRpdGxlSWQoKTtcbiAgICAgICAgdGhpcy5jb250ZW50SWQgPSB0aGlzLmdlbmVyYXRlQ29udGVudElkKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBzZXQgaHRtbEF0dHJpYnV0ZXMoYXR0cmlidXRlcykge1xuICAgICAgICBzZXRIVE1MQXR0cmlidXRlcyhhdHRyaWJ1dGVzLCB0aGlzLnJlbmRlcmVyLCB0aGlzLndyYXBwZXIubmF0aXZlRWxlbWVudCk7XG4gICAgICAgIGNvbnN0IGVsID0gdGhpcy53cmFwcGVyLm5hdGl2ZUVsZW1lbnQ7XG4gICAgICAgIGNvbnN0IGRpciA9IGVsLmdldEF0dHJpYnV0ZSgnZGlyJyk7XG4gICAgICAgIGNvbnN0IHRJbmRleCA9IGVsLmdldEF0dHJpYnV0ZSgndGFiaW5kZXgnKTtcbiAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uICE9PSBkaXIgJiYgZGlyKSB7XG4gICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IGRpcjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy50YWJJbmRleCAhPT0gdEluZGV4ICYmIHRJbmRleCkge1xuICAgICAgICAgICAgdGhpcy50YWJJbmRleCA9IHRJbmRleDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9odG1sQXR0cmlidXRlcyA9IGF0dHJpYnV0ZXM7XG4gICAgfVxuICAgIGdldCBodG1sQXR0cmlidXRlcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2h0bWxBdHRyaWJ1dGVzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgc2V0IGNzc0NsYXNzKGNsYXNzZXMpIHtcbiAgICAgICAgdGhpcy5zZXRTZXJ2aWNlQ2xhc3Nlcyh0aGlzLl9jc3NDbGFzcywgY2xhc3Nlcyk7XG4gICAgICAgIHRoaXMuX2Nzc0NsYXNzID0gY2xhc3NlcztcbiAgICB9XG4gICAgZ2V0IGNzc0NsYXNzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY3NzQ2xhc3M7XG4gICAgfVxuICAgIGdldCBkaXIoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRpcmVjdGlvbjtcbiAgICB9XG4gICAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xuICAgICAgICB0aGlzLmJ1YmJsZSgnY2xvc2UnLCB0aGlzLnRpdGxlYmFyQ29udGVudC5maXJzdCk7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMud3JhcHBlci5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5rLWRpYWxvZycpLCAnYXJpYS1kZXNjcmliZWRieScsIHRoaXMuY29udGVudElkKTtcbiAgICAgICAgaWYgKHRoaXMudGl0bGViYXJDb250ZW50LmZpcnN0KSB7XG4gICAgICAgICAgICB0aGlzLnRpdGxlYmFyQ29udGVudC5maXJzdC5pZCA9IHRoaXMudGl0bGVJZDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKHRoaXMudGl0bGViYXJDb250ZW50LmNoYW5nZXMuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoaXNQcmVzZW50KHRoaXMudGl0bGViYXJDb250ZW50LmZpcnN0KSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRpdGxlYmFyQ29udGVudC5maXJzdC5pZCA9IHRoaXMudGl0bGVJZDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uZ1pvbmUub25TdGFibGUucGlwZSh0YWtlKDEpKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5idWJibGUoJ2Nsb3NlJywgdGhpcy50aXRsZWJhckNvbnRlbnQuZmlyc3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUodGhpcy53cmFwcGVyLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLmstZGlhbG9nJyksICdhcmlhLWxhYmVsbGVkYnknLCB0aGlzLnRpdGxlSWQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgICAgICB0aGlzLmhhbmRsZUluaXRpYWxGb2N1cygpO1xuICAgICAgICB0aGlzLmJ1YmJsZSgnY2xvc2UnLCB0aGlzLnRpdGxlYmFyVmlldy5maXJzdCk7XG4gICAgICAgIHRoaXMuYnViYmxlKCdhY3Rpb24nLCB0aGlzLmFjdGlvbnNWaWV3KTtcbiAgICAgICAgaWYgKHRoaXMudGl0bGViYXJWaWV3LmZpcnN0IHx8IHRoaXMudGl0bGViYXJDb250ZW50LmZpcnN0KSB7XG4gICAgICAgICAgICAvL05lZWRlZCBmb3IgRGlhbG9ncyBjcmVhdGVkIHZpYSBzZXJ2aWNlXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLndyYXBwZXIubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuay1kaWFsb2cnKSwgJ2FyaWEtbGFiZWxsZWRieScsIHRoaXMudGl0bGVJZCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaCh0aGlzLnRpdGxlYmFyVmlldy5jaGFuZ2VzLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGlzUHJlc2VudCh0aGlzLnRpdGxlYmFyVmlldy5maXJzdCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50aXRsZWJhclZpZXcuZmlyc3QuaWQgPSB0aGlzLnRpdGxlSWQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubmdab25lLm9uU3RhYmxlLnBpcGUodGFrZSgxKSkuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYnViYmxlKCdjbG9zZScsIHRoaXMudGl0bGViYXJWaWV3LmZpcnN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMud3JhcHBlci5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5rLWRpYWxvZycpLCAnYXJpYS1sYWJlbGxlZGJ5JywgdGhpcy50aXRsZUlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaW5pdERvbUV2ZW50cygpO1xuICAgIH1cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVBdHRyaWJ1dGUodGhpcy53cmFwcGVyLm5hdGl2ZUVsZW1lbnQsICd0aXRsZScpO1xuICAgICAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgfVxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMuZm9yRWFjaChzID0+IHMudW5zdWJzY3JpYmUoKSk7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IFtdO1xuICAgICAgICBpZiAodGhpcy5kb21TdWJzKSB7XG4gICAgICAgICAgICB0aGlzLmRvbVN1YnMudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBGb2N1c2VzIHRoZSB3cmFwcGVyIG9mIHRoZSBEaWFsb2cgY29tcG9uZW50LlxuICAgICAqL1xuICAgIGZvY3VzKCkge1xuICAgICAgICBjb25zdCB3cmFwcGVyID0gdGhpcy53cmFwcGVyLm5hdGl2ZUVsZW1lbnQ7XG4gICAgICAgIGlmIChpc1ByZXNlbnQod3JhcHBlcikpIHtcbiAgICAgICAgICAgIHdyYXBwZXIuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpbml0RG9tRXZlbnRzKCkge1xuICAgICAgICBpZiAoIXRoaXMud3JhcHBlcikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZG9tU3Vicy5hZGQodGhpcy5yZW5kZXJlci5saXN0ZW4odGhpcy53cmFwcGVyLm5hdGl2ZUVsZW1lbnQsICdrZXlkb3duJywgKGV2KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5vbktleURvd24oZXYpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgb25LZXlEb3duKGV2ZW50KSB7XG4gICAgICAgIGNvbnN0IHRhcmdldCA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgY29uc3QgcGFyZW50ID0gdGFyZ2V0LnBhcmVudEVsZW1lbnQ7XG4gICAgICAgIGlmIChoYXNDbGFzc2VzKHRhcmdldCwgRElBTE9HX0VMRU1FTlRTX0hBTkRMSU5HX0VTQ19LRVkpIHx8IGhhc0NsYXNzZXMocGFyZW50LCBESUFMT0dfRUxFTUVOVFNfSEFORExJTkdfRVNDX0tFWSkpIHtcbiAgICAgICAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSBLZXlzLmVzYykge1xuICAgICAgICAgICAgICAgIHRoaXMubmdab25lLnJ1bigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UuZW1pdChuZXcgRGlhbG9nQ2xvc2VSZXN1bHQoKSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGhhc0NsYXNzZXModGFyZ2V0LCAnay1idXR0b24nKSAmJiBoYXNDbGFzc2VzKHBhcmVudCwgRElBTE9HX0VMRU1FTlRTX0hBTkRMSU5HX0FSUk9XUykgJiZcbiAgICAgICAgICAgIChldmVudC5rZXlDb2RlID09PSBLZXlzLmxlZnQgfHwgZXZlbnQua2V5Q29kZSA9PT0gS2V5cy5yaWdodCkpIHtcbiAgICAgICAgICAgIHRoaXMubmdab25lLnJ1bigoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVBY3Rpb25CdXR0b25Gb2N1cyhwYXJlbnQsIGV2ZW50LmtleUNvZGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IEtleXMudGFiKSB7XG4gICAgICAgICAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMua2VlcEZvY3VzV2l0aGluQ29tcG9uZW50KHRhcmdldCwgZXZlbnQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2V0U2VydmljZUNsYXNzZXMocHJldlZhbHVlLCB2YWx1ZSkge1xuICAgICAgICBjb25zdCBlbCA9IHRoaXMud3JhcHBlci5uYXRpdmVFbGVtZW50O1xuICAgICAgICBpZiAocHJldlZhbHVlKSB7XG4gICAgICAgICAgICBwYXJzZUNTU0NsYXNzTmFtZXMocHJldlZhbHVlKS5mb3JFYWNoKGNsYXNzTmFtZSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVDbGFzcyhlbCwgY2xhc3NOYW1lKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgcGFyc2VDU1NDbGFzc05hbWVzKHZhbHVlKS5mb3JFYWNoKGNsYXNzTmFtZSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhlbCwgY2xhc3NOYW1lKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBoYW5kbGVJbml0aWFsRm9jdXMoKSB7XG4gICAgICAgIGNvbnN0IHdyYXBwZXIgPSB0aGlzLndyYXBwZXIubmF0aXZlRWxlbWVudDtcbiAgICAgICAgY29uc3QgcHJpbWFyeUJ1dHRvbiA9IHRoaXMuZmluZFByaW1hcnkod3JhcHBlcik7XG4gICAgICAgIGlmICh0aGlzLmF1dG9Gb2N1c2VkRWxlbWVudCkge1xuICAgICAgICAgICAgY29uc3QgaW5pdGlhbGx5Rm9jdXNlZEVsZW1lbnQgPSB3cmFwcGVyLnF1ZXJ5U2VsZWN0b3IodGhpcy5hdXRvRm9jdXNlZEVsZW1lbnQpO1xuICAgICAgICAgICAgaWYgKGluaXRpYWxseUZvY3VzZWRFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgaW5pdGlhbGx5Rm9jdXNlZEVsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLnNob3VsZEZvY3VzUHJpbWFyeShwcmltYXJ5QnV0dG9uKSkge1xuICAgICAgICAgICAgcHJpbWFyeUJ1dHRvbi5mb2N1cygpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgd3JhcHBlci5mb2N1cygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBmaW5kUHJpbWFyeSh3cmFwcGVyKSB7XG4gICAgICAgIGNvbnN0IGFjdGlvbkJ0bnMgPSB3cmFwcGVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy5rLWFjdGlvbnMgLmstYnV0dG9uJyk7XG4gICAgICAgIHJldHVybiBmaW5kUHJpbWFyeUJ1dHRvbihhY3Rpb25CdG5zKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIGhhbmRsZUFjdGlvbkJ1dHRvbkZvY3VzKHBhcmVudCwga2V5KSB7XG4gICAgICAgIGNvbnN0IGZvY3VzYWJsZUFjdGlvbkJ1dHRvbnMgPSB0aGlzLmdldEFsbEZvY3VzYWJsZUNoaWxkcmVuKHBhcmVudCk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZm9jdXNhYmxlQWN0aW9uQnV0dG9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgY3VycmVudCA9IGZvY3VzYWJsZUFjdGlvbkJ1dHRvbnNbaV07XG4gICAgICAgICAgICBpZiAoY3VycmVudCA9PT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkge1xuICAgICAgICAgICAgICAgIGlmIChrZXkgPT09IEtleXMubGVmdCAmJiBpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBmb2N1c2FibGVBY3Rpb25CdXR0b25zW2kgLSAxXS5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gS2V5cy5yaWdodCAmJiBpIDwgZm9jdXNhYmxlQWN0aW9uQnV0dG9ucy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvY3VzYWJsZUFjdGlvbkJ1dHRvbnNbaSArIDFdLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAga2VlcEZvY3VzV2l0aGluQ29tcG9uZW50KHRhcmdldCwgZXZlbnQpIHtcbiAgICAgICAgY29uc3Qgd3JhcHBlciA9IHRoaXMud3JhcHBlci5uYXRpdmVFbGVtZW50O1xuICAgICAgICBjb25zdCBbZmlyc3RGb2N1c2FibGUsIGxhc3RGb2N1c2FibGVdID0gdGhpcy5nZXRGaXJzdEFuZExhc3RGb2N1c2FibGUod3JhcHBlcik7XG4gICAgICAgIGNvbnN0IHRhYkFmdGVyTGFzdEZvY3VzYWJsZSA9ICFldmVudC5zaGlmdEtleSAmJiB0YXJnZXQgPT09IGxhc3RGb2N1c2FibGU7XG4gICAgICAgIGNvbnN0IHNoaWZ0VGFiQWZ0ZXJGaXJzdEZvY3VzYWJsZSA9IGV2ZW50LnNoaWZ0S2V5ICYmIHRhcmdldCA9PT0gZmlyc3RGb2N1c2FibGU7XG4gICAgICAgIGlmICh0YWJBZnRlckxhc3RGb2N1c2FibGUpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBmaXJzdEZvY3VzYWJsZS5mb2N1cygpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzaGlmdFRhYkFmdGVyRmlyc3RGb2N1c2FibGUpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBsYXN0Rm9jdXNhYmxlLmZvY3VzKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIHNob3VsZEZvY3VzUHJpbWFyeShlbCkge1xuICAgICAgICByZXR1cm4gaXNQcmVzZW50KGVsKSAmJiBpc0ZvY3VzYWJsZShlbCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBnZXRBbGxGb2N1c2FibGVDaGlsZHJlbihwYXJlbnQpIHtcbiAgICAgICAgcmV0dXJuIHBhcmVudC5xdWVyeVNlbGVjdG9yQWxsKGZvY3VzYWJsZVNlbGVjdG9yKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIGdldEZpcnN0QW5kTGFzdEZvY3VzYWJsZShwYXJlbnQpIHtcbiAgICAgICAgY29uc3QgYWxsID0gdGhpcy5nZXRBbGxGb2N1c2FibGVDaGlsZHJlbihwYXJlbnQpO1xuICAgICAgICBjb25zdCBmaXJzdEZvY3VzYWJsZSA9IGFsbC5sZW5ndGggPiAwID8gYWxsWzBdIDogcGFyZW50O1xuICAgICAgICBjb25zdCBsYXN0Rm9jdXNhYmxlID0gYWxsLmxlbmd0aCA+IDAgPyBhbGxbYWxsLmxlbmd0aCAtIDFdIDogcGFyZW50O1xuICAgICAgICByZXR1cm4gW2ZpcnN0Rm9jdXNhYmxlLCBsYXN0Rm9jdXNhYmxlXTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIGdlbmVyYXRlVGl0bGVJZCgpIHtcbiAgICAgICAgcmV0dXJuICdrZW5kby1kaWFsb2ctdGl0bGUtJyArIE1hdGguY2VpbChNYXRoLnJhbmRvbSgpICogMTAwMDAwMCkudG9TdHJpbmcoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIGdlbmVyYXRlQ29udGVudElkKCkge1xuICAgICAgICByZXR1cm4gJ2tlbmRvLWRpYWxvZy1jb250ZW50LScgKyBNYXRoLmNlaWwoTWF0aC5yYW5kb20oKSAqIDEwMDAwMDApLnRvU3RyaW5nKCk7XG4gICAgfVxuICAgIGdldCB3cmFwcGVyQ2xhc3MoKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBnZXQgc3R5bGVzKCkge1xuICAgICAgICBjb25zdCBzdHlsZXMgPSB7fTtcbiAgICAgICAgaWYgKHRoaXMud2lkdGgpIHtcbiAgICAgICAgICAgIHN0eWxlcy53aWR0aCA9IGNyZWF0ZVZhbHVlV2l0aFVuaXQodGhpcy53aWR0aCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaGVpZ2h0KSB7XG4gICAgICAgICAgICBzdHlsZXMuaGVpZ2h0ID0gY3JlYXRlVmFsdWVXaXRoVW5pdCh0aGlzLmhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubWluV2lkdGgpIHtcbiAgICAgICAgICAgIHN0eWxlcy5taW5XaWR0aCA9IGNyZWF0ZVZhbHVlV2l0aFVuaXQodGhpcy5taW5XaWR0aCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubWF4V2lkdGgpIHtcbiAgICAgICAgICAgIHN0eWxlcy5tYXhXaWR0aCA9IGNyZWF0ZVZhbHVlV2l0aFVuaXQodGhpcy5tYXhXaWR0aCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubWluSGVpZ2h0KSB7XG4gICAgICAgICAgICBzdHlsZXMubWluSGVpZ2h0ID0gY3JlYXRlVmFsdWVXaXRoVW5pdCh0aGlzLm1pbkhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubWF4SGVpZ2h0KSB7XG4gICAgICAgICAgICBzdHlsZXMubWF4SGVpZ2h0ID0gY3JlYXRlVmFsdWVXaXRoVW5pdCh0aGlzLm1heEhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN0eWxlcztcbiAgICB9XG4gICAgYnViYmxlKGV2ZW50TmFtZSwgY29tcG9uZW50KSB7XG4gICAgICAgIGlmIChjb21wb25lbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IGVtaXQgPSBlID0+IHRoaXNbZXZlbnROYW1lXS5lbWl0KGUpO1xuICAgICAgICAgICAgY29uc3QgcyA9IGNvbXBvbmVudFtldmVudE5hbWVdLnN1YnNjcmliZShlbWl0KTtcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKHMpO1xuICAgICAgICB9XG4gICAgfVxufTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEFycmF5KVxuXSwgRGlhbG9nQ29tcG9uZW50LnByb3RvdHlwZSwgXCJhY3Rpb25zXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpXG5dLCBEaWFsb2dDb21wb25lbnQucHJvdG90eXBlLCBcImFjdGlvbnNMYXlvdXRcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFN0cmluZylcbl0sIERpYWxvZ0NvbXBvbmVudC5wcm90b3R5cGUsIFwiYXV0b0ZvY3VzZWRFbGVtZW50XCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpXG5dLCBEaWFsb2dDb21wb25lbnQucHJvdG90eXBlLCBcInRpdGxlXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBPYmplY3QpXG5dLCBEaWFsb2dDb21wb25lbnQucHJvdG90eXBlLCBcIndpZHRoXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBPYmplY3QpXG5dLCBEaWFsb2dDb21wb25lbnQucHJvdG90eXBlLCBcIm1pbldpZHRoXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBPYmplY3QpXG5dLCBEaWFsb2dDb21wb25lbnQucHJvdG90eXBlLCBcIm1heFdpZHRoXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBPYmplY3QpXG5dLCBEaWFsb2dDb21wb25lbnQucHJvdG90eXBlLCBcImhlaWdodFwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgT2JqZWN0KVxuXSwgRGlhbG9nQ29tcG9uZW50LnByb3RvdHlwZSwgXCJtaW5IZWlnaHRcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE9iamVjdClcbl0sIERpYWxvZ0NvbXBvbmVudC5wcm90b3R5cGUsIFwibWF4SGVpZ2h0XCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBPdXRwdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgRXZlbnRFbWl0dGVyKVxuXSwgRGlhbG9nQ29tcG9uZW50LnByb3RvdHlwZSwgXCJhY3Rpb25cIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIE91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBFdmVudEVtaXR0ZXIpXG5dLCBEaWFsb2dDb21wb25lbnQucHJvdG90eXBlLCBcImNsb3NlXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBIb3N0QmluZGluZygnYXR0ci5kaXInKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW10pXG5dLCBEaWFsb2dDb21wb25lbnQucHJvdG90eXBlLCBcImRpclwiLCBudWxsKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdhdHRyLnRhYkluZGV4JyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE51bWJlcilcbl0sIERpYWxvZ0NvbXBvbmVudC5wcm90b3R5cGUsIFwidGFiSW5kZXhcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIENvbnRlbnRDaGlsZHJlbihEaWFsb2dUaXRsZUJhckNvbXBvbmVudCwgeyBkZXNjZW5kYW50czogZmFsc2UgfSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFF1ZXJ5TGlzdClcbl0sIERpYWxvZ0NvbXBvbmVudC5wcm90b3R5cGUsIFwidGl0bGViYXJDb250ZW50XCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBWaWV3Q2hpbGRyZW4oRGlhbG9nVGl0bGVCYXJDb21wb25lbnQpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBRdWVyeUxpc3QpXG5dLCBEaWFsb2dDb21wb25lbnQucHJvdG90eXBlLCBcInRpdGxlYmFyVmlld1wiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgVmlld0NoaWxkKERpYWxvZ0FjdGlvbnNDb21wb25lbnQsIHsgc3RhdGljOiBmYWxzZSB9KSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgRGlhbG9nQWN0aW9uc0NvbXBvbmVudClcbl0sIERpYWxvZ0NvbXBvbmVudC5wcm90b3R5cGUsIFwiYWN0aW9uc1ZpZXdcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdjbGFzcy5rLWRpYWxvZy13cmFwcGVyJyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEJvb2xlYW4pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbXSlcbl0sIERpYWxvZ0NvbXBvbmVudC5wcm90b3R5cGUsIFwid3JhcHBlckNsYXNzXCIsIG51bGwpO1xuRGlhbG9nQ29tcG9uZW50ID0gX19kZWNvcmF0ZShbXG4gICAgQ29tcG9uZW50KHtcbiAgICAgICAgYW5pbWF0aW9uczogW1xuICAgICAgICAgICAgdHJpZ2dlcignb3ZlcmxheUFwcGVhcicsIFtcbiAgICAgICAgICAgICAgICBzdGF0ZSgnaW4nLCBzdHlsZSh7IG9wYWNpdHk6IDEgfSkpLFxuICAgICAgICAgICAgICAgIHRyYW5zaXRpb24oJ3ZvaWQgPT4gKicsIFtzdHlsZSh7IG9wYWNpdHk6IDAuMSB9KSwgYW5pbWF0ZSgnLjNzIGN1YmljLWJlemllciguMiwgLjYsIC40LCAxKScpXSlcbiAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgdHJpZ2dlcignZGlhbG9nU2xpZGVJbkFwcGVhcicsIFtcbiAgICAgICAgICAgICAgICBzdGF0ZSgnaW4nLCBzdHlsZSh7IHRyYW5zZm9ybTogJ3RyYW5zbGF0ZSgwLCAwKScgfSkpLFxuICAgICAgICAgICAgICAgIHRyYW5zaXRpb24oJ3ZvaWQgPT4gKicsIFtzdHlsZSh7IHRyYW5zZm9ybTogJ3RyYW5zbGF0ZSgwLCAtMTAlKScgfSksIGFuaW1hdGUoJy4zcyBjdWJpYy1iZXppZXIoLjIsIDEsIC4yLCAxKScpXSlcbiAgICAgICAgICAgIF0pXG4gICAgICAgIF0sXG4gICAgICAgIGV4cG9ydEFzOiAna2VuZG9EaWFsb2cnLFxuICAgICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgICAgIExvY2FsaXphdGlvblNlcnZpY2UsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcHJvdmlkZTogRElBTE9HX0xPQ0FMSVpBVElPTl9TRVJWSUNFLFxuICAgICAgICAgICAgICAgIHVzZUV4aXN0aW5nOiBMb2NhbGl6YXRpb25TZXJ2aWNlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHByb3ZpZGU6IEwxME5fUFJFRklYLFxuICAgICAgICAgICAgICAgIHVzZVZhbHVlOiAna2VuZG8uZGlhbG9nJ1xuICAgICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBzZWxlY3RvcjogJ2tlbmRvLWRpYWxvZycsXG4gICAgICAgIHRlbXBsYXRlOiBgXG4gICAgICAgIDxuZy1jb250YWluZXJcbiAgICAgICAgICAgIGtlbmRvRGlhbG9nTG9jYWxpemVkTWVzc2FnZXNcbiAgICAgICAgICAgIGkxOG4tY2xvc2VUaXRsZT1cImtlbmRvLmRpYWxvZy5jbG9zZVRpdGxlfFRoZSB0aXRsZSBvZiB0aGUgY2xvc2UgYnV0dG9uXCJcbiAgICAgICAgICAgIGNsb3NlVGl0bGU9XCJDbG9zZVwiXG4gICAgICAgID5cbiAgICAgICAgPGRpdiBjbGFzcz1cImstb3ZlcmxheVwiIEBvdmVybGF5QXBwZWFyPjwvZGl2PlxuXG4gICAgICAgIDxkaXYgY2xhc3M9XCJrLXdpbmRvdyBrLWRpYWxvZ1wiIHJvbGU9XCJkaWFsb2dcIiBhcmlhLW1vZGFsPVwidHJ1ZVwiIFtuZ1N0eWxlXT1cInN0eWxlc1wiIEBkaWFsb2dTbGlkZUluQXBwZWFyPlxuICAgICAgICAgICAgPGtlbmRvLWRpYWxvZy10aXRsZWJhciAqbmdJZj1cInRpdGxlXCIgW2Nsb3NlVGl0bGVdPVwiY2xvc2VUaXRsZVwiIFtpZF09XCJ0aXRsZUlkXCI+e3sgdGl0bGUgfX08L2tlbmRvLWRpYWxvZy10aXRsZWJhcj5cbiAgICAgICAgICAgIDxuZy1jb250ZW50IHNlbGVjdD1cImtlbmRvLWRpYWxvZy10aXRsZWJhclwiICpuZ0lmPVwiIXRpdGxlXCI+PC9uZy1jb250ZW50PlxuXG4gICAgICAgICAgICA8ZGl2IFtpZF09XCJjb250ZW50SWRcIiBjbGFzcz1cImstY29udGVudCBrLXdpbmRvdy1jb250ZW50IGstZGlhbG9nLWNvbnRlbnRcIj5cbiAgICAgICAgICAgICAgICA8bmctY29udGVudCAqbmdJZj1cIiFjb250ZW50VGVtcGxhdGVcIj48L25nLWNvbnRlbnQ+XG4gICAgICAgICAgICAgICAgPG5nLXRlbXBsYXRlIFtuZ1RlbXBsYXRlT3V0bGV0XT1cImNvbnRlbnRUZW1wbGF0ZVwiICpuZ0lmPVwiY29udGVudFRlbXBsYXRlXCI+PC9uZy10ZW1wbGF0ZT5cbiAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICA8bmctY29udGVudCBzZWxlY3Q9XCJrZW5kby1kaWFsb2ctYWN0aW9uc1wiICpuZ0lmPVwiIWFjdGlvbnNcIj48L25nLWNvbnRlbnQ+XG4gICAgICAgICAgICA8a2VuZG8tZGlhbG9nLWFjdGlvbnMgKm5nSWY9XCJhY3Rpb25zXCIgW2FjdGlvbnNdPVwiYWN0aW9uc1wiIFtsYXlvdXRdPVwiYWN0aW9uc0xheW91dFwiPiA8L2tlbmRvLWRpYWxvZy1hY3Rpb25zPlxuICAgICAgICA8L2Rpdj5cbiAgICA8L25nLWNvbnRhaW5lcj5cbiAgICBgXG4gICAgfSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtFbGVtZW50UmVmLFxuICAgICAgICBSZW5kZXJlcjIsXG4gICAgICAgIExvY2FsaXphdGlvblNlcnZpY2UsXG4gICAgICAgIENoYW5nZURldGVjdG9yUmVmLFxuICAgICAgICBOZ1pvbmVdKVxuXSwgRGlhbG9nQ29tcG9uZW50KTtcblxuLyoqXG4gKiBUaGUgYmFzZSBjbGFzcyAgd2hpY2ggd2lsbCBiZSBleHRlbmRlZCBieSBhIGNvbXBvbmVudCB0aGF0IGlzIHByb3ZpZGVkIGFzIGNvbnRlbnQgdGhyb3VnaCBgY29udGVudGBcbiAqIChbc2VlIGV4YW1wbGVdKHslIHNsdWcgc2VydmljZV9kaWFsb2cgJX0jdG9jLXBhc3NpbmctdGl0bGUtY29udGVudC1hbmQtYWN0aW9ucy1hcy1hLXNpbmdsZS1jb21wb25lbnQpKS5cbiAqL1xuY2xhc3MgRGlhbG9nQ29udGVudEJhc2Uge1xuICAgIGNvbnN0cnVjdG9yKGRpYWxvZykge1xuICAgICAgICB0aGlzLmRpYWxvZyA9IGRpYWxvZztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZGlhbG9nVGl0bGVCYXIpIHtcbiAgICAgICAgICAgIC8vIHdoZW4gb3BlbmluZyBjb21wb25lbnQgaW5zaWRlIGRpYWxvZyB3aXRoIHNlcnZpY2UgQU5EIHRoZSBjb21wb25lbnQgaGFzIGRlZmluZWQgaXRzIG93biB0aXRsZWJhclxuICAgICAgICAgICAgdGhpcy5kaWFsb2dUaXRsZUJhci5jbG9zZS5waXBlKGZpbHRlcigoZSkgPT4gIWUuaXNEZWZhdWx0UHJldmVudGVkKCkpKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlhbG9nLmNsb3NlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5kaWFsb2dBY3Rpb25zKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kaWFsb2dBY3Rpb25zLmFjdGlvbnMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpYWxvZ0FjdGlvbnMuYWN0aW9uLnN1YnNjcmliZShhY3Rpb24gPT4gdGhpcy5kaWFsb2cuZGlhbG9nLmluc3RhbmNlLmFjdGlvbi5lbWl0KGFjdGlvbikpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuX19kZWNvcmF0ZShbXG4gICAgVmlld0NoaWxkKERpYWxvZ1RpdGxlQmFyQ29tcG9uZW50LCB7IHN0YXRpYzogZmFsc2UgfSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIERpYWxvZ1RpdGxlQmFyQ29tcG9uZW50KVxuXSwgRGlhbG9nQ29udGVudEJhc2UucHJvdG90eXBlLCBcImRpYWxvZ1RpdGxlQmFyXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBWaWV3Q2hpbGQoRGlhbG9nQWN0aW9uc0NvbXBvbmVudCwgeyBzdGF0aWM6IGZhbHNlIH0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBEaWFsb2dBY3Rpb25zQ29tcG9uZW50KVxuXSwgRGlhbG9nQ29udGVudEJhc2UucHJvdG90eXBlLCBcImRpYWxvZ0FjdGlvbnNcIiwgdm9pZCAwKTtcblxudmFyIERpYWxvZ0NvbnRhaW5lclNlcnZpY2VfMTtcbi8qKlxuICogQGhpZGRlblxuICovXG5sZXQgRGlhbG9nQ29udGFpbmVyU2VydmljZSA9IERpYWxvZ0NvbnRhaW5lclNlcnZpY2VfMSA9IGNsYXNzIERpYWxvZ0NvbnRhaW5lclNlcnZpY2Uge1xuICAgIHNldCBjb250YWluZXIoY29udGFpbmVyKSB7XG4gICAgICAgIERpYWxvZ0NvbnRhaW5lclNlcnZpY2VfMS5jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgfVxuICAgIGdldCBjb250YWluZXIoKSB7XG4gICAgICAgIHJldHVybiBEaWFsb2dDb250YWluZXJTZXJ2aWNlXzEuY29udGFpbmVyO1xuICAgIH1cbn07XG5EaWFsb2dDb250YWluZXJTZXJ2aWNlLmNvbnRhaW5lciA9IG51bGw7XG5EaWFsb2dDb250YWluZXJTZXJ2aWNlID0gRGlhbG9nQ29udGFpbmVyU2VydmljZV8xID0gX19kZWNvcmF0ZShbXG4gICAgSW5qZWN0YWJsZSgpXG5dLCBEaWFsb2dDb250YWluZXJTZXJ2aWNlKTtcblxuY29uc3QgaXNOb3RDb21wb25lbnQgPSAoY29tcG9uZW50KSA9PiBpc1N0cmluZyhjb21wb25lbnQpIHx8IGNvbXBvbmVudCBpbnN0YW5jZW9mIFRlbXBsYXRlUmVmO1xuY2xhc3MgRGlhbG9nSW5qZWN0b3Ige1xuICAgIGNvbnN0cnVjdG9yKGdldERpYWxvZ1JlZiwgcGFyZW50SW5qZWN0b3IpIHtcbiAgICAgICAgdGhpcy5nZXREaWFsb2dSZWYgPSBnZXREaWFsb2dSZWY7XG4gICAgICAgIHRoaXMucGFyZW50SW5qZWN0b3IgPSBwYXJlbnRJbmplY3RvcjtcbiAgICB9XG4gICAgZ2V0KHRva2VuLCBub3RGb3VuZFZhbHVlKSB7XG4gICAgICAgIGlmICh0b2tlbiA9PT0gRGlhbG9nUmVmKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXREaWFsb2dSZWYoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnRJbmplY3Rvci5nZXQodG9rZW4sIG5vdEZvdW5kVmFsdWUpO1xuICAgIH1cbn1cbi8qKlxuICogQSBzZXJ2aWNlIGZvciBvcGVuaW5nIERpYWxvZyB3aW5kb3dzIGR5bmFtaWNhbGx5XG4gKiAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIHNlcnZpY2VfZGlhbG9nICV9KSkuXG4gKi9cbmxldCBEaWFsb2dTZXJ2aWNlID0gY2xhc3MgRGlhbG9nU2VydmljZSB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIHJlc29sdmVyLCBjb250YWluZXJTZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMucmVzb2x2ZXIgPSByZXNvbHZlcjtcbiAgICAgICAgdGhpcy5jb250YWluZXJTZXJ2aWNlID0gY29udGFpbmVyU2VydmljZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogT3BlbnMgYSBEaWFsb2cgd2luZG93LiBSZXF1aXJlcyBhbiBlbGVtZW50IGluIHRoZSBhcHBsaWNhdGlvbiB0aGF0IHVzZXMgdGhlXG4gICAgICogW2BrZW5kb0RpYWxvZ0NvbnRhaW5lcmBdKHslIHNsdWcgYXBpX2RpYWxvZ19kaWFsb2djb250YWluZXJkaXJlY3RpdmUgJX0pIGRpcmVjdGl2ZS5cbiAgICAgKiBDcmVhdGVkIERpYWxvZ3Mgd2lsbCBiZSBtb3VudGVkIGluIHRoZSBET00gZGlyZWN0bHkgYWZ0ZXIgdGhhdCBlbGVtZW50LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtEaWFsb2dBY3Rpb259IG9wdGlvbnMgLSBUaGUgb3B0aW9ucyB0aGF0IGRlZmluZSB0aGUgRGlhbG9nLlxuICAgICAqIEByZXR1cm5zIHtEaWFsb2dSZWZ9IC0gQSByZWZlcmVuY2UgdG8gdGhlIERpYWxvZyBvYmplY3QgYW5kIHRoZSBjb252ZW5pZW5jZSBwcm9wZXJ0aWVzLlxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqIGBgYHRzLW5vLXJ1blxuICAgICAqIF9AQ29tcG9uZW50KHtcbiAgICAgKiAgIHNlbGVjdG9yOiAnbXktYXBwJyxcbiAgICAgKiAgIHRlbXBsYXRlOiBgXG4gICAgICogICAgIDxidXR0b24ga2VuZG9CdXR0b24gKGNsaWNrKT1cIm9wZW4oKVwiPkhhcm1sZXNzIGJ1dHRvbjwvYnV0dG9uPlxuICAgICAqICAgICA8ZGl2IGtlbmRvRGlhbG9nQ29udGFpbmVyPjwvZGl2PlxuICAgICAqICAgYFxuICAgICAqIH0pXG4gICAgICogZXhwb3J0IGNsYXNzIEFwcENvbXBvbmVudCB7XG4gICAgICogICAgIGNvbnN0cnVjdG9yKCBwcml2YXRlIGRpYWxvZ1NlcnZpY2U6IERpYWxvZ1NlcnZpY2UgKSB7fVxuICAgICAqXG4gICAgICogICAgIHB1YmxpYyBvcGVuKCkge1xuICAgICAqICAgICAgICAgdmFyIGRpYWxvZyA9IHRoaXMuZGlhbG9nU2VydmljZS5vcGVuKHtcbiAgICAgKiAgICAgICAgICAgdGl0bGU6IFwiUGxlYXNlIGNvbmZpcm1cIixcbiAgICAgKiAgICAgICAgICAgY29udGVudDogXCJBcmUgeW91IHN1cmU/XCIsXG4gICAgICogICAgICAgICAgIGFjdGlvbnM6IFtcbiAgICAgKiAgICAgICAgICAgICB7IHRleHQ6IFwiTm9cIiB9LFxuICAgICAqICAgICAgICAgICAgIHsgdGV4dDogXCJZZXNcIiwgdGhlbWVDb2xvcjogJ3ByaW1hcnknIH1cbiAgICAgKiAgICAgICAgICAgXVxuICAgICAqICAgICAgICAgfSk7XG4gICAgICpcbiAgICAgKiAgICAgICAgIGRpYWxvZy5yZXN1bHQuc3Vic2NyaWJlKChyZXN1bHQpID0+IHtcbiAgICAgKiAgICAgICAgICAgaWYgKHJlc3VsdCBpbnN0YW5jZW9mIERpYWxvZ0Nsb3NlUmVzdWx0KSB7XG4gICAgICogICAgICAgICAgICAgY29uc29sZS5sb2coXCJjbG9zZVwiKTtcbiAgICAgKiAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgKiAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImFjdGlvblwiLCByZXN1bHQpO1xuICAgICAqICAgICAgICAgICB9XG4gICAgICogICAgICAgICB9KTtcbiAgICAgKiAgICAgfVxuICAgICAqIH1cbiAgICAgKiBgYGBcbiAgICAgKlxuICAgICAqL1xuICAgIG9wZW4ob3B0aW9ucykge1xuICAgICAgICBjb25zdCBmYWN0b3J5ID0gdGhpcy5yZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShEaWFsb2dDb21wb25lbnQpO1xuICAgICAgICBjb25zdCBjb250YWluZXIgPSBvcHRpb25zLmFwcGVuZFRvIHx8IHRoaXMuY29udGFpbmVyU2VydmljZS5jb250YWluZXI7XG4gICAgICAgIGlmICghY29udGFpbmVyKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFxuQ2Fubm90IGF0dGFjaCBkaWFsb2cgdG8gdGhlIHBhZ2UuXG5BZGQgYW4gZWxlbWVudCB0aGF0IHVzZXMgdGhlIGtlbmRvRGlhbG9nQ29udGFpbmVyIGRpcmVjdGl2ZSwgb3Igc2V0IHRoZSAnYXBwZW5kVG8nIHByb3BlcnR5LlxuU2VlIGh0dHBzOi8vd3d3LnRlbGVyaWsuY29tL2tlbmRvLWFuZ3VsYXItdWkvY29tcG9uZW50cy9kaWFsb2dzL2RpYWxvZy9zZXJ2aWNlLy5cbiAgICAgICAgICBgKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBjcmVhdGUgRGlhbG9nUmVmIHRvICgxKSBwYXNzIGFzIHJlc3VsdCwgKDIpIHByb3ZpZGUgdGhyb3VnaCBpbmplY3RvclxuICAgICAgICBjb25zdCBkaWFsb2dSZWYgPSB7XG4gICAgICAgICAgICBjbG9zZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIC8qIG5vb3AgKi9cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZW50OiBudWxsLFxuICAgICAgICAgICAgZGlhbG9nOiBudWxsLFxuICAgICAgICAgICAgcmVzdWx0OiBudWxsXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB0aGlzLmluaXRpYWxpemVEaWFsb2cob3B0aW9ucy5jb250ZW50LCBmYWN0b3J5LCBjb250YWluZXIsIGRpYWxvZ1JlZiwgb3B0aW9ucyk7XG4gICAgfVxuICAgIGluaXRpYWxpemVEaWFsb2coY29tcG9uZW50LCBmYWN0b3J5LCBjb250YWluZXIsIGRpYWxvZ1JlZiwgb3B0aW9ucykge1xuICAgICAgICBjb25zdCBjb250ZW50ID0gdGhpcy5jb250ZW50RnJvbShjb21wb25lbnQsIGNvbnRhaW5lciwgZGlhbG9nUmVmKTtcbiAgICAgICAgY29uc3QgZGlhbG9nID0gY29udGFpbmVyLmNyZWF0ZUNvbXBvbmVudChmYWN0b3J5LCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgY29udGVudC5ub2Rlcyk7XG4gICAgICAgIGRpYWxvZ1JlZi5kaWFsb2cgPSBkaWFsb2c7XG4gICAgICAgIGRpYWxvZy5jaGFuZ2VEZXRlY3RvclJlZi5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgLy8gY29weSBASW5wdXQgb3B0aW9ucyB0byBkaWFsb2cgaW5zdGFuY2VcbiAgICAgICAgdGhpcy5hcHBseU9wdGlvbnMoZGlhbG9nLmluc3RhbmNlLCBvcHRpb25zKTtcbiAgICAgICAgLy8gY3JlYXRlIGNsb3NlIGhhbmRsZXIgYW5kIHJlc3VsdCBzdHJlYW1cbiAgICAgICAgY29uc3QgYXBpQ2xvc2UgPSBuZXcgU3ViamVjdCgpO1xuICAgICAgICBjb25zdCBjbG9zZSA9IChlKSA9PiB7XG4gICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIFByZXZlbnRhYmxlRXZlbnQpIHtcbiAgICAgICAgICAgICAgICBlID0gbmV3IERpYWxvZ0Nsb3NlUmVzdWx0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhcGlDbG9zZS5uZXh0KGUgfHwgbmV3IERpYWxvZ0Nsb3NlUmVzdWx0KCkpO1xuICAgICAgICAgICAgaWYgKGNvbnRlbnQuY29tcG9uZW50UmVmKSB7XG4gICAgICAgICAgICAgICAgY29udGVudC5jb21wb25lbnRSZWYuZGVzdHJveSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGlhbG9nLmRlc3Ryb3koKTtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gbWVyZ2UoYXBpQ2xvc2UsIFxuICAgICAgICAvLyB0cmlnZ2VyZWQgd2hlbiB0aGUgdGl0bGViYXIgb3IgYWN0aW9ucyBhcmUgZGVmaW5lZCBpbiBEaWFsb2dTZXR0aW5nc1xuICAgICAgICBtZXJnZShkaWFsb2cuaW5zdGFuY2UuY2xvc2UsIGRpYWxvZy5pbnN0YW5jZS5hY3Rpb24pLnBpcGUobWFwKGUgPT4gKGUgaW5zdGFuY2VvZiBQcmV2ZW50YWJsZUV2ZW50ID8gbmV3IERpYWxvZ0Nsb3NlUmVzdWx0KCkgOiBlKSksIGZpbHRlcihlID0+IHtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnByZXZlbnRBY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAvLyBhZGQgZGlhbG9nUmVmIG9ubHkgd2hlbiB1c2luZyBjb21wb25lbnRcbiAgICAgICAgICAgICAgICBjb25zdCBkaWFsb2dSZWZQYXJhbWV0ZXIgPSBpc05vdENvbXBvbmVudChjb21wb25lbnQpID8gdW5kZWZpbmVkIDogZGlhbG9nUmVmO1xuICAgICAgICAgICAgICAgIHJldHVybiAhb3B0aW9ucy5wcmV2ZW50QWN0aW9uKGUsIGRpYWxvZ1JlZlBhcmFtZXRlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSkpKS5waXBlKHRha2UoMSksIFxuICAgICAgICAvLyBUYWtlcyBjYXJlIGZvciBtdWx0aXBsZSBzdWJzY3JpcHRpb25zOlxuICAgICAgICAvLyBXZSBzdWJzY3JpYmUgaW50ZXJuYWx5IGFuZCB0aGUgdXNlciBtYXkgc3Vic2NyaWJlIHRvIGdldCBhIGNsb3NlIHJlc3VsdCAtIGRpYWxvZy5yZXN1bHQuc3Vic2NyaWJlKCkuXG4gICAgICAgIC8vIFRoaXMgY2F1c2VzIG11bHRpcGxlIHN1YnNjcmlwdGlvbnMgdG8gdGhlIHNhbWUgc291cmNlIGFuZCB0aHVzIG11bHRpcGxlIGVtaXNzaW9ucy4gc2hhcmUoKSBzb2x2ZXMgdGhhdC5cbiAgICAgICAgc2hhcmUoKSk7XG4gICAgICAgIHJlc3VsdC5zdWJzY3JpYmUoY2xvc2UpO1xuICAgICAgICBkaWFsb2dSZWYuY2xvc2UgPSBjbG9zZTtcbiAgICAgICAgZGlhbG9nUmVmLnJlc3VsdCA9IHJlc3VsdDtcbiAgICAgICAgaWYgKGNvbXBvbmVudCAmJiBpc0Rldk1vZGUoKSkge1xuICAgICAgICAgICAgY29uc3QgaGFzQ29udGVudFRpdGxlID0gY29udGVudC5ub2Rlc1swXSAmJiBjb250ZW50Lm5vZGVzWzBdLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICBjb25zdCBoYXNDb250ZW50QWN0aW9ucyA9IGNvbnRlbnQubm9kZXNbMl0gJiYgY29udGVudC5ub2Rlc1syXS5sZW5ndGggPiAwO1xuICAgICAgICAgICAgY29uc3QgbXVsdGlwbGVUaXRsZXMgPSBvcHRpb25zLnRpdGxlICYmIGhhc0NvbnRlbnRUaXRsZTtcbiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxlQWN0aW9ucyA9IG9wdGlvbnMuYWN0aW9ucyAmJiBoYXNDb250ZW50QWN0aW9ucztcbiAgICAgICAgICAgIGlmIChjb21wb25lbnQucHJvdG90eXBlIGluc3RhbmNlb2YgRGlhbG9nQ29udGVudEJhc2UpIHtcbiAgICAgICAgICAgICAgICAvLyBjb250ZW50IGNvbXBvbmVudCBleHRlbmRzIERpYWxvZ0NvbnRlbnRCYXNlXG4gICAgICAgICAgICAgICAgaWYgKG11bHRpcGxlVGl0bGVzIHx8IG11bHRpcGxlQWN0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFxuICAgICAgICAgICAgICAgICAgICBNdWx0aXBsZSBUaXRsZSBhbmQvb3IgQWN0aW9ucyBjb25maWd1cmF0aW9ucyBkZXRlY3RlZC5cbiAgICAgICAgICAgICAgICAgICAgV2hlbiB1c2luZyBhIGNvbXBvbmVudCBhcyBjb250ZW50LCBwcm92aWRlIHRoZSB0aXRsZSBhbmQgYWN0aW9ucyBlaXRoZXIgaW4gdGhlIGNvbXBvbmVudCdzIG1hcmt1cFxuICAgICAgICAgICAgICAgICAgICBvciB2aWEgdGhlIHRpdGxlIGFuZCBhY3Rpb25zIHByb3BlcnRpZXMgb2YgdGhlIERpYWxvZ1NldHRpbmdzIG9iamVjdCwgYnV0IG5vdCBib3RoLlxuICAgICAgICAgICAgICAgICAgICBTZWUgaHR0cHM6Ly93d3cudGVsZXJpay5jb20va2VuZG8tYW5ndWxhci11aS9jb21wb25lbnRzL2RpYWxvZ3MvZGlhbG9nL3NlcnZpY2UvI3RvYy1wYXNzaW5nLXRpdGxlLWNvbnRlbnQtYW5kLWFjdGlvbnMtYXMtYS1zaW5nbGUtY29tcG9uZW50J2ApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChoYXNDb250ZW50VGl0bGUgfHwgaGFzQ29udGVudEFjdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBcbiAgICAgICAgICAgICAgICAgICAgV2hlbiBUaXRsZSBhbmQvb3IgQWN0aW9ucyBtYXJrdXAgaXMgcHJvdmlkZWQgaW4gY29udGVudCBjb21wb25lbnQncyB0ZW1wbGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgdGhlIGNvbXBvbmVudCBuZWVkcyB0byBpbmhlcml0IHRoZSBEaWFsb2dDb250ZW50QmFzZSBjbGFzcyB0byBlbnN1cmUgdGhhdCBjbG9zZSBhbmQgcmVzdWx0IGV2ZW50cyBhcmUgcHJvcGVybHkgaG9va2VkLlxuICAgICAgICAgICAgICAgICAgICBTZWUgaHR0cHM6Ly93d3cudGVsZXJpay5jb20va2VuZG8tYW5ndWxhci11aS9jb21wb25lbnRzL2RpYWxvZ3MvZGlhbG9nL3NlcnZpY2UvI3RvYy1wYXNzaW5nLXRpdGxlLWNvbnRlbnQtYW5kLWFjdGlvbnMtYXMtYS1zaW5nbGUtY29tcG9uZW50J2ApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGlhbG9nUmVmO1xuICAgIH1cbiAgICBhcHBseU9wdGlvbnMoaW5zdGFuY2UsIG9wdGlvbnMpIHtcbiAgICAgICAgaW5zdGFuY2UudGl0bGUgPSBvcHRpb25zLnRpdGxlO1xuICAgICAgICBpbnN0YW5jZS5hY3Rpb25zID0gb3B0aW9ucy5hY3Rpb25zO1xuICAgICAgICBpbnN0YW5jZS5hY3Rpb25zTGF5b3V0ID0gb3B0aW9ucy5hY3Rpb25zTGF5b3V0IHx8ICdzdHJldGNoZWQnO1xuICAgICAgICBpbnN0YW5jZS53aWR0aCA9IG9wdGlvbnMud2lkdGg7XG4gICAgICAgIGluc3RhbmNlLm1pbldpZHRoID0gb3B0aW9ucy5taW5XaWR0aDtcbiAgICAgICAgaW5zdGFuY2UubWF4V2lkdGggPSBvcHRpb25zLm1heFdpZHRoO1xuICAgICAgICBpbnN0YW5jZS5oZWlnaHQgPSBvcHRpb25zLmhlaWdodDtcbiAgICAgICAgaW5zdGFuY2UubWluSGVpZ2h0ID0gb3B0aW9ucy5taW5IZWlnaHQ7XG4gICAgICAgIGluc3RhbmNlLm1heEhlaWdodCA9IG9wdGlvbnMubWF4SGVpZ2h0O1xuICAgICAgICBpbnN0YW5jZS5hdXRvRm9jdXNlZEVsZW1lbnQgPSBvcHRpb25zLmF1dG9Gb2N1c2VkRWxlbWVudDtcbiAgICAgICAgaW5zdGFuY2UuY2xvc2VUaXRsZSA9IG9wdGlvbnMuY2xvc2VUaXRsZTtcbiAgICAgICAgaW5zdGFuY2UuY3NzQ2xhc3MgPSBvcHRpb25zLmNzc0NsYXNzO1xuICAgICAgICBpbnN0YW5jZS5odG1sQXR0cmlidXRlcyA9IG9wdGlvbnMuaHRtbEF0dHJpYnV0ZXM7XG4gICAgICAgIGlmIChvcHRpb25zLmNvbnRlbnQgaW5zdGFuY2VvZiBUZW1wbGF0ZVJlZikge1xuICAgICAgICAgICAgaW5zdGFuY2UuY29udGVudFRlbXBsYXRlID0gb3B0aW9ucy5jb250ZW50O1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnRlbnRGcm9tKGNvbnRlbnQsIGNvbnRhaW5lciwgZGlhbG9nUmVmKSB7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gY29udGFpbmVyLmluamVjdG9yLmdldChSZW5kZXJlcjIpO1xuICAgICAgICBsZXQgbm9kZXMgPSBbXTtcbiAgICAgICAgbGV0IHRpdGxlTm9kZXMgPSBbXTtcbiAgICAgICAgbGV0IGFjdGlvbk5vZGVzID0gW107XG4gICAgICAgIGxldCBjb21wb25lbnRSZWYgPSBudWxsO1xuICAgICAgICBpZiAodHlwZW9mIGNvbnRlbnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBub2RlcyA9IFtyZW5kZXJlci5jcmVhdGVUZXh0KGNvbnRlbnQpXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb250ZW50ICYmICEoY29udGVudCBpbnN0YW5jZW9mIFRlbXBsYXRlUmVmKSkge1xuICAgICAgICAgICAgLy8gQ29tcG9uZW50XG4gICAgICAgICAgICBjb25zdCBpbmplY3RvciA9IG5ldyBEaWFsb2dJbmplY3RvcigoKSA9PiBkaWFsb2dSZWYsIGNvbnRhaW5lci5pbmplY3Rvcik7XG4gICAgICAgICAgICBjb25zdCBmYWN0b3J5ID0gdGhpcy5yZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShjb250ZW50KTtcbiAgICAgICAgICAgIGNvbXBvbmVudFJlZiA9IGNvbnRhaW5lci5jcmVhdGVDb21wb25lbnQoZmFjdG9yeSwgdW5kZWZpbmVkLCBpbmplY3Rvcik7XG4gICAgICAgICAgICB0aXRsZU5vZGVzID0gQXJyYXkuZnJvbShjb21wb25lbnRSZWYubG9jYXRpb24ubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCdrZW5kby1kaWFsb2ctdGl0bGViYXInKSk7XG4gICAgICAgICAgICBub2RlcyA9IFtjb21wb25lbnRSZWYubG9jYXRpb24ubmF0aXZlRWxlbWVudF07XG4gICAgICAgICAgICBhY3Rpb25Ob2RlcyA9IEFycmF5LmZyb20oY29tcG9uZW50UmVmLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgna2VuZG8tZGlhbG9nLWFjdGlvbnMnKSk7XG4gICAgICAgICAgICBkaWFsb2dSZWYuY29udGVudCA9IGNvbXBvbmVudFJlZjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29tcG9uZW50UmVmLFxuICAgICAgICAgICAgbm9kZXM6IFtcbiAgICAgICAgICAgICAgICB0aXRsZU5vZGVzLFxuICAgICAgICAgICAgICAgIG5vZGVzLFxuICAgICAgICAgICAgICAgIGFjdGlvbk5vZGVzIC8vIDxuZy1jb250ZW50IHNlbGVjdD1cImtlbmRvLWRpYWxvZy1hY3Rpb25zXCI+XG4gICAgICAgICAgICBdXG4gICAgICAgIH07XG4gICAgfVxufTtcbkRpYWxvZ1NlcnZpY2UgPSBfX2RlY29yYXRlKFtcbiAgICBJbmplY3RhYmxlKCksXG4gICAgX19wYXJhbSgxLCBJbmplY3QoRGlhbG9nQ29udGFpbmVyU2VydmljZSkpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICAgICAgICBEaWFsb2dDb250YWluZXJTZXJ2aWNlXSlcbl0sIERpYWxvZ1NlcnZpY2UpO1xuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xubGV0IG5ld1pJbmRleCA9IDEwMDAyO1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IERFRkFVTFRfT1BUSU9OUyA9IHtcbiAgICBkcmFnZ2FibGU6IHRydWUsXG4gICAgaGVpZ2h0OiBudWxsLFxuICAgIGxlZnQ6IG51bGwsXG4gICAgbWluSGVpZ2h0OiAxMDAsXG4gICAgbWluV2lkdGg6IDEyMCxcbiAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICByZXNpemFibGU6IHRydWUsXG4gICAgc3RhdGU6ICdkZWZhdWx0JyxcbiAgICB0b3A6IG51bGwsXG4gICAgd2lkdGg6IG51bGxcbn07XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgY3JlYXRlTW92ZVN0cmVhbSA9IChlbCwgZXYpID0+IG1vdXNlRG93biA9PiB7XG4gICAgcmV0dXJuIGVsLmtlbmRvRHJhZ1xuICAgICAgICAucGlwZSh0YWtlVW50aWwoZWwua2VuZG9SZWxlYXNlLnBpcGUodGFwKCgpID0+IHsgZXYuZW1pdCgpOyB9KSkpLCBtYXAoKHsgcGFnZVgsIHBhZ2VZIH0pID0+ICh7XG4gICAgICAgIG9yaWdpbmFsWDogbW91c2VEb3duLnBhZ2VYLFxuICAgICAgICBvcmlnaW5hbFk6IG1vdXNlRG93bi5wYWdlWSxcbiAgICAgICAgcGFnZVgsXG4gICAgICAgIHBhZ2VZXG4gICAgfSkpKTtcbn07XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xubGV0IERyYWdSZXNpemVTZXJ2aWNlID0gY2xhc3MgRHJhZ1Jlc2l6ZVNlcnZpY2Uge1xuICAgIGNvbnN0cnVjdG9yKG5nWm9uZSkge1xuICAgICAgICB0aGlzLm5nWm9uZSA9IG5nWm9uZTtcbiAgICAgICAgdGhpcy5jbG9zZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5mb2N1cyA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5jaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMuc3RhdGVDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMuZHJhZ1N0YXJ0ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLmRyYWdFbmQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMucmVzaXplU3RhcnQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMucmVzaXplRW5kID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX09QVElPTlMpO1xuICAgICAgICB0aGlzLmxhc3RBY3Rpb24gPSBudWxsO1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMgPSBuZXcgU3Vic2NyaXB0aW9uKCk7XG4gICAgICAgIHRoaXMuZHJhZ1N1YnNjcmlwdGlvbiA9IG5ldyBTdWJzY3JpcHRpb24oKTtcbiAgICB9XG4gICAgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbnMpIHtcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy51bnN1YnNjcmliZSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmRyYWdTdWJzY3JpcHRpb24pIHtcbiAgICAgICAgICAgIHRoaXMuZHJhZ1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGluaXQoZWwpIHtcbiAgICAgICAgY29uc3Qgc3RhdGUkJDEgPSB0aGlzLm9wdGlvbnMuc3RhdGU7XG4gICAgICAgIGxldCBvcHRpb25zID0gdGhpcy5vcHRpb25zO1xuICAgICAgICB0aGlzLndpbmRvdyA9IGVsO1xuICAgICAgICBpZiAoc3RhdGUkJDEgIT09ICdkZWZhdWx0Jykge1xuICAgICAgICAgICAgdGhpcy5yZXN0b3JlT3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzdGF0ZSQkMSA9PT0gJ21pbmltaXplZCcpIHtcbiAgICAgICAgICAgIG9wdGlvbnMuaGVpZ2h0ID0gMDtcbiAgICAgICAgICAgIG9wdGlvbnMubWluSGVpZ2h0ID0gMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3RhdGUkJDEgPT09ICdtYXhpbWl6ZWQnKSB7XG4gICAgICAgICAgICBvcHRpb25zLnBvc2l0aW9uID0gJ2ZpeGVkJztcbiAgICAgICAgfVxuICAgIH1cbiAgICBvbkRyYWcoZWwpIHtcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLmFkZCh0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgICAgICBsZXQgc3RhcnRQb3NpdGlvbjtcbiAgICAgICAgICAgIGxldCBkcmFnU3RhcnRlZDtcbiAgICAgICAgICAgIHRoaXMuZHJhZ1N1YnNjcmlwdGlvbiA9IGVsLmtlbmRvUHJlc3NcbiAgICAgICAgICAgICAgICAucGlwZSh0YXAoKGV2KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFldi5pc1RvdWNoKSB7XG4gICAgICAgICAgICAgICAgICAgIHByZXZlbnREZWZhdWx0KGV2KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5mb2N1cy5lbWl0KCk7XG4gICAgICAgICAgICAgICAgc3RhcnRQb3NpdGlvbiA9IHRoaXMuY3VycmVudFBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgZHJhZ1N0YXJ0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pLCBzd2l0Y2hNYXAoY3JlYXRlTW92ZVN0cmVhbShlbCwgdGhpcy5kcmFnRW5kKSkpXG4gICAgICAgICAgICAgICAgLnN1YnNjcmliZSgoeyBwYWdlWCwgcGFnZVksIG9yaWdpbmFsWCwgb3JpZ2luYWxZIH0pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWRyYWdTdGFydGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW5zdXJlV2lkdGgoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmFnU3RhcnQuZW1pdCgpO1xuICAgICAgICAgICAgICAgICAgICBkcmFnU3RhcnRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlRHJhZyh7XG4gICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsWCwgb3JpZ2luYWxZLFxuICAgICAgICAgICAgICAgICAgICBwYWdlWCwgcGFnZVksIHN0YXJ0UG9zaXRpb25cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGhhbmRsZURyYWcoeyBvcmlnaW5hbFgsIG9yaWdpbmFsWSwgcGFnZVgsIHBhZ2VZLCBzdGFydFBvc2l0aW9uIH0pIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLmxlZnQgPSBzdGFydFBvc2l0aW9uLnggKyBwYWdlWCAtIG9yaWdpbmFsWDtcbiAgICAgICAgdGhpcy5vcHRpb25zLnRvcCA9IHN0YXJ0UG9zaXRpb24ueSArIHBhZ2VZIC0gb3JpZ2luYWxZO1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnN0YXRlID09PSAnbWluaW1pemVkJyAmJiBpc1ByZXNlbnQodGhpcy5yZXN0b3JlT3B0aW9ucykpIHtcbiAgICAgICAgICAgIHRoaXMucmVzdG9yZU9wdGlvbnMubGVmdCA9IHRoaXMub3B0aW9ucy5sZWZ0O1xuICAgICAgICAgICAgdGhpcy5yZXN0b3JlT3B0aW9ucy50b3AgPSB0aGlzLm9wdGlvbnMudG9wO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2hhbmdlLmVtaXQoe1xuICAgICAgICAgICAgbGVmdDogc3RhcnRQb3NpdGlvbi54ICsgcGFnZVggLSBvcmlnaW5hbFgsXG4gICAgICAgICAgICB0b3A6IHN0YXJ0UG9zaXRpb24ueSArIHBhZ2VZIC0gb3JpZ2luYWxZXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBvblJlc2l6ZShoYW5kbGUsIGRpcmVjdGlvbikge1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMuYWRkKHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgICAgICAgIGxldCBzdGFydE9mZnNldEFuZFBvc2l0aW9uO1xuICAgICAgICAgICAgbGV0IHJlc2l6ZVN0YXJ0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIGhhbmRsZS5rZW5kb1ByZXNzLnBpcGUodGFwKChldikgPT4ge1xuICAgICAgICAgICAgICAgIHByZXZlbnREZWZhdWx0KGV2KTtcbiAgICAgICAgICAgICAgICB0aGlzLmZvY3VzLmVtaXQoKTtcbiAgICAgICAgICAgICAgICBzdGFydE9mZnNldEFuZFBvc2l0aW9uID0gdGhpcy5jdXJyZW50T2Zmc2V0QW5kUG9zaXRpb24oKTtcbiAgICAgICAgICAgICAgICByZXNpemVTdGFydGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9KSwgc3dpdGNoTWFwKGNyZWF0ZU1vdmVTdHJlYW0oaGFuZGxlLCB0aGlzLnJlc2l6ZUVuZCkpKVxuICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUoKHsgcGFnZVgsIHBhZ2VZLCBvcmlnaW5hbFgsIG9yaWdpbmFsWSB9KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXNpemVTdGFydGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVzaXplU3RhcnQuZW1pdChkaXJlY3Rpb24pO1xuICAgICAgICAgICAgICAgICAgICByZXNpemVTdGFydGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGV0IGRlbHRhWCA9IHBhZ2VYIC0gb3JpZ2luYWxYO1xuICAgICAgICAgICAgICAgIGxldCBkZWx0YVkgPSBwYWdlWSAtIG9yaWdpbmFsWTtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVJlc2l6ZShzdGFydE9mZnNldEFuZFBvc2l0aW9uLCBkaXJlY3Rpb24sIGRlbHRhWCwgZGVsdGFZKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGhhbmRsZVJlc2l6ZShpbml0aWFsLCBkaXIsIGRlbHRhWCwgZGVsdGFZKSB7XG4gICAgICAgIGNvbnN0IG9sZCA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgbGV0IGV2ID0ge307XG4gICAgICAgIGlmIChkaXIuaW5kZXhPZignZScpID49IDApIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld1dpZHRoID0gaW5pdGlhbC53aWR0aCArIGRlbHRhWDtcbiAgICAgICAgICAgIGlmIChuZXdXaWR0aCAhPT0gb2xkLndpZHRoICYmIG5ld1dpZHRoID49IG9sZC5taW5XaWR0aCkge1xuICAgICAgICAgICAgICAgIGV2LndpZHRoID0gbmV3V2lkdGg7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRpci5pbmRleE9mKCduJykgPj0gMCkge1xuICAgICAgICAgICAgY29uc3QgbmV3SGVpZ2h0ID0gaW5pdGlhbC5oZWlnaHQgLSBkZWx0YVk7XG4gICAgICAgICAgICBjb25zdCBuZXdUb3AgPSBpbml0aWFsLnkgKyBkZWx0YVk7XG4gICAgICAgICAgICBpZiAobmV3SGVpZ2h0ICE9PSBvbGQuaGVpZ2h0ICYmIG5ld0hlaWdodCA+PSBvbGQubWluSGVpZ2h0ICYmIG5ld1RvcCAhPT0gb2xkLnRvcCkge1xuICAgICAgICAgICAgICAgIGV2LmhlaWdodCA9IG5ld0hlaWdodDtcbiAgICAgICAgICAgICAgICBldi50b3AgPSBuZXdUb3A7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRpci5pbmRleE9mKCdzJykgPj0gMCkge1xuICAgICAgICAgICAgY29uc3QgbmV3SGVpZ2h0ID0gaW5pdGlhbC5oZWlnaHQgKyBkZWx0YVk7XG4gICAgICAgICAgICBpZiAobmV3SGVpZ2h0ICE9PSBvbGQuaGVpZ2h0ICYmIG5ld0hlaWdodCA+PSBvbGQubWluSGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgZXYuaGVpZ2h0ID0gbmV3SGVpZ2h0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChkaXIuaW5kZXhPZigndycpID49IDApIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld0xlZnQgPSBpbml0aWFsLnggKyBkZWx0YVg7XG4gICAgICAgICAgICBjb25zdCBuZXdXaWR0aCA9IGluaXRpYWwud2lkdGggLSBkZWx0YVg7XG4gICAgICAgICAgICBpZiAobmV3V2lkdGggIT09IG9sZC53aWR0aCAmJiBuZXdXaWR0aCA+PSBvbGQubWluV2lkdGggJiYgbmV3TGVmdCAhPT0gb2xkLmxlZnQpIHtcbiAgICAgICAgICAgICAgICBldi53aWR0aCA9IG5ld1dpZHRoO1xuICAgICAgICAgICAgICAgIGV2LmxlZnQgPSBuZXdMZWZ0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChpc1ByZXNlbnQoZXYud2lkdGgpIHx8IGlzUHJlc2VudChldi5oZWlnaHQpKSB7XG4gICAgICAgICAgICBPRkZTRVRfU1RZTEVTLmZvckVhY2goKHN0eWxlJCQxKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGlzUHJlc2VudChldltzdHlsZSQkMV0pKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9uc1tzdHlsZSQkMV0gPSBldltzdHlsZSQkMV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLmNoYW5nZS5lbWl0KGV2KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXN0b3JlQWN0aW9uKCkge1xuICAgICAgICB0aGlzLmxhc3RBY3Rpb24gPSAncmVzdG9yZSc7XG4gICAgICAgIHRoaXMuZGVmYXVsdFN0YXRlKCk7XG4gICAgfVxuICAgIGRlZmF1bHRTdGF0ZSgpIHtcbiAgICAgICAgaWYgKGlzUHJlc2VudCh0aGlzLnJlc3RvcmVPcHRpb25zKSkge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5yZXN0b3JlT3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5vcHRpb25zLnN0YXRlID0gJ2RlZmF1bHQnO1xuICAgICAgICB0aGlzLnN0YXRlQ2hhbmdlLmVtaXQoJ2RlZmF1bHQnKTtcbiAgICB9XG4gICAgc3RvcmVPcHRpb25zKCkge1xuICAgICAgICB0aGlzLnJlc3RvcmVPcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5vcHRpb25zKTtcbiAgICB9XG4gICAgbWF4aW1pemVBY3Rpb24oKSB7XG4gICAgICAgIHRoaXMubGFzdEFjdGlvbiA9ICdtYXhpbWl6ZSc7XG4gICAgICAgIHRoaXMubWF4aW1pemVTdGF0ZSgpO1xuICAgIH1cbiAgICBtYXhpbWl6ZVN0YXRlKCkge1xuICAgICAgICB0aGlzLnN0b3JlT3B0aW9ucygpO1xuICAgICAgICBjb25zdCB3bmQgPSB0aGlzLndpbmRvd1ZpZXdQb3J0O1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLm9wdGlvbnMsIHtcbiAgICAgICAgICAgIGhlaWdodDogd25kLmhlaWdodCxcbiAgICAgICAgICAgIGxlZnQ6IDAsXG4gICAgICAgICAgICBwb3NpdGlvbjogJ2ZpeGVkJyxcbiAgICAgICAgICAgIHN0YXRlOiAnbWF4aW1pemVkJyxcbiAgICAgICAgICAgIHRvcDogMCxcbiAgICAgICAgICAgIHdpZHRoOiB3bmQud2lkdGhcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc3RhdGVDaGFuZ2UuZW1pdCgnbWF4aW1pemVkJyk7XG4gICAgfVxuICAgIG1pbmltaXplQWN0aW9uKCkge1xuICAgICAgICB0aGlzLmxhc3RBY3Rpb24gPSAnbWluaW1pemUnO1xuICAgICAgICB0aGlzLm1pbmltaXplU3RhdGUoKTtcbiAgICB9XG4gICAgbWluaW1pemVTdGF0ZSgpIHtcbiAgICAgICAgdGhpcy5zdG9yZU9wdGlvbnMoKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5vcHRpb25zLCB7XG4gICAgICAgICAgICBoZWlnaHQ6IG51bGwsXG4gICAgICAgICAgICBtaW5IZWlnaHQ6IDAsXG4gICAgICAgICAgICBzdGF0ZTogJ21pbmltaXplZCdcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc3RhdGVDaGFuZ2UuZW1pdCgnbWluaW1pemVkJyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEhhbmRsZXMgbWFudWFsIGNoYW5nZXMgb2YgdGhlICdzdGF0ZScgcHJvcGVydHkuXG4gICAgICogUmVxdWlyZWQgdG8gZGlzdGluZ3Vpc2ggdGhlbSBmcm9tIGFjdGlvbiBjbGlja3MuXG4gICAgICovXG4gICAgYXBwbHlNYW51YWxTdGF0ZSgpIHtcbiAgICAgICAgY29uc3Qgc3RhdGUkJDEgPSB0aGlzLm9wdGlvbnMuc3RhdGU7XG4gICAgICAgIHN3aXRjaCAoc3RhdGUkJDEpIHtcbiAgICAgICAgICAgIGNhc2UgJ2RlZmF1bHQnOlxuICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJIZWlnaHQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmRlZmF1bHRTdGF0ZSgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnbWF4aW1pemVkJzpcbiAgICAgICAgICAgICAgICB0aGlzLmNsZWFySGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5tYXhpbWl6ZVN0YXRlKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdtaW5pbWl6ZWQnOlxuICAgICAgICAgICAgICAgIHRoaXMubWluaW1pemVTdGF0ZSgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICBjbG9zZUFjdGlvbigpIHtcbiAgICAgICAgdGhpcy5jbG9zZS5lbWl0KCk7XG4gICAgfVxuICAgIGVuc3VyZVdpZHRoKCkge1xuICAgICAgICBjb25zdCB3aW5kb3dPZmZzZXQgPSBvZmZzZXQodGhpcy53aW5kb3cubmF0aXZlRWxlbWVudCk7XG4gICAgICAgIGlmICghaXNQcmVzZW50KHRoaXMub3B0aW9ucy53aWR0aCkpIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy53aWR0aCA9IHdpbmRvd09mZnNldC53aWR0aDtcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlLmVtaXQoeyB3aWR0aDogd2luZG93T2Zmc2V0LndpZHRoIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNsZWFySGVpZ2h0KCkge1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmhlaWdodCA9PT0gMCkge1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMub3B0aW9ucy5oZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5taW5IZWlnaHQgPT09IDApIHtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLm9wdGlvbnMubWluSGVpZ2h0O1xuICAgICAgICB9XG4gICAgfVxuICAgIGNlbnRlcigpIHtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zdGF0ZSA9PT0gJ21heGltaXplZCcpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgc2Nyb2xsID0gc2Nyb2xsUG9zaXRpb24odGhpcy53aW5kb3cubmF0aXZlRWxlbWVudCk7XG4gICAgICAgIGxldCB3bmQgPSB0aGlzLndpbmRvd1ZpZXdQb3J0O1xuICAgICAgICBsZXQgd3JhcHBlciA9IG9mZnNldCh0aGlzLndpbmRvdy5uYXRpdmVFbGVtZW50KTtcbiAgICAgICAgbGV0IGV2ID0ge307XG4gICAgICAgIGlmICghaXNQcmVzZW50KHRoaXMub3B0aW9ucy5sZWZ0KSkge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmxlZnQgPSBzY3JvbGwueCArIE1hdGgubWF4KDAsICh3bmQud2lkdGggLSB3cmFwcGVyLndpZHRoKSAvIDIpO1xuICAgICAgICAgICAgZXYubGVmdCA9IHRoaXMub3B0aW9ucy5sZWZ0O1xuICAgICAgICB9XG4gICAgICAgIGlmICghaXNQcmVzZW50KHRoaXMub3B0aW9ucy50b3ApKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMudG9wID0gc2Nyb2xsLnkgKyBNYXRoLm1heCgwLCAod25kLmhlaWdodCAtIHdyYXBwZXIuaGVpZ2h0KSAvIDIpO1xuICAgICAgICAgICAgZXYudG9wID0gdGhpcy5vcHRpb25zLnRvcDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNoYW5nZS5lbWl0KGV2KTtcbiAgICB9XG4gICAgY3VycmVudE9mZnNldEFuZFBvc2l0aW9uKCkge1xuICAgICAgICBjb25zdCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICBjb25zdCBvZmYgPSBvZmZzZXQodGhpcy53aW5kb3cubmF0aXZlRWxlbWVudCk7XG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmN1cnJlbnRQb3NpdGlvbigpLCB7XG4gICAgICAgICAgICBoZWlnaHQ6IG8uaGVpZ2h0ID8gby5oZWlnaHQgOiBvZmYuaGVpZ2h0LFxuICAgICAgICAgICAgd2lkdGg6IG8ud2lkdGggPyBvLndpZHRoIDogb2ZmLndpZHRoXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjdXJyZW50UG9zaXRpb24oKSB7XG4gICAgICAgIGNvbnN0IG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgIGlmICghby50b3AgfHwgIW8ubGVmdCkge1xuICAgICAgICAgICAgdGhpcy5zZXRQb3NpdGlvbigpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB4OiB0aGlzLm9wdGlvbnMubGVmdCxcbiAgICAgICAgICAgIHk6IHRoaXMub3B0aW9ucy50b3BcbiAgICAgICAgfTtcbiAgICB9XG4gICAgc2V0UG9zaXRpb24oKSB7XG4gICAgICAgIGNvbnN0IHdyYXBwZXIgPSBwb3NpdGlvbldpdGhTY3JvbGwodGhpcy53aW5kb3cubmF0aXZlRWxlbWVudCwgZ2V0RG9jdW1lbnRFbGVtZW50KHRoaXMud2luZG93Lm5hdGl2ZUVsZW1lbnQpKTtcbiAgICAgICAgdGhpcy5vcHRpb25zLmxlZnQgPSB3cmFwcGVyLmxlZnQ7XG4gICAgICAgIHRoaXMub3B0aW9ucy50b3AgPSB3cmFwcGVyLnRvcDtcbiAgICB9XG4gICAgc2V0UmVzdG9yZU9wdGlvbihzdHlsZSQkMSwgdmFsdWUpIHtcbiAgICAgICAgaWYgKGlzUHJlc2VudCh0aGlzLnJlc3RvcmVPcHRpb25zKSkge1xuICAgICAgICAgICAgdGhpcy5yZXN0b3JlT3B0aW9uc1tzdHlsZSQkMV0gPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgbmV4dFBvc3NpYmxlWkluZGV4KCkge1xuICAgICAgICByZXR1cm4gbmV3WkluZGV4O1xuICAgIH1cbiAgICBnZXQgbmV4dFpJbmRleCgpIHtcbiAgICAgICAgcmV0dXJuIG5ld1pJbmRleCsrO1xuICAgIH1cbiAgICBnZXQgd2luZG93Vmlld1BvcnQoKSB7XG4gICAgICAgIHJldHVybiBnZXRXaW5kb3dWaWV3UG9ydCh0aGlzLndpbmRvdy5uYXRpdmVFbGVtZW50KTtcbiAgICB9XG59O1xuRHJhZ1Jlc2l6ZVNlcnZpY2UgPSBfX2RlY29yYXRlKFtcbiAgICBJbmplY3RhYmxlKCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtOZ1pvbmVdKVxuXSwgRHJhZ1Jlc2l6ZVNlcnZpY2UpO1xuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xubGV0IFJlc2l6ZUhhbmRsZURpcmVjdGl2ZSA9IGNsYXNzIFJlc2l6ZUhhbmRsZURpcmVjdGl2ZSB7XG4gICAgY29uc3RydWN0b3IoZHJhZ2dhYmxlLCBlbCwgcmVuZGVyZXIsIHNlcnZpY2UpIHtcbiAgICAgICAgdGhpcy5kcmFnZ2FibGUgPSBkcmFnZ2FibGU7XG4gICAgICAgIHRoaXMuZWwgPSBlbDtcbiAgICAgICAgdGhpcy5yZW5kZXJlciA9IHJlbmRlcmVyO1xuICAgICAgICB0aGlzLnNlcnZpY2UgPSBzZXJ2aWNlO1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMgPSBuZXcgU3Vic2NyaXB0aW9uKCk7XG4gICAgfVxuICAgIGdldCBob3N0Q2xhc3MoKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5zZXREaXNwbGF5KCk7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnay1yZXNpemUtJyArIHRoaXMuZGlyZWN0aW9uKTtcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLmFkZChvZih0aGlzLmRyYWdnYWJsZSkuc3Vic2NyaWJlKGhhbmRsZSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNlcnZpY2Uub25SZXNpemUoaGFuZGxlLCB0aGlzLmRpcmVjdGlvbik7XG4gICAgICAgIH0pKTtcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLmFkZCh0aGlzLnNlcnZpY2UucmVzaXplU3RhcnQuc3Vic2NyaWJlKChkaXIpID0+IHtcbiAgICAgICAgICAgIGlmIChkaXIgIT09IHRoaXMuZGlyZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXREaXNwbGF5KCdub25lJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKTtcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLmFkZCh0aGlzLnNlcnZpY2UuZHJhZ1N0YXJ0LnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNldERpc3BsYXkoJ25vbmUnKTtcbiAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMuYWRkKG1lcmdlKHRoaXMuc2VydmljZS5yZXNpemVFbmQsIHRoaXMuc2VydmljZS5kcmFnRW5kKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXREaXNwbGF5KCdibG9jaycpO1xuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5hZGQodGhpcy5zZXJ2aWNlLnN0YXRlQ2hhbmdlLnN1YnNjcmliZSgoc3RhdGUkJDEpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2V0RGlzcGxheShzdGF0ZSQkMSA9PT0gJ2RlZmF1bHQnID8gJ2Jsb2NrJyA6ICdub25lJyk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgICBzZXREaXNwbGF5KHZhbHVlID0gJ2Jsb2NrJykge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2Rpc3BsYXknLCB0aGlzLnNlcnZpY2Uub3B0aW9ucy5zdGF0ZSA9PT0gJ2RlZmF1bHQnID8gdmFsdWUgOiAnbm9uZScpO1xuICAgIH1cbn07XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpXG5dLCBSZXNpemVIYW5kbGVEaXJlY3RpdmUucHJvdG90eXBlLCBcImRpcmVjdGlvblwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdEJpbmRpbmcoJ2NsYXNzLmstcmVzaXplLWhhbmRsZScpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBCb29sZWFuKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW10pXG5dLCBSZXNpemVIYW5kbGVEaXJlY3RpdmUucHJvdG90eXBlLCBcImhvc3RDbGFzc1wiLCBudWxsKTtcblJlc2l6ZUhhbmRsZURpcmVjdGl2ZSA9IF9fZGVjb3JhdGUoW1xuICAgIERpcmVjdGl2ZSh7XG4gICAgICAgIHNlbGVjdG9yOiAnW2tlbmRvV2luZG93UmVzaXplSGFuZGxlXSdcbiAgICB9KSxcbiAgICBfX3BhcmFtKDAsIEhvc3QoKSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtEcmFnZ2FibGVEaXJlY3RpdmUsXG4gICAgICAgIEVsZW1lbnRSZWYsXG4gICAgICAgIFJlbmRlcmVyMixcbiAgICAgICAgRHJhZ1Jlc2l6ZVNlcnZpY2VdKVxuXSwgUmVzaXplSGFuZGxlRGlyZWN0aXZlKTtcblxubGV0IFdpbmRvd1RpdGxlQmFyQ29tcG9uZW50ID0gY2xhc3MgV2luZG93VGl0bGVCYXJDb21wb25lbnQge1xuICAgIGNvbnN0cnVjdG9yKGVsLCBzZXJ2aWNlLCBuZ1pvbmUpIHtcbiAgICAgICAgdGhpcy5lbCA9IGVsO1xuICAgICAgICB0aGlzLm5nWm9uZSA9IG5nWm9uZTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlID0gc2VydmljZTtcbiAgICB9XG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMuZHJhZ0RpcmVjdGl2ZSA9IG5ldyBEcmFnZ2FibGVEaXJlY3RpdmUodGhpcy5lbCwgdGhpcy5uZ1pvbmUpO1xuICAgICAgICB0aGlzLmRyYWdEaXJlY3RpdmUubmdPbkluaXQoKTtcbiAgICAgICAgaWYgKHRoaXMuaXNEcmFnZ2FibGUpIHtcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlRHJhZygpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3Vic2NyaWJlU3RhdGVDaGFuZ2UoKTtcbiAgICB9XG4gICAgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuZHJhZ0RpcmVjdGl2ZS5uZ09uRGVzdHJveSgpO1xuICAgICAgICB0aGlzLnVuc3Vic2NyaWJlRHJhZygpO1xuICAgICAgICB0aGlzLnVuc3Vic2NyaWJlU3RhdGUoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIHN1YnNjcmliZURyYWcoKSB7XG4gICAgICAgIHRoaXMudW5zdWJzY3JpYmVEcmFnKCk7XG4gICAgICAgIHRoaXMuZHJhZ1N1YnNjcmlwdGlvbiA9IG9mKHRoaXMuZHJhZ0RpcmVjdGl2ZSkuc3Vic2NyaWJlKHRpdGxlQmFyID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2VydmljZS5vbkRyYWcodGl0bGVCYXIpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIHN1YnNjcmliZVN0YXRlQ2hhbmdlKCkge1xuICAgICAgICB0aGlzLnN0YXRlU3Vic2NyaXB0aW9uID0gdGhpcy5zZXJ2aWNlLnN0YXRlQ2hhbmdlLnN1YnNjcmliZSgoc3RhdGUkJDEpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLnNlcnZpY2Uub3B0aW9ucy5kcmFnZ2FibGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoc3RhdGUkJDEgPT09ICdtYXhpbWl6ZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudW5zdWJzY3JpYmVEcmFnKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN1YnNjcmliZURyYWcoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgdW5zdWJzY3JpYmVEcmFnKCkge1xuICAgICAgICBpZiAodGhpcy5kcmFnU3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLnNlcnZpY2UuZHJhZ1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgdGhpcy5kcmFnU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICB0aGlzLmRyYWdTdWJzY3JpcHRpb24gPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICB1bnN1YnNjcmliZVN0YXRlKCkge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZVN1YnNjcmlwdGlvbikge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgdGhpcy5zdGF0ZVN1YnNjcmlwdGlvbiA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGNsYXNzTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGdldCB0b3VjaEFjdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNEcmFnZ2FibGUpIHtcbiAgICAgICAgICAgIHJldHVybiAnbm9uZSc7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIGhhbmRsZShldikge1xuICAgICAgICBjb25zdCB0YXJnZXQgPSBldi50YXJnZXQ7XG4gICAgICAgIGNvbnN0IHN0YXRlJCQxID0gdGhpcy5zZXJ2aWNlLm9wdGlvbnMuc3RhdGU7XG4gICAgICAgIGlmICghaGFzQ2xhc3Nlcyh0YXJnZXQsICdrLWljb24nKSAmJiAhaXNGb2N1c2FibGUodGFyZ2V0LCBmYWxzZSkgJiYgdGhpcy5zZXJ2aWNlLm9wdGlvbnMucmVzaXphYmxlKSB7XG4gICAgICAgICAgICBpZiAoc3RhdGUkJDEgPT09ICdkZWZhdWx0Jykge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VydmljZS5tYXhpbWl6ZUFjdGlvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoc3RhdGUkJDEgPT09ICdtYXhpbWl6ZWQnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXJ2aWNlLnJlc3RvcmVBY3Rpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgaXNEcmFnZ2FibGUoKSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLnNlcnZpY2Uub3B0aW9ucztcbiAgICAgICAgcmV0dXJuIG9wdGlvbnMuZHJhZ2dhYmxlICYmIG9wdGlvbnMuc3RhdGUgIT09ICdtYXhpbWl6ZWQnO1xuICAgIH1cbn07XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBUZW1wbGF0ZVJlZilcbl0sIFdpbmRvd1RpdGxlQmFyQ29tcG9uZW50LnByb3RvdHlwZSwgXCJ0ZW1wbGF0ZVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdEJpbmRpbmcoJ2NsYXNzLmstd2luZG93LXRpdGxlYmFyJyksXG4gICAgSG9zdEJpbmRpbmcoJ2NsYXNzLmstZGlhbG9nLXRpdGxlYmFyJyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEJvb2xlYW4pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbXSlcbl0sIFdpbmRvd1RpdGxlQmFyQ29tcG9uZW50LnByb3RvdHlwZSwgXCJjbGFzc05hbWVcIiwgbnVsbCk7XG5fX2RlY29yYXRlKFtcbiAgICBIb3N0QmluZGluZygnc3R5bGUudG91Y2gtYWN0aW9uJyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFN0cmluZyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtdKVxuXSwgV2luZG93VGl0bGVCYXJDb21wb25lbnQucHJvdG90eXBlLCBcInRvdWNoQWN0aW9uXCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdExpc3RlbmVyKCdkYmxjbGljaycsIFsnJGV2ZW50J10pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBGdW5jdGlvbiksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtPYmplY3RdKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnJldHVybnR5cGVcIiwgdm9pZCAwKVxuXSwgV2luZG93VGl0bGVCYXJDb21wb25lbnQucHJvdG90eXBlLCBcImhhbmRsZVwiLCBudWxsKTtcbldpbmRvd1RpdGxlQmFyQ29tcG9uZW50ID0gX19kZWNvcmF0ZShbXG4gICAgQ29tcG9uZW50KHtcbiAgICAgICAgc2VsZWN0b3I6ICdrZW5kby13aW5kb3ctdGl0bGViYXInLFxuICAgICAgICB0ZW1wbGF0ZTogYFxuICAgIDxuZy1jb250ZW50ICpuZ0lmPVwiIXRlbXBsYXRlXCI+PC9uZy1jb250ZW50PlxuICAgIDxuZy10ZW1wbGF0ZVxuICAgICAgW25nVGVtcGxhdGVPdXRsZXRdPVwidGVtcGxhdGVcIlxuICAgICAgW25nVGVtcGxhdGVPdXRsZXRDb250ZXh0XT1cInsnJGltcGxpY2l0Jzogc2VydmljZX1cIiAqbmdJZj1cInRlbXBsYXRlXCI+XG4gICAgPC9uZy10ZW1wbGF0ZT5cbiAgYFxuICAgIH0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbRWxlbWVudFJlZiwgRHJhZ1Jlc2l6ZVNlcnZpY2UsIE5nWm9uZV0pXG5dLCBXaW5kb3dUaXRsZUJhckNvbXBvbmVudCk7XG5cbi8qKlxuICogQGhpZGRlblxuICovXG5sZXQgTmF2aWdhdGlvblNlcnZpY2UgPSBjbGFzcyBOYXZpZ2F0aW9uU2VydmljZSB7XG4gICAgY29uc3RydWN0b3Iod2luZG93LCBuZ1pvbmUpIHtcbiAgICAgICAgdGhpcy53aW5kb3cgPSB3aW5kb3c7XG4gICAgICAgIHRoaXMubmdab25lID0gbmdab25lO1xuICAgIH1cbiAgICBwcm9jZXNzKGV2KSB7XG4gICAgICAgIGNvbnN0IGtleSA9IGV2LmtleUNvZGU7XG4gICAgICAgIHN3aXRjaCAoa2V5KSB7XG4gICAgICAgICAgICBjYXNlIEtleXMudXA6XG4gICAgICAgICAgICBjYXNlIEtleXMuZG93bjpcbiAgICAgICAgICAgIGNhc2UgS2V5cy5sZWZ0OlxuICAgICAgICAgICAgY2FzZSBLZXlzLnJpZ2h0OiB7XG4gICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUFycm93KGtleSwgZXYpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBLZXlzLmVzYzpcbiAgICAgICAgICAgICAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUVzY2FwZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICBoYW5kbGVBcnJvdyhrZXksIGV2KSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLndpbmRvdy5vcHRpb25zO1xuICAgICAgICBpZiAoZXYuYWx0S2V5KSB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZVN0YXRlQ2hhbmdlKGtleSwgb3B0aW9ucy5zdGF0ZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKChldi5jdHJsS2V5IHx8IGV2Lm1ldGFLZXkpICYmIG9wdGlvbnMuc3RhdGUgPT09ICdkZWZhdWx0Jykge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXNpemUoa2V5KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRHJhZyhrZXkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGhhbmRsZUVzY2FwZSgpIHtcbiAgICAgICAgdGhpcy53aW5kb3cuY2xvc2VBY3Rpb24oKTtcbiAgICB9XG4gICAgaGFuZGxlRHJhZyhrZXkpIHtcbiAgICAgICAgbGV0IG9wdGlvbnMgPSB0aGlzLndpbmRvdy5vcHRpb25zO1xuICAgICAgICBpZiAoIW9wdGlvbnMuZHJhZ2dhYmxlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgb2Zmc2V0JCQxID0gdGhpcy53aW5kb3cuY3VycmVudE9mZnNldEFuZFBvc2l0aW9uKCk7XG4gICAgICAgIGxldCByZXN0b3JlT3B0aW9ucyA9IHRoaXMud2luZG93LnJlc3RvcmVPcHRpb25zO1xuICAgICAgICBsZXQgZXYgPSB7fTtcbiAgICAgICAgbGV0IGRlbHRhID0gMTA7XG4gICAgICAgIGlmIChrZXkgPT09IEtleXMubGVmdCB8fCBrZXkgPT09IEtleXMudXApIHtcbiAgICAgICAgICAgIGRlbHRhICo9IC0xO1xuICAgICAgICB9XG4gICAgICAgIHN3aXRjaCAoa2V5KSB7XG4gICAgICAgICAgICBjYXNlIEtleXMubGVmdDpcbiAgICAgICAgICAgIGNhc2UgS2V5cy5yaWdodDoge1xuICAgICAgICAgICAgICAgIGV2LmxlZnQgPSBvZmZzZXQkJDEueCArIGRlbHRhO1xuICAgICAgICAgICAgICAgIG9wdGlvbnMubGVmdCA9IGV2LmxlZnQ7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIEtleXMudXA6XG4gICAgICAgICAgICBjYXNlIEtleXMuZG93bjoge1xuICAgICAgICAgICAgICAgIGV2LnRvcCA9IG9mZnNldCQkMS55ICsgZGVsdGE7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy50b3AgPSBldi50b3A7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLnN0YXRlID09PSAnbWluaW1pemVkJyAmJiBpc1ByZXNlbnQocmVzdG9yZU9wdGlvbnMpKSB7XG4gICAgICAgICAgICByZXN0b3JlT3B0aW9ucy5sZWZ0ID0gb3B0aW9ucy5sZWZ0O1xuICAgICAgICAgICAgcmVzdG9yZU9wdGlvbnMudG9wID0gb3B0aW9ucy50b3A7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy53aW5kb3cuY2hhbmdlLmVtaXQoZXYpO1xuICAgIH1cbiAgICBoYW5kbGVSZXNpemUoa2V5KSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLndpbmRvdy5vcHRpb25zO1xuICAgICAgICBpZiAoIW9wdGlvbnMucmVzaXphYmxlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgb2Zmc2V0JCQxID0gdGhpcy53aW5kb3cuY3VycmVudE9mZnNldEFuZFBvc2l0aW9uKCk7XG4gICAgICAgIGxldCBuZXdXaWR0aDtcbiAgICAgICAgbGV0IG5ld0hlaWdodDtcbiAgICAgICAgbGV0IGV2ID0ge307XG4gICAgICAgIGxldCBkZWx0YSA9IDEwO1xuICAgICAgICBpZiAoa2V5ID09PSBLZXlzLmxlZnQgfHwga2V5ID09PSBLZXlzLnVwKSB7XG4gICAgICAgICAgICBkZWx0YSAqPSAtMTtcbiAgICAgICAgfVxuICAgICAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgICAgICAgY2FzZSBLZXlzLmxlZnQ6XG4gICAgICAgICAgICBjYXNlIEtleXMucmlnaHQ6IHtcbiAgICAgICAgICAgICAgICBuZXdXaWR0aCA9IG9mZnNldCQkMS53aWR0aCArIGRlbHRhO1xuICAgICAgICAgICAgICAgIGlmIChuZXdXaWR0aCAhPT0gb3B0aW9ucy53aWR0aCAmJiBuZXdXaWR0aCA+PSBvcHRpb25zLm1pbldpZHRoKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2LndpZHRoID0gbmV3V2lkdGg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBLZXlzLnVwOlxuICAgICAgICAgICAgY2FzZSBLZXlzLmRvd246IHtcbiAgICAgICAgICAgICAgICBuZXdIZWlnaHQgPSBvZmZzZXQkJDEuaGVpZ2h0ICsgZGVsdGE7XG4gICAgICAgICAgICAgICAgaWYgKG5ld0hlaWdodCAhPT0gb3B0aW9ucy5oZWlnaHQgJiYgbmV3SGVpZ2h0ID49IG9wdGlvbnMubWluSGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgICAgIGV2LmhlaWdodCA9IG5ld0hlaWdodDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1ByZXNlbnQoZXYud2lkdGgpIHx8IGlzUHJlc2VudChldi5oZWlnaHQpKSB7XG4gICAgICAgICAgICBPRkZTRVRfU1RZTEVTLmZvckVhY2goKHN0eWxlJCQxKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGlzUHJlc2VudChldltzdHlsZSQkMV0pKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMud2luZG93Lm9wdGlvbnNbc3R5bGUkJDFdID0gZXZbc3R5bGUkJDFdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy53aW5kb3cuY2hhbmdlLmVtaXQoZXYpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGhhbmRsZVN0YXRlQ2hhbmdlKGtleSwgc3RhdGUkJDEpIHtcbiAgICAgICAgaWYgKChzdGF0ZSQkMSA9PT0gJ21pbmltaXplZCcgJiYga2V5ID09PSBLZXlzLnVwKSB8fFxuICAgICAgICAgICAgKHN0YXRlJCQxID09PSAnbWF4aW1pemVkJyAmJiBrZXkgPT09IEtleXMuZG93bikpIHtcbiAgICAgICAgICAgIHRoaXMud2luZG93LnJlc3RvcmVBY3Rpb24oKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3RhdGUkJDEgPT09ICdkZWZhdWx0Jykge1xuICAgICAgICAgICAgaWYgKGtleSA9PT0gS2V5cy51cCkge1xuICAgICAgICAgICAgICAgIHRoaXMud2luZG93Lm1heGltaXplQWN0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChrZXkgPT09IEtleXMuZG93bikge1xuICAgICAgICAgICAgICAgIHRoaXMud2luZG93Lm1pbmltaXplQWN0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59O1xuTmF2aWdhdGlvblNlcnZpY2UgPSBfX2RlY29yYXRlKFtcbiAgICBJbmplY3RhYmxlKCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtEcmFnUmVzaXplU2VydmljZSxcbiAgICAgICAgTmdab25lXSlcbl0sIE5hdmlnYXRpb25TZXJ2aWNlKTtcblxuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBbS2VuZG8gVUkgV2luZG93IGNvbXBvbmVudCBmb3IgQW5ndWxhcl0oeyUgc2x1ZyBvdmVydmlld193aW5kb3dfZGlhbG9ncyAlfSkuXG4gKi9cbmxldCBXaW5kb3dDb21wb25lbnQgPSBjbGFzcyBXaW5kb3dDb21wb25lbnQge1xuICAgIGNvbnN0cnVjdG9yKGVsLCByZW5kZXJlciwgc2VydmljZSwgbmF2aWdhdGlvbiwgbmdab25lLCBsb2NhbGl6YXRpb24pIHtcbiAgICAgICAgdGhpcy5lbCA9IGVsO1xuICAgICAgICB0aGlzLnJlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgICAgIHRoaXMuc2VydmljZSA9IHNlcnZpY2U7XG4gICAgICAgIHRoaXMubmF2aWdhdGlvbiA9IG5hdmlnYXRpb247XG4gICAgICAgIHRoaXMubmdab25lID0gbmdab25lO1xuICAgICAgICB0aGlzLmxvY2FsaXphdGlvbiA9IGxvY2FsaXphdGlvbjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNwZWNpZmllcyBpZiB0aGUgY29udGVudCBvZiB0aGUgY29tcG9uZW50IGlzIHBlcnNpc3RlZCBpbiB0aGUgRE9NIHdoZW4gbWluaW1pemVkLlxuICAgICAgICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5rZWVwQ29udGVudCA9IGZhbHNlO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiB0aGUgdXNlciBzdGFydHMgdG8gbW92ZSB0aGUgV2luZG93LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kcmFnU3RhcnQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyB3aGVuIHRoZSBXaW5kb3cgd2FzIG1vdmVkIGJ5IHRoZSB1c2VyLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kcmFnRW5kID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiB0aGUgdXNlciBzdGFydHMgdG8gcmVzaXplIHRoZSBXaW5kb3cuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnJlc2l6ZVN0YXJ0ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiB0aGUgV2luZG93IHdhcyByZXNpemVkIGJ5IHRoZSB1c2VyLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5yZXNpemVFbmQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyB3aGVuIHRoZSB1c2VyIGNsb3NlcyB0aGUgV2luZG93LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jbG9zZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gdGhlIGB3aWR0aGAgcHJvcGVydHkgb2YgdGhlIGNvbXBvbmVudCB3YXMgdXBkYXRlZC4gVGhlIGV2ZW50IGlzIHRyaWdnZXJlZCBvbmx5IGFmdGVyIHRoZSByZXNpemluZ1xuICAgICAgICAgKiBoYXMgZW5kZWQuIFRoZSBldmVudCBkYXRhIGNvbnRhaW5zIHRoZSBuZXcgd2lkdGguIEFsbG93cyBhIHR3by13YXkgYmluZGluZyBvZiB0aGUgYHdpZHRoYCBwcm9wZXJ0eS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMud2lkdGhDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyB3aGVuIHRoZSBgaGVpZ2h0YCBwcm9wZXJ0eSBvZiB0aGUgY29tcG9uZW50IHdhcyB1cGRhdGVkLiBUaGUgZXZlbnQgaXMgdHJpZ2dlcmVkIG9ubHkgYWZ0ZXIgdGhlIHJlc2l6aW5nXG4gICAgICAgICAqIGhhcyBlbmRlZC4gVGhlIGV2ZW50IGRhdGEgY29udGFpbnMgdGhlIG5ldyBoZWlnaHQuIEFsbG93cyBhIHR3by13YXkgYmluZGluZyBvZiB0aGUgYGhlaWdodGAgcHJvcGVydHkuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmhlaWdodENoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gdGhlIGB0b3BgIHByb3BlcnR5IG9mIHRoZSBjb21wb25lbnQgd2FzIHVwZGF0ZWQuIFRoZSBldmVudCBpcyB0cmlnZ2VyZWQgb25seSBhZnRlciB0aGUgZHJhZ2dpbmdcbiAgICAgICAgICogYW5kIHJlc2l6aW5nIGhhdmUgZW5kZWQuIFRoZSBldmVudCBkYXRhIGNvbnRhaW5zIHRoZSBuZXcgdG9wIG9mZnNldC4gQWxsb3dzIGEgdHdvLXdheSBiaW5kaW5nIG9mIHRoZSBgdG9wYCBwcm9wZXJ0eS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudG9wQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiB0aGUgYGxlZnRgIHByb3BlcnR5IG9mIHRoZSBjb21wb25lbnQgd2FzIHVwZGF0ZWQuIFRoZSBldmVudCBpcyB0cmlnZ2VyZWQgb25seSBhZnRlciB0aGUgZHJhZ2dpbmdcbiAgICAgICAgICogYW5kIHJlc2l6aW5nIGhhdmUgZW5kZWQuIFRoZSBldmVudCBkYXRhIGNvbnRhaW5zIHRoZSBuZXcgbGVmdCBvZmZzZXQuIEFsbG93cyBhIHR3by13YXkgYmluZGluZyBvZiB0aGUgYGxlZnRgIHByb3BlcnR5LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5sZWZ0Q2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiB0aGUgYHN0YXRlYCBwcm9wZXJ0eSBvZiB0aGUgY29tcG9uZW50IHdhcyB1cGRhdGVkLiBUaGUgZXZlbnQgZGF0YSBjb250YWlucyB0aGUgbmV3IHN0YXRlLiBBbGxvd3MgYVxuICAgICAgICAgKiB0d28td2F5IGJpbmRpbmcgb2YgdGhlIGBzdGF0ZWAgcHJvcGVydHkuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnN0YXRlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICAvKipcbiAgICAgICAgICogQGhpZGRlblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5tZXNzYWdlcyA9IHt9O1xuICAgICAgICB0aGlzLnRhYkluZGV4ID0gMDtcbiAgICAgICAgdGhpcy5kcmFnZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5yZXNpemVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMud2luZG93U3Vic2NyaXB0aW9uID0gbmV3IFN1YnNjcmlwdGlvbigpO1xuICAgICAgICB0aGlzLmRvbVN1YnMgPSBuZXcgU3Vic2NyaXB0aW9uKCk7XG4gICAgICAgIHZhbGlkYXRlUGFja2FnZShwYWNrYWdlTWV0YWRhdGEpO1xuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IHRoaXMubG9jYWxpemF0aW9uLnJ0bCA/ICdydGwnIDogJ2x0cic7XG4gICAgICAgIHRoaXMubG9jYWxpemF0aW9uQ2hhbmdlU3Vic2NyaXB0aW9uID0gdGhpcy5sb2NhbGl6YXRpb24uY2hhbmdlc1xuICAgICAgICAgICAgLnN1YnNjcmliZSgoeyBydGwgfSkgPT4gdGhpcy5kaXJlY3Rpb24gPSBydGwgPyAncnRsJyA6ICdsdHInKTtcbiAgICAgICAgdGhpcy5yZXNpemVEaXJlY3Rpb25zID0gUkVTSVpFX0RJUkVDVElPTlM7XG4gICAgICAgIHRoaXMuc3Vic2NyaWJlRXZlbnRzKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNwZWNpZmllcyB3aGV0aGVyIHRoZSB1c2VyIHdpbGwgYmUgYWJsZSB0byBkcmFnIHRoZSBjb21wb25lbnQuXG4gICAgICogQGRlZmF1bHQgdHJ1ZVxuICAgICAqL1xuICAgIHNldCBkcmFnZ2FibGUodmFsdWUpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLmRyYWdnYWJsZSA9IHZhbHVlO1xuICAgIH1cbiAgICBnZXQgZHJhZ2dhYmxlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmRyYWdnYWJsZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3BlY2lmaWVzIHdoZXRoZXIgdGhlIHVzZXIgd2lsbCBiZSBhYmxlIHRvIHJlc2l6ZSB0aGUgY29tcG9uZW50LlxuICAgICAqIEBkZWZhdWx0IHRydWVcbiAgICAgKi9cbiAgICBzZXQgcmVzaXphYmxlKHZhbHVlKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5yZXNpemFibGUgPSB2YWx1ZTtcbiAgICB9XG4gICAgZ2V0IHJlc2l6YWJsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5yZXNpemFibGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBzZXQgY3NzQ2xhc3MoY2xhc3Nlcykge1xuICAgICAgICB0aGlzLnNldFNlcnZpY2VDbGFzc2VzKHRoaXMuX2Nzc0NsYXNzLCBjbGFzc2VzKTtcbiAgICAgICAgdGhpcy5fY3NzQ2xhc3MgPSBjbGFzc2VzO1xuICAgIH1cbiAgICBnZXQgY3NzQ2xhc3MoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jc3NDbGFzcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIHNldCBodG1sQXR0cmlidXRlcyhhdHRyaWJ1dGVzKSB7XG4gICAgICAgIHNldEhUTUxBdHRyaWJ1dGVzKGF0dHJpYnV0ZXMsIHRoaXMucmVuZGVyZXIsIHRoaXMuZWwubmF0aXZlRWxlbWVudCk7XG4gICAgICAgIGNvbnN0IGVsID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50O1xuICAgICAgICBjb25zdCBkaXIgPSBlbC5nZXRBdHRyaWJ1dGUoJ2RpcicpO1xuICAgICAgICBjb25zdCB0SW5kZXggPSBlbC5nZXRBdHRyaWJ1dGUoJ3RhYmluZGV4Jyk7XG4gICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiAhPT0gZGlyKSB7XG4gICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IGRpcjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy50YWJJbmRleCAhPT0gdEluZGV4KSB7XG4gICAgICAgICAgICB0aGlzLnRhYkluZGV4ID0gdEluZGV4O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2h0bWxBdHRyaWJ1dGVzID0gYXR0cmlidXRlcztcbiAgICB9XG4gICAgZ2V0IGh0bWxBdHRyaWJ1dGVzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faHRtbEF0dHJpYnV0ZXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNwZWNpZmllcyB0aGUgaW5pdGlhbCBzdGF0ZSBvZiB0aGUgY29tcG9uZW50LlxuICAgICAqIElmIG5vdCBzcGVjaWZpZWQsIHRoZSB2YWx1ZSBpcyBzZXQgdG8gYGRlZmF1bHRgLlxuICAgICAqXG4gICAgICogVGhlIHBvc3NpYmxlIHZhbHVlcyBhcmU6XG4gICAgICogKiBgbWluaW1pemVkYFxuICAgICAqICogYG1heGltaXplZGBcbiAgICAgKiAqIGBkZWZhdWx0YFxuICAgICAqL1xuICAgIHNldCBzdGF0ZSh2YWx1ZSkge1xuICAgICAgICB0aGlzLm9wdGlvbnMuc3RhdGUgPSB2YWx1ZTtcbiAgICB9XG4gICAgZ2V0IHN0YXRlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLnN0YXRlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTcGVjaWZpZXMgdGhlIG1pbmltdW0gd2lkdGggb2YgdGhlIGNvbXBvbmVudC5cbiAgICAgKiBUaGUgYG1pbldpZHRoYCBwcm9wZXJ0eSBoYXMgdG8gYmUgc2V0IGluIHBpeGVscy5cbiAgICAgKiBAZGVmYXVsdCAxMjBcbiAgICAgKi9cbiAgICBzZXQgbWluV2lkdGgodmFsdWUpIHtcbiAgICAgICAgdGhpcy5zZXRPcHRpb24oJ21pbldpZHRoJywgdmFsdWUpO1xuICAgIH1cbiAgICBnZXQgbWluV2lkdGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMubWluV2lkdGg7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNwZWNpZmllcyB0aGUgbWluaW11bSBoZWlnaHQgb2YgdGhlIFdpbmRvdy5cbiAgICAgKiBUaGUgYG1pbkhlaWdodGAgcHJvcGVydHkgaGFzIHRvIGJlIHNldCBpbiBwaXhlbHMuXG4gICAgICogQGRlZmF1bHQgMTAwXG4gICAgICovXG4gICAgc2V0IG1pbkhlaWdodCh2YWx1ZSkge1xuICAgICAgICB0aGlzLnNldE9wdGlvbignbWluSGVpZ2h0JywgdmFsdWUpO1xuICAgIH1cbiAgICBnZXQgbWluSGVpZ2h0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLm1pbkhlaWdodDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3BlY2lmaWVzIHRoZSB3aWR0aCBvZiB0aGUgV2luZG93LlxuICAgICAqIFRoZSBgd2lkdGhgIHByb3BlcnR5IGhhcyB0byBiZSBzZXQgaW4gcGl4ZWxzLlxuICAgICAqL1xuICAgIHNldCB3aWR0aCh2YWx1ZSkge1xuICAgICAgICB0aGlzLnNldE9wdGlvbignd2lkdGgnLCB2YWx1ZSk7XG4gICAgfVxuICAgIGdldCB3aWR0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy53aWR0aDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3BlY2lmaWVzIHRoZSBoZWlnaHQgb2YgdGhlIFdpbmRvdy5cbiAgICAgKiBUaGUgYGhlaWdodGAgcHJvcGVydHkgaGFzIHRvIGJlIHNldCBpbiBwaXhlbHMuXG4gICAgICovXG4gICAgc2V0IGhlaWdodCh2YWx1ZSkge1xuICAgICAgICB0aGlzLnNldE9wdGlvbignaGVpZ2h0JywgdmFsdWUpO1xuICAgIH1cbiAgICBnZXQgaGVpZ2h0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmhlaWdodDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3BlY2lmaWVzIHRoZSBpbml0aWFsIHRvcCBvZmZzZXQgb2YgdGhlIFdpbmRvdy5cbiAgICAgKiBUaGUgYHRvcGAgcHJvcGVydHkgaGFzIHRvIGJlIHNldCBpbiBwaXhlbHMuXG4gICAgICovXG4gICAgc2V0IHRvcCh2YWx1ZSkge1xuICAgICAgICB0aGlzLnNldE9wdGlvbigndG9wJywgdmFsdWUpO1xuICAgIH1cbiAgICBnZXQgdG9wKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLnRvcDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3BlY2lmaWVzIHRoZSBpbml0aWFsIGxlZnQgb2Zmc2V0IG9mIHRoZSBXaW5kb3cuXG4gICAgICogTnVtZXJpYyB2YWx1ZXMgYXJlIHRyZWF0ZWQgYXMgcGl4ZWxzLlxuICAgICAqL1xuICAgIHNldCBsZWZ0KHZhbHVlKSB7XG4gICAgICAgIHRoaXMuc2V0T3B0aW9uKCdsZWZ0JywgdmFsdWUpO1xuICAgIH1cbiAgICBnZXQgbGVmdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5sZWZ0O1xuICAgIH1cbiAgICBnZXQgY2xvc2VCdXR0b25UaXRsZSgpIHtcbiAgICAgICAgaWYgKHRoaXMubWVzc2FnZXMgJiYgdGhpcy5tZXNzYWdlcy5jbG9zZVRpdGxlKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5tZXNzYWdlcy5jbG9zZVRpdGxlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmxvY2FsaXphdGlvbi5nZXQoJ2Nsb3NlVGl0bGUnKTtcbiAgICB9XG4gICAgZ2V0IHJlc3RvcmVCdXR0b25UaXRsZSgpIHtcbiAgICAgICAgaWYgKHRoaXMubWVzc2FnZXMgJiYgdGhpcy5tZXNzYWdlcy5yZXN0b3JlVGl0bGUpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm1lc3NhZ2VzLnJlc3RvcmVUaXRsZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGl6YXRpb24uZ2V0KCdyZXN0b3JlVGl0bGUnKTtcbiAgICB9XG4gICAgZ2V0IG1heGltaXplQnV0dG9uVGl0bGUoKSB7XG4gICAgICAgIGlmICh0aGlzLm1lc3NhZ2VzICYmIHRoaXMubWVzc2FnZXMubWF4aW1pemVUaXRsZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubWVzc2FnZXMubWF4aW1pemVUaXRsZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGl6YXRpb24uZ2V0KCdtYXhpbWl6ZVRpdGxlJyk7XG4gICAgfVxuICAgIGdldCBtaW5pbWl6ZUJ1dHRvblRpdGxlKCkge1xuICAgICAgICBpZiAodGhpcy5tZXNzYWdlcyAmJiB0aGlzLm1lc3NhZ2VzLm1pbmltaXplVGl0bGUpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm1lc3NhZ2VzLm1pbmltaXplVGl0bGU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxpemF0aW9uLmdldCgnbWluaW1pemVUaXRsZScpO1xuICAgIH1cbiAgICBnZXQgaG9zdENsYXNzZXMoKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBnZXQgZGlyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kaXJlY3Rpb247XG4gICAgfVxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICAgICAgdGhpcy5zZXROZXh0WkluZGV4KCk7XG4gICAgICAgIHRoaXMuaGFuZGxlSW5pdGlhbEZvY3VzKCk7XG4gICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IFByb21pc2UucmVzb2x2ZShudWxsKS50aGVuKCgpID0+IHRoaXMuc2V0SW5pdGlhbE9mZnNldCgpKSk7XG4gICAgICAgIHRoaXMuaW5pdERvbUV2ZW50cygpO1xuICAgIH1cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVBdHRyaWJ1dGUodGhpcy5lbC5uYXRpdmVFbGVtZW50LCAndGl0bGUnKTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlLmluaXQodGhpcy5lbCk7XG4gICAgfVxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXMpIHtcbiAgICAgICAgT0ZGU0VUX1NUWUxFUy5mb3JFYWNoKChzdHlsZSQkMSkgPT4ge1xuICAgICAgICAgICAgaWYgKGlzQ2hhbmdlZChzdHlsZSQkMSwgY2hhbmdlcykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0eWxlKHN0eWxlJCQxLCB0aGlzLm9wdGlvbnNbc3R5bGUkJDFdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChpc0NoYW5nZWQoJ2RyYWdnYWJsZScsIGNoYW5nZXMpKSB7XG4gICAgICAgICAgICBjb25zdCB0aXRsZUJhciA9IGlzUHJlc2VudCh0aGlzLnRpdGxlQmFyQ29udGVudCkgPyB0aGlzLnRpdGxlQmFyQ29udGVudCA6IHRoaXMudGl0bGVCYXJWaWV3O1xuICAgICAgICAgICAgaWYgKGlzVHJ1dGh5KGNoYW5nZXMuZHJhZ2dhYmxlLmN1cnJlbnRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICB0aXRsZUJhci5zdWJzY3JpYmVEcmFnKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aXRsZUJhci51bnN1YnNjcmliZURyYWcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNDaGFuZ2VkKCdzdGF0ZScsIGNoYW5nZXMpKSB7XG4gICAgICAgICAgICBpZiAoaXNQcmVzZW50KHRoaXMuc2VydmljZS5sYXN0QWN0aW9uKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VydmljZS5sYXN0QWN0aW9uID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VydmljZS5hcHBseU1hbnVhbFN0YXRlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVBbGxPZmZzZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgaWYgKHRoaXMud2luZG93U3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLndpbmRvd1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmRvbVN1YnMpIHtcbiAgICAgICAgICAgIHRoaXMuZG9tU3Vicy51bnN1YnNjcmliZSgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubG9jYWxpemF0aW9uQ2hhbmdlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEZvY3VzZXMgdGhlIHdyYXBwZXIgb2YgdGhlIFdpbmRvdyBjb21wb25lbnQuXG4gICAgICovXG4gICAgZm9jdXMoKSB7XG4gICAgICAgIGNvbnN0IHdyYXBwZXIgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQ7XG4gICAgICAgIGlmIChpc1ByZXNlbnQod3JhcHBlcikpIHtcbiAgICAgICAgICAgIHdyYXBwZXIuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBCcmluZ3MgdGhlIGN1cnJlbnQgV2luZG93IGNvbXBvbmVudCBvbiB0b3Agb2Ygb3RoZXIgV2luZG93IGNvbXBvbmVudHMgb24gdGhlIHBhZ2UuXG4gICAgICovXG4gICAgYnJpbmdUb0Zyb250KCkge1xuICAgICAgICB0aGlzLnNldE5leHRaSW5kZXgoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogTWFudWFsbHkgdXBkYXRlcyB0aGUgYHdpZHRoYCBvciBgaGVpZ2h0YCBvcHRpb24gb2YgdGhlIFdpbmRvdy5cbiAgICAgKiBUaGUgcmVxdWlyZWQgc3R5bGUgd2lsbCBiZSBhcHBsaWVkIHRvIHRoZSBXaW5kb3cgd3JhcHBlciBlbGVtZW50IGFuZCB0aGVcbiAgICAgKiBjb3JyZXNwb25kaW5nIHByb3BlcnR5IG9mIHRoZSBjb21wb25lbnQgaW5zdGFuY2Ugd2lsbCBiZSB1cGRhdGVkLlxuICAgICAqIFRoaXMgbWV0aG9kIGlzIGludGVuZGVkIHRvIGJlIHVzZWQgZm9yIHNpemluZyBkeW5hbWljYWxseSBjcmVhdGVkIGNvbXBvbmVudHMgdXNpbmcgdGhlXG4gICAgICogW2BXaW5kb3dTZXJ2aWNlYF0oeyUgc2x1ZyBhcGlfZGlhbG9nX3dpbmRvd3NlcnZpY2UgJX0pXG4gICAgICogQHBhcmFtIHtXaW5kb3dEaW1lbnNpb25TZXR0aW5nfSBkaW1lbnNpb24gLSBUaGUgb3B0aW9uIHRoYXQgd2lsbCBiZSB1cGRhdGVkXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIC0gVGhlIHZhbHVlIHNldCBpbiBwaXhlbHNcbiAgICAgKi9cbiAgICBzZXREaW1lbnNpb24oZGltZW5zaW9uLCB2YWx1ZSkge1xuICAgICAgICB0aGlzLnNldE9wdGlvbihkaW1lbnNpb24sIHZhbHVlKTtcbiAgICAgICAgdGhpcy5zZXRTdHlsZShkaW1lbnNpb24sIHZhbHVlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogTWFudWFsbHkgdXBkYXRlcyB0aGUgYHRvcGAgb3IgYGxlZnRgIG9mZnNldCBvZiB0aGUgV2luZG93LlxuICAgICAqIFRoZSByZXF1aXJlZCBzdHlsZSB3aWxsIGJlIGFwcGxpZWQgdG8gdGhlIFdpbmRvdyB3cmFwcGVyIGVsZW1lbnQgYW5kIHRoZVxuICAgICAqIGNvcnJlc3BvbmRpbmcgcHJvcGVydHkgb2YgdGhlIGNvbXBvbmVudCBpbnN0YW5jZSB3aWxsIGJlIHVwZGF0ZWQuXG4gICAgICogVGhpcyBtZXRob2QgaXMgaW50ZW5kZWQgdG8gYmUgdXNlZCBmb3IgcG9zaXRpb25pbmcgZHluYW1pY2FsbHkgY3JlYXRlZCBjb21wb25lbnRzIHVzaW5nIHRoZVxuICAgICAqIFtgV2luZG93U2VydmljZWBdKHslIHNsdWcgYXBpX2RpYWxvZ193aW5kb3dzZXJ2aWNlICV9KVxuICAgICAqIEBwYXJhbSB7V2luZG93T2Zmc2V0U2V0dGluZ30gb2Zmc2V0IC0gVGhlIG9wdGlvbiB0aGF0IHdpbGwgYmUgdXBkYXRlZFxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSAtIFRoZSB2YWx1ZSBzZXQgaW4gcGl4ZWxzXG4gICAgICovXG4gICAgc2V0T2Zmc2V0KG9mZnNldCQkMSwgdmFsdWUpIHtcbiAgICAgICAgdGhpcy5zZXRPcHRpb24ob2Zmc2V0JCQxLCB2YWx1ZSk7XG4gICAgICAgIHRoaXMuc2V0U3R5bGUob2Zmc2V0JCQxLCB2YWx1ZSk7XG4gICAgfVxuICAgIGdldCBzaG93RGVmYXVsdFRpdGxlQmFyKCkge1xuICAgICAgICByZXR1cm4gIWlzUHJlc2VudCh0aGlzLnRpdGxlQmFyQ29udGVudCk7XG4gICAgfVxuICAgIGdldCBzdHlsZU1pbldpZHRoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5taW5XaWR0aCArICdweCc7XG4gICAgfVxuICAgIGdldCBzdHlsZU1pbkhlaWdodCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWluSGVpZ2h0ICsgJ3B4JztcbiAgICB9XG4gICAgZ2V0IHN0eWxlUG9zaXRpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMucG9zaXRpb247XG4gICAgfVxuICAgIGdldCB3cmFwcGVyTWF4aW1pemVkQ2xhc3MoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXRlID09PSAnbWF4aW1pemVkJztcbiAgICB9XG4gICAgZ2V0IHdyYXBwZXJNaW5pbWl6ZWRDbGFzcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUgPT09ICdtaW5pbWl6ZWQnO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgb25Db21wb25lbnRGb2N1cygpIHtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdrLWZvY3VzJyk7XG4gICAgICAgIHRoaXMuc2V0TmV4dFpJbmRleCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgb25Db21wb25lbnRCbHVyKCkge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2stZm9jdXMnKTtcbiAgICB9XG4gICAgc3Vic2NyaWJlRXZlbnRzKCkge1xuICAgICAgICBpZiAoIWlzRG9jdW1lbnRBdmFpbGFibGUoKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMud2luZG93U3Vic2NyaXB0aW9uLmFkZCh0aGlzLnNlcnZpY2UuZm9jdXMuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMud2luZG93U3Vic2NyaXB0aW9uLmFkZCh0aGlzLnNlcnZpY2UuZHJhZ1N0YXJ0LnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRyYWdlZCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZHJhZ1N0YXJ0LmVtaXQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMud2luZG93U3Vic2NyaXB0aW9uLmFkZCh0aGlzLnNlcnZpY2UuZHJhZ0VuZC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuZHJhZ2VkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kcmFnZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRyYWdFbmQuZW1pdCgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMud2luZG93U3Vic2NyaXB0aW9uLmFkZCh0aGlzLnNlcnZpY2UuY2xvc2Uuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UuZW1pdCgpO1xuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMud2luZG93U3Vic2NyaXB0aW9uLmFkZCh0aGlzLnNlcnZpY2UucmVzaXplU3RhcnQuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMucmVzaXplZCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucmVzaXplU3RhcnQuZW1pdCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgdGhpcy53aW5kb3dTdWJzY3JpcHRpb24uYWRkKHRoaXMuc2VydmljZS5yZXNpemVFbmQuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLnJlc2l6ZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc2l6ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc2l6ZUVuZC5lbWl0KCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKTtcbiAgICAgICAgdGhpcy53aW5kb3dTdWJzY3JpcHRpb24uYWRkKHRoaXMuc2VydmljZS5jaGFuZ2Uuc3Vic2NyaWJlKChldikgPT4ge1xuICAgICAgICAgICAgT0ZGU0VUX1NUWUxFUy5mb3JFYWNoKChzdHlsZSQkMSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpc1ByZXNlbnQoZXZbc3R5bGUkJDFdKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0eWxlKHN0eWxlJCQxLCBldltzdHlsZSQkMV0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSAhPT0gJ21heGltaXplZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVtaXR0ZXIgPSB0aGlzW3N0eWxlJCQxICsgJ0NoYW5nZSddO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVtaXR0ZXIub2JzZXJ2ZXJzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubmdab25lLnJ1bigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXR0ZXIuZW1pdChldltzdHlsZSQkMV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgdGhpcy53aW5kb3dTdWJzY3JpcHRpb24uYWRkKHRoaXMuc2VydmljZS5zdGF0ZUNoYW5nZS5zdWJzY3JpYmUoKHN0YXRlJCQxKSA9PiB7XG4gICAgICAgICAgICBpZiAoaXNQcmVzZW50KHRoaXMuc2VydmljZS5sYXN0QWN0aW9uKSkge1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQWxsT2Zmc2V0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0ZUNoYW5nZS5lbWl0KHN0YXRlJCQxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBpbml0RG9tRXZlbnRzKCkge1xuICAgICAgICBpZiAoIXRoaXMuZWwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRvbVN1YnMuYWRkKHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2tleWRvd24nLCAoZXYpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLm9uS2V5RG93bihldik7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBvbktleURvd24oZXZlbnQpIHtcbiAgICAgICAgaWYgKGhhc0NsYXNzZXMoZXZlbnQudGFyZ2V0LCBXSU5ET1dfQ0xBU1NFUykpIHtcbiAgICAgICAgICAgIHRoaXMubmF2aWdhdGlvbi5wcm9jZXNzKGV2ZW50KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzZXRTZXJ2aWNlQ2xhc3NlcyhwcmV2VmFsdWUsIHZhbHVlKSB7XG4gICAgICAgIGNvbnN0IGVsID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50O1xuICAgICAgICBpZiAocHJldlZhbHVlKSB7XG4gICAgICAgICAgICBwYXJzZUNTU0NsYXNzTmFtZXMocHJldlZhbHVlKS5mb3JFYWNoKGNsYXNzTmFtZSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVDbGFzcyhlbCwgY2xhc3NOYW1lKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgcGFyc2VDU1NDbGFzc05hbWVzKHZhbHVlKS5mb3JFYWNoKGNsYXNzTmFtZSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhlbCwgY2xhc3NOYW1lKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNldE5leHRaSW5kZXgoKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRaSW5kZXggPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuc3R5bGVbJ3otaW5kZXgnXTtcbiAgICAgICAgY29uc3QgbmV4dFBvc3NpYmxlWkluZGV4ID0gdGhpcy5zZXJ2aWNlLm5leHRQb3NzaWJsZVpJbmRleDtcbiAgICAgICAgaWYgKCFjdXJyZW50WkluZGV4IHx8IChuZXh0UG9zc2libGVaSW5kZXggLSBjdXJyZW50WkluZGV4ID4gMSkpIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbC5uYXRpdmVFbGVtZW50LCBcInotaW5kZXhcIiwgdGhpcy5zZXJ2aWNlLm5leHRaSW5kZXgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNldEluaXRpYWxPZmZzZXQoKSB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSAnbWF4aW1pemVkJykge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVBbGxPZmZzZXQoKTtcbiAgICAgICAgICAgIGlmICghaXNQcmVzZW50KHRoaXMubGVmdCkgfHwgIWlzUHJlc2VudCh0aGlzLnRvcCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlcnZpY2UuY2VudGVyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCB2aWV3UG9ydCA9IHRoaXMuc2VydmljZS53aW5kb3dWaWV3UG9ydDtcbiAgICAgICAgICAgIHRoaXMuc2V0U3R5bGUoJ3dpZHRoJywgdmlld1BvcnQud2lkdGgpO1xuICAgICAgICAgICAgdGhpcy5zZXRTdHlsZSgnaGVpZ2h0Jywgdmlld1BvcnQuaGVpZ2h0KTtcbiAgICAgICAgICAgIHRoaXMuc2V0U3R5bGUoJ3RvcCcsIDApO1xuICAgICAgICAgICAgdGhpcy5zZXRTdHlsZSgnbGVmdCcsIDApO1xuICAgICAgICB9XG4gICAgfVxuICAgIHVwZGF0ZUFsbE9mZnNldCgpIHtcbiAgICAgICAgT0ZGU0VUX1NUWUxFUy5mb3JFYWNoKChzdHlsZSQkMSkgPT4ge1xuICAgICAgICAgICAgaWYgKGlzUHJlc2VudCh0aGlzW3N0eWxlJCQxXSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0eWxlKHN0eWxlJCQxLCB0aGlzW3N0eWxlJCQxXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZVN0eWxlKHN0eWxlJCQxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHNldFN0eWxlKHN0eWxlJCQxLCB2YWx1ZSkge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgc3R5bGUkJDEsIHZhbHVlICsgJ3B4Jyk7XG4gICAgfVxuICAgIHJlbW92ZVN0eWxlKHN0eWxlJCQxKSB7XG4gICAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlU3R5bGUodGhpcy5lbC5uYXRpdmVFbGVtZW50LCBzdHlsZSQkMSk7XG4gICAgfVxuICAgIGdldCBvcHRpb25zKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZXJ2aWNlLm9wdGlvbnM7XG4gICAgfVxuICAgIHNldE9wdGlvbihzdHlsZSQkMSwgdmFsdWUpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ251bWJlcicgJiYgdHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBhcnNlZFZhbHVlID0gKHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicpID8gdmFsdWUgOiBwYXJzZUludCh2YWx1ZSwgMTApO1xuICAgICAgICB0aGlzLm9wdGlvbnNbc3R5bGUkJDFdID0gcGFyc2VkVmFsdWU7XG4gICAgICAgIHRoaXMuc2VydmljZS5zZXRSZXN0b3JlT3B0aW9uKHN0eWxlJCQxLCBwYXJzZWRWYWx1ZSk7XG4gICAgfVxuICAgIGhhbmRsZUluaXRpYWxGb2N1cygpIHtcbiAgICAgICAgY29uc3Qgd3JhcHBlciA9IHRoaXMuZWwubmF0aXZlRWxlbWVudDtcbiAgICAgICAgaWYgKHRoaXMuYXV0b0ZvY3VzZWRFbGVtZW50KSB7XG4gICAgICAgICAgICBjb25zdCBpbml0aWFsbHlGb2N1c2VkRWxlbWVudCA9IHdyYXBwZXIucXVlcnlTZWxlY3Rvcih0aGlzLmF1dG9Gb2N1c2VkRWxlbWVudCk7XG4gICAgICAgICAgICBpZiAoaW5pdGlhbGx5Rm9jdXNlZEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBpbml0aWFsbHlGb2N1c2VkRWxlbWVudC5mb2N1cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5mb2N1cygpO1xuICAgICAgICB9XG4gICAgfVxufTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFN0cmluZylcbl0sIFdpbmRvd0NvbXBvbmVudC5wcm90b3R5cGUsIFwiYXV0b0ZvY3VzZWRFbGVtZW50XCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcInRpdGxlXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBCb29sZWFuKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW0Jvb2xlYW5dKVxuXSwgV2luZG93Q29tcG9uZW50LnByb3RvdHlwZSwgXCJkcmFnZ2FibGVcIiwgbnVsbCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBCb29sZWFuKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW0Jvb2xlYW5dKVxuXSwgV2luZG93Q29tcG9uZW50LnByb3RvdHlwZSwgXCJyZXNpemFibGVcIiwgbnVsbCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBCb29sZWFuKVxuXSwgV2luZG93Q29tcG9uZW50LnByb3RvdHlwZSwgXCJrZWVwQ29udGVudFwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW1N0cmluZ10pXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcInN0YXRlXCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgTnVtYmVyKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW051bWJlcl0pXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcIm1pbldpZHRoXCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgTnVtYmVyKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW051bWJlcl0pXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcIm1pbkhlaWdodFwiLCBudWxsKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE51bWJlciksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtOdW1iZXJdKVxuXSwgV2luZG93Q29tcG9uZW50LnByb3RvdHlwZSwgXCJ3aWR0aFwiLCBudWxsKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE51bWJlciksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtOdW1iZXJdKVxuXSwgV2luZG93Q29tcG9uZW50LnByb3RvdHlwZSwgXCJoZWlnaHRcIiwgbnVsbCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBOdW1iZXIpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbTnVtYmVyXSlcbl0sIFdpbmRvd0NvbXBvbmVudC5wcm90b3R5cGUsIFwidG9wXCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgTnVtYmVyKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW051bWJlcl0pXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcImxlZnRcIiwgbnVsbCk7XG5fX2RlY29yYXRlKFtcbiAgICBPdXRwdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgRXZlbnRFbWl0dGVyKVxuXSwgV2luZG93Q29tcG9uZW50LnByb3RvdHlwZSwgXCJkcmFnU3RhcnRcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIE91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBFdmVudEVtaXR0ZXIpXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcImRyYWdFbmRcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIE91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBFdmVudEVtaXR0ZXIpXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcInJlc2l6ZVN0YXJ0XCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBPdXRwdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgRXZlbnRFbWl0dGVyKVxuXSwgV2luZG93Q29tcG9uZW50LnByb3RvdHlwZSwgXCJyZXNpemVFbmRcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIE91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBFdmVudEVtaXR0ZXIpXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcImNsb3NlXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBPdXRwdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgRXZlbnRFbWl0dGVyKVxuXSwgV2luZG93Q29tcG9uZW50LnByb3RvdHlwZSwgXCJ3aWR0aENoYW5nZVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgT3V0cHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEV2ZW50RW1pdHRlcilcbl0sIFdpbmRvd0NvbXBvbmVudC5wcm90b3R5cGUsIFwiaGVpZ2h0Q2hhbmdlXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBPdXRwdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgRXZlbnRFbWl0dGVyKVxuXSwgV2luZG93Q29tcG9uZW50LnByb3RvdHlwZSwgXCJ0b3BDaGFuZ2VcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIE91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBFdmVudEVtaXR0ZXIpXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcImxlZnRDaGFuZ2VcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIE91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBFdmVudEVtaXR0ZXIpXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcInN0YXRlQ2hhbmdlXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBIb3N0QmluZGluZygnYXR0ci50YWJJbmRleCcpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBOdW1iZXIpXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcInRhYkluZGV4XCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBIb3N0QmluZGluZygnY2xhc3Muay13aW5kb3cnKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgQm9vbGVhbiksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtdKVxuXSwgV2luZG93Q29tcG9uZW50LnByb3RvdHlwZSwgXCJob3N0Q2xhc3Nlc1wiLCBudWxsKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdhdHRyLmRpcicpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbXSlcbl0sIFdpbmRvd0NvbXBvbmVudC5wcm90b3R5cGUsIFwiZGlyXCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgVmlld0NoaWxkKFdpbmRvd1RpdGxlQmFyQ29tcG9uZW50LCB7IHN0YXRpYzogZmFsc2UgfSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFdpbmRvd1RpdGxlQmFyQ29tcG9uZW50KVxuXSwgV2luZG93Q29tcG9uZW50LnByb3RvdHlwZSwgXCJ0aXRsZUJhclZpZXdcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIENvbnRlbnRDaGlsZChXaW5kb3dUaXRsZUJhckNvbXBvbmVudCwgeyBzdGF0aWM6IGZhbHNlIH0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBXaW5kb3dUaXRsZUJhckNvbXBvbmVudClcbl0sIFdpbmRvd0NvbXBvbmVudC5wcm90b3R5cGUsIFwidGl0bGVCYXJDb250ZW50XCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBWaWV3Q2hpbGRyZW4oUmVzaXplSGFuZGxlRGlyZWN0aXZlKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgUXVlcnlMaXN0KVxuXSwgV2luZG93Q29tcG9uZW50LnByb3RvdHlwZSwgXCJyZXNpemVIYW5kbGVzXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBIb3N0QmluZGluZygnc3R5bGUubWluV2lkdGgnKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW10pXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcInN0eWxlTWluV2lkdGhcIiwgbnVsbCk7XG5fX2RlY29yYXRlKFtcbiAgICBIb3N0QmluZGluZygnc3R5bGUubWluSGVpZ2h0JyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFN0cmluZyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtdKVxuXSwgV2luZG93Q29tcG9uZW50LnByb3RvdHlwZSwgXCJzdHlsZU1pbkhlaWdodFwiLCBudWxsKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdzdHlsZS5wb3NpdGlvbicpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbXSlcbl0sIFdpbmRvd0NvbXBvbmVudC5wcm90b3R5cGUsIFwic3R5bGVQb3NpdGlvblwiLCBudWxsKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdjbGFzcy5rLXdpbmRvdy1tYXhpbWl6ZWQnKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgQm9vbGVhbiksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtdKVxuXSwgV2luZG93Q29tcG9uZW50LnByb3RvdHlwZSwgXCJ3cmFwcGVyTWF4aW1pemVkQ2xhc3NcIiwgbnVsbCk7XG5fX2RlY29yYXRlKFtcbiAgICBIb3N0QmluZGluZygnY2xhc3Muay13aW5kb3ctbWluaW1pemVkJyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEJvb2xlYW4pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbXSlcbl0sIFdpbmRvd0NvbXBvbmVudC5wcm90b3R5cGUsIFwid3JhcHBlck1pbmltaXplZENsYXNzXCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdExpc3RlbmVyKCdmb2N1cycpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBGdW5jdGlvbiksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtdKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnJldHVybnR5cGVcIiwgdm9pZCAwKVxuXSwgV2luZG93Q29tcG9uZW50LnByb3RvdHlwZSwgXCJvbkNvbXBvbmVudEZvY3VzXCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdExpc3RlbmVyKCdibHVyJyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEZ1bmN0aW9uKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW10pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cmV0dXJudHlwZVwiLCB2b2lkIDApXG5dLCBXaW5kb3dDb21wb25lbnQucHJvdG90eXBlLCBcIm9uQ29tcG9uZW50Qmx1clwiLCBudWxsKTtcbldpbmRvd0NvbXBvbmVudCA9IF9fZGVjb3JhdGUoW1xuICAgIENvbXBvbmVudCh7XG4gICAgICAgIGV4cG9ydEFzOiAna2VuZG9XaW5kb3cnLFxuICAgICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgICAgIERyYWdSZXNpemVTZXJ2aWNlLFxuICAgICAgICAgICAgTmF2aWdhdGlvblNlcnZpY2UsXG4gICAgICAgICAgICBMb2NhbGl6YXRpb25TZXJ2aWNlLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHByb3ZpZGU6IEwxME5fUFJFRklYLFxuICAgICAgICAgICAgICAgIHVzZVZhbHVlOiAna2VuZG8ud2luZG93J1xuICAgICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBzZWxlY3RvcjogJ2tlbmRvLXdpbmRvdycsXG4gICAgICAgIHRlbXBsYXRlOiBgXG4gICAgICAgIDxuZy1jb250YWluZXIga2VuZG9XaW5kb3dMb2NhbGl6ZWRNZXNzYWdlc1xuICAgICAgICAgICAgaTE4bi1jbG9zZVRpdGxlPVwia2VuZG8ud2luZG93LmNsb3NlVGl0bGV8VGhlIHRpdGxlIG9mIHRoZSBjbG9zZSBidXR0b25cIlxuICAgICAgICAgICAgY2xvc2VUaXRsZT1cIkNsb3NlXCJcblxuICAgICAgICAgICAgaTE4bi1yZXN0b3JlVGl0bGU9XCJrZW5kby53aW5kb3cucmVzdG9yZVRpdGxlfFRoZSB0aXRsZSBvZiB0aGUgcmVzdG9yZSBidXR0b25cIlxuICAgICAgICAgICAgcmVzdG9yZVRpdGxlPVwiUmVzdG9yZVwiXG5cbiAgICAgICAgICAgIGkxOG4tbWF4aW1pemVUaXRsZT1cImtlbmRvLndpbmRvdy5tYXhpbWl6ZVRpdGxlfFRoZSB0aXRsZSBvZiB0aGUgbWF4aW1pemUgYnV0dG9uXCJcbiAgICAgICAgICAgIG1heGltaXplVGl0bGU9XCJNYXhpbWl6ZVwiXG5cbiAgICAgICAgICAgIGkxOG4tbWluaW1pemVUaXRsZT1cImtlbmRvLndpbmRvdy5taW5pbWl6ZVRpdGxlfFRoZSB0aXRsZSBvZiB0aGUgbWluaW1pemUgYnV0dG9uXCJcbiAgICAgICAgICAgIG1pbmltaXplVGl0bGU9XCJNaW5pbWl6ZVwiXG4gICAgICAgID5cbiAgICAgICAgPG5nLWNvbnRhaW5lcj5cblxuICAgICAgICA8a2VuZG8td2luZG93LXRpdGxlYmFyICpuZ0lmPVwic2hvd0RlZmF1bHRUaXRsZUJhclwiIFt0ZW1wbGF0ZV09XCJ0aXRsZUJhclRlbXBsYXRlXCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiay13aW5kb3ctdGl0bGVcIj57eyB0aXRsZSB9fTwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImstd2luZG93LWFjdGlvbnNcIj5cbiAgICAgICAgICAgICAgICA8YnV0dG9uIGtlbmRvV2luZG93TWluaW1pemVBY3Rpb24gIFthdHRyLnRpdGxlXT1cIm1pbmltaXplQnV0dG9uVGl0bGVcIiBbYXR0ci5hcmlhLWxhYmVsXT1cIm1pbmltaXplQnV0dG9uVGl0bGVcIj48L2J1dHRvbj5cbiAgICAgICAgICAgICAgICA8YnV0dG9uIGtlbmRvV2luZG93TWF4aW1pemVBY3Rpb24gW2F0dHIudGl0bGVdPVwibWF4aW1pemVCdXR0b25UaXRsZVwiIFthdHRyLmFyaWEtbGFiZWxdPVwibWF4aW1pemVCdXR0b25UaXRsZVwiPjwvYnV0dG9uPlxuICAgICAgICAgICAgICAgIDxidXR0b24ga2VuZG9XaW5kb3dSZXN0b3JlQWN0aW9uIFthdHRyLnRpdGxlXT1cInJlc3RvcmVCdXR0b25UaXRsZVwiIFthdHRyLmFyaWEtbGFiZWxdPVwicmVzdG9yZUJ1dHRvblRpdGxlXCI+PC9idXR0b24+XG4gICAgICAgICAgICAgICAgPGJ1dHRvbiBrZW5kb1dpbmRvd0Nsb3NlQWN0aW9uIFthdHRyLnRpdGxlXT1cImNsb3NlQnV0dG9uVGl0bGVcIiBbYXR0ci5hcmlhLWxhYmVsXT1cImNsb3NlQnV0dG9uVGl0bGVcIj48L2J1dHRvbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2tlbmRvLXdpbmRvdy10aXRsZWJhcj5cbiAgICAgICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwia2VuZG8td2luZG93LXRpdGxlYmFyXCIgKm5nSWY9XCIhc2hvd0RlZmF1bHRUaXRsZUJhclwiPjwvbmctY29udGVudD5cblxuICAgICAgICA8ZGl2ICpuZ0lmPVwic3RhdGUgIT09ICdtaW5pbWl6ZWQnIHx8IGtlZXBDb250ZW50XCJcbiAgICAgICAgICAgIFtoaWRkZW5dPVwic3RhdGUgPT09ICdtaW5pbWl6ZWQnICYmIGtlZXBDb250ZW50XCJcbiAgICAgICAgICAgIGNsYXNzPVwiay1jb250ZW50IGstd2luZG93LWNvbnRlbnRcIlxuICAgICAgICA+XG4gICAgICAgICAgICA8bmctY29udGVudCAqbmdJZj1cIiFjb250ZW50VGVtcGxhdGVcIj48L25nLWNvbnRlbnQ+XG4gICAgICAgICAgICA8bmctdGVtcGxhdGUgW25nVGVtcGxhdGVPdXRsZXRdPVwiY29udGVudFRlbXBsYXRlXCIgKm5nSWY9XCJjb250ZW50VGVtcGxhdGVcIj48L25nLXRlbXBsYXRlPlxuICAgICAgICA8L2Rpdj5cblxuICAgICAgICA8bmctdGVtcGxhdGUgW25nSWZdPSdyZXNpemFibGUnPlxuICAgICAgICAgICAgPGRpdiAqbmdGb3I9J2xldCBkaXIgb2YgcmVzaXplRGlyZWN0aW9ucydcbiAgICAgICAgICAgICAgICBbZGlyZWN0aW9uXT1cImRpclwiXG4gICAgICAgICAgICAgICAga2VuZG9XaW5kb3dSZXNpemVIYW5kbGVcbiAgICAgICAgICAgICAgICBrZW5kb0RyYWdnYWJsZT5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L25nLXRlbXBsYXRlPlxuICAgIGBcbiAgICB9KSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW0VsZW1lbnRSZWYsXG4gICAgICAgIFJlbmRlcmVyMixcbiAgICAgICAgRHJhZ1Jlc2l6ZVNlcnZpY2UsXG4gICAgICAgIE5hdmlnYXRpb25TZXJ2aWNlLFxuICAgICAgICBOZ1pvbmUsXG4gICAgICAgIExvY2FsaXphdGlvblNlcnZpY2VdKVxuXSwgV2luZG93Q29tcG9uZW50KTtcblxubGV0IFdpbmRvd01heGltaXplQWN0aW9uRGlyZWN0aXZlID0gY2xhc3MgV2luZG93TWF4aW1pemVBY3Rpb25EaXJlY3RpdmUgZXh0ZW5kcyBCdXR0b24ge1xuICAgIGNvbnN0cnVjdG9yKGVsLCByZW5kZXJlciwgX3NlcnZpY2UsIGxvY2FsaXphdGlvbiwgbmdab25lKSB7XG4gICAgICAgIHN1cGVyKGVsLCByZW5kZXJlciwgbnVsbCwgbG9jYWxpemF0aW9uLCBuZ1pvbmUpO1xuICAgICAgICB0aGlzLmJ1dHRvblR5cGUgPSAnYnV0dG9uJztcbiAgICAgICAgdGhpcy53aW5kb3cgPSBfc2VydmljZTtcbiAgICAgICAgdGhpcy5maWxsTW9kZSA9ICdmbGF0JztcbiAgICAgICAgdGhpcy5pY29uID0gJ3dpbmRvdy1tYXhpbWl6ZSc7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBvbkNsaWNrKCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNEaXNhYmxlZCkge1xuICAgICAgICAgICAgdGhpcy53aW5kb3cubWF4aW1pemVBY3Rpb24oKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgdmlzaWJsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud2luZG93Lm9wdGlvbnMuc3RhdGUgPT09ICdkZWZhdWx0JyA/ICdpbmxpbmUtZmxleCcgOiAnbm9uZSc7XG4gICAgfVxufTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE9iamVjdClcbl0sIFdpbmRvd01heGltaXplQWN0aW9uRGlyZWN0aXZlLnByb3RvdHlwZSwgXCJ3aW5kb3dcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdhdHRyLnR5cGUnKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKVxuXSwgV2luZG93TWF4aW1pemVBY3Rpb25EaXJlY3RpdmUucHJvdG90eXBlLCBcImJ1dHRvblR5cGVcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RMaXN0ZW5lcignY2xpY2snKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgRnVuY3Rpb24pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbXSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpyZXR1cm50eXBlXCIsIHZvaWQgMClcbl0sIFdpbmRvd01heGltaXplQWN0aW9uRGlyZWN0aXZlLnByb3RvdHlwZSwgXCJvbkNsaWNrXCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdEJpbmRpbmcoJ3N0eWxlLmRpc3BsYXknKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW10pXG5dLCBXaW5kb3dNYXhpbWl6ZUFjdGlvbkRpcmVjdGl2ZS5wcm90b3R5cGUsIFwidmlzaWJsZVwiLCBudWxsKTtcbldpbmRvd01heGltaXplQWN0aW9uRGlyZWN0aXZlID0gX19kZWNvcmF0ZShbXG4gICAgRGlyZWN0aXZlKHtcbiAgICAgICAgZXhwb3J0QXM6ICdrZW5kb1dpbmRvd01heGltaXplQWN0aW9uJyxcbiAgICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgICAgICBMb2NhbGl6YXRpb25TZXJ2aWNlLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHByb3ZpZGU6IEwxME5fUFJFRklYLFxuICAgICAgICAgICAgICAgIHVzZVZhbHVlOiAna2VuZG8uYnV0dG9uJ1xuICAgICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBzZWxlY3RvcjogJ2J1dHRvbltrZW5kb1dpbmRvd01heGltaXplQWN0aW9uXScgLy8gdHNsaW50OmRpc2FibGUtbGluZVxuICAgIH0pLFxuICAgIF9fcGFyYW0oMiwgT3B0aW9uYWwoKSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtFbGVtZW50UmVmLFxuICAgICAgICBSZW5kZXJlcjIsXG4gICAgICAgIERyYWdSZXNpemVTZXJ2aWNlLFxuICAgICAgICBMb2NhbGl6YXRpb25TZXJ2aWNlLFxuICAgICAgICBOZ1pvbmVdKVxuXSwgV2luZG93TWF4aW1pemVBY3Rpb25EaXJlY3RpdmUpO1xuXG5sZXQgV2luZG93TWluaW1pemVBY3Rpb25EaXJlY3RpdmUgPSBjbGFzcyBXaW5kb3dNaW5pbWl6ZUFjdGlvbkRpcmVjdGl2ZSBleHRlbmRzIEJ1dHRvbiB7XG4gICAgY29uc3RydWN0b3IoZWwsIHJlbmRlcmVyLCBfc2VydmljZSwgbG9jYWxpemF0aW9uLCBuZ1pvbmUpIHtcbiAgICAgICAgc3VwZXIoZWwsIHJlbmRlcmVyLCBudWxsLCBsb2NhbGl6YXRpb24sIG5nWm9uZSk7XG4gICAgICAgIHRoaXMuYnV0dG9uVHlwZSA9ICdidXR0b24nO1xuICAgICAgICB0aGlzLndpbmRvdyA9IF9zZXJ2aWNlO1xuICAgICAgICB0aGlzLmZpbGxNb2RlID0gJ2ZsYXQnO1xuICAgICAgICB0aGlzLmljb24gPSAnd2luZG93LW1pbmltaXplJztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIG9uQ2xpY2soKSB7XG4gICAgICAgIGlmICghdGhpcy5pc0Rpc2FibGVkKSB7XG4gICAgICAgICAgICB0aGlzLndpbmRvdy5taW5pbWl6ZUFjdGlvbigpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCB2aXNpYmxlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy53aW5kb3cub3B0aW9ucy5zdGF0ZSA9PT0gJ2RlZmF1bHQnID8gJ2lubGluZS1mbGV4JyA6ICdub25lJztcbiAgICB9XG59O1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgT2JqZWN0KVxuXSwgV2luZG93TWluaW1pemVBY3Rpb25EaXJlY3RpdmUucHJvdG90eXBlLCBcIndpbmRvd1wiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdEJpbmRpbmcoJ2F0dHIudHlwZScpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpXG5dLCBXaW5kb3dNaW5pbWl6ZUFjdGlvbkRpcmVjdGl2ZS5wcm90b3R5cGUsIFwiYnV0dG9uVHlwZVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdExpc3RlbmVyKCdjbGljaycpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBGdW5jdGlvbiksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtdKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnJldHVybnR5cGVcIiwgdm9pZCAwKVxuXSwgV2luZG93TWluaW1pemVBY3Rpb25EaXJlY3RpdmUucHJvdG90eXBlLCBcIm9uQ2xpY2tcIiwgbnVsbCk7XG5fX2RlY29yYXRlKFtcbiAgICBIb3N0QmluZGluZygnc3R5bGUuZGlzcGxheScpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbXSlcbl0sIFdpbmRvd01pbmltaXplQWN0aW9uRGlyZWN0aXZlLnByb3RvdHlwZSwgXCJ2aXNpYmxlXCIsIG51bGwpO1xuV2luZG93TWluaW1pemVBY3Rpb25EaXJlY3RpdmUgPSBfX2RlY29yYXRlKFtcbiAgICBEaXJlY3RpdmUoe1xuICAgICAgICBleHBvcnRBczogJ2tlbmRvV2luZG93TWluaW1pemVBY3Rpb24nLFxuICAgICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgICAgIExvY2FsaXphdGlvblNlcnZpY2UsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcHJvdmlkZTogTDEwTl9QUkVGSVgsXG4gICAgICAgICAgICAgICAgdXNlVmFsdWU6ICdrZW5kby5idXR0b24nXG4gICAgICAgICAgICB9XG4gICAgICAgIF0sXG4gICAgICAgIHNlbGVjdG9yOiAnYnV0dG9uW2tlbmRvV2luZG93TWluaW1pemVBY3Rpb25dJyAvLyB0c2xpbnQ6ZGlzYWJsZS1saW5lXG4gICAgfSksXG4gICAgX19wYXJhbSgyLCBPcHRpb25hbCgpKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW0VsZW1lbnRSZWYsXG4gICAgICAgIFJlbmRlcmVyMixcbiAgICAgICAgRHJhZ1Jlc2l6ZVNlcnZpY2UsXG4gICAgICAgIExvY2FsaXphdGlvblNlcnZpY2UsXG4gICAgICAgIE5nWm9uZV0pXG5dLCBXaW5kb3dNaW5pbWl6ZUFjdGlvbkRpcmVjdGl2ZSk7XG5cbmxldCBXaW5kb3dDbG9zZUFjdGlvbkRpcmVjdGl2ZSA9IGNsYXNzIFdpbmRvd0Nsb3NlQWN0aW9uRGlyZWN0aXZlIGV4dGVuZHMgQnV0dG9uIHtcbiAgICBjb25zdHJ1Y3RvcihlbCwgcmVuZGVyZXIsIF9zZXJ2aWNlLCBsb2NhbGl6YXRpb24sIG5nWm9uZSkge1xuICAgICAgICBzdXBlcihlbCwgcmVuZGVyZXIsIG51bGwsIGxvY2FsaXphdGlvbiwgbmdab25lKTtcbiAgICAgICAgdGhpcy5idXR0b25UeXBlID0gJ2J1dHRvbic7XG4gICAgICAgIHRoaXMud2luZG93ID0gX3NlcnZpY2U7XG4gICAgICAgIHRoaXMuZmlsbE1vZGUgPSAnZmxhdCc7XG4gICAgICAgIHRoaXMuaWNvbiA9ICdjbG9zZSc7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBvbkNsaWNrKCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNEaXNhYmxlZCkge1xuICAgICAgICAgICAgdGhpcy53aW5kb3cuY2xvc2VBY3Rpb24oKTtcbiAgICAgICAgfVxuICAgIH1cbn07XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBPYmplY3QpXG5dLCBXaW5kb3dDbG9zZUFjdGlvbkRpcmVjdGl2ZS5wcm90b3R5cGUsIFwid2luZG93XCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBIb3N0QmluZGluZygnYXR0ci50eXBlJyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFN0cmluZylcbl0sIFdpbmRvd0Nsb3NlQWN0aW9uRGlyZWN0aXZlLnByb3RvdHlwZSwgXCJidXR0b25UeXBlXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBIb3N0TGlzdGVuZXIoJ2NsaWNrJyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEZ1bmN0aW9uKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW10pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cmV0dXJudHlwZVwiLCB2b2lkIDApXG5dLCBXaW5kb3dDbG9zZUFjdGlvbkRpcmVjdGl2ZS5wcm90b3R5cGUsIFwib25DbGlja1wiLCBudWxsKTtcbldpbmRvd0Nsb3NlQWN0aW9uRGlyZWN0aXZlID0gX19kZWNvcmF0ZShbXG4gICAgRGlyZWN0aXZlKHtcbiAgICAgICAgZXhwb3J0QXM6ICdrZW5kb1dpbmRvd0Nsb3NlQWN0aW9uJyxcbiAgICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgICAgICBMb2NhbGl6YXRpb25TZXJ2aWNlLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHByb3ZpZGU6IEwxME5fUFJFRklYLFxuICAgICAgICAgICAgICAgIHVzZVZhbHVlOiAna2VuZG8uYnV0dG9uJ1xuICAgICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBzZWxlY3RvcjogJ2J1dHRvbltrZW5kb1dpbmRvd0Nsb3NlQWN0aW9uXScgLy8gdHNsaW50OmRpc2FibGUtbGluZVxuICAgIH0pLFxuICAgIF9fcGFyYW0oMiwgT3B0aW9uYWwoKSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtFbGVtZW50UmVmLFxuICAgICAgICBSZW5kZXJlcjIsXG4gICAgICAgIERyYWdSZXNpemVTZXJ2aWNlLFxuICAgICAgICBMb2NhbGl6YXRpb25TZXJ2aWNlLFxuICAgICAgICBOZ1pvbmVdKVxuXSwgV2luZG93Q2xvc2VBY3Rpb25EaXJlY3RpdmUpO1xuXG5sZXQgV2luZG93UmVzdG9yZUFjdGlvbkRpcmVjdGl2ZSA9IGNsYXNzIFdpbmRvd1Jlc3RvcmVBY3Rpb25EaXJlY3RpdmUgZXh0ZW5kcyBCdXR0b24ge1xuICAgIGNvbnN0cnVjdG9yKGVsLCByZW5kZXJlciwgX3NlcnZpY2UsIGxvY2FsaXphdGlvbiwgbmdab25lKSB7XG4gICAgICAgIHN1cGVyKGVsLCByZW5kZXJlciwgbnVsbCwgbG9jYWxpemF0aW9uLCBuZ1pvbmUpO1xuICAgICAgICB0aGlzLmJ1dHRvblR5cGUgPSAnYnV0dG9uJztcbiAgICAgICAgdGhpcy53aW5kb3cgPSBfc2VydmljZTtcbiAgICAgICAgdGhpcy5maWxsTW9kZSA9ICdmbGF0JztcbiAgICAgICAgdGhpcy5pY29uID0gJ3dpbmRvdy1yZXN0b3JlJztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIG9uQ2xpY2soKSB7XG4gICAgICAgIGlmICghdGhpcy5pc0Rpc2FibGVkKSB7XG4gICAgICAgICAgICB0aGlzLndpbmRvdy5yZXN0b3JlQWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IHZpc2libGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLndpbmRvdy5vcHRpb25zLnN0YXRlID09PSAnZGVmYXVsdCcgPyAnbm9uZScgOiAnaW5saW5lLWZsZXgnO1xuICAgIH1cbn07XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBPYmplY3QpXG5dLCBXaW5kb3dSZXN0b3JlQWN0aW9uRGlyZWN0aXZlLnByb3RvdHlwZSwgXCJ3aW5kb3dcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdhdHRyLnR5cGUnKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKVxuXSwgV2luZG93UmVzdG9yZUFjdGlvbkRpcmVjdGl2ZS5wcm90b3R5cGUsIFwiYnV0dG9uVHlwZVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdExpc3RlbmVyKCdjbGljaycpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBGdW5jdGlvbiksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtdKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnJldHVybnR5cGVcIiwgdm9pZCAwKVxuXSwgV2luZG93UmVzdG9yZUFjdGlvbkRpcmVjdGl2ZS5wcm90b3R5cGUsIFwib25DbGlja1wiLCBudWxsKTtcbl9fZGVjb3JhdGUoW1xuICAgIEhvc3RCaW5kaW5nKCdzdHlsZS5kaXNwbGF5JyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFN0cmluZyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtdKVxuXSwgV2luZG93UmVzdG9yZUFjdGlvbkRpcmVjdGl2ZS5wcm90b3R5cGUsIFwidmlzaWJsZVwiLCBudWxsKTtcbldpbmRvd1Jlc3RvcmVBY3Rpb25EaXJlY3RpdmUgPSBfX2RlY29yYXRlKFtcbiAgICBEaXJlY3RpdmUoe1xuICAgICAgICBleHBvcnRBczogJ2tlbmRvV2luZG93UmVzdG9yZUFjdGlvbicsXG4gICAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICAgICAgTG9jYWxpemF0aW9uU2VydmljZSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBwcm92aWRlOiBMMTBOX1BSRUZJWCxcbiAgICAgICAgICAgICAgICB1c2VWYWx1ZTogJ2tlbmRvLmJ1dHRvbidcbiAgICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgc2VsZWN0b3I6ICdidXR0b25ba2VuZG9XaW5kb3dSZXN0b3JlQWN0aW9uXScgLy8gdHNsaW50OmRpc2FibGUtbGluZVxuICAgIH0pLFxuICAgIF9fcGFyYW0oMiwgT3B0aW9uYWwoKSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtFbGVtZW50UmVmLFxuICAgICAgICBSZW5kZXJlcjIsXG4gICAgICAgIERyYWdSZXNpemVTZXJ2aWNlLFxuICAgICAgICBMb2NhbGl6YXRpb25TZXJ2aWNlLFxuICAgICAgICBOZ1pvbmVdKVxuXSwgV2luZG93UmVzdG9yZUFjdGlvbkRpcmVjdGl2ZSk7XG5cbi8qKlxuICogVGhlIHNldHRpbmdzIGZvciB0aGUgV2luZG93IGFjdGlvbnMgd2hlbiB0aGUgV2luZG93IGlzIG9wZW5lZCB0aHJvdWdoIGBXaW5kb3dTZXJ2aWNlYFxuICogKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBhcGlfZGlhbG9nX3dpbmRvd3NlcnZpY2UgJX0jdG9jLW9wZW4pKS5cbiAqL1xuY2xhc3MgV2luZG93U2V0dGluZ3Mge1xufVxuLyoqXG4gKiBJbmRpY2F0ZXMgdGhhdCB0aGUgKipDbG9zZSoqIGJ1dHRvbiBvZiBhIFdpbmRvdyB0aGF0IGlzIG9wZW5lZCB0aHJvdWdoIGBXaW5kb3dTZXJ2aWNlYCBpcyBjbGlja2VkLlxuICovXG5jbGFzcyBXaW5kb3dDbG9zZVJlc3VsdCB7XG59XG4vKipcbiAqIEhvbGRzIHJlZmVyZW5jZXMgdG8gdGhlIG9iamVjdCBpbnN0YW5jZSBvZiB0aGUgV2luZG93LlxuICogQ29udHJvbHMgdGhlIFdpbmRvd3MgdGhhdCB3ZXJlIG9wZW5lZCB0aHJvdWdoIGBXaW5kb3dTZXJ2aWNlYFxuICogKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBhcGlfZGlhbG9nX3dpbmRvd3NlcnZpY2UgJX0jdG9jLW9wZW4pKS5cbiAqL1xuY2xhc3MgV2luZG93UmVmIHtcbn1cblxudmFyIFdpbmRvd0NvbnRhaW5lclNlcnZpY2VfMTtcbi8qKlxuICogQGhpZGRlblxuICovXG5sZXQgV2luZG93Q29udGFpbmVyU2VydmljZSA9IFdpbmRvd0NvbnRhaW5lclNlcnZpY2VfMSA9IGNsYXNzIFdpbmRvd0NvbnRhaW5lclNlcnZpY2Uge1xuICAgIHNldCBjb250YWluZXIoY29udGFpbmVyKSB7XG4gICAgICAgIFdpbmRvd0NvbnRhaW5lclNlcnZpY2VfMS5jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgfVxuICAgIGdldCBjb250YWluZXIoKSB7XG4gICAgICAgIHJldHVybiBXaW5kb3dDb250YWluZXJTZXJ2aWNlXzEuY29udGFpbmVyO1xuICAgIH1cbn07XG5XaW5kb3dDb250YWluZXJTZXJ2aWNlLmNvbnRhaW5lciA9IG51bGw7XG5XaW5kb3dDb250YWluZXJTZXJ2aWNlID0gV2luZG93Q29udGFpbmVyU2VydmljZV8xID0gX19kZWNvcmF0ZShbXG4gICAgSW5qZWN0YWJsZSgpXG5dLCBXaW5kb3dDb250YWluZXJTZXJ2aWNlKTtcblxuY29uc3QgaXNOb3RDb21wb25lbnQkMSA9IChjb21wb25lbnQpID0+IGlzU3RyaW5nKGNvbXBvbmVudCkgfHwgY29tcG9uZW50IGluc3RhbmNlb2YgVGVtcGxhdGVSZWY7XG5jbGFzcyBXaW5kb3dJbmplY3RvciB7XG4gICAgY29uc3RydWN0b3IoZ2V0V2luZG93UmVmLCBwYXJlbnRJbmplY3Rvcikge1xuICAgICAgICB0aGlzLmdldFdpbmRvd1JlZiA9IGdldFdpbmRvd1JlZjtcbiAgICAgICAgdGhpcy5wYXJlbnRJbmplY3RvciA9IHBhcmVudEluamVjdG9yO1xuICAgIH1cbiAgICBnZXQodG9rZW4sIG5vdEZvdW5kVmFsdWUpIHtcbiAgICAgICAgaWYgKHRva2VuID09PSBXaW5kb3dSZWYpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFdpbmRvd1JlZigpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnBhcmVudEluamVjdG9yLmdldCh0b2tlbiwgbm90Rm91bmRWYWx1ZSk7XG4gICAgfVxufVxuLyoqXG4gKiBBIHNlcnZpY2UgZm9yIG9wZW5pbmcgV2luZG93cyBkeW5hbWljYWxseVxuICogKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBzZXJ2aWNlX3dpbmRvdyAlfSkpLlxuICovXG5sZXQgV2luZG93U2VydmljZSA9IGNsYXNzIFdpbmRvd1NlcnZpY2Uge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICByZXNvbHZlciwgY29udGFpbmVyU2VydmljZSkge1xuICAgICAgICB0aGlzLnJlc29sdmVyID0gcmVzb2x2ZXI7XG4gICAgICAgIHRoaXMuY29udGFpbmVyU2VydmljZSA9IGNvbnRhaW5lclNlcnZpY2U7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE9wZW5zIGEgV2luZG93IGNvbXBvbmVudC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7V2luZG93U2V0dGluZ3N9IHNldHRpbmdzIC0gVGhlIHNldHRpbmdzIHRoYXQgZGVmaW5lIHRoZSBXaW5kb3cuXG4gICAgICogQHJldHVybnMge1dpbmRvd1JlZn0gLSBBIHJlZmVyZW5jZSB0byB0aGUgV2luZG93IG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiBgYGB0cy1uby1ydW5cbiAgICAgKiBfQENvbXBvbmVudCh7XG4gICAgICogICBzZWxlY3RvcjogJ215LWFwcCcsXG4gICAgICogICB0ZW1wbGF0ZTogYFxuICAgICAqICAgICA8YnV0dG9uIGtlbmRvQnV0dG9uIChjbGljayk9XCJvcGVuKClcIj5PcGVuIHdpbmRvdzwvYnV0dG9uPlxuICAgICAqICAgICA8ZGl2IGtlbmRvV2luZG93Q29udGFpbmVyPjwvZGl2PlxuICAgICAqICAgYFxuICAgICAqIH0pXG4gICAgICogZXhwb3J0IGNsYXNzIEFwcENvbXBvbmVudCB7XG4gICAgICogICAgIGNvbnN0cnVjdG9yKCBwcml2YXRlIHdpbmRvd1NlcnZpY2U6IFdpbmRvd1NlcnZpY2UgKSB7fVxuICAgICAqXG4gICAgICogICAgIHB1YmxpYyBvcGVuKCkge1xuICAgICAqICAgICAgICAgdmFyIHdpbmRvdyA9IHRoaXMud2luZG93U2VydmljZS5vcGVuKHtcbiAgICAgKiAgICAgICAgICAgdGl0bGU6IFwiTXkgd2luZG93XCIsXG4gICAgICogICAgICAgICAgIGNvbnRlbnQ6IFwiTXkgY29udGVudCFcIlxuICAgICAqICAgICAgICAgfSk7XG4gICAgICpcbiAgICAgKiAgICAgICAgIHdpbmRvdy5yZXN1bHQuc3Vic2NyaWJlKChyZXN1bHQpID0+IHtcbiAgICAgKiAgICAgICAgICAgaWYgKHJlc3VsdCBpbnN0YW5jZW9mIFdpbmRvd0Nsb3NlUmVzdWx0KSB7XG4gICAgICogICAgICAgICAgICAgY29uc29sZS5sb2coXCJXaW5kb3cgd2FzIGNsb3NlZFwiKTtcbiAgICAgKiAgICAgICAgICAgfVxuICAgICAqICAgICAgICAgfSk7XG4gICAgICogICAgIH1cbiAgICAgKiB9XG4gICAgICogYGBgXG4gICAgICpcbiAgICAgKi9cbiAgICBvcGVuKHNldHRpbmdzKSB7XG4gICAgICAgIGNvbnN0IGZhY3RvcnkgPSB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFdpbmRvd0NvbXBvbmVudCk7XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IHNldHRpbmdzLmFwcGVuZFRvIHx8IHRoaXMuY29udGFpbmVyU2VydmljZS5jb250YWluZXI7XG4gICAgICAgIGlmICghY29udGFpbmVyKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBhdHRhY2ggd2luZG93IHRvIHRoZSBwYWdlLlxuICAgICAgICAgICAgICAgIEFkZCBhbiBlbGVtZW50IHRoYXQgdXNlcyB0aGUga2VuZG9XaW5kb3dDb250YWluZXIgZGlyZWN0aXZlLCBvciBzZXQgdGhlICdhcHBlbmRUbycgcHJvcGVydHkuXG4gICAgICAgICAgICAgICAgU2VlIGh0dHBzOi8vd3d3LnRlbGVyaWsuY29tL2tlbmRvLWFuZ3VsYXItdWkvY29tcG9uZW50cy9kaWFsb2dzL3dpbmRvdy9zZXJ2aWNlL1xuICAgICAgICAgICAgYCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgd2luZG93UmVmID0ge1xuICAgICAgICAgICAgY2xvc2U6ICgpID0+IHsgfSxcbiAgICAgICAgICAgIGNvbnRlbnQ6IG51bGwsXG4gICAgICAgICAgICByZXN1bHQ6IG51bGwsXG4gICAgICAgICAgICB3aW5kb3c6IG51bGxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgY29udGVudCA9IHRoaXMuY29udGVudEZyb20oc2V0dGluZ3MuY29udGVudCwgY29udGFpbmVyLCB3aW5kb3dSZWYpO1xuICAgICAgICBjb25zdCB3aW5kb3cgPSBjb250YWluZXIuY3JlYXRlQ29tcG9uZW50KGZhY3RvcnksIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBjb250ZW50Lm5vZGVzKTtcbiAgICAgICAgd2luZG93UmVmLndpbmRvdyA9IHdpbmRvdztcbiAgICAgICAgdGhpcy5hcHBseU9wdGlvbnMod2luZG93Lmluc3RhbmNlLCBzZXR0aW5ncyk7XG4gICAgICAgIGNvbnN0IGFwaUNsb3NlID0gbmV3IFN1YmplY3QoKTtcbiAgICAgICAgY29uc3QgY2xvc2UgPSAoZSkgPT4ge1xuICAgICAgICAgICAgYXBpQ2xvc2UubmV4dChlIHx8IG5ldyBXaW5kb3dDbG9zZVJlc3VsdCgpKTtcbiAgICAgICAgICAgIGlmIChjb250ZW50LmNvbXBvbmVudFJlZikge1xuICAgICAgICAgICAgICAgIGNvbnRlbnQuY29tcG9uZW50UmVmLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHdpbmRvdy5kZXN0cm95KCk7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IG1lcmdlKGFwaUNsb3NlLCB3aW5kb3cuaW5zdGFuY2UuY2xvc2UucGlwZShtYXAoZSA9PiAoZSA/IGUgOiBuZXcgV2luZG93Q2xvc2VSZXN1bHQoKSkpLCBmaWx0ZXIoKGUpID0+IHtcbiAgICAgICAgICAgIGlmIChzZXR0aW5ncy5wcmV2ZW50Q2xvc2UpIHtcbiAgICAgICAgICAgICAgICAvLyBhZGQgd2luZG93UmVmIG9ubHkgd2hlbiB1c2luZyBjb21wb25lbnRcbiAgICAgICAgICAgICAgICBjb25zdCB3aW5kb3dSZWZQYXJhbWV0ZXIgPSBpc05vdENvbXBvbmVudCQxKHNldHRpbmdzLmNvbnRlbnQpID8gdW5kZWZpbmVkIDogd2luZG93UmVmO1xuICAgICAgICAgICAgICAgIHJldHVybiAhc2V0dGluZ3MucHJldmVudENsb3NlKGUsIHdpbmRvd1JlZlBhcmFtZXRlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSkpKS5waXBlKHRha2UoMSksIFxuICAgICAgICAvLyBUYWtlcyBjYXJlIGZvciBtdWx0aXBsZSBzdWJzY3JpcHRpb25zOlxuICAgICAgICAvLyBXZSBzdWJzY3JpYmUgaW50ZXJuYWxseSBhbmQgdGhlIHVzZXIgbWF5IHN1YnNjcmliZSB0byBnZXQgYSBjbG9zZSByZXN1bHQgLSB3aW5kb3cucmVzdWx0LnN1YnNjcmliZSgpLlxuICAgICAgICAvLyBUaGlzIGNhdXNlcyBtdWx0aXBsZSBzdWJzY3JpcHRpb25zIHRvIHRoZSBzYW1lIHNvdXJjZSBhbmQgdGh1cyBtdWx0aXBsZSBlbWlzc2lvbnMuIHNoYXJlKCkgc29sdmVzIHRoYXQuXG4gICAgICAgIHNoYXJlKCkpO1xuICAgICAgICByZXN1bHQuc3Vic2NyaWJlKGNsb3NlKTtcbiAgICAgICAgd2luZG93UmVmLmNsb3NlID0gY2xvc2U7XG4gICAgICAgIHdpbmRvd1JlZi5yZXN1bHQgPSByZXN1bHQ7XG4gICAgICAgIHdpbmRvdy5jaGFuZ2VEZXRlY3RvclJlZi5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgcmV0dXJuIHdpbmRvd1JlZjtcbiAgICB9XG4gICAgYXBwbHlPcHRpb25zKGluc3RhbmNlLCBvcHRpb25zKSB7XG4gICAgICAgIGlmIChpc1ByZXNlbnQob3B0aW9ucy5odG1sQXR0cmlidXRlcykpIHtcbiAgICAgICAgICAgIGluc3RhbmNlLmh0bWxBdHRyaWJ1dGVzID0gb3B0aW9ucy5odG1sQXR0cmlidXRlcztcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNQcmVzZW50KG9wdGlvbnMuY3NzQ2xhc3MpKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS5jc3NDbGFzcyA9IG9wdGlvbnMuY3NzQ2xhc3M7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzUHJlc2VudChvcHRpb25zLnRpdGxlKSkge1xuICAgICAgICAgICAgaW5zdGFuY2UudGl0bGUgPSBvcHRpb25zLnRpdGxlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1ByZXNlbnQob3B0aW9ucy5rZWVwQ29udGVudCkpIHtcbiAgICAgICAgICAgIGluc3RhbmNlLmtlZXBDb250ZW50ID0gb3B0aW9ucy5rZWVwQ29udGVudDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNQcmVzZW50KG9wdGlvbnMud2lkdGgpKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS53aWR0aCA9IG9wdGlvbnMud2lkdGg7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzUHJlc2VudChvcHRpb25zLm1pbldpZHRoKSkge1xuICAgICAgICAgICAgaW5zdGFuY2UubWluV2lkdGggPSBvcHRpb25zLm1pbldpZHRoO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1ByZXNlbnQob3B0aW9ucy5oZWlnaHQpKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS5oZWlnaHQgPSBvcHRpb25zLmhlaWdodDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNQcmVzZW50KG9wdGlvbnMubWluSGVpZ2h0KSkge1xuICAgICAgICAgICAgaW5zdGFuY2UubWluSGVpZ2h0ID0gb3B0aW9ucy5taW5IZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzUHJlc2VudChvcHRpb25zLmxlZnQpKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS5sZWZ0ID0gb3B0aW9ucy5sZWZ0O1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1ByZXNlbnQob3B0aW9ucy50b3ApKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS50b3AgPSBvcHRpb25zLnRvcDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNQcmVzZW50KG9wdGlvbnMuZHJhZ2dhYmxlKSkge1xuICAgICAgICAgICAgaW5zdGFuY2UuZHJhZ2dhYmxlID0gb3B0aW9ucy5kcmFnZ2FibGU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzUHJlc2VudChvcHRpb25zLnJlc2l6YWJsZSkpIHtcbiAgICAgICAgICAgIGluc3RhbmNlLnJlc2l6YWJsZSA9IG9wdGlvbnMucmVzaXphYmxlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1ByZXNlbnQob3B0aW9ucy5tZXNzYWdlcyAmJiBvcHRpb25zLm1lc3NhZ2VzLmNsb3NlVGl0bGUpKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS5tZXNzYWdlcy5jbG9zZVRpdGxlID0gb3B0aW9ucy5tZXNzYWdlcy5jbG9zZVRpdGxlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1ByZXNlbnQob3B0aW9ucy5tZXNzYWdlcyAmJiBvcHRpb25zLm1lc3NhZ2VzLnJlc3RvcmVUaXRsZSkpIHtcbiAgICAgICAgICAgIGluc3RhbmNlLm1lc3NhZ2VzLnJlc3RvcmVUaXRsZSA9IG9wdGlvbnMubWVzc2FnZXMucmVzdG9yZVRpdGxlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1ByZXNlbnQob3B0aW9ucy5tZXNzYWdlcyAmJiBvcHRpb25zLm1lc3NhZ2VzLm1heGltaXplVGl0bGUpKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS5tZXNzYWdlcy5tYXhpbWl6ZVRpdGxlID0gb3B0aW9ucy5tZXNzYWdlcy5tYXhpbWl6ZVRpdGxlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1ByZXNlbnQob3B0aW9ucy5tZXNzYWdlcyAmJiBvcHRpb25zLm1lc3NhZ2VzLm1pbmltaXplVGl0bGUpKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS5tZXNzYWdlcy5taW5pbWl6ZVRpdGxlID0gb3B0aW9ucy5tZXNzYWdlcy5taW5pbWl6ZVRpdGxlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1ByZXNlbnQob3B0aW9ucy5hdXRvRm9jdXNlZEVsZW1lbnQpKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS5hdXRvRm9jdXNlZEVsZW1lbnQgPSBvcHRpb25zLmF1dG9Gb2N1c2VkRWxlbWVudDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNQcmVzZW50KG9wdGlvbnMuc3RhdGUpKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS5zdGF0ZSA9IG9wdGlvbnMuc3RhdGU7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5zdGF0ZSA9PT0gJ21pbmltaXplZCcpIHtcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5rZWVwQ29udGVudCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMuY29udGVudCBpbnN0YW5jZW9mIFRlbXBsYXRlUmVmKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS5jb250ZW50VGVtcGxhdGUgPSBvcHRpb25zLmNvbnRlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMudGl0bGVCYXJDb250ZW50IGluc3RhbmNlb2YgVGVtcGxhdGVSZWYpIHtcbiAgICAgICAgICAgIGluc3RhbmNlLnRpdGxlQmFyVGVtcGxhdGUgPSBvcHRpb25zLnRpdGxlQmFyQ29udGVudDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb250ZW50RnJvbShjb250ZW50LCBjb250YWluZXIsIHdpbmRvd1JlZikge1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IGNvbnRhaW5lci5pbmplY3Rvci5nZXQoUmVuZGVyZXIyKTtcbiAgICAgICAgbGV0IG5vZGVzID0gW107XG4gICAgICAgIGxldCBjb21wb25lbnRSZWYgPSBudWxsO1xuICAgICAgICBpZiAodHlwZW9mIGNvbnRlbnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBub2RlcyA9IFtyZW5kZXJlci5jcmVhdGVUZXh0KGNvbnRlbnQpXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb250ZW50ICYmICEoY29udGVudCBpbnN0YW5jZW9mIFRlbXBsYXRlUmVmKSkge1xuICAgICAgICAgICAgY29uc3QgaW5qZWN0b3IgPSBuZXcgV2luZG93SW5qZWN0b3IoKCkgPT4gd2luZG93UmVmLCBjb250YWluZXIuaW5qZWN0b3IpO1xuICAgICAgICAgICAgY29uc3QgZmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoY29udGVudCk7XG4gICAgICAgICAgICBjb21wb25lbnRSZWYgPSBjb250YWluZXIuY3JlYXRlQ29tcG9uZW50KGZhY3RvcnksIHVuZGVmaW5lZCwgaW5qZWN0b3IpO1xuICAgICAgICAgICAgbm9kZXMgPSBbY29tcG9uZW50UmVmLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnRdO1xuICAgICAgICAgICAgd2luZG93UmVmLmNvbnRlbnQgPSBjb21wb25lbnRSZWY7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbXBvbmVudFJlZixcbiAgICAgICAgICAgIG5vZGVzOiBbXG4gICAgICAgICAgICAgICAgW10sXG4gICAgICAgICAgICAgICAgbm9kZXMgLy8gQ29udGVudFxuICAgICAgICAgICAgXVxuICAgICAgICB9O1xuICAgIH1cbn07XG5XaW5kb3dTZXJ2aWNlID0gX19kZWNvcmF0ZShbXG4gICAgSW5qZWN0YWJsZSgpLFxuICAgIF9fcGFyYW0oMSwgSW5qZWN0KFdpbmRvd0NvbnRhaW5lclNlcnZpY2UpKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW0NvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgICAgICAgV2luZG93Q29udGFpbmVyU2VydmljZV0pXG5dLCBXaW5kb3dTZXJ2aWNlKTtcblxuLyoqXG4gKiBQcm92aWRlcyBhbiBpbnNlcnRpb24gcG9pbnQgZm9yIHRoZSBEaWFsb2dzIHdoaWNoIGFyZSBjcmVhdGVkIHRocm91Z2ggdGhlXG4gKiBEaWFsb2cgc2VydmljZSAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIGFwaV9kaWFsb2dfZGlhbG9nc2VydmljZSAlfSN0b2Mtb3BlbikpLlxuICogQ3JlYXRlZCBEaWFsb2dzIHdpbGwgYmUgbW91bnRlZCBhZnRlciB0aGF0IGVsZW1lbnQuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGh0bWwtbm8tcnVuXG4gKiA8ZGl2IGtlbmRvRGlhbG9nQ29udGFpbmVyPjwvZGl2PlxuICogYGBgXG4gKi9cbmxldCBEaWFsb2dDb250YWluZXJEaXJlY3RpdmUgPSBjbGFzcyBEaWFsb2dDb250YWluZXJEaXJlY3RpdmUge1xuICAgIGNvbnN0cnVjdG9yKGNvbnRhaW5lciwgc2VydmljZSkge1xuICAgICAgICBzZXJ2aWNlLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICB9XG59O1xuRGlhbG9nQ29udGFpbmVyRGlyZWN0aXZlID0gX19kZWNvcmF0ZShbXG4gICAgRGlyZWN0aXZlKHtcbiAgICAgICAgc2VsZWN0b3I6ICdba2VuZG9EaWFsb2dDb250YWluZXJdJ1xuICAgIH0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbVmlld0NvbnRhaW5lclJlZixcbiAgICAgICAgRGlhbG9nQ29udGFpbmVyU2VydmljZV0pXG5dLCBEaWFsb2dDb250YWluZXJEaXJlY3RpdmUpO1xuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY2xhc3MgTWVzc2FnZXMgZXh0ZW5kcyBDb21wb25lbnRNZXNzYWdlcyB7XG59XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpXG5dLCBNZXNzYWdlcy5wcm90b3R5cGUsIFwiY2xvc2VUaXRsZVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKVxuXSwgTWVzc2FnZXMucHJvdG90eXBlLCBcInJlc3RvcmVUaXRsZVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKVxuXSwgTWVzc2FnZXMucHJvdG90eXBlLCBcIm1heGltaXplVGl0bGVcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFN0cmluZylcbl0sIE1lc3NhZ2VzLnByb3RvdHlwZSwgXCJtaW5pbWl6ZVRpdGxlXCIsIHZvaWQgMCk7XG5cbnZhciBMb2NhbGl6ZWRNZXNzYWdlc0RpcmVjdGl2ZV8xO1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmxldCBMb2NhbGl6ZWRNZXNzYWdlc0RpcmVjdGl2ZSA9IExvY2FsaXplZE1lc3NhZ2VzRGlyZWN0aXZlXzEgPSBjbGFzcyBMb2NhbGl6ZWRNZXNzYWdlc0RpcmVjdGl2ZSBleHRlbmRzIE1lc3NhZ2VzIHtcbiAgICBjb25zdHJ1Y3RvcihzZXJ2aWNlKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuc2VydmljZSA9IHNlcnZpY2U7XG4gICAgfVxufTtcbkxvY2FsaXplZE1lc3NhZ2VzRGlyZWN0aXZlID0gTG9jYWxpemVkTWVzc2FnZXNEaXJlY3RpdmVfMSA9IF9fZGVjb3JhdGUoW1xuICAgIERpcmVjdGl2ZSh7XG4gICAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHByb3ZpZGU6IE1lc3NhZ2VzLFxuICAgICAgICAgICAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IExvY2FsaXplZE1lc3NhZ2VzRGlyZWN0aXZlXzEpXG4gICAgICAgICAgICB9XG4gICAgICAgIF0sXG4gICAgICAgIHNlbGVjdG9yOiBgXG4gICAgW2tlbmRvRGlhbG9nTG9jYWxpemVkTWVzc2FnZXNdLFxuICAgIFtrZW5kb1dpbmRvd0xvY2FsaXplZE1lc3NhZ2VzXSxcbiAgICBba2VuZG9EaWFsb2dUaXRsZUJhckxvY2FsaXplZE1lc3NhZ2VzXVxuICBgXG4gICAgfSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtMb2NhbGl6YXRpb25TZXJ2aWNlXSlcbl0sIExvY2FsaXplZE1lc3NhZ2VzRGlyZWN0aXZlKTtcblxudmFyIEN1c3RvbU1lc3NhZ2VzQ29tcG9uZW50XzE7XG4vKipcbiAqIEN1c3RvbSBjb21wb25lbnQgbWVzc2FnZXMgb3ZlcnJpZGUgZGVmYXVsdCBjb21wb25lbnQgbWVzc2FnZXNcbiAqIChbc2VlIGV4YW1wbGVdKHslIHNsdWcgZ2xvYmFsaXphdGlvbl9kaWFsb2dzICV9I3RvYy1sb2NhbGl6YXRpb24pKS5cbiAqL1xubGV0IEN1c3RvbU1lc3NhZ2VzQ29tcG9uZW50ID0gQ3VzdG9tTWVzc2FnZXNDb21wb25lbnRfMSA9IGNsYXNzIEN1c3RvbU1lc3NhZ2VzQ29tcG9uZW50IGV4dGVuZHMgTWVzc2FnZXMge1xuICAgIGNvbnN0cnVjdG9yKHNlcnZpY2UpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlID0gc2VydmljZTtcbiAgICB9XG4gICAgZ2V0IG92ZXJyaWRlKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG59O1xuQ3VzdG9tTWVzc2FnZXNDb21wb25lbnQgPSBDdXN0b21NZXNzYWdlc0NvbXBvbmVudF8xID0gX19kZWNvcmF0ZShbXG4gICAgQ29tcG9uZW50KHtcbiAgICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcHJvdmlkZTogTWVzc2FnZXMsXG4gICAgICAgICAgICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gQ3VzdG9tTWVzc2FnZXNDb21wb25lbnRfMSkgLy8gdHNsaW50OmRpc2FibGUtbGluZTpuby1mb3J3YXJkLXJlZlxuICAgICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBzZWxlY3RvcjogJ2tlbmRvLWRpYWxvZy1tZXNzYWdlcywga2VuZG8td2luZG93LW1lc3NhZ2VzJyxcbiAgICAgICAgdGVtcGxhdGU6IGBgXG4gICAgfSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtMb2NhbGl6YXRpb25TZXJ2aWNlXSlcbl0sIEN1c3RvbU1lc3NhZ2VzQ29tcG9uZW50KTtcblxuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IFNIQVJFRF9ESVJFQ1RJVkVTID0gW1xuICAgIERpYWxvZ0FjdGlvbnNDb21wb25lbnQsXG4gICAgQ3VzdG9tTWVzc2FnZXNDb21wb25lbnQsXG4gICAgTG9jYWxpemVkTWVzc2FnZXNEaXJlY3RpdmVcbl07XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xubGV0IFNoYXJlZE1vZHVsZSA9IGNsYXNzIFNoYXJlZE1vZHVsZSB7XG59O1xuU2hhcmVkTW9kdWxlID0gX19kZWNvcmF0ZShbXG4gICAgTmdNb2R1bGUoe1xuICAgICAgICBkZWNsYXJhdGlvbnM6IFtTSEFSRURfRElSRUNUSVZFU10sXG4gICAgICAgIGV4cG9ydHM6IFtTSEFSRURfRElSRUNUSVZFUywgQ29tbW9uTW9kdWxlXSxcbiAgICAgICAgaW1wb3J0czogW0NvbW1vbk1vZHVsZV1cbiAgICB9KVxuXSwgU2hhcmVkTW9kdWxlKTtcblxuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IERJQUxPR19ESVJFQ1RJVkVTID0gW1xuICAgIERpYWxvZ0NvbXBvbmVudCxcbiAgICBEaWFsb2dUaXRsZUJhckNvbXBvbmVudFxuXTtcbi8qKlxuICogUmVwcmVzZW50cyB0aGUgW05nTW9kdWxlXSh7eyBzaXRlLmRhdGEudXJscy5hbmd1bGFyWyduZ21vZHVsZWFwaSddIH19KVxuICogZGVmaW5pdGlvbiBmb3IgdGhlIERpYWxvZyBjb21wb25lbnQgdGhhdCBpbmNsdWRlcyBhbGwgRGlhbG9nIGNvbXBvbmVudHMgYW5kIGRpcmVjdGl2ZXMuXG4gKiBJbXBvcnRzIGBEaWFsb2dNb2R1bGVgIGludG8gdGhlIFtyb290IG1vZHVsZV0oe3sgc2l0ZS5kYXRhLnVybHMuYW5ndWxhclsnbmdtb2R1bGVzJ10gfX0jYW5ndWxhci1tb2R1bGFyaXR5KVxuICogb2YgeW91ciBhcHBsaWNhdGlvbiBvciBpbnRvIGFueSBvdGhlciBzdWItbW9kdWxlIHRoYXQgd2lsbCB1c2UgdGhlIERpYWxvZyBjb21wb25lbnQuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHRzLW5vLXJ1blxuICogaW1wb3J0IHsgTmdNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbiAqIGltcG9ydCB7IEJyb3dzZXJNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcbiAqIGltcG9ydCB7IERpYWxvZ01vZHVsZSB9IGZyb20gJ0Bwcm9ncmVzcy9rZW5kby1hbmd1bGFyLWRpYWxvZyc7XG4gKiBpbXBvcnQgeyBBcHBDb21wb25lbnQgfSBmcm9tICcuL2FwcC5jb21wb25lbnQnO1xuICpcbiAqIF9ATmdNb2R1bGUoe1xuICogICAgIGJvb3RzdHJhcDogICAgW0FwcENvbXBvbmVudF0sXG4gKiAgICAgZGVjbGFyYXRpb25zOiBbQXBwQ29tcG9uZW50XSxcbiAqICAgICBpbXBvcnRzOiAgICAgIFtCcm93c2VyTW9kdWxlLCBEaWFsb2dNb2R1bGVdXG4gKiB9KVxuICogZXhwb3J0IGNsYXNzIEFwcE1vZHVsZSB7XG4gKiB9XG4gKiBgYGBcbiAqL1xubGV0IERpYWxvZ01vZHVsZSA9IGNsYXNzIERpYWxvZ01vZHVsZSB7XG59O1xuRGlhbG9nTW9kdWxlID0gX19kZWNvcmF0ZShbXG4gICAgTmdNb2R1bGUoe1xuICAgICAgICBkZWNsYXJhdGlvbnM6IFtESUFMT0dfRElSRUNUSVZFUywgRGlhbG9nQ29udGFpbmVyRGlyZWN0aXZlXSxcbiAgICAgICAgZW50cnlDb21wb25lbnRzOiBbRElBTE9HX0RJUkVDVElWRVNdLFxuICAgICAgICBleHBvcnRzOiBbRElBTE9HX0RJUkVDVElWRVMsIFNIQVJFRF9ESVJFQ1RJVkVTLCBEaWFsb2dDb250YWluZXJEaXJlY3RpdmVdLFxuICAgICAgICBpbXBvcnRzOiBbU2hhcmVkTW9kdWxlXSxcbiAgICAgICAgcHJvdmlkZXJzOiBbRGlhbG9nQ29udGFpbmVyU2VydmljZSwgRGlhbG9nU2VydmljZV1cbiAgICB9KVxuXSwgRGlhbG9nTW9kdWxlKTtcblxuLyoqXG4gKiBQcm92aWRlcyBhbiBpbnNlcnRpb24gcG9pbnQgZm9yIHRoZSBXaW5kb3dzIHdoaWNoIGFyZSBjcmVhdGVkIHRocm91Z2ggdGhlXG4gKiBXaW5kb3cgc2VydmljZSAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIGFwaV9kaWFsb2dfd2luZG93c2VydmljZSAlfSN0b2Mtb3BlbikpLlxuICogQ3JlYXRlZCBXaW5kb3dzIHdpbGwgYmUgbW91bnRlZCBhZnRlciB0aGF0IGVsZW1lbnQuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGh0bWwtbm8tcnVuXG4gKiA8ZGl2IGtlbmRvV2luZG93Q29udGFpbmVyPjwvZGl2PlxuICogYGBgXG4gKi9cbmxldCBXaW5kb3dDb250YWluZXJEaXJlY3RpdmUgPSBjbGFzcyBXaW5kb3dDb250YWluZXJEaXJlY3RpdmUge1xuICAgIGNvbnN0cnVjdG9yKGNvbnRhaW5lciwgc2VydmljZSkge1xuICAgICAgICBzZXJ2aWNlLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICB9XG59O1xuV2luZG93Q29udGFpbmVyRGlyZWN0aXZlID0gX19kZWNvcmF0ZShbXG4gICAgRGlyZWN0aXZlKHtcbiAgICAgICAgc2VsZWN0b3I6ICdba2VuZG9XaW5kb3dDb250YWluZXJdJ1xuICAgIH0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbVmlld0NvbnRhaW5lclJlZixcbiAgICAgICAgV2luZG93Q29udGFpbmVyU2VydmljZV0pXG5dLCBXaW5kb3dDb250YWluZXJEaXJlY3RpdmUpO1xuXG5jb25zdCBXSU5ET1dfRElSRUNUSVZFUyA9IFtcbiAgICBSZXNpemVIYW5kbGVEaXJlY3RpdmUsXG4gICAgV2luZG93Q29tcG9uZW50LFxuICAgIFdpbmRvd1RpdGxlQmFyQ29tcG9uZW50LFxuICAgIFdpbmRvd0Nsb3NlQWN0aW9uRGlyZWN0aXZlLFxuICAgIFdpbmRvd01pbmltaXplQWN0aW9uRGlyZWN0aXZlLFxuICAgIFdpbmRvd01heGltaXplQWN0aW9uRGlyZWN0aXZlLFxuICAgIFdpbmRvd1Jlc3RvcmVBY3Rpb25EaXJlY3RpdmVcbl07XG5jb25zdCBFTlRSWV9DT01QT05FTlRTID0gW1xuICAgIFdpbmRvd0NvbXBvbmVudCxcbiAgICBXaW5kb3dUaXRsZUJhckNvbXBvbmVudFxuXTtcbmNvbnN0IGV4cG9ydGVkTW9kdWxlcyA9IFtcbiAgICBXaW5kb3dDb21wb25lbnQsXG4gICAgV2luZG93Q2xvc2VBY3Rpb25EaXJlY3RpdmUsXG4gICAgV2luZG93TWluaW1pemVBY3Rpb25EaXJlY3RpdmUsXG4gICAgV2luZG93TWF4aW1pemVBY3Rpb25EaXJlY3RpdmUsXG4gICAgV2luZG93UmVzdG9yZUFjdGlvbkRpcmVjdGl2ZSxcbiAgICBXaW5kb3dUaXRsZUJhckNvbXBvbmVudFxuXTtcbi8qKlxuICogUmVwcmVzZW50cyB0aGUgW05nTW9kdWxlXSh7eyBzaXRlLmRhdGEudXJscy5hbmd1bGFyWyduZ21vZHVsZWFwaSddIH19KVxuICogZGVmaW5pdGlvbiBmb3IgdGhlIFdpbmRvdyBjb21wb25lbnQuIEltcG9ydHMgYFdpbmRvd01vZHVsZWAgaW50byB0aGVcbiAqIFtyb290IG1vZHVsZV0oe3sgc2l0ZS5kYXRhLnVybHMuYW5ndWxhclsnbmdtb2R1bGVzJ10gfX0jYW5ndWxhci1tb2R1bGFyaXR5KVxuICogb2YgeW91ciBhcHBsaWNhdGlvbiBvciBpbnRvIGFueSBvdGhlciBzdWItbW9kdWxlIHRoYXQgd2lsbCB1c2UgdGhlIFdpbmRvdyBjb21wb25lbnQuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHRzLW5vLXJ1blxuICogaW1wb3J0IHsgTmdNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbiAqIGltcG9ydCB7IEJyb3dzZXJNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcbiAqIGltcG9ydCB7IFdpbmRvd01vZHVsZSB9IGZyb20gJ0Bwcm9ncmVzcy9rZW5kby1hbmd1bGFyLXdpbmRvdyc7XG4gKiBpbXBvcnQgeyBBcHBDb21wb25lbnQgfSBmcm9tICcuL2FwcC5jb21wb25lbnQnO1xuICpcbiAqIF9ATmdNb2R1bGUoe1xuICogICAgIGJvb3RzdHJhcDogICAgW0FwcENvbXBvbmVudF0sXG4gKiAgICAgZGVjbGFyYXRpb25zOiBbQXBwQ29tcG9uZW50XSxcbiAqICAgICBpbXBvcnRzOiAgICAgIFtCcm93c2VyTW9kdWxlLCBXaW5kb3dNb2R1bGVdXG4gKiB9KVxuICogZXhwb3J0IGNsYXNzIEFwcE1vZHVsZSB7XG4gKiB9XG4gKiBgYGBcbiAqL1xubGV0IFdpbmRvd01vZHVsZSA9IGNsYXNzIFdpbmRvd01vZHVsZSB7XG59O1xuV2luZG93TW9kdWxlID0gX19kZWNvcmF0ZShbXG4gICAgTmdNb2R1bGUoe1xuICAgICAgICBkZWNsYXJhdGlvbnM6IFtXSU5ET1dfRElSRUNUSVZFUywgV2luZG93Q29udGFpbmVyRGlyZWN0aXZlXSxcbiAgICAgICAgZW50cnlDb21wb25lbnRzOiBbRU5UUllfQ09NUE9ORU5UU10sXG4gICAgICAgIGV4cG9ydHM6IFtleHBvcnRlZE1vZHVsZXMsIFNIQVJFRF9ESVJFQ1RJVkVTLCBXaW5kb3dDb250YWluZXJEaXJlY3RpdmVdLFxuICAgICAgICBpbXBvcnRzOiBbU2hhcmVkTW9kdWxlLCBEcmFnZ2FibGVNb2R1bGVdLFxuICAgICAgICBwcm92aWRlcnM6IFtXaW5kb3dDb250YWluZXJTZXJ2aWNlLCBXaW5kb3dTZXJ2aWNlXVxuICAgIH0pXG5dLCBXaW5kb3dNb2R1bGUpO1xuXG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIFtOZ01vZHVsZV0oe3sgc2l0ZS5kYXRhLnVybHMuYW5ndWxhclsnbmdtb2R1bGVhcGknXSB9fSlcbiAqIGRlZmluaXRpb24gZm9yIHRoZSBEaWFsb2dzIGNvbXBvbmVudHMuXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiBgYGB0cy1uby1ydW5cbiAqIGltcG9ydCB7IERpYWxvZ3NNb2R1bGUgfSBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tYW5ndWxhci1kaWFsb2cnO1xuICpcbiAqIGltcG9ydCB7IHBsYXRmb3JtQnJvd3NlckR5bmFtaWMgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyLWR5bmFtaWMnO1xuICogaW1wb3J0IHsgTmdNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbiAqXG4gKiBpbXBvcnQgeyBBcHBDb21wb25lbnQgfSBmcm9tICcuL2FwcC5jb21wb25lbnQnO1xuICpcbiAqIF9ATmdNb2R1bGUoe1xuICogICAgIGRlY2xhcmF0aW9uczogW0FwcENvbXBvbmVudF0sXG4gKiAgICAgaW1wb3J0czogICAgICBbQnJvd3Nlck1vZHVsZSwgRGlhbG9nc01vZHVsZV0sXG4gKiAgICAgYm9vdHN0cmFwOiAgICBbQXBwQ29tcG9uZW50XVxuICogfSlcbiAqIGV4cG9ydCBjbGFzcyBBcHBNb2R1bGUge31cbiAqXG4gKiBwbGF0Zm9ybUJyb3dzZXJEeW5hbWljKCkuYm9vdHN0cmFwTW9kdWxlKEFwcE1vZHVsZSk7XG4gKlxuICogYGBgXG4gKi9cbmxldCBEaWFsb2dzTW9kdWxlID0gY2xhc3MgRGlhbG9nc01vZHVsZSB7XG59O1xuRGlhbG9nc01vZHVsZSA9IF9fZGVjb3JhdGUoW1xuICAgIE5nTW9kdWxlKHtcbiAgICAgICAgZXhwb3J0czogW0RpYWxvZ01vZHVsZSwgV2luZG93TW9kdWxlXVxuICAgIH0pXG5dLCBEaWFsb2dzTW9kdWxlKTtcblxuLyoqXG4gKiBHZW5lcmF0ZWQgYnVuZGxlIGluZGV4LiBEbyBub3QgZWRpdC5cbiAqL1xuXG5leHBvcnQgeyBESUFMT0dfRElSRUNUSVZFUywgRGlhbG9nQ29udGFpbmVyRGlyZWN0aXZlLCBEaWFsb2dDb250YWluZXJTZXJ2aWNlLCBDdXN0b21NZXNzYWdlc0NvbXBvbmVudCwgRElBTE9HX0xPQ0FMSVpBVElPTl9TRVJWSUNFLCBMb2NhbGl6ZWRNZXNzYWdlc0RpcmVjdGl2ZSwgTWVzc2FnZXMsIFRpdGxlQmFyTG9jYWxpemF0aW9uU2VydmljZSwgU0hBUkVEX0RJUkVDVElWRVMsIFNoYXJlZE1vZHVsZSwgRHJhZ1Jlc2l6ZVNlcnZpY2UsIE5hdmlnYXRpb25TZXJ2aWNlLCBXaW5kb3dDb250YWluZXJEaXJlY3RpdmUsIFdpbmRvd0NvbnRhaW5lclNlcnZpY2UsIFJlc2l6ZUhhbmRsZURpcmVjdGl2ZSwgRGlhbG9nQ29tcG9uZW50LCBEaWFsb2dUaXRsZUJhckNvbXBvbmVudCwgRGlhbG9nQ29udGVudEJhc2UsIERpYWxvZ0FjdGlvbnNDb21wb25lbnQsIERpYWxvZ1NlcnZpY2UsIERpYWxvZ0Nsb3NlUmVzdWx0LCBEaWFsb2dSZWYsIERpYWxvZ1NldHRpbmdzLCBEaWFsb2dBY3Rpb24sIFdpbmRvd0NvbXBvbmVudCwgV2luZG93VGl0bGVCYXJDb21wb25lbnQsIFdpbmRvd01heGltaXplQWN0aW9uRGlyZWN0aXZlLCBXaW5kb3dNaW5pbWl6ZUFjdGlvbkRpcmVjdGl2ZSwgV2luZG93Q2xvc2VBY3Rpb25EaXJlY3RpdmUsIFdpbmRvd1Jlc3RvcmVBY3Rpb25EaXJlY3RpdmUsIFdpbmRvd1NldHRpbmdzLCBXaW5kb3dSZWYsIFdpbmRvd0Nsb3NlUmVzdWx0LCBXaW5kb3dTZXJ2aWNlLCBEaWFsb2dNb2R1bGUsIFdpbmRvd01vZHVsZSwgRGlhbG9nc01vZHVsZSB9O1xuIl19