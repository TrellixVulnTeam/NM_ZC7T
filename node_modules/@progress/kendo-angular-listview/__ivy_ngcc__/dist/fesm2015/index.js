/**-----------------------------------------------------------------------------------------
* Copyright © 2021 Progress Software Corporation. All rights reserved.
* Licensed under commercial license. See LICENSE.md in the project root for more information
*-------------------------------------------------------------------------------------------*/
import { __decorate, __metadata, __param } from 'tslib';
import { Injectable, Input, Directive, ElementRef, Renderer2, TemplateRef, Optional, EventEmitter, NgZone, HostBinding, ContentChild, ViewChild, ViewChildren, QueryList, Output, Component, ChangeDetectionStrategy, ViewContainerRef, HostListener, NgModule } from '@angular/core';
import { isDocumentAvailable, Keys, isChanged, hasObservers, EventsModule } from '@progress/kendo-angular-common';
import { validatePackage } from '@progress/kendo-licensing';
import { LocalizationService, L10N_PREFIX } from '@progress/kendo-angular-l10n';
import { Subject, Subscription } from 'rxjs';
import { FormGroup, FormControl } from '@angular/forms';
import { switchMap, take } from 'rxjs/operators';
import { PageSizeChangeEvent, PagerModule } from '@progress/kendo-angular-pager';
import { CommonModule } from '@angular/common';
import { Button } from '@progress/kendo-angular-buttons';

/**
 * @hidden
 */
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/common';
import * as ɵngcc2 from '@progress/kendo-angular-common';
import * as ɵngcc3 from '@progress/kendo-angular-pager';
import * as ɵngcc4 from '@progress/kendo-angular-l10n';

const _c0 = ["contentContainer"];
function ListViewComponent_0_ng_template_0_Template(rf, ctx) { }
const _c1 = function () { return { pagerClass: "k-listview-pager k-listview-pager-top" }; };
function ListViewComponent_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, ListViewComponent_0_ng_template_0_Template, 0, 0, "ng-template", 9);
} if (rf & 2) {
    ɵngcc0.ɵɵnextContext();
    const _r9 = ɵngcc0.ɵɵreference(11);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", _r9)("ngTemplateOutletContext", ɵngcc0.ɵɵpureFunction0(2, _c1));
} }
function ListViewComponent_div_1_ng_template_1_Template(rf, ctx) { }
function ListViewComponent_div_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 10);
    ɵngcc0.ɵɵtemplate(1, ListViewComponent_div_1_ng_template_1_Template, 0, 0, "ng-template", 11);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r1.headerTemplate == null ? null : ctx_r1.headerTemplate.templateRef);
} }
function ListViewComponent_div_4_1_ng_template_0_Template(rf, ctx) { }
function ListViewComponent_div_4_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, ListViewComponent_div_4_1_ng_template_0_Template, 0, 0, "ng-template", 9);
} if (rf & 2) {
    const ctx_r13 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r13.editTemplate == null ? null : ctx_r13.editTemplate.templateRef)("ngTemplateOutletContext", ctx_r13.editTemplateContext(-1));
} }
function ListViewComponent_div_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 12);
    ɵngcc0.ɵɵtemplate(1, ListViewComponent_div_4_1_Template, 1, 2, null, 0);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("index", -1)("ngClass", ctx_r3.itemClass)("ngStyle", ctx_r3.itemStyle);
    ɵngcc0.ɵɵattribute("role", ctx_r3.listItemRole)("data-kendo-listview-item-index", -1);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r3.editTemplate);
} }
function ListViewComponent_div_5_ng_template_1_Template(rf, ctx) { }
function ListViewComponent_div_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 12);
    ɵngcc0.ɵɵtemplate(1, ListViewComponent_div_5_ng_template_1_Template, 0, 0, "ng-template", 9);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const index_r16 = ctx.index;
    const ctx_r4 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("index", index_r16)("ngClass", ctx_r4.itemClass)("ngStyle", ctx_r4.itemStyle);
    ɵngcc0.ɵɵattribute("role", ctx_r4.listItemRole)("aria-posinset", ctx_r4.itemPosInSet(index_r16))("aria-setsize", ctx_r4.total)("data-kendo-listview-item-index", index_r16);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r4.isEdited(index_r16) ? ctx_r4.editTemplate == null ? null : ctx_r4.editTemplate.templateRef : ctx_r4.itemTemplate == null ? null : ctx_r4.itemTemplate.templateRef)("ngTemplateOutletContext", ctx_r4.isEdited(index_r16) ? ctx_r4.editTemplateContext(index_r16) : ctx_r4.templateContext(index_r16));
} }
function ListViewComponent_div_6_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 13)(1, "span", 14);
    ɵngcc0.ɵɵtext(2, "Loading");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(3, "div", 15)(4, "div", 16);
    ɵngcc0.ɵɵelementEnd();
} }
function ListViewComponent_7_ng_template_0_Template(rf, ctx) { }
function ListViewComponent_7_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, ListViewComponent_7_ng_template_0_Template, 0, 0, "ng-template", 11);
} if (rf & 2) {
    const ctx_r6 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r6.loaderTemplate.templateRef);
} }
function ListViewComponent_div_8_ng_template_1_Template(rf, ctx) { }
function ListViewComponent_div_8_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 17);
    ɵngcc0.ɵɵtemplate(1, ListViewComponent_div_8_ng_template_1_Template, 0, 0, "ng-template", 11);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r7 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r7.footerTemplate == null ? null : ctx_r7.footerTemplate.templateRef);
} }
function ListViewComponent_9_ng_template_0_Template(rf, ctx) { }
const _c2 = function () { return { pagerClass: "k-listview-pager" }; };
function ListViewComponent_9_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, ListViewComponent_9_ng_template_0_Template, 0, 0, "ng-template", 9);
} if (rf & 2) {
    ɵngcc0.ɵɵnextContext();
    const _r9 = ɵngcc0.ɵɵreference(11);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", _r9)("ngTemplateOutletContext", ɵngcc0.ɵɵpureFunction0(2, _c2));
} }
function ListViewComponent_ng_template_10_kendo_datapager_0_Template(rf, ctx) { if (rf & 1) {
    const _r26 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "kendo-datapager", 19);
    ɵngcc0.ɵɵlistener("pageChange", function ListViewComponent_ng_template_10_kendo_datapager_0_Template_kendo_datapager_pageChange_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r26); const ctx_r25 = ɵngcc0.ɵɵnextContext(2); return ctx_r25.handlePageChange($event); })("pageSizeChange", function ListViewComponent_ng_template_10_kendo_datapager_0_Template_kendo_datapager_pageSizeChange_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r26); const ctx_r27 = ɵngcc0.ɵɵnextContext(2); return ctx_r27.pageSizeChange.emit($event); });
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const pagerClass_r23 = ɵngcc0.ɵɵnextContext().pagerClass;
    const ctx_r24 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵclassMap(pagerClass_r23);
    ɵngcc0.ɵɵproperty("total", ctx_r24.total)("pageSize", ctx_r24.pageSize)("skip", ctx_r24.skip)("buttonCount", ctx_r24.pagerSettings.buttonCount)("info", ctx_r24.pagerSettings.info)("previousNext", ctx_r24.pagerSettings.previousNext)("type", ctx_r24.pagerSettings.type)("pageSizeValues", ctx_r24.pagerSettings.pageSizeValues);
} }
function ListViewComponent_ng_template_10_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, ListViewComponent_ng_template_10_kendo_datapager_0_Template, 1, 10, "kendo-datapager", 18);
} if (rf & 2) {
    const ctx_r10 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngIf", ctx_r10.pageable);
} }
const _c3 = function (a0) { return { scroll: a0 }; };
const packageMetadata = {
    name: '@progress/kendo-angular-listview',
    productName: 'Kendo UI for Angular',
    productCodes: ['KENDOUIANGULAR', 'KENDOUICOMPLETE'],
    publishDate: 1646219074,
    version: '',
    licensingDocsUrl: 'https://www.telerik.com/kendo-angular-ui/my-license/?utm_medium=product&utm_source=kendoangular&utm_campaign=kendo-ui-angular-purchase-license-keys-warning'
};

const LISTVIEW_ITEM_SELECTOR = '.k-listview-item';
/**
 * @hidden
 */
const isPresent = (item) => item !== null && item !== undefined;
/**
 * @hidden
 *
 * Polyfill for `Element.matches`.
 * https://developer.mozilla.org/en-US/docs/Web/API/Element/matches
 */
const match = (element, selector) => {
    const matcher = element.matches || element.msMatchesSelector || element.webkitMatchesSelector;
    if (!isPresent(matcher)) {
        return false;
    }
    return matcher.call(element, selector);
};
/**
 * @hidden
 *
 * Checks if a target element has the `.k-listview-item` CSS class.
 */
const isListViewItem = (element) => {
    if (!isPresent(element)) {
        return false;
    }
    return match(element, LISTVIEW_ITEM_SELECTOR);
};
/**
 * @hidden
 *
 * Extracts and parses to a number the `data-kendo-listview-item-index` attribute value from the targeted element.
 */
const getListItemIndex = (item) => {
    if (!isPresent(item)) {
        return null;
    }
    return Number(item.getAttribute('data-kendo-listview-item-index'));
};
/**
 * @hidden
 *
 * Gets the new focus target from a blur event.
 * Queries both event.relatedTarget and document.activeElement for compatibility with IE.
 */
const relatedTarget = (event) => {
    if (!isPresent(event.relatedTarget) || !isDocumentAvailable()) {
        return null;
    }
    return event.relatedTarget || document.activeElement;
};
/**
 * @hidden
 *
 * If the given contender number is not defined or lower than the specified min - returns min, if its above the specified max - returns max.
 * If the number is in the given bounds, it is returned.
 */
const fitIntoRange = (contender, min, max) => {
    if (!isPresent(contender) || contender <= min) {
        return min;
    }
    else if (contender >= max) {
        return max;
    }
    else {
        return contender;
    }
};
/**
 * @hidden
 */
const closestWithMatch = (element, selector) => {
    let parent = element;
    while (parent !== null && parent.nodeType === 1) {
        if (match(parent, selector)) {
            return parent;
        }
        parent = parent.parentElement || parent.parentNode;
    }
    return null;
};
/**
 * @hidden
 *
 * Extracts and parses to a number the `data-kendo-listview-item-index` attribute value from the targeted element.
 */
const getClosestListItemIndex = (element) => {
    if (!isPresent(element)) {
        return null;
    }
    const closestListViewItem = closestWithMatch(element, LISTVIEW_ITEM_SELECTOR);
    return getListItemIndex(closestListViewItem);
};

/**
 * @hidden
 *
 * Provided per ListView instance. Keeps the availability, active index and focused state of the current ListView.
 * Emits `changes` when any of the aforementioned states changes.
 */
let NavigationService = class NavigationService {
    /**
     * @hidden
     *
     * Provided per ListView instance. Keeps the availability, active index and focused state of the current ListView.
     * Emits `changes` when any of the aforementioned states changes.
     */
    constructor() {
        /**
         * Emits every time a change in active index/focus/blur/navigation availability occurs.
         */
        this.changes = new Subject();
        /**
         * Specifies if a ListView item currently holds focus.
         */
        this.isFocused = false;
        /**
         * Keeps track of the index of the items that should be the current focus target (tabindex="0").
         * When set to `null`/`undefined`, the navigation is disabled and the items should not render a tabindex.
         */
        this.activeIndex = null;
    }
    /**
     * Sets or gets if the navigation is enabled.
     * When no activeIndex is present, the navigation is inferred as disabled.
     * Toggling the service availability clears the current active index or activates the first one.
     */
    get isEnabled() {
        return isPresent(this.activeIndex);
    }
    set isEnabled(enabled) {
        if (enabled) {
            this.activeIndex = 0;
        }
        else {
            this.activeIndex = null;
        }
        this.changes.next();
    }
    /**
     * Shows if the checked index should be the current available focus target (tabindex="0").
     */
    isActive(index) {
        return index === this.activeIndex;
    }
    handleKeyDown(event, totalItemsCount) {
        const { keyCode } = event;
        switch (keyCode) {
            case Keys.ArrowLeft:
            case Keys.ArrowUp:
                this.navigateToPrevious();
                break;
            case Keys.ArrowRight:
            case Keys.ArrowDown:
                this.navigateToNext(totalItemsCount);
                break;
            case Keys.Home:
                const firstIndex = 0;
                this.navigateTo(firstIndex);
                break;
            case Keys.End:
                const lastIndex = totalItemsCount - 1;
                this.navigateTo(lastIndex);
                break;
            default: return;
        }
        // the following line is executed only if the pressed key matches one of the listview hotkeys -
        // they `break`, while the `default` case `return`s
        event.preventDefault();
    }
    handleFocusIn(event) {
        const target = event.target;
        if (!isListViewItem(target)) {
            const listViewItemSelector = '.k-listview-item';
            const closestListViewItem = closestWithMatch(target, listViewItemSelector);
            const isListViewItemChild = isPresent(closestListViewItem);
            if (isListViewItemChild) {
                const itemIndex = getListItemIndex(closestListViewItem);
                this.setActiveIndex(itemIndex);
            }
            return;
        }
        const targetIndex = getListItemIndex(target);
        // don't emit if the no change in focused state has occurred and the targeted index is the same as the current activeIndex
        if (this.isFocused && targetIndex === this.activeIndex) {
            return;
        }
        this.activeIndex = targetIndex;
        this.isFocused = true;
        this.changes.next();
    }
    handleFocusOut(event) {
        // don't emit if the blurred item is not a listview item or if the new focus target is another listview item
        if (!isListViewItem(event.target) || isListViewItem(relatedTarget(event))) {
            return;
        }
        this.isFocused = false;
        this.changes.next();
    }
    /**
     * Sets the `activeIndex` and triggers changes without focusing the corresponding ListView item.
     */
    setActiveIndex(index) {
        if (!this.isEnabled) {
            return;
        }
        if (index === this.activeIndex) {
            return;
        }
        this.activeIndex = index;
        this.changes.next();
    }
    /**
     * Focuses item at the targeted index. If no index is passed, the current `activeIndex` is used.
     * The passed target index is normalized to fit the min/max available indices bounds.
     */
    focusIndex(index, totalItemsCount) {
        if (!this.isEnabled) {
            return;
        }
        const parsed = parseInt(index, 10);
        const firstIndex = 0;
        const lastIndex = totalItemsCount - 1;
        const targetIndex = isNaN(parsed) ? this.activeIndex : fitIntoRange(parsed, firstIndex, lastIndex);
        this.navigateTo(targetIndex);
    }
    navigateTo(index) {
        if (this.isFocused && this.activeIndex === index) {
            return;
        }
        this.isFocused = true;
        this.activeIndex = index;
        this.changes.next();
    }
    navigateToPrevious() {
        const previousIndex = Math.max(this.activeIndex - 1, 0);
        this.navigateTo(previousIndex);
    }
    navigateToNext(totalItemsCount) {
        const lastAvailableIndex = totalItemsCount - 1;
        const nextIndex = Math.min(this.activeIndex + 1, lastAvailableIndex);
        this.navigateTo(nextIndex);
    }
};
NavigationService.ɵfac = function NavigationService_Factory(t) { return new (t || NavigationService)(); };
NavigationService.ɵprov = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjectable({ token: NavigationService, factory: function (t) { return NavigationService.ɵfac(t); } });

/**
 * @hidden
 */
let ListViewNavigableItemDirective = class ListViewNavigableItemDirective {
    constructor(hostElement, renderer, navigationService) {
        this.hostElement = hostElement;
        this.renderer = renderer;
        this.navigationService = navigationService;
    }
    ngOnChanges() {
        this.updateNavigationState();
    }
    ngOnInit() {
        this.navigationSubscription = this.navigationService.changes
            .subscribe(this.updateNavigationState.bind(this));
    }
    ngOnDestroy() {
        if (isPresent(this.navigationSubscription)) {
            this.navigationSubscription.unsubscribe();
        }
    }
    updateNavigationState() {
        this.updateTabIndex();
        this.updateFocusedState();
    }
    updateFocusedState() {
        const shouldFocus = this.navigationService.isActive(this.index) && this.navigationService.isFocused;
        const focusedCssClass = 'k-state-focused';
        if (shouldFocus) {
            this.renderer.addClass(this.hostElement.nativeElement, focusedCssClass);
            this.hostElement.nativeElement.focus();
        }
        else {
            this.renderer.removeClass(this.hostElement.nativeElement, focusedCssClass);
        }
    }
    updateTabIndex() {
        if (!this.navigationService.isEnabled) {
            this.renderer.removeAttribute(this.hostElement.nativeElement, 'tabindex');
        }
        else if (this.navigationService.isActive(this.index)) {
            this.renderer.setAttribute(this.hostElement.nativeElement, 'tabindex', '0');
        }
        else {
            this.renderer.setAttribute(this.hostElement.nativeElement, 'tabindex', '-1');
        }
    }
};
ListViewNavigableItemDirective.ɵfac = function ListViewNavigableItemDirective_Factory(t) { return new (t || ListViewNavigableItemDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(NavigationService)); };
ListViewNavigableItemDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: ListViewNavigableItemDirective, selectors: [["", "kendoListViewNavigableItem", ""]], inputs: { index: "index" }, features: [ɵngcc0.ɵɵNgOnChangesFeature] });
__decorate([
    Input(),
    __metadata("design:type", Number)
], ListViewNavigableItemDirective.prototype, "index", void 0);
ListViewNavigableItemDirective = __decorate([ __metadata("design:paramtypes", [ElementRef,
        Renderer2,
        NavigationService])
], ListViewNavigableItemDirective);

/**
 * Renders the list item content. To define an item template, nest an `<ng-template>` tag
 * with the `kendoListViewItemTemplate` directive inside the `<kendo-listview>` tag
 * [see example]({% slug templates_listview %}#toc-item-template).
 *
 * The following values are available as context variables:
 * - `let-dataItem="dataItem"` (`any`) - The current data item. Also available as implicit context variable.
 * - `let-index="index"` (`number`) - The current item index.
 * - `let-isFirst="isFirst"` (`boolean`) - Indicates whether the current data item will be rendered as the first item on the list.
 * - `let-isLast="isLast"` (`boolean`)- Indicates whether the current data item will be rendered as the last item on the list.
 */
let ItemTemplateDirective = class ItemTemplateDirective {
    constructor(templateRef) {
        this.templateRef = templateRef;
    }
};
ItemTemplateDirective.ɵfac = function ItemTemplateDirective_Factory(t) { return new (t || ItemTemplateDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.TemplateRef)); };
ItemTemplateDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: ItemTemplateDirective, selectors: [["", "kendoListViewItemTemplate", ""]] });
ItemTemplateDirective = __decorate([ __metadata("design:paramtypes", [TemplateRef])
], ItemTemplateDirective);

/**
 * Renders the header content of the ListView. To define a header template, nest an `<ng-template>` tag
 * with the `kendoListViewHeaderTemplate` directive inside the `<kendo-listview>` tag
 * [see example]({% slug templates_listview %}#toc-header-template).
 */
let HeaderTemplateDirective = class HeaderTemplateDirective {
    constructor(templateRef) {
        this.templateRef = templateRef;
    }
};
HeaderTemplateDirective.ɵfac = function HeaderTemplateDirective_Factory(t) { return new (t || HeaderTemplateDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.TemplateRef)); };
HeaderTemplateDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: HeaderTemplateDirective, selectors: [["", "kendoListViewHeaderTemplate", ""]] });
HeaderTemplateDirective = __decorate([ __metadata("design:paramtypes", [TemplateRef])
], HeaderTemplateDirective);

/**
 * Renders the footer content of the ListView. To define a footer template, nest an `<ng-template>` tag
 * with the `kendoListViewFooterTemplate` directive inside the `<kendo-listview>` tag
 * [see example]({% slug templates_listview %}#toc-footer-template).
 */
let FooterTemplateDirective = class FooterTemplateDirective {
    constructor(templateRef) {
        this.templateRef = templateRef;
    }
};
FooterTemplateDirective.ɵfac = function FooterTemplateDirective_Factory(t) { return new (t || FooterTemplateDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.TemplateRef)); };
FooterTemplateDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: FooterTemplateDirective, selectors: [["", "kendoListViewFooterTemplate", ""]] });
FooterTemplateDirective = __decorate([ __metadata("design:paramtypes", [TemplateRef])
], FooterTemplateDirective);

/**
 * Overrides the default loader content of the ListView. To define a loader template, nest an `<ng-template>` tag
 * with the `kendoListViewLoaderTemplate` directive inside the `<kendo-listview>` tag
 * [see example]({% slug templates_listview %}#toc-loader-template).
 */
let LoaderTemplateDirective = class LoaderTemplateDirective {
    constructor(templateRef) {
        this.templateRef = templateRef;
    }
};
LoaderTemplateDirective.ɵfac = function LoaderTemplateDirective_Factory(t) { return new (t || LoaderTemplateDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.TemplateRef)); };
LoaderTemplateDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: LoaderTemplateDirective, selectors: [["", "kendoListViewLoaderTemplate", ""]] });
LoaderTemplateDirective = __decorate([ __metadata("design:paramtypes", [TemplateRef])
], LoaderTemplateDirective);

/**
 * Represents the edit template of the ListView ([see example]({% slug editing_template_forms_listview %})).
 * Helps to customize the content of the edited items. To define the template, nest an `<ng-template>`
 * tag with the `kendoListViewEditTemplate` directive inside a `<kendo-listview>` tag.
 *
 * The template context contains the following fields:
 * - `formGroup`&mdash;The current [`FormGroup`]({{ site.data.urls.angular['formgroupapi'] }}).
 * If you use the ListView inside [Template-Driven Forms]({{ site.data.urls.angular['forms'] }}), it will be `undefined`.
 * - `itemIndex`&mdash;The current item index. If inside a new item, `itemIndex` is `-1`.
 * - `dataItem`&mdash;The current data item.
 * - `isNew`&mdash;The state of the current item.
 */
let EditTemplateDirective = class EditTemplateDirective {
    constructor(templateRef) {
        this.templateRef = templateRef;
    }
};
EditTemplateDirective.ɵfac = function EditTemplateDirective_Factory(t) { return new (t || EditTemplateDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.TemplateRef, 8)); };
EditTemplateDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: EditTemplateDirective, selectors: [["", "kendoListViewEditTemplate", ""]] });
EditTemplateDirective = __decorate([ __param(0, Optional()),
    __metadata("design:paramtypes", [TemplateRef])
], EditTemplateDirective);

/**
 * @hidden
 */
const isEqual = (index) => (item) => item.index === index;
/**
 * @hidden
 */
const isNotEqual = (index) => (item) => item.index !== index;
/**
 * @hidden
 */
const isNewItem = (index) => index === -1 || index === undefined;
/**
 * @hidden
 */
let EditService = class EditService {
    constructor(ngZone) {
        this.ngZone = ngZone;
        this.changes = new EventEmitter();
        this.editedIndices = [];
        this.changedSource = new Subject();
        this.changed = this.changedSource.asObservable().pipe(switchMap(() => this.ngZone.onStable.asObservable().pipe(take(1))));
    }
    editItem(index, group = undefined) {
        this.editedIndices.push({ index, group });
        this.onChanged();
    }
    addItem(group) {
        this.newItem = { group };
        this.onChanged();
    }
    isEditing() {
        return this.editedIndices.length > 0;
    }
    get hasNewItem() {
        return isPresent(this.newItem);
    }
    get newDataItem() {
        if (this.hasNewItem) {
            return this.newItem.group.value;
        }
        return {};
    }
    get newItemGroup() {
        if (this.hasNewItem) {
            return this.newItem.group;
        }
        return new FormGroup({});
    }
    editGroup(index) {
        return this.context(index).group;
    }
    close(index) {
        if (isNewItem(index)) {
            this.newItem = undefined;
            return;
        }
        this.editedIndices = this.editedIndices.filter(isNotEqual(index));
        this.onChanged();
    }
    context(index) {
        if (isNewItem(index)) {
            return this.newItem;
        }
        return this.findByIndex(index);
    }
    isEdited(index) {
        if (isNewItem(index) && isPresent(this.newItem)) {
            return true;
        }
        return isPresent(this.findByIndex(index));
    }
    hasEdited(index) {
        return isPresent(this.context(index));
    }
    beginEdit(itemIndex) {
        this.changes.emit({ action: 'edit', itemIndex });
    }
    beginAdd() {
        this.changes.emit({ action: 'add' });
    }
    endEdit(itemIndex) {
        const { group: formGroup } = this.context(itemIndex);
        this.changes.emit({ action: 'cancel', itemIndex, formGroup, isNew: isNewItem(itemIndex) });
    }
    save(itemIndex) {
        const { group: formGroup } = this.context(itemIndex);
        this.changes.emit({ action: 'save', itemIndex, formGroup, isNew: isNewItem(itemIndex) });
    }
    remove(itemIndex) {
        this.changes.emit({ action: 'remove', itemIndex });
    }
    findByIndex(index) {
        return this.editedIndices.find(isEqual(index));
    }
    onChanged() {
        this.ngZone.runOutsideAngular(() => {
            this.changedSource.next();
        });
    }
};
EditService.ɵfac = function EditService_Factory(t) { return new (t || EditService)(ɵngcc0.ɵɵinject(ɵngcc0.NgZone)); };
EditService.ɵprov = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjectable({ token: EditService, factory: function (t) { return EditService.ɵfac(t); } });
EditService = __decorate([ __metadata("design:paramtypes", [NgZone])
], EditService);

const DEFAULT_PAGER_SETTINGS = {
    position: 'bottom',
    buttonCount: 5,
    info: true,
    previousNext: true,
    type: 'numeric',
    pageSizeValues: [5, 10, 20]
};
const createControl = (source) => (acc, key) => {
    acc[key] = new FormControl(source[key]);
    return acc;
};
/**
 * Represents the Kendo UI ListView component for Angular.
 */
let ListViewComponent = class ListViewComponent {
    constructor(ngZone, element, renderer, editService, navigationService) {
        this.ngZone = ngZone;
        this.element = element;
        this.renderer = renderer;
        this.editService = editService;
        this.navigationService = navigationService;
        /**
         * @hidden
         */
        this.className = true;
        /**
         * Specifies if the loading indicator of the ListView will be displayed
         * ([see example]({% slug paging_listview %}#toc-remote-binding)).
         */
        this.loading = false;
        /**
         * Specifies the content container `role` attribute
         * ([more details]({% slug accessibility_listview %}#toc-wai-aria-support)).
         * By default, the container `role` is set to `listbox`.
         */
        this.containerRole = 'listbox';
        /**
         * Specifies the list item `role` attribute
         * ([more details]({% slug accessibility_listview %}#toc-wai-aria-support)).
         * By default, the list item `role` is set to `option`.
         */
        this.listItemRole = 'option';
        /**
         * Fires when the user scrolls to the last record on the page
         * ([see endless scrolling example]({% slug scrollmodes_listview %}#toc-endless-scrolling)).
         */
        this.scrollBottom = new EventEmitter();
        /**
         * Fires when the page or the page size of the ListView is changed
         * ([see example]({% slug paging_listview %}#toc-remote-binding)).
         * You have to handle the event yourself and page the data.
         */
        this.pageChange = new EventEmitter();
        /**
         * Fires when the page size of the ListView is changed. This event can be prevented (`$event.preventDefault()`).
         * If not prevented, the `pageChange` event will be fired subsequently.
         */
        this.pageSizeChange = new EventEmitter();
        /**
         * Fires when the user clicks the **Edit** command button to edit an item
         * ([see example]({% slug editing_template_forms_listview %}#toc-editing-records)).
         */
        this.edit = new EventEmitter();
        /**
         * Fires when the user clicks the **Cancel** command button to close an item
         * ([see example]({% slug editing_template_forms_listview %}#toc-cancelling-editing)).
         */
        this.cancel = new EventEmitter();
        /**
         * Fires when the user clicks the **Save** command button to save changes in an item
         * ([see example]({% slug editing_template_forms_listview %}#toc-saving-records)).
         */
        this.save = new EventEmitter();
        /**
         * Fires when the user clicks the **Remove** command button to remove an item
         * ([see example]({% slug editing_template_forms_listview %}#toc-removing-records)).
         */
        this.remove = new EventEmitter();
        /**
         * Fires when the user clicks the **Add** command button to add a new item
         * ([see example]({% slug editing_template_forms_listview %}#toc-adding-records)).
         */
        this.add = new EventEmitter();
        this._skip = 0;
        this._navigable = false;
        validatePackage(packageMetadata);
        this.attachEditHandlers();
    }
    /**
     * Specifies whether the keyboard navigation is enabled
     * ([see example]({% slug keyboard_navigation_listview %})).
     * By default, the navigation is disabled.
     */
    set navigable(navigable) {
        if (!navigable && isPresent(this.removeNavigationListeners)) {
            this.removeNavigationListeners();
            this.removeNavigationListeners = null;
            this.navigationService.isEnabled = false;
        }
        else if (navigable && !isPresent(this.removeNavigationListeners)) {
            this.addNavigationListeners();
            this.navigationService.isEnabled = true;
        }
        this._navigable = navigable;
    }
    get navigable() {
        return this._navigable;
    }
    /**
     * Defines the number of records to be skipped by the pager
     * ([more details]({% slug paging_listview %})).
     */
    set skip(skip) {
        const parsed = parseInt(skip, 10);
        const defaultSkipValue = 0;
        this._skip = !isNaN(parsed) ? parsed : defaultSkipValue;
    }
    get skip() {
        return this._skip;
    }
    /**
     * Configures whether the ListView will render a pager
     * ([more details]({% slug paging_listview %})).
     * Providing a boolean value will render a pager with the default settings.
     */
    set pageable(pageable) {
        this._pageable = pageable;
        this.pagerSettings = pageable ? Object.assign({}, DEFAULT_PAGER_SETTINGS, pageable) : null;
    }
    get pageable() {
        return this._pageable;
    }
    /**
     * @hidden
     *
     * Gets the data items passed to the ListView.
     * If a ListViewDataResult is passed, the data value is used. If an array is passed - it's directly used.
     */
    get items() {
        if (!isPresent(this.data)) {
            return [];
        }
        return Array.isArray(this.data) ? this.data : this.data.data;
    }
    /**
     * @hidden
     *
     * Gets the total number of records passed to the ListView.
     * If a ListViewDataResult is passed, the total value is used. If an array is passed - its length is used.
     */
    get total() {
        if (!isPresent(this.data)) {
            return 0;
        }
        return Array.isArray(this.data) ? this.data.length : this.data.total;
    }
    /**
     * @hidden
     */
    get containerTabindex() {
        // workaround for FF, where a scrollable container is focusable even without a tabindex and creates an unwanted tab stop
        // https://bugzilla.mozilla.org/show_bug.cgi?id=616594
        return this.navigable ? -1 : null;
    }
    /**
     * Gets the current active item index
     * ([see example]({% slug keyboard_navigation_listview %}#toc-controlling-the-focus)).
     * Returns `null` when the keyboard navigation is disabled.
     */
    get activeIndex() {
        return this.navigationService.activeIndex;
    }
    ngOnChanges(changes) {
        if (isChanged('height', changes, false)) {
            this.renderer.setStyle(this.element.nativeElement, 'height', `${this.height}px`);
        }
    }
    ngOnDestroy() {
        if (isPresent(this.editServiceSubscription)) {
            this.editServiceSubscription.unsubscribe();
        }
    }
    /**
     * @hidden
     */
    templateContext(index) {
        return {
            "$implicit": this.items[index],
            "isLast": index === this.items.length - 1,
            "isFirst": index === 0,
            "dataItem": this.items[index],
            "index": index
        };
    }
    /**
     * @hidden
     */
    editTemplateContext(index) {
        const isNew = index === -1;
        const group = isNew ? this.editService.newItemGroup : this.editService.editGroup(index);
        return {
            "$implicit": group,
            "formGroup": group,
            "dataItem": isNew ? this.editService.newDataItem : this.items[index],
            "isNew": isNew,
            "index": index
        };
    }
    /**
     * Focuses the item at the specified index ([see example]({% slug keyboard_navigation_listview %}#toc-controlling-the-focus)):
     * - If no index is specified, the current active index will be focused.
     * - If the passed value is below `0`, the first item receives focus.
     * - If the passed value is above the last available index, the last item receives focus.
     *
     * > The index param is based on the logical structure of the ListView and does not correspond to the data item index -
     * > i.e. the index `0` corresponds to the first rendered list item. Paging is not taken into account.
     * > Also, for the focusing to work, the `navigable` prop must first be set to `true`.
     */
    focus(index) {
        const totalRenderedItems = this.listViewItems.length;
        this.navigationService.focusIndex(index, totalRenderedItems);
    }
    /**
     * Creates a new item editor ([see example]({% slug editing_template_forms_listview %}#toc-adding-records)).
     *
     * @param {FormGroup} group - The [`FormGroup`]({{ site.data.urls.angular['formgroupapi'] }}) that describes
     * the edit form. If called with a data item, it will build the `FormGroup` from the data item fields.
     */
    addItem(group) {
        const isFormGroup = group instanceof FormGroup;
        if (!isFormGroup) {
            const fields = Object.keys(group).reduce(createControl(group), {});
            group = new FormGroup(fields);
        }
        this.editService.addItem(group);
    }
    /**
     * Switches the specified item to edit mode ([see example]({% slug editing_template_forms_listview %}#toc-editing-records)).
     *
     * @param index - The item index that will be switched to edit mode.
     * @param group - The [`FormGroup`]({{ site.data.urls.angular['formgroupapi'] }})
     * that describes the edit form.
     */
    editItem(index, group) {
        this.editService.editItem(index, group);
    }
    /**
     * Closes the editor for a given item ([see example]({% slug editing_template_forms_grid %}#toc-cancelling-editing)).
     *
     * @param {number} index - The item index that will be switched out of the edit mode. If no index is provided, it is assumed
     * that the new item editor will be closed.
     */
    closeItem(index) {
        this.editService.close(index);
    }
    /**
     * @hidden
     */
    isEdited(index) {
        return this.editService.isEdited(index);
    }
    /**
     * @hidden
     */
    handlePageChange(event) {
        this.scrollToContainerTop();
        const firstIndex = 0;
        this.navigationService.setActiveIndex(firstIndex);
        this.pageChange.emit(event);
    }
    /**
     * @hidden
     */
    handleContentScroll() {
        if (!hasObservers(this.scrollBottom)) {
            return;
        }
        const THRESHOLD = 2;
        const { scrollHeight, scrollTop, clientHeight } = this.contentContainer.nativeElement;
        const atBottom = scrollHeight - clientHeight - scrollTop <= THRESHOLD;
        if (atBottom) {
            this.ngZone.run(() => {
                const event = { sender: this };
                this.scrollBottom.emit(event);
            });
        }
    }
    /**
     * @hidden
     */
    itemPosInSet(index) {
        // adds 1 as the aria-posinset is not zero-based and the counting starts from 1
        return this.skip + index + 1;
    }
    scrollToContainerTop() {
        const container = this.contentContainer.nativeElement;
        container.scrollTop = 0;
        container.scrollLeft = 0;
    }
    addNavigationListeners() {
        this.ngZone.runOutsideAngular(() => {
            const removeKeydownListener = this.renderer.listen(this.contentContainer.nativeElement, 'keydown', event => this.navigationService.handleKeyDown(event, this.listViewItems.length));
            const removeFocusInListener = this.renderer.listen(this.contentContainer.nativeElement, 'focusin', event => this.navigationService.handleFocusIn(event));
            const removeFocusOutListener = this.renderer.listen(this.contentContainer.nativeElement, 'focusout', event => this.navigationService.handleFocusOut(event));
            this.removeNavigationListeners = () => {
                removeKeydownListener();
                removeFocusInListener();
                removeFocusOutListener();
            };
        });
    }
    attachEditHandlers() {
        if (!isPresent(this.editService)) {
            return;
        }
        this.editServiceSubscription = this.editService
            .changes.subscribe(this.emitCRUDEvent.bind(this));
    }
    emitCRUDEvent(args) {
        const { action, itemIndex, formGroup } = args;
        let dataItem = this.items[itemIndex];
        if (action !== 'add' && formGroup) {
            dataItem = formGroup.value;
        }
        Object.assign(args, {
            dataItem: dataItem,
            sender: this
        });
        this[action].emit(args);
    }
};
ListViewComponent.ɵfac = function ListViewComponent_Factory(t) { return new (t || ListViewComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(EditService), ɵngcc0.ɵɵdirectiveInject(NavigationService)); };
ListViewComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: ListViewComponent, selectors: [["kendo-listview"]], contentQueries: function ListViewComponent_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
        ɵngcc0.ɵɵcontentQuery(dirIndex, ItemTemplateDirective, 5);
        ɵngcc0.ɵɵcontentQuery(dirIndex, HeaderTemplateDirective, 5);
        ɵngcc0.ɵɵcontentQuery(dirIndex, FooterTemplateDirective, 5);
        ɵngcc0.ɵɵcontentQuery(dirIndex, LoaderTemplateDirective, 5);
        ɵngcc0.ɵɵcontentQuery(dirIndex, EditTemplateDirective, 5);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.itemTemplate = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.headerTemplate = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.footerTemplate = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.loaderTemplate = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.editTemplate = _t.first);
    } }, viewQuery: function ListViewComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(_c0, 7);
        ɵngcc0.ɵɵviewQuery(ListViewNavigableItemDirective, 5);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.contentContainer = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.listViewItems = _t);
    } }, hostVars: 8, hostBindings: function ListViewComponent_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵclassProp("k-widget", ctx.className)("k-listview", ctx.className)("k-listview-bordered", ctx.className)("k-d-flex", ctx.className);
    } }, inputs: { loading: "loading", containerRole: "containerRole", listItemRole: "listItemRole", navigable: "navigable", skip: "skip", pageable: "pageable", data: "data", containerStyle: "containerStyle", itemStyle: "itemStyle", containerClass: "containerClass", itemClass: "itemClass", containerLabel: "containerLabel", pageSize: "pageSize", height: "height" }, outputs: { scrollBottom: "scrollBottom", pageChange: "pageChange", pageSizeChange: "pageSizeChange", edit: "edit", cancel: "cancel", save: "save", remove: "remove", add: "add" }, exportAs: ["kendoListView"], features: [ɵngcc0.ɵɵProvidersFeature([
            EditService,
            NavigationService,
            LocalizationService,
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.listview'
            }
        ]), ɵngcc0.ɵɵNgOnChangesFeature], decls: 12, vars: 17, consts: [[4, "ngIf"], ["class", "k-listview-header", 4, "ngIf"], [1, "k-listview-content", 3, "ngClass", "ngStyle", "kendoEventsOutsideAngular", "scope"], ["contentContainer", ""], ["class", "k-listview-item", "kendoListViewNavigableItem", "", 3, "index", "ngClass", "ngStyle", 4, "ngIf"], ["class", "k-listview-item", "kendoListViewNavigableItem", "", 3, "index", "ngClass", "ngStyle", 4, "ngFor", "ngForOf"], ["class", "k-loading-mask", 4, "ngIf"], ["class", "k-listview-footer", 4, "ngIf"], ["pagerTemplate", ""], [3, "ngTemplateOutlet", "ngTemplateOutletContext"], [1, "k-listview-header"], [3, "ngTemplateOutlet"], ["kendoListViewNavigableItem", "", 1, "k-listview-item", 3, "index", "ngClass", "ngStyle"], [1, "k-loading-mask"], [1, "k-loading-text"], [1, "k-loading-image"], [1, "k-loading-color"], [1, "k-listview-footer"], [3, "class", "total", "pageSize", "skip", "buttonCount", "info", "previousNext", "type", "pageSizeValues", "pageChange", "pageSizeChange", 4, "ngIf"], [3, "total", "pageSize", "skip", "buttonCount", "info", "previousNext", "type", "pageSizeValues", "pageChange", "pageSizeChange"]], template: function ListViewComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, ListViewComponent_0_Template, 1, 3, null, 0);
        ɵngcc0.ɵɵtemplate(1, ListViewComponent_div_1_Template, 2, 1, "div", 1);
        ɵngcc0.ɵɵelementStart(2, "div", 2, 3);
        ɵngcc0.ɵɵtemplate(4, ListViewComponent_div_4_Template, 2, 6, "div", 4);
        ɵngcc0.ɵɵtemplate(5, ListViewComponent_div_5_Template, 2, 9, "div", 5);
        ɵngcc0.ɵɵtemplate(6, ListViewComponent_div_6_Template, 5, 0, "div", 6);
        ɵngcc0.ɵɵtemplate(7, ListViewComponent_7_Template, 1, 1, null, 0);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(8, ListViewComponent_div_8_Template, 2, 1, "div", 7);
        ɵngcc0.ɵɵtemplate(9, ListViewComponent_9_Template, 1, 3, null, 0);
        ɵngcc0.ɵɵtemplate(10, ListViewComponent_ng_template_10_Template, 1, 1, "ng-template", null, 8, ɵngcc0.ɵɵtemplateRefExtractor);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngIf", (ctx.pagerSettings == null ? null : ctx.pagerSettings.position) !== "bottom");
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.headerTemplate);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngClass", ctx.containerClass)("ngStyle", ctx.containerStyle)("kendoEventsOutsideAngular", ɵngcc0.ɵɵpureFunction1(15, _c3, ctx.handleContentScroll))("scope", ctx);
        ɵngcc0.ɵɵattribute("tabindex", ctx.containerTabindex)("role", ctx.containerRole)("aria-label", ctx.containerLabel);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.editService.hasNewItem);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngForOf", ctx.items);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.loading && !ctx.loaderTemplate);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.loading && ctx.loaderTemplate);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.footerTemplate);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", (ctx.pagerSettings == null ? null : ctx.pagerSettings.position) !== "top");
    } }, directives: [ɵngcc1.NgIf, ɵngcc1.NgTemplateOutlet, ɵngcc1.NgClass, ɵngcc1.NgStyle, ɵngcc2.EventsOutsideAngularDirective, ListViewNavigableItemDirective, ɵngcc1.NgForOf, ɵngcc3.PagerComponent], encapsulation: 2, changeDetection: 0 });
__decorate([
    HostBinding('class.k-widget'),
    HostBinding('class.k-listview'),
    HostBinding('class.k-listview-bordered'),
    HostBinding('class.k-d-flex'),
    __metadata("design:type", Boolean)
], ListViewComponent.prototype, "className", void 0);
__decorate([
    ContentChild(ItemTemplateDirective, { static: false }),
    __metadata("design:type", ItemTemplateDirective)
], ListViewComponent.prototype, "itemTemplate", void 0);
__decorate([
    ContentChild(HeaderTemplateDirective, { static: false }),
    __metadata("design:type", HeaderTemplateDirective)
], ListViewComponent.prototype, "headerTemplate", void 0);
__decorate([
    ContentChild(FooterTemplateDirective, { static: false }),
    __metadata("design:type", FooterTemplateDirective)
], ListViewComponent.prototype, "footerTemplate", void 0);
__decorate([
    ContentChild(LoaderTemplateDirective, { static: false }),
    __metadata("design:type", LoaderTemplateDirective)
], ListViewComponent.prototype, "loaderTemplate", void 0);
__decorate([
    ViewChild('contentContainer', { static: true }),
    __metadata("design:type", ElementRef)
], ListViewComponent.prototype, "contentContainer", void 0);
__decorate([
    ContentChild(EditTemplateDirective, { static: false }),
    __metadata("design:type", EditTemplateDirective)
], ListViewComponent.prototype, "editTemplate", void 0);
__decorate([
    ViewChildren(ListViewNavigableItemDirective),
    __metadata("design:type", QueryList)
], ListViewComponent.prototype, "listViewItems", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], ListViewComponent.prototype, "data", void 0);
__decorate([
    Input(),
    __metadata("design:type", Boolean)
], ListViewComponent.prototype, "loading", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], ListViewComponent.prototype, "containerStyle", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], ListViewComponent.prototype, "itemStyle", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], ListViewComponent.prototype, "containerClass", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], ListViewComponent.prototype, "itemClass", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], ListViewComponent.prototype, "containerLabel", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], ListViewComponent.prototype, "containerRole", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], ListViewComponent.prototype, "listItemRole", void 0);
__decorate([
    Input(),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [Boolean])
], ListViewComponent.prototype, "navigable", null);
__decorate([
    Input(),
    __metadata("design:type", Number)
], ListViewComponent.prototype, "pageSize", void 0);
__decorate([
    Input(),
    __metadata("design:type", Number),
    __metadata("design:paramtypes", [Number])
], ListViewComponent.prototype, "skip", null);
__decorate([
    Input(),
    __metadata("design:type", Object),
    __metadata("design:paramtypes", [Object])
], ListViewComponent.prototype, "pageable", null);
__decorate([
    Input(),
    __metadata("design:type", Number)
], ListViewComponent.prototype, "height", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], ListViewComponent.prototype, "scrollBottom", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], ListViewComponent.prototype, "pageChange", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], ListViewComponent.prototype, "pageSizeChange", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], ListViewComponent.prototype, "edit", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], ListViewComponent.prototype, "cancel", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], ListViewComponent.prototype, "save", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], ListViewComponent.prototype, "remove", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], ListViewComponent.prototype, "add", void 0);
ListViewComponent = __decorate([ __metadata("design:paramtypes", [NgZone,
        ElementRef,
        Renderer2,
        EditService,
        NavigationService])
], ListViewComponent);

/**
 * A directive that encapsulates the in-memory handling of paging
 * ([see example]({% slug paging_listview %}#toc-binding-directive)).
 */
let DataBindingDirective = class DataBindingDirective {
    constructor(listView) {
        this.listView = listView;
        this.subscriptions = new Subscription();
    }
    /**
     * The array of data which will be used to populate the ListView.
     */
    set data(data) {
        this._data = data || [];
        this.updateListViewData();
    }
    get data() {
        return this._data;
    }
    ngOnInit() {
        this.subscriptions.add(this.listView.pageChange.subscribe(this.handlePageChange.bind(this)));
        this.subscriptions.add(this.listView.pageSizeChange.subscribe(this.handlePageSizeChange.bind(this)));
        this.updateListViewData();
    }
    ngOnDestroy() {
        this.subscriptions.unsubscribe();
    }
    handlePageChange(event) {
        this.listView.skip = event.skip;
        this.listView.pageSize = event.take;
        this.updateListViewData();
    }
    handlePageSizeChange(event) {
        this.listView.pageSize = Number(event.newPageSize);
    }
    updateListViewData() {
        const from = this.listView.skip || 0;
        const to = from + (this.listView.pageSize || this.data.length);
        this.listView.data = {
            data: this.data.slice(from, to),
            total: this.data.length
        };
    }
};
DataBindingDirective.ɵfac = function DataBindingDirective_Factory(t) { return new (t || DataBindingDirective)(ɵngcc0.ɵɵdirectiveInject(ListViewComponent)); };
DataBindingDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: DataBindingDirective, selectors: [["", "kendoListViewBinding", ""]], inputs: { data: ["kendoListViewBinding", "data"] } });
__decorate([
    Input('kendoListViewBinding'),
    __metadata("design:type", Array),
    __metadata("design:paramtypes", [Array])
], DataBindingDirective.prototype, "data", null);
DataBindingDirective = __decorate([ __metadata("design:paramtypes", [ListViewComponent])
], DataBindingDirective);

/**
 * The arguments of the [`pageSizeChange`]({% slug api_listview_listviewcomponent %}#toc-pagesizechange) event of the ListView
 * ([more details]({% slug paging_listview %}).
 */
class PageSizeChangeEvent$1 extends PageSizeChangeEvent {
}

/**
 * @hidden
 */
let TemplateContextDirective = class TemplateContextDirective {
    constructor(viewContainerRef) {
        this.viewContainerRef = viewContainerRef;
    }
    set templateContext(context) {
        if (this.insertedViewRef) {
            this.viewContainerRef.remove(this.viewContainerRef.indexOf(this.insertedViewRef));
            this.insertedViewRef = undefined;
        }
        if (context.templateRef) {
            this.insertedViewRef = this.viewContainerRef.createEmbeddedView(context.templateRef, context);
        }
    }
};
TemplateContextDirective.ɵfac = function TemplateContextDirective_Factory(t) { return new (t || TemplateContextDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ViewContainerRef)); };
TemplateContextDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: TemplateContextDirective, selectors: [["", "templateContext", ""]], inputs: { templateContext: "templateContext" } });
__decorate([
    Input(),
    __metadata("design:type", Object),
    __metadata("design:paramtypes", [Object])
], TemplateContextDirective.prototype, "templateContext", null);
TemplateContextDirective = __decorate([ __metadata("design:paramtypes", [ViewContainerRef])
], TemplateContextDirective);

/**
 * Represents the `edit` command of the ListView. You can apply this directive to any `button`
 * element inside a [`EditTemplateDirective`]({% slug api_listview_edittemplatedirective %}) template.
 * When an associated button with the directive is clicked, the
 * [`edit`]({% slug api_listview_listviewcomponent %}#toc-edit) event
 * is triggered ([see example]({% slug editing_listview %})).
 *
 * @example
 * ```html-no-run
 * <kendo-listview>
 *   <ng-template kendoListViewEditTemplate>
 *     <button kendoListViewEditCommand class="k-primary">Edit</button>
 *   </ng-template>
 * </kendo-listview>
 * ```
 *
 */
let EditCommandDirective = class EditCommandDirective extends Button {
    constructor(editService, element, renderer, localization, ngZone) {
        super(element, renderer, null, localization, ngZone);
        this.editService = editService;
        this.elementRef = element;
    }
    /**
     * @hidden
     */
    clickHandler(e) {
        e.preventDefault();
        const index = getClosestListItemIndex(this.elementRef.nativeElement);
        this.editService.beginEdit(index);
    }
};
EditCommandDirective.ɵfac = function EditCommandDirective_Factory(t) { return new (t || EditCommandDirective)(ɵngcc0.ɵɵdirectiveInject(EditService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(ɵngcc4.LocalizationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
EditCommandDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: EditCommandDirective, selectors: [["", "kendoListViewEditCommand", ""]], hostBindings: function EditCommandDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function EditCommandDirective_click_HostBindingHandler($event) { return ctx.clickHandler($event); });
    } }, features: [ɵngcc0.ɵɵInheritDefinitionFeature] });
__decorate([
    HostListener('click', ['$event']),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", void 0)
], EditCommandDirective.prototype, "clickHandler", null);
EditCommandDirective = __decorate([ __metadata("design:paramtypes", [EditService,
        ElementRef,
        Renderer2,
        LocalizationService,
        NgZone])
], EditCommandDirective);

/**
 * Represents the `cancel` command of the ListView. You can apply this directive to any `button`
 * element inside a [`EditTemplateDirective`]({% slug api_listview_edittemplatedirective %}) template.
 * When an associated button with the directive is clicked, the
 * [`cancel`]({% slug api_listview_listviewcomponent %}#toc-cancel) event
 * is triggered ([see example]({% slug editing_listview %})).
 *
 * @example
 * ```html-no-run
 * <kendo-listview>
 *   <ng-template kendoListViewEditTemplate>
 *     <button kendoListViewCancelCommand>Cancel changes</button>
 *   </ng-template>
 * </kendo-listview>
 * ```
 *
 * You can control the content of the button based on the state of the item.
 *
 * @example
 * ```html-no-run
 * <kendo-listview>
 *   <ng-template kendoListViewEditTemplate let-isNew="isNew">
 *     <button kendoListViewCancelCommand>{{isNew ? 'Discard' : 'Cancel changes'}}</button>
 *   </ng-template>
 * </kendo-listview>
 * ```
 */
let CancelCommandDirective = class CancelCommandDirective extends Button {
    constructor(editService, element, renderer, localization, ngZone) {
        super(element, renderer, null, localization, ngZone);
        this.editService = editService;
        this.elementRef = element;
    }
    /**
     * @hidden
     */
    clickHandler(e) {
        e.preventDefault();
        const index = getClosestListItemIndex(this.elementRef.nativeElement);
        if (this.editService.isEdited(index)) {
            this.editService.endEdit(index);
        }
    }
};
CancelCommandDirective.ɵfac = function CancelCommandDirective_Factory(t) { return new (t || CancelCommandDirective)(ɵngcc0.ɵɵdirectiveInject(EditService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(ɵngcc4.LocalizationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
CancelCommandDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: CancelCommandDirective, selectors: [["", "kendoListViewCancelCommand", ""]], hostBindings: function CancelCommandDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function CancelCommandDirective_click_HostBindingHandler($event) { return ctx.clickHandler($event); });
    } }, features: [ɵngcc0.ɵɵInheritDefinitionFeature] });
__decorate([
    HostListener('click', ['$event']),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", void 0)
], CancelCommandDirective.prototype, "clickHandler", null);
CancelCommandDirective = __decorate([ __metadata("design:paramtypes", [EditService,
        ElementRef,
        Renderer2,
        LocalizationService,
        NgZone])
], CancelCommandDirective);

/**
 * Represents the `save` command of the ListView. You can apply this directive to any `button`
 * element inside a [`EditTemplateDirective`]({% slug api_listview_edittemplatedirective %}) template.
 * When an associated button with the directive is clicked, the
 * [`save`]({% slug api_listview_listviewcomponent %}#toc-save) event
 * is triggered ([see example]({% slug editing_listview %})).
 *
 * @example
 * ```html-no-run
 * <kendo-listview>
 *   <ng-template kendoListViewEditTemplate>
 *     <button kendoListViewSaveCommand>Save changes</button>
 *   </ng-template>
 * </kendo-listview>
 * ```
 *
 * You can control the content of the button based on the state of the item.
 *
 * @example
 * ```html-no-run
 * <kendo-listview>
 *   <ng-template kendoListViewEditTemplate let-isNew="isNew">
 *     <button kendoListViewSaveCommand>{{isNew ? 'Add' : 'Update'}}</button>
 *   </ng-template>
 * </kendo-listview>
 * ```
 */
let SaveCommandDirective = class SaveCommandDirective extends Button {
    constructor(editService, element, renderer, localization, ngZone) {
        super(element, renderer, null, localization, ngZone);
        this.editService = editService;
        this.elementRef = element;
    }
    /**
     * @hidden
     */
    clickHandler(e) {
        e.preventDefault();
        const index = getClosestListItemIndex(this.elementRef.nativeElement);
        if (this.editService.isEdited(index)) {
            this.editService.save(index);
        }
    }
};
SaveCommandDirective.ɵfac = function SaveCommandDirective_Factory(t) { return new (t || SaveCommandDirective)(ɵngcc0.ɵɵdirectiveInject(EditService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(ɵngcc4.LocalizationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
SaveCommandDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: SaveCommandDirective, selectors: [["", "kendoListViewSaveCommand", ""]], hostBindings: function SaveCommandDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function SaveCommandDirective_click_HostBindingHandler($event) { return ctx.clickHandler($event); });
    } }, features: [ɵngcc0.ɵɵInheritDefinitionFeature] });
__decorate([
    HostListener('click', ['$event']),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", void 0)
], SaveCommandDirective.prototype, "clickHandler", null);
SaveCommandDirective = __decorate([ __metadata("design:paramtypes", [EditService,
        ElementRef,
        Renderer2,
        LocalizationService,
        NgZone])
], SaveCommandDirective);

/**
 * Represents the `remove` command of the ListView. You can apply this directive to any `button` element
 * inside a [`EditTemplateDirective`]({% slug api_listview_edittemplatedirective %}) template.
 * When an associated button with the directive is clicked, the
 * [`remove` event]({% slug api_listview_listviewcomponent %}#toc-remove)
 * is triggered ([see example]({% slug editing_listview %})).
 *
 * @example
 * ```html-no-run
 * <kendo-listview>
 *   <ng-template kendoListViewEditTemplate>
 *     <button kendoListViewRemoveCommand>Remove item</button>
 *   </ng-template>
 * </kendo-listview>
 * ```
 */
let RemoveCommandDirective = class RemoveCommandDirective extends Button {
    constructor(editService, element, renderer, localization, ngZone) {
        super(element, renderer, null, localization, ngZone);
        this.editService = editService;
        this.elementRef = element;
    }
    /**
     * @hidden
     */
    clickHandler(e) {
        e.preventDefault();
        const index = getClosestListItemIndex(this.elementRef.nativeElement);
        this.editService.remove(index);
    }
};
RemoveCommandDirective.ɵfac = function RemoveCommandDirective_Factory(t) { return new (t || RemoveCommandDirective)(ɵngcc0.ɵɵdirectiveInject(EditService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(ɵngcc4.LocalizationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
RemoveCommandDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: RemoveCommandDirective, selectors: [["", "kendoListViewRemoveCommand", ""]], hostBindings: function RemoveCommandDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function RemoveCommandDirective_click_HostBindingHandler($event) { return ctx.clickHandler($event); });
    } }, features: [ɵngcc0.ɵɵInheritDefinitionFeature] });
__decorate([
    HostListener('click', ['$event']),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", void 0)
], RemoveCommandDirective.prototype, "clickHandler", null);
RemoveCommandDirective = __decorate([ __metadata("design:paramtypes", [EditService,
        ElementRef,
        Renderer2,
        LocalizationService,
        NgZone])
], RemoveCommandDirective);

/**
 * Represents the command for adding a new item to the ListView. You can apply this directive to any
 * `button` element inside a [`HeaderTemplate`]({% slug api_listview_headertemplatedirective %}).
 * When an associated button with the directive is clicked, the
 * [`add`]({% slug api_listview_listviewcomponent %}#toc-add) event is triggered
 * ([see example]({% slug editing_listview %})).
 *
 * @example
 * ```html-no-run
 * <kendo-listview>
 *    <ng-template kendoListViewHeaderTemplate>
 *       <button kendoListViewAddCommand>Add new</button>
 *    </ng-template>
 * </kendo-listview>
 * ```
 */
let AddCommandDirective = class AddCommandDirective extends Button {
    constructor(editService, element, renderer, localization, ngZone) {
        super(element, renderer, null, localization, ngZone);
        this.editService = editService;
    }
    /**
     * @hidden
     */
    clickHandler(e) {
        e.preventDefault();
        this.editService.beginAdd();
    }
};
AddCommandDirective.ɵfac = function AddCommandDirective_Factory(t) { return new (t || AddCommandDirective)(ɵngcc0.ɵɵdirectiveInject(EditService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(ɵngcc4.LocalizationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
AddCommandDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: AddCommandDirective, selectors: [["", "kendoListViewAddCommand", ""]], hostBindings: function AddCommandDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function AddCommandDirective_click_HostBindingHandler($event) { return ctx.clickHandler($event); });
    } }, features: [ɵngcc0.ɵɵInheritDefinitionFeature] });
__decorate([
    HostListener('click', ['$event']),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", void 0)
], AddCommandDirective.prototype, "clickHandler", null);
AddCommandDirective = __decorate([ __metadata("design:paramtypes", [EditService,
        ElementRef,
        Renderer2,
        LocalizationService,
        NgZone])
], AddCommandDirective);

const TEMPLATE_DIRECTIVES = [
    ItemTemplateDirective,
    HeaderTemplateDirective,
    FooterTemplateDirective,
    LoaderTemplateDirective
];
const BINDING_DIRECTIVES = [
    DataBindingDirective
];
const EDITING_DIRECTIVES = [
    EditTemplateDirective,
    EditCommandDirective,
    CancelCommandDirective,
    SaveCommandDirective,
    RemoveCommandDirective,
    AddCommandDirective
];
/**
 * The exported package module.
 *
 * The package exports:
 * - [`ListViewComponent`]({% slug api_listview_listviewcomponent %})&mdash;The ListView component class.
 * - [`ItemTemplateDirective`]({% slug api_listview_itemtemplatedirective %})&mdash;The item template directive.
 * - [`HeaderTemplateDirective`]({% slug api_listview_headertemplatedirective %})&mdash;The header template directive.
 * - [`FooterTemplateDirective`]({% slug api_listview_footertemplatedirective %})&mdash;The footer template directive.
 * - [`LoaderTemplateDirective`]({% slug api_listview_loadertemplatedirective %})&mdash;The loeader template directive.
 * - [`DataBindingDirective`]({% slug api_listview_databindingdirective %})&mdash;The data binding directive.
 * - [`EditTemplateDirective`]({% slug api_listview_editingdirective %}&mdash;The editing template directive.
 */
let ListViewModule = class ListViewModule {
};
ListViewModule.ɵfac = function ListViewModule_Factory(t) { return new (t || ListViewModule)(); };
ListViewModule.ɵmod = /*@__PURE__*/ ɵngcc0.ɵɵdefineNgModule({ type: ListViewModule });
ListViewModule.ɵinj = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjector({ imports: [[
            CommonModule,
            PagerModule,
            EventsModule
        ], CommonModule,
        EventsModule] });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(NavigationService, [{
        type: Injectable
    }], function () { return []; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ListViewNavigableItemDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoListViewNavigableItem]'
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: NavigationService }]; }, { index: [{
            type: Input
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ItemTemplateDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoListViewItemTemplate]'
            }]
    }], function () { return [{ type: ɵngcc0.TemplateRef }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(HeaderTemplateDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoListViewHeaderTemplate]'
            }]
    }], function () { return [{ type: ɵngcc0.TemplateRef }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(FooterTemplateDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoListViewFooterTemplate]'
            }]
    }], function () { return [{ type: ɵngcc0.TemplateRef }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(LoaderTemplateDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoListViewLoaderTemplate]'
            }]
    }], function () { return [{ type: ɵngcc0.TemplateRef }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(EditTemplateDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoListViewEditTemplate]'
            }]
    }], function () { return [{ type: ɵngcc0.TemplateRef, decorators: [{
                type: Optional
            }] }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(EditService, [{
        type: Injectable
    }], function () { return [{ type: ɵngcc0.NgZone }]; }, null); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ListViewComponent, [{
        type: Component,
        args: [{
                changeDetection: ChangeDetectionStrategy.OnPush,
                exportAs: 'kendoListView',
                selector: 'kendo-listview',
                providers: [
                    EditService,
                    NavigationService,
                    LocalizationService,
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.listview'
                    }
                ],
                template: `
        <!-- top pager -->
        <ng-template
            *ngIf="pagerSettings?.position !== 'bottom'"
            [ngTemplateOutlet]="pagerTemplate"
            [ngTemplateOutletContext]="{ pagerClass: 'k-listview-pager k-listview-pager-top' }"
        >
        </ng-template>

        <!-- header -->
        <div
            *ngIf="headerTemplate"
            class="k-listview-header"
        >
            <ng-template
                [ngTemplateOutlet]="headerTemplate?.templateRef"
            >
            </ng-template>
        </div>

        <!-- content -->
        <div
            #contentContainer
            [attr.tabindex]="containerTabindex"
            class="k-listview-content"
            [ngClass]="containerClass"
            [ngStyle]="containerStyle"
            [kendoEventsOutsideAngular]="{
                scroll: handleContentScroll
            }"
            [scope]="this"
            [attr.role]="containerRole"
            [attr.aria-label]="containerLabel"
        >
            <!-- new item edit template -->
            <div
                *ngIf="editService.hasNewItem"
                class="k-listview-item"
                [attr.role]="listItemRole"
                kendoListViewNavigableItem
                [index]="-1"
                [attr.data-kendo-listview-item-index]="-1"
                [ngClass]="itemClass"
                [ngStyle]="itemStyle"
            >
                <ng-template
                    *ngIf="editTemplate"
                    [ngTemplateOutlet]="editTemplate?.templateRef"
                    [ngTemplateOutletContext]="editTemplateContext(-1)"
                >
                </ng-template>
            </div>

            <!-- items -->
            <div
                *ngFor="let dataItem of items; let index = index; let first = first; let last = last;"
                class="k-listview-item"
                [attr.role]="listItemRole"
                [attr.aria-posinset]="itemPosInSet(index)"
                [attr.aria-setsize]="total"
                kendoListViewNavigableItem
                [index]="index"
                [attr.data-kendo-listview-item-index]="index"
                [ngClass]="itemClass"
                [ngStyle]="itemStyle"
            >
                <ng-template
                    [ngTemplateOutlet]="isEdited(index) ? editTemplate?.templateRef : itemTemplate?.templateRef"
                    [ngTemplateOutletContext]="isEdited(index) ? editTemplateContext(index) : templateContext(index)"
                >
                </ng-template>
            </div>

            <!-- loading indicator -->
            <div
                *ngIf="loading && !loaderTemplate"
                class="k-loading-mask"
            >
                <!-- TODO: the k-loading-text is hidden with css but read by readers - review when implementing accessibility + possible localization case -->
                <span class="k-loading-text">Loading</span>
                <div class="k-loading-image"></div>
                <div class="k-loading-color"></div>
            </div>
            <ng-template
                *ngIf="loading && loaderTemplate"
                [ngTemplateOutlet]="loaderTemplate.templateRef"
            >
            </ng-template>
        </div>

        <!-- footer -->
        <div
            *ngIf="footerTemplate"
            class="k-listview-footer"
        >
            <ng-template
                [ngTemplateOutlet]="footerTemplate?.templateRef"
            >
            </ng-template>
        </div>

        <!-- bottom pager -->
        <ng-template
            *ngIf="pagerSettings?.position !== 'top'"
            [ngTemplateOutlet]="pagerTemplate"
            [ngTemplateOutletContext]="{ pagerClass: 'k-listview-pager' }"
        >
        </ng-template>

        <!-- pager template -->
        <ng-template #pagerTemplate let-pagerClass="pagerClass">
            <kendo-datapager
                *ngIf="pageable"
                [class]="pagerClass"
                [total]="total"
                [pageSize]="pageSize"
                [skip]="skip"
                [buttonCount]="pagerSettings.buttonCount"
                [info]="pagerSettings.info"
                [previousNext]="pagerSettings.previousNext"
                [type]="pagerSettings.type"
                [pageSizeValues]="pagerSettings.pageSizeValues"
                (pageChange)="handlePageChange($event)"
                (pageSizeChange)="pageSizeChange.emit($event)"
            >
            </kendo-datapager>
        </ng-template>
    `
            }]
    }], function () { return [{ type: ɵngcc0.NgZone }, { type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: EditService }, { type: NavigationService }]; }, { className: [{
            type: HostBinding,
            args: ['class.k-widget']
        }, {
            type: HostBinding,
            args: ['class.k-listview']
        }, {
            type: HostBinding,
            args: ['class.k-listview-bordered']
        }, {
            type: HostBinding,
            args: ['class.k-d-flex']
        }], loading: [{
            type: Input
        }], containerRole: [{
            type: Input
        }], listItemRole: [{
            type: Input
        }], scrollBottom: [{
            type: Output
        }], pageChange: [{
            type: Output
        }], pageSizeChange: [{
            type: Output
        }], edit: [{
            type: Output
        }], cancel: [{
            type: Output
        }], save: [{
            type: Output
        }], remove: [{
            type: Output
        }], add: [{
            type: Output
        }], navigable: [{
            type: Input
        }], skip: [{
            type: Input
        }], pageable: [{
            type: Input
        }], itemTemplate: [{
            type: ContentChild,
            args: [ItemTemplateDirective, { static: false }]
        }], headerTemplate: [{
            type: ContentChild,
            args: [HeaderTemplateDirective, { static: false }]
        }], footerTemplate: [{
            type: ContentChild,
            args: [FooterTemplateDirective, { static: false }]
        }], loaderTemplate: [{
            type: ContentChild,
            args: [LoaderTemplateDirective, { static: false }]
        }], contentContainer: [{
            type: ViewChild,
            args: ['contentContainer', { static: true }]
        }], editTemplate: [{
            type: ContentChild,
            args: [EditTemplateDirective, { static: false }]
        }], listViewItems: [{
            type: ViewChildren,
            args: [ListViewNavigableItemDirective]
        }], data: [{
            type: Input
        }], containerStyle: [{
            type: Input
        }], itemStyle: [{
            type: Input
        }], containerClass: [{
            type: Input
        }], itemClass: [{
            type: Input
        }], containerLabel: [{
            type: Input
        }], pageSize: [{
            type: Input
        }], height: [{
            type: Input
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DataBindingDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoListViewBinding]'
            }]
    }], function () { return [{ type: ListViewComponent }]; }, { data: [{
            type: Input,
            args: ['kendoListViewBinding']
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(TemplateContextDirective, [{
        type: Directive,
        args: [{
                selector: '[templateContext]' // tslint:disable-line
            }]
    }], function () { return [{ type: ɵngcc0.ViewContainerRef }]; }, { templateContext: [{
            type: Input
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(EditCommandDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoListViewEditCommand]'
            }]
    }], function () { return [{ type: EditService }, { type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: ɵngcc4.LocalizationService }, { type: ɵngcc0.NgZone }]; }, { 
    /**
     * @hidden
     */
    clickHandler: [{
            type: HostListener,
            args: ['click', ['$event']]
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(CancelCommandDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoListViewCancelCommand]'
            }]
    }], function () { return [{ type: EditService }, { type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: ɵngcc4.LocalizationService }, { type: ɵngcc0.NgZone }]; }, { 
    /**
     * @hidden
     */
    clickHandler: [{
            type: HostListener,
            args: ['click', ['$event']]
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(SaveCommandDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoListViewSaveCommand]'
            }]
    }], function () { return [{ type: EditService }, { type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: ɵngcc4.LocalizationService }, { type: ɵngcc0.NgZone }]; }, { 
    /**
     * @hidden
     */
    clickHandler: [{
            type: HostListener,
            args: ['click', ['$event']]
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(RemoveCommandDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoListViewRemoveCommand]'
            }]
    }], function () { return [{ type: EditService }, { type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: ɵngcc4.LocalizationService }, { type: ɵngcc0.NgZone }]; }, { 
    /**
     * @hidden
     */
    clickHandler: [{
            type: HostListener,
            args: ['click', ['$event']]
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(AddCommandDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoListViewAddCommand]'
            }]
    }], function () { return [{ type: EditService }, { type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: ɵngcc4.LocalizationService }, { type: ɵngcc0.NgZone }]; }, { 
    /**
     * @hidden
     */
    clickHandler: [{
            type: HostListener,
            args: ['click', ['$event']]
        }] }); })();
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ListViewModule, [{
        type: NgModule,
        args: [{
                declarations: [
                    TEMPLATE_DIRECTIVES,
                    BINDING_DIRECTIVES,
                    EDITING_DIRECTIVES,
                    ListViewComponent,
                    TemplateContextDirective,
                    ListViewNavigableItemDirective
                ],
                exports: [
                    TEMPLATE_DIRECTIVES,
                    BINDING_DIRECTIVES,
                    EDITING_DIRECTIVES,
                    ListViewComponent,
                    CommonModule,
                    EventsModule
                ],
                imports: [
                    CommonModule,
                    PagerModule,
                    EventsModule
                ]
            }]
    }], null, null); })();
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(ListViewModule, { declarations: function () { return [ItemTemplateDirective, HeaderTemplateDirective, FooterTemplateDirective, LoaderTemplateDirective, DataBindingDirective, EditTemplateDirective, EditCommandDirective, CancelCommandDirective, SaveCommandDirective, RemoveCommandDirective, AddCommandDirective, ListViewComponent, TemplateContextDirective, ListViewNavigableItemDirective]; }, imports: function () { return [CommonModule,
        PagerModule,
        EventsModule]; }, exports: function () { return [ItemTemplateDirective, HeaderTemplateDirective, FooterTemplateDirective, LoaderTemplateDirective, DataBindingDirective, EditTemplateDirective, EditCommandDirective, CancelCommandDirective, SaveCommandDirective, RemoveCommandDirective, AddCommandDirective, ListViewComponent, CommonModule,
        EventsModule]; } }); })();

/**
 * Generated bundle index. Do not edit.
 */

export { AddCommandDirective, CancelCommandDirective, EditCommandDirective, RemoveCommandDirective, SaveCommandDirective, EditService, ListViewNavigableItemDirective, NavigationService, TemplateContextDirective, ListViewComponent, ItemTemplateDirective, HeaderTemplateDirective, FooterTemplateDirective, LoaderTemplateDirective, DataBindingDirective, EditTemplateDirective, PageSizeChangeEvent$1 as PageSizeChangeEvent, ListViewModule };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7NkpBR3NCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztpUEFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBSUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzt5SkFBRTtBQUNGLG9DQUlHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzsrSkFBRTtBQUNGLHNDQUlHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzsrSkFBRTtBQUNGLHNDQUlHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzsrSkFBRTtBQUNGLHNDQUlHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O3lKQUFFO0FBQ0Ysb0NBSUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzsySUFBRTtBQUNGLDBCQUVHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztrUEFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQStJRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O3NNQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUlHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7cU1BQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBSUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OzswREFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUlHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OzswREFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUlHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OzswREFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUlHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7MERBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FJRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7MERBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FJRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O2tDQXlCbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlc0NvbnRlbnQiOlsiLyoqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiogQ29weXJpZ2h0IMKpIDIwMjEgUHJvZ3Jlc3MgU29mdHdhcmUgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4qIExpY2Vuc2VkIHVuZGVyIGNvbW1lcmNpYWwgbGljZW5zZS4gU2VlIExJQ0VOU0UubWQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbW9yZSBpbmZvcm1hdGlvblxuKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuaW1wb3J0IHsgX19kZWNvcmF0ZSwgX19tZXRhZGF0YSwgX19wYXJhbSB9IGZyb20gJ3RzbGliJztcbmltcG9ydCB7IEluamVjdGFibGUsIElucHV0LCBEaXJlY3RpdmUsIEVsZW1lbnRSZWYsIFJlbmRlcmVyMiwgVGVtcGxhdGVSZWYsIE9wdGlvbmFsLCBFdmVudEVtaXR0ZXIsIE5nWm9uZSwgSG9zdEJpbmRpbmcsIENvbnRlbnRDaGlsZCwgVmlld0NoaWxkLCBWaWV3Q2hpbGRyZW4sIFF1ZXJ5TGlzdCwgT3V0cHV0LCBDb21wb25lbnQsIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBWaWV3Q29udGFpbmVyUmVmLCBIb3N0TGlzdGVuZXIsIE5nTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBpc0RvY3VtZW50QXZhaWxhYmxlLCBLZXlzLCBpc0NoYW5nZWQsIGhhc09ic2VydmVycywgRXZlbnRzTW9kdWxlIH0gZnJvbSAnQHByb2dyZXNzL2tlbmRvLWFuZ3VsYXItY29tbW9uJztcbmltcG9ydCB7IHZhbGlkYXRlUGFja2FnZSB9IGZyb20gJ0Bwcm9ncmVzcy9rZW5kby1saWNlbnNpbmcnO1xuaW1wb3J0IHsgTG9jYWxpemF0aW9uU2VydmljZSwgTDEwTl9QUkVGSVggfSBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tYW5ndWxhci1sMTBuJztcbmltcG9ydCB7IFN1YmplY3QsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgRm9ybUdyb3VwLCBGb3JtQ29udHJvbCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IHN3aXRjaE1hcCwgdGFrZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IFBhZ2VTaXplQ2hhbmdlRXZlbnQsIFBhZ2VyTW9kdWxlIH0gZnJvbSAnQHByb2dyZXNzL2tlbmRvLWFuZ3VsYXItcGFnZXInO1xuaW1wb3J0IHsgQ29tbW9uTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IEJ1dHRvbiB9IGZyb20gJ0Bwcm9ncmVzcy9rZW5kby1hbmd1bGFyLWJ1dHRvbnMnO1xuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgcGFja2FnZU1ldGFkYXRhID0ge1xuICAgIG5hbWU6ICdAcHJvZ3Jlc3Mva2VuZG8tYW5ndWxhci1saXN0dmlldycsXG4gICAgcHJvZHVjdE5hbWU6ICdLZW5kbyBVSSBmb3IgQW5ndWxhcicsXG4gICAgcHJvZHVjdENvZGVzOiBbJ0tFTkRPVUlBTkdVTEFSJywgJ0tFTkRPVUlDT01QTEVURSddLFxuICAgIHB1Ymxpc2hEYXRlOiAxNjQ2MjE5MDc0LFxuICAgIHZlcnNpb246ICcnLFxuICAgIGxpY2Vuc2luZ0RvY3NVcmw6ICdodHRwczovL3d3dy50ZWxlcmlrLmNvbS9rZW5kby1hbmd1bGFyLXVpL215LWxpY2Vuc2UvP3V0bV9tZWRpdW09cHJvZHVjdCZ1dG1fc291cmNlPWtlbmRvYW5ndWxhciZ1dG1fY2FtcGFpZ249a2VuZG8tdWktYW5ndWxhci1wdXJjaGFzZS1saWNlbnNlLWtleXMtd2FybmluZydcbn07XG5cbmNvbnN0IExJU1RWSUVXX0lURU1fU0VMRUNUT1IgPSAnLmstbGlzdHZpZXctaXRlbSc7XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgaXNQcmVzZW50ID0gKGl0ZW0pID0+IGl0ZW0gIT09IG51bGwgJiYgaXRlbSAhPT0gdW5kZWZpbmVkO1xuLyoqXG4gKiBAaGlkZGVuXG4gKlxuICogUG9seWZpbGwgZm9yIGBFbGVtZW50Lm1hdGNoZXNgLlxuICogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0VsZW1lbnQvbWF0Y2hlc1xuICovXG5jb25zdCBtYXRjaCA9IChlbGVtZW50LCBzZWxlY3RvcikgPT4ge1xuICAgIGNvbnN0IG1hdGNoZXIgPSBlbGVtZW50Lm1hdGNoZXMgfHwgZWxlbWVudC5tc01hdGNoZXNTZWxlY3RvciB8fCBlbGVtZW50LndlYmtpdE1hdGNoZXNTZWxlY3RvcjtcbiAgICBpZiAoIWlzUHJlc2VudChtYXRjaGVyKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiBtYXRjaGVyLmNhbGwoZWxlbWVudCwgc2VsZWN0b3IpO1xufTtcbi8qKlxuICogQGhpZGRlblxuICpcbiAqIENoZWNrcyBpZiBhIHRhcmdldCBlbGVtZW50IGhhcyB0aGUgYC5rLWxpc3R2aWV3LWl0ZW1gIENTUyBjbGFzcy5cbiAqL1xuY29uc3QgaXNMaXN0Vmlld0l0ZW0gPSAoZWxlbWVudCkgPT4ge1xuICAgIGlmICghaXNQcmVzZW50KGVsZW1lbnQpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIG1hdGNoKGVsZW1lbnQsIExJU1RWSUVXX0lURU1fU0VMRUNUT1IpO1xufTtcbi8qKlxuICogQGhpZGRlblxuICpcbiAqIEV4dHJhY3RzIGFuZCBwYXJzZXMgdG8gYSBudW1iZXIgdGhlIGBkYXRhLWtlbmRvLWxpc3R2aWV3LWl0ZW0taW5kZXhgIGF0dHJpYnV0ZSB2YWx1ZSBmcm9tIHRoZSB0YXJnZXRlZCBlbGVtZW50LlxuICovXG5jb25zdCBnZXRMaXN0SXRlbUluZGV4ID0gKGl0ZW0pID0+IHtcbiAgICBpZiAoIWlzUHJlc2VudChpdGVtKSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIE51bWJlcihpdGVtLmdldEF0dHJpYnV0ZSgnZGF0YS1rZW5kby1saXN0dmlldy1pdGVtLWluZGV4JykpO1xufTtcbi8qKlxuICogQGhpZGRlblxuICpcbiAqIEdldHMgdGhlIG5ldyBmb2N1cyB0YXJnZXQgZnJvbSBhIGJsdXIgZXZlbnQuXG4gKiBRdWVyaWVzIGJvdGggZXZlbnQucmVsYXRlZFRhcmdldCBhbmQgZG9jdW1lbnQuYWN0aXZlRWxlbWVudCBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIElFLlxuICovXG5jb25zdCByZWxhdGVkVGFyZ2V0ID0gKGV2ZW50KSA9PiB7XG4gICAgaWYgKCFpc1ByZXNlbnQoZXZlbnQucmVsYXRlZFRhcmdldCkgfHwgIWlzRG9jdW1lbnRBdmFpbGFibGUoKSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIGV2ZW50LnJlbGF0ZWRUYXJnZXQgfHwgZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtcbn07XG4vKipcbiAqIEBoaWRkZW5cbiAqXG4gKiBJZiB0aGUgZ2l2ZW4gY29udGVuZGVyIG51bWJlciBpcyBub3QgZGVmaW5lZCBvciBsb3dlciB0aGFuIHRoZSBzcGVjaWZpZWQgbWluIC0gcmV0dXJucyBtaW4sIGlmIGl0cyBhYm92ZSB0aGUgc3BlY2lmaWVkIG1heCAtIHJldHVybnMgbWF4LlxuICogSWYgdGhlIG51bWJlciBpcyBpbiB0aGUgZ2l2ZW4gYm91bmRzLCBpdCBpcyByZXR1cm5lZC5cbiAqL1xuY29uc3QgZml0SW50b1JhbmdlID0gKGNvbnRlbmRlciwgbWluLCBtYXgpID0+IHtcbiAgICBpZiAoIWlzUHJlc2VudChjb250ZW5kZXIpIHx8IGNvbnRlbmRlciA8PSBtaW4pIHtcbiAgICAgICAgcmV0dXJuIG1pbjtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29udGVuZGVyID49IG1heCkge1xuICAgICAgICByZXR1cm4gbWF4O1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGNvbnRlbmRlcjtcbiAgICB9XG59O1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IGNsb3Nlc3RXaXRoTWF0Y2ggPSAoZWxlbWVudCwgc2VsZWN0b3IpID0+IHtcbiAgICBsZXQgcGFyZW50ID0gZWxlbWVudDtcbiAgICB3aGlsZSAocGFyZW50ICE9PSBudWxsICYmIHBhcmVudC5ub2RlVHlwZSA9PT0gMSkge1xuICAgICAgICBpZiAobWF0Y2gocGFyZW50LCBzZWxlY3RvcikpIHtcbiAgICAgICAgICAgIHJldHVybiBwYXJlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudEVsZW1lbnQgfHwgcGFyZW50LnBhcmVudE5vZGU7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufTtcbi8qKlxuICogQGhpZGRlblxuICpcbiAqIEV4dHJhY3RzIGFuZCBwYXJzZXMgdG8gYSBudW1iZXIgdGhlIGBkYXRhLWtlbmRvLWxpc3R2aWV3LWl0ZW0taW5kZXhgIGF0dHJpYnV0ZSB2YWx1ZSBmcm9tIHRoZSB0YXJnZXRlZCBlbGVtZW50LlxuICovXG5jb25zdCBnZXRDbG9zZXN0TGlzdEl0ZW1JbmRleCA9IChlbGVtZW50KSA9PiB7XG4gICAgaWYgKCFpc1ByZXNlbnQoZWxlbWVudCkpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGNsb3Nlc3RMaXN0Vmlld0l0ZW0gPSBjbG9zZXN0V2l0aE1hdGNoKGVsZW1lbnQsIExJU1RWSUVXX0lURU1fU0VMRUNUT1IpO1xuICAgIHJldHVybiBnZXRMaXN0SXRlbUluZGV4KGNsb3Nlc3RMaXN0Vmlld0l0ZW0pO1xufTtcblxuLyoqXG4gKiBAaGlkZGVuXG4gKlxuICogUHJvdmlkZWQgcGVyIExpc3RWaWV3IGluc3RhbmNlLiBLZWVwcyB0aGUgYXZhaWxhYmlsaXR5LCBhY3RpdmUgaW5kZXggYW5kIGZvY3VzZWQgc3RhdGUgb2YgdGhlIGN1cnJlbnQgTGlzdFZpZXcuXG4gKiBFbWl0cyBgY2hhbmdlc2Agd2hlbiBhbnkgb2YgdGhlIGFmb3JlbWVudGlvbmVkIHN0YXRlcyBjaGFuZ2VzLlxuICovXG5sZXQgTmF2aWdhdGlvblNlcnZpY2UgPSBjbGFzcyBOYXZpZ2F0aW9uU2VydmljZSB7XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqXG4gICAgICogUHJvdmlkZWQgcGVyIExpc3RWaWV3IGluc3RhbmNlLiBLZWVwcyB0aGUgYXZhaWxhYmlsaXR5LCBhY3RpdmUgaW5kZXggYW5kIGZvY3VzZWQgc3RhdGUgb2YgdGhlIGN1cnJlbnQgTGlzdFZpZXcuXG4gICAgICogRW1pdHMgYGNoYW5nZXNgIHdoZW4gYW55IG9mIHRoZSBhZm9yZW1lbnRpb25lZCBzdGF0ZXMgY2hhbmdlcy5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEVtaXRzIGV2ZXJ5IHRpbWUgYSBjaGFuZ2UgaW4gYWN0aXZlIGluZGV4L2ZvY3VzL2JsdXIvbmF2aWdhdGlvbiBhdmFpbGFiaWxpdHkgb2NjdXJzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jaGFuZ2VzID0gbmV3IFN1YmplY3QoKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNwZWNpZmllcyBpZiBhIExpc3RWaWV3IGl0ZW0gY3VycmVudGx5IGhvbGRzIGZvY3VzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pc0ZvY3VzZWQgPSBmYWxzZTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEtlZXBzIHRyYWNrIG9mIHRoZSBpbmRleCBvZiB0aGUgaXRlbXMgdGhhdCBzaG91bGQgYmUgdGhlIGN1cnJlbnQgZm9jdXMgdGFyZ2V0ICh0YWJpbmRleD1cIjBcIikuXG4gICAgICAgICAqIFdoZW4gc2V0IHRvIGBudWxsYC9gdW5kZWZpbmVkYCwgdGhlIG5hdmlnYXRpb24gaXMgZGlzYWJsZWQgYW5kIHRoZSBpdGVtcyBzaG91bGQgbm90IHJlbmRlciBhIHRhYmluZGV4LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5hY3RpdmVJbmRleCA9IG51bGw7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldHMgb3IgZ2V0cyBpZiB0aGUgbmF2aWdhdGlvbiBpcyBlbmFibGVkLlxuICAgICAqIFdoZW4gbm8gYWN0aXZlSW5kZXggaXMgcHJlc2VudCwgdGhlIG5hdmlnYXRpb24gaXMgaW5mZXJyZWQgYXMgZGlzYWJsZWQuXG4gICAgICogVG9nZ2xpbmcgdGhlIHNlcnZpY2UgYXZhaWxhYmlsaXR5IGNsZWFycyB0aGUgY3VycmVudCBhY3RpdmUgaW5kZXggb3IgYWN0aXZhdGVzIHRoZSBmaXJzdCBvbmUuXG4gICAgICovXG4gICAgZ2V0IGlzRW5hYmxlZCgpIHtcbiAgICAgICAgcmV0dXJuIGlzUHJlc2VudCh0aGlzLmFjdGl2ZUluZGV4KTtcbiAgICB9XG4gICAgc2V0IGlzRW5hYmxlZChlbmFibGVkKSB7XG4gICAgICAgIGlmIChlbmFibGVkKSB7XG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUluZGV4ID0gMDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlSW5kZXggPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2hhbmdlcy5uZXh0KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNob3dzIGlmIHRoZSBjaGVja2VkIGluZGV4IHNob3VsZCBiZSB0aGUgY3VycmVudCBhdmFpbGFibGUgZm9jdXMgdGFyZ2V0ICh0YWJpbmRleD1cIjBcIikuXG4gICAgICovXG4gICAgaXNBY3RpdmUoaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIGluZGV4ID09PSB0aGlzLmFjdGl2ZUluZGV4O1xuICAgIH1cbiAgICBoYW5kbGVLZXlEb3duKGV2ZW50LCB0b3RhbEl0ZW1zQ291bnQpIHtcbiAgICAgICAgY29uc3QgeyBrZXlDb2RlIH0gPSBldmVudDtcbiAgICAgICAgc3dpdGNoIChrZXlDb2RlKSB7XG4gICAgICAgICAgICBjYXNlIEtleXMuQXJyb3dMZWZ0OlxuICAgICAgICAgICAgY2FzZSBLZXlzLkFycm93VXA6XG4gICAgICAgICAgICAgICAgdGhpcy5uYXZpZ2F0ZVRvUHJldmlvdXMoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgS2V5cy5BcnJvd1JpZ2h0OlxuICAgICAgICAgICAgY2FzZSBLZXlzLkFycm93RG93bjpcbiAgICAgICAgICAgICAgICB0aGlzLm5hdmlnYXRlVG9OZXh0KHRvdGFsSXRlbXNDb3VudCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEtleXMuSG9tZTpcbiAgICAgICAgICAgICAgICBjb25zdCBmaXJzdEluZGV4ID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLm5hdmlnYXRlVG8oZmlyc3RJbmRleCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEtleXMuRW5kOlxuICAgICAgICAgICAgICAgIGNvbnN0IGxhc3RJbmRleCA9IHRvdGFsSXRlbXNDb3VudCAtIDE7XG4gICAgICAgICAgICAgICAgdGhpcy5uYXZpZ2F0ZVRvKGxhc3RJbmRleCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OiByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gdGhlIGZvbGxvd2luZyBsaW5lIGlzIGV4ZWN1dGVkIG9ubHkgaWYgdGhlIHByZXNzZWQga2V5IG1hdGNoZXMgb25lIG9mIHRoZSBsaXN0dmlldyBob3RrZXlzIC1cbiAgICAgICAgLy8gdGhleSBgYnJlYWtgLCB3aGlsZSB0aGUgYGRlZmF1bHRgIGNhc2UgYHJldHVybmBzXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuICAgIGhhbmRsZUZvY3VzSW4oZXZlbnQpIHtcbiAgICAgICAgY29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICBpZiAoIWlzTGlzdFZpZXdJdGVtKHRhcmdldCkpIHtcbiAgICAgICAgICAgIGNvbnN0IGxpc3RWaWV3SXRlbVNlbGVjdG9yID0gJy5rLWxpc3R2aWV3LWl0ZW0nO1xuICAgICAgICAgICAgY29uc3QgY2xvc2VzdExpc3RWaWV3SXRlbSA9IGNsb3Nlc3RXaXRoTWF0Y2godGFyZ2V0LCBsaXN0Vmlld0l0ZW1TZWxlY3Rvcik7XG4gICAgICAgICAgICBjb25zdCBpc0xpc3RWaWV3SXRlbUNoaWxkID0gaXNQcmVzZW50KGNsb3Nlc3RMaXN0Vmlld0l0ZW0pO1xuICAgICAgICAgICAgaWYgKGlzTGlzdFZpZXdJdGVtQ2hpbGQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBpdGVtSW5kZXggPSBnZXRMaXN0SXRlbUluZGV4KGNsb3Nlc3RMaXN0Vmlld0l0ZW0pO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlSW5kZXgoaXRlbUluZGV4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB0YXJnZXRJbmRleCA9IGdldExpc3RJdGVtSW5kZXgodGFyZ2V0KTtcbiAgICAgICAgLy8gZG9uJ3QgZW1pdCBpZiB0aGUgbm8gY2hhbmdlIGluIGZvY3VzZWQgc3RhdGUgaGFzIG9jY3VycmVkIGFuZCB0aGUgdGFyZ2V0ZWQgaW5kZXggaXMgdGhlIHNhbWUgYXMgdGhlIGN1cnJlbnQgYWN0aXZlSW5kZXhcbiAgICAgICAgaWYgKHRoaXMuaXNGb2N1c2VkICYmIHRhcmdldEluZGV4ID09PSB0aGlzLmFjdGl2ZUluZGV4KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hY3RpdmVJbmRleCA9IHRhcmdldEluZGV4O1xuICAgICAgICB0aGlzLmlzRm9jdXNlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuY2hhbmdlcy5uZXh0KCk7XG4gICAgfVxuICAgIGhhbmRsZUZvY3VzT3V0KGV2ZW50KSB7XG4gICAgICAgIC8vIGRvbid0IGVtaXQgaWYgdGhlIGJsdXJyZWQgaXRlbSBpcyBub3QgYSBsaXN0dmlldyBpdGVtIG9yIGlmIHRoZSBuZXcgZm9jdXMgdGFyZ2V0IGlzIGFub3RoZXIgbGlzdHZpZXcgaXRlbVxuICAgICAgICBpZiAoIWlzTGlzdFZpZXdJdGVtKGV2ZW50LnRhcmdldCkgfHwgaXNMaXN0Vmlld0l0ZW0ocmVsYXRlZFRhcmdldChldmVudCkpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pc0ZvY3VzZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jaGFuZ2VzLm5leHQoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgYGFjdGl2ZUluZGV4YCBhbmQgdHJpZ2dlcnMgY2hhbmdlcyB3aXRob3V0IGZvY3VzaW5nIHRoZSBjb3JyZXNwb25kaW5nIExpc3RWaWV3IGl0ZW0uXG4gICAgICovXG4gICAgc2V0QWN0aXZlSW5kZXgoaW5kZXgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzRW5hYmxlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpbmRleCA9PT0gdGhpcy5hY3RpdmVJbmRleCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYWN0aXZlSW5kZXggPSBpbmRleDtcbiAgICAgICAgdGhpcy5jaGFuZ2VzLm5leHQoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRm9jdXNlcyBpdGVtIGF0IHRoZSB0YXJnZXRlZCBpbmRleC4gSWYgbm8gaW5kZXggaXMgcGFzc2VkLCB0aGUgY3VycmVudCBgYWN0aXZlSW5kZXhgIGlzIHVzZWQuXG4gICAgICogVGhlIHBhc3NlZCB0YXJnZXQgaW5kZXggaXMgbm9ybWFsaXplZCB0byBmaXQgdGhlIG1pbi9tYXggYXZhaWxhYmxlIGluZGljZXMgYm91bmRzLlxuICAgICAqL1xuICAgIGZvY3VzSW5kZXgoaW5kZXgsIHRvdGFsSXRlbXNDb3VudCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNFbmFibGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGFyc2VkID0gcGFyc2VJbnQoaW5kZXgsIDEwKTtcbiAgICAgICAgY29uc3QgZmlyc3RJbmRleCA9IDA7XG4gICAgICAgIGNvbnN0IGxhc3RJbmRleCA9IHRvdGFsSXRlbXNDb3VudCAtIDE7XG4gICAgICAgIGNvbnN0IHRhcmdldEluZGV4ID0gaXNOYU4ocGFyc2VkKSA/IHRoaXMuYWN0aXZlSW5kZXggOiBmaXRJbnRvUmFuZ2UocGFyc2VkLCBmaXJzdEluZGV4LCBsYXN0SW5kZXgpO1xuICAgICAgICB0aGlzLm5hdmlnYXRlVG8odGFyZ2V0SW5kZXgpO1xuICAgIH1cbiAgICBuYXZpZ2F0ZVRvKGluZGV4KSB7XG4gICAgICAgIGlmICh0aGlzLmlzRm9jdXNlZCAmJiB0aGlzLmFjdGl2ZUluZGV4ID09PSBpbmRleCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaXNGb2N1c2VkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5hY3RpdmVJbmRleCA9IGluZGV4O1xuICAgICAgICB0aGlzLmNoYW5nZXMubmV4dCgpO1xuICAgIH1cbiAgICBuYXZpZ2F0ZVRvUHJldmlvdXMoKSB7XG4gICAgICAgIGNvbnN0IHByZXZpb3VzSW5kZXggPSBNYXRoLm1heCh0aGlzLmFjdGl2ZUluZGV4IC0gMSwgMCk7XG4gICAgICAgIHRoaXMubmF2aWdhdGVUbyhwcmV2aW91c0luZGV4KTtcbiAgICB9XG4gICAgbmF2aWdhdGVUb05leHQodG90YWxJdGVtc0NvdW50KSB7XG4gICAgICAgIGNvbnN0IGxhc3RBdmFpbGFibGVJbmRleCA9IHRvdGFsSXRlbXNDb3VudCAtIDE7XG4gICAgICAgIGNvbnN0IG5leHRJbmRleCA9IE1hdGgubWluKHRoaXMuYWN0aXZlSW5kZXggKyAxLCBsYXN0QXZhaWxhYmxlSW5kZXgpO1xuICAgICAgICB0aGlzLm5hdmlnYXRlVG8obmV4dEluZGV4KTtcbiAgICB9XG59O1xuTmF2aWdhdGlvblNlcnZpY2UgPSBfX2RlY29yYXRlKFtcbiAgICBJbmplY3RhYmxlKClcbl0sIE5hdmlnYXRpb25TZXJ2aWNlKTtcblxuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmxldCBMaXN0Vmlld05hdmlnYWJsZUl0ZW1EaXJlY3RpdmUgPSBjbGFzcyBMaXN0Vmlld05hdmlnYWJsZUl0ZW1EaXJlY3RpdmUge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RFbGVtZW50LCByZW5kZXJlciwgbmF2aWdhdGlvblNlcnZpY2UpIHtcbiAgICAgICAgdGhpcy5ob3N0RWxlbWVudCA9IGhvc3RFbGVtZW50O1xuICAgICAgICB0aGlzLnJlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgICAgIHRoaXMubmF2aWdhdGlvblNlcnZpY2UgPSBuYXZpZ2F0aW9uU2VydmljZTtcbiAgICB9XG4gICAgbmdPbkNoYW5nZXMoKSB7XG4gICAgICAgIHRoaXMudXBkYXRlTmF2aWdhdGlvblN0YXRlKCk7XG4gICAgfVxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLm5hdmlnYXRpb25TdWJzY3JpcHRpb24gPSB0aGlzLm5hdmlnYXRpb25TZXJ2aWNlLmNoYW5nZXNcbiAgICAgICAgICAgIC5zdWJzY3JpYmUodGhpcy51cGRhdGVOYXZpZ2F0aW9uU3RhdGUuYmluZCh0aGlzKSk7XG4gICAgfVxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICBpZiAoaXNQcmVzZW50KHRoaXMubmF2aWdhdGlvblN1YnNjcmlwdGlvbikpIHtcbiAgICAgICAgICAgIHRoaXMubmF2aWdhdGlvblN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHVwZGF0ZU5hdmlnYXRpb25TdGF0ZSgpIHtcbiAgICAgICAgdGhpcy51cGRhdGVUYWJJbmRleCgpO1xuICAgICAgICB0aGlzLnVwZGF0ZUZvY3VzZWRTdGF0ZSgpO1xuICAgIH1cbiAgICB1cGRhdGVGb2N1c2VkU3RhdGUoKSB7XG4gICAgICAgIGNvbnN0IHNob3VsZEZvY3VzID0gdGhpcy5uYXZpZ2F0aW9uU2VydmljZS5pc0FjdGl2ZSh0aGlzLmluZGV4KSAmJiB0aGlzLm5hdmlnYXRpb25TZXJ2aWNlLmlzRm9jdXNlZDtcbiAgICAgICAgY29uc3QgZm9jdXNlZENzc0NsYXNzID0gJ2stc3RhdGUtZm9jdXNlZCc7XG4gICAgICAgIGlmIChzaG91bGRGb2N1cykge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQsIGZvY3VzZWRDc3NDbGFzcyk7XG4gICAgICAgICAgICB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQ2xhc3ModGhpcy5ob3N0RWxlbWVudC5uYXRpdmVFbGVtZW50LCBmb2N1c2VkQ3NzQ2xhc3MpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHVwZGF0ZVRhYkluZGV4KCkge1xuICAgICAgICBpZiAoIXRoaXMubmF2aWdhdGlvblNlcnZpY2UuaXNFbmFibGVkKSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUF0dHJpYnV0ZSh0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQsICd0YWJpbmRleCcpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMubmF2aWdhdGlvblNlcnZpY2UuaXNBY3RpdmUodGhpcy5pbmRleCkpIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudCwgJ3RhYmluZGV4JywgJzAnKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudCwgJ3RhYmluZGV4JywgJy0xJyk7XG4gICAgICAgIH1cbiAgICB9XG59O1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgTnVtYmVyKVxuXSwgTGlzdFZpZXdOYXZpZ2FibGVJdGVtRGlyZWN0aXZlLnByb3RvdHlwZSwgXCJpbmRleFwiLCB2b2lkIDApO1xuTGlzdFZpZXdOYXZpZ2FibGVJdGVtRGlyZWN0aXZlID0gX19kZWNvcmF0ZShbXG4gICAgRGlyZWN0aXZlKHtcbiAgICAgICAgc2VsZWN0b3I6ICdba2VuZG9MaXN0Vmlld05hdmlnYWJsZUl0ZW1dJ1xuICAgIH0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbRWxlbWVudFJlZixcbiAgICAgICAgUmVuZGVyZXIyLFxuICAgICAgICBOYXZpZ2F0aW9uU2VydmljZV0pXG5dLCBMaXN0Vmlld05hdmlnYWJsZUl0ZW1EaXJlY3RpdmUpO1xuXG4vKipcbiAqIFJlbmRlcnMgdGhlIGxpc3QgaXRlbSBjb250ZW50LiBUbyBkZWZpbmUgYW4gaXRlbSB0ZW1wbGF0ZSwgbmVzdCBhbiBgPG5nLXRlbXBsYXRlPmAgdGFnXG4gKiB3aXRoIHRoZSBga2VuZG9MaXN0Vmlld0l0ZW1UZW1wbGF0ZWAgZGlyZWN0aXZlIGluc2lkZSB0aGUgYDxrZW5kby1saXN0dmlldz5gIHRhZ1xuICogW3NlZSBleGFtcGxlXSh7JSBzbHVnIHRlbXBsYXRlc19saXN0dmlldyAlfSN0b2MtaXRlbS10ZW1wbGF0ZSkuXG4gKlxuICogVGhlIGZvbGxvd2luZyB2YWx1ZXMgYXJlIGF2YWlsYWJsZSBhcyBjb250ZXh0IHZhcmlhYmxlczpcbiAqIC0gYGxldC1kYXRhSXRlbT1cImRhdGFJdGVtXCJgIChgYW55YCkgLSBUaGUgY3VycmVudCBkYXRhIGl0ZW0uIEFsc28gYXZhaWxhYmxlIGFzIGltcGxpY2l0IGNvbnRleHQgdmFyaWFibGUuXG4gKiAtIGBsZXQtaW5kZXg9XCJpbmRleFwiYCAoYG51bWJlcmApIC0gVGhlIGN1cnJlbnQgaXRlbSBpbmRleC5cbiAqIC0gYGxldC1pc0ZpcnN0PVwiaXNGaXJzdFwiYCAoYGJvb2xlYW5gKSAtIEluZGljYXRlcyB3aGV0aGVyIHRoZSBjdXJyZW50IGRhdGEgaXRlbSB3aWxsIGJlIHJlbmRlcmVkIGFzIHRoZSBmaXJzdCBpdGVtIG9uIHRoZSBsaXN0LlxuICogLSBgbGV0LWlzTGFzdD1cImlzTGFzdFwiYCAoYGJvb2xlYW5gKS0gSW5kaWNhdGVzIHdoZXRoZXIgdGhlIGN1cnJlbnQgZGF0YSBpdGVtIHdpbGwgYmUgcmVuZGVyZWQgYXMgdGhlIGxhc3QgaXRlbSBvbiB0aGUgbGlzdC5cbiAqL1xubGV0IEl0ZW1UZW1wbGF0ZURpcmVjdGl2ZSA9IGNsYXNzIEl0ZW1UZW1wbGF0ZURpcmVjdGl2ZSB7XG4gICAgY29uc3RydWN0b3IodGVtcGxhdGVSZWYpIHtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZVJlZiA9IHRlbXBsYXRlUmVmO1xuICAgIH1cbn07XG5JdGVtVGVtcGxhdGVEaXJlY3RpdmUgPSBfX2RlY29yYXRlKFtcbiAgICBEaXJlY3RpdmUoe1xuICAgICAgICBzZWxlY3RvcjogJ1trZW5kb0xpc3RWaWV3SXRlbVRlbXBsYXRlXSdcbiAgICB9KSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW1RlbXBsYXRlUmVmXSlcbl0sIEl0ZW1UZW1wbGF0ZURpcmVjdGl2ZSk7XG5cbi8qKlxuICogUmVuZGVycyB0aGUgaGVhZGVyIGNvbnRlbnQgb2YgdGhlIExpc3RWaWV3LiBUbyBkZWZpbmUgYSBoZWFkZXIgdGVtcGxhdGUsIG5lc3QgYW4gYDxuZy10ZW1wbGF0ZT5gIHRhZ1xuICogd2l0aCB0aGUgYGtlbmRvTGlzdFZpZXdIZWFkZXJUZW1wbGF0ZWAgZGlyZWN0aXZlIGluc2lkZSB0aGUgYDxrZW5kby1saXN0dmlldz5gIHRhZ1xuICogW3NlZSBleGFtcGxlXSh7JSBzbHVnIHRlbXBsYXRlc19saXN0dmlldyAlfSN0b2MtaGVhZGVyLXRlbXBsYXRlKS5cbiAqL1xubGV0IEhlYWRlclRlbXBsYXRlRGlyZWN0aXZlID0gY2xhc3MgSGVhZGVyVGVtcGxhdGVEaXJlY3RpdmUge1xuICAgIGNvbnN0cnVjdG9yKHRlbXBsYXRlUmVmKSB7XG4gICAgICAgIHRoaXMudGVtcGxhdGVSZWYgPSB0ZW1wbGF0ZVJlZjtcbiAgICB9XG59O1xuSGVhZGVyVGVtcGxhdGVEaXJlY3RpdmUgPSBfX2RlY29yYXRlKFtcbiAgICBEaXJlY3RpdmUoe1xuICAgICAgICBzZWxlY3RvcjogJ1trZW5kb0xpc3RWaWV3SGVhZGVyVGVtcGxhdGVdJ1xuICAgIH0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbVGVtcGxhdGVSZWZdKVxuXSwgSGVhZGVyVGVtcGxhdGVEaXJlY3RpdmUpO1xuXG4vKipcbiAqIFJlbmRlcnMgdGhlIGZvb3RlciBjb250ZW50IG9mIHRoZSBMaXN0Vmlldy4gVG8gZGVmaW5lIGEgZm9vdGVyIHRlbXBsYXRlLCBuZXN0IGFuIGA8bmctdGVtcGxhdGU+YCB0YWdcbiAqIHdpdGggdGhlIGBrZW5kb0xpc3RWaWV3Rm9vdGVyVGVtcGxhdGVgIGRpcmVjdGl2ZSBpbnNpZGUgdGhlIGA8a2VuZG8tbGlzdHZpZXc+YCB0YWdcbiAqIFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyB0ZW1wbGF0ZXNfbGlzdHZpZXcgJX0jdG9jLWZvb3Rlci10ZW1wbGF0ZSkuXG4gKi9cbmxldCBGb290ZXJUZW1wbGF0ZURpcmVjdGl2ZSA9IGNsYXNzIEZvb3RlclRlbXBsYXRlRGlyZWN0aXZlIHtcbiAgICBjb25zdHJ1Y3Rvcih0ZW1wbGF0ZVJlZikge1xuICAgICAgICB0aGlzLnRlbXBsYXRlUmVmID0gdGVtcGxhdGVSZWY7XG4gICAgfVxufTtcbkZvb3RlclRlbXBsYXRlRGlyZWN0aXZlID0gX19kZWNvcmF0ZShbXG4gICAgRGlyZWN0aXZlKHtcbiAgICAgICAgc2VsZWN0b3I6ICdba2VuZG9MaXN0Vmlld0Zvb3RlclRlbXBsYXRlXSdcbiAgICB9KSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW1RlbXBsYXRlUmVmXSlcbl0sIEZvb3RlclRlbXBsYXRlRGlyZWN0aXZlKTtcblxuLyoqXG4gKiBPdmVycmlkZXMgdGhlIGRlZmF1bHQgbG9hZGVyIGNvbnRlbnQgb2YgdGhlIExpc3RWaWV3LiBUbyBkZWZpbmUgYSBsb2FkZXIgdGVtcGxhdGUsIG5lc3QgYW4gYDxuZy10ZW1wbGF0ZT5gIHRhZ1xuICogd2l0aCB0aGUgYGtlbmRvTGlzdFZpZXdMb2FkZXJUZW1wbGF0ZWAgZGlyZWN0aXZlIGluc2lkZSB0aGUgYDxrZW5kby1saXN0dmlldz5gIHRhZ1xuICogW3NlZSBleGFtcGxlXSh7JSBzbHVnIHRlbXBsYXRlc19saXN0dmlldyAlfSN0b2MtbG9hZGVyLXRlbXBsYXRlKS5cbiAqL1xubGV0IExvYWRlclRlbXBsYXRlRGlyZWN0aXZlID0gY2xhc3MgTG9hZGVyVGVtcGxhdGVEaXJlY3RpdmUge1xuICAgIGNvbnN0cnVjdG9yKHRlbXBsYXRlUmVmKSB7XG4gICAgICAgIHRoaXMudGVtcGxhdGVSZWYgPSB0ZW1wbGF0ZVJlZjtcbiAgICB9XG59O1xuTG9hZGVyVGVtcGxhdGVEaXJlY3RpdmUgPSBfX2RlY29yYXRlKFtcbiAgICBEaXJlY3RpdmUoe1xuICAgICAgICBzZWxlY3RvcjogJ1trZW5kb0xpc3RWaWV3TG9hZGVyVGVtcGxhdGVdJ1xuICAgIH0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbVGVtcGxhdGVSZWZdKVxuXSwgTG9hZGVyVGVtcGxhdGVEaXJlY3RpdmUpO1xuXG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIGVkaXQgdGVtcGxhdGUgb2YgdGhlIExpc3RWaWV3IChbc2VlIGV4YW1wbGVdKHslIHNsdWcgZWRpdGluZ190ZW1wbGF0ZV9mb3Jtc19saXN0dmlldyAlfSkpLlxuICogSGVscHMgdG8gY3VzdG9taXplIHRoZSBjb250ZW50IG9mIHRoZSBlZGl0ZWQgaXRlbXMuIFRvIGRlZmluZSB0aGUgdGVtcGxhdGUsIG5lc3QgYW4gYDxuZy10ZW1wbGF0ZT5gXG4gKiB0YWcgd2l0aCB0aGUgYGtlbmRvTGlzdFZpZXdFZGl0VGVtcGxhdGVgIGRpcmVjdGl2ZSBpbnNpZGUgYSBgPGtlbmRvLWxpc3R2aWV3PmAgdGFnLlxuICpcbiAqIFRoZSB0ZW1wbGF0ZSBjb250ZXh0IGNvbnRhaW5zIHRoZSBmb2xsb3dpbmcgZmllbGRzOlxuICogLSBgZm9ybUdyb3VwYCZtZGFzaDtUaGUgY3VycmVudCBbYEZvcm1Hcm91cGBdKHt7IHNpdGUuZGF0YS51cmxzLmFuZ3VsYXJbJ2Zvcm1ncm91cGFwaSddIH19KS5cbiAqIElmIHlvdSB1c2UgdGhlIExpc3RWaWV3IGluc2lkZSBbVGVtcGxhdGUtRHJpdmVuIEZvcm1zXSh7eyBzaXRlLmRhdGEudXJscy5hbmd1bGFyWydmb3JtcyddIH19KSwgaXQgd2lsbCBiZSBgdW5kZWZpbmVkYC5cbiAqIC0gYGl0ZW1JbmRleGAmbWRhc2g7VGhlIGN1cnJlbnQgaXRlbSBpbmRleC4gSWYgaW5zaWRlIGEgbmV3IGl0ZW0sIGBpdGVtSW5kZXhgIGlzIGAtMWAuXG4gKiAtIGBkYXRhSXRlbWAmbWRhc2g7VGhlIGN1cnJlbnQgZGF0YSBpdGVtLlxuICogLSBgaXNOZXdgJm1kYXNoO1RoZSBzdGF0ZSBvZiB0aGUgY3VycmVudCBpdGVtLlxuICovXG5sZXQgRWRpdFRlbXBsYXRlRGlyZWN0aXZlID0gY2xhc3MgRWRpdFRlbXBsYXRlRGlyZWN0aXZlIHtcbiAgICBjb25zdHJ1Y3Rvcih0ZW1wbGF0ZVJlZikge1xuICAgICAgICB0aGlzLnRlbXBsYXRlUmVmID0gdGVtcGxhdGVSZWY7XG4gICAgfVxufTtcbkVkaXRUZW1wbGF0ZURpcmVjdGl2ZSA9IF9fZGVjb3JhdGUoW1xuICAgIERpcmVjdGl2ZSh7XG4gICAgICAgIHNlbGVjdG9yOiAnW2tlbmRvTGlzdFZpZXdFZGl0VGVtcGxhdGVdJ1xuICAgIH0pLFxuICAgIF9fcGFyYW0oMCwgT3B0aW9uYWwoKSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtUZW1wbGF0ZVJlZl0pXG5dLCBFZGl0VGVtcGxhdGVEaXJlY3RpdmUpO1xuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgaXNFcXVhbCA9IChpbmRleCkgPT4gKGl0ZW0pID0+IGl0ZW0uaW5kZXggPT09IGluZGV4O1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IGlzTm90RXF1YWwgPSAoaW5kZXgpID0+IChpdGVtKSA9PiBpdGVtLmluZGV4ICE9PSBpbmRleDtcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBpc05ld0l0ZW0gPSAoaW5kZXgpID0+IGluZGV4ID09PSAtMSB8fCBpbmRleCA9PT0gdW5kZWZpbmVkO1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmxldCBFZGl0U2VydmljZSA9IGNsYXNzIEVkaXRTZXJ2aWNlIHtcbiAgICBjb25zdHJ1Y3RvcihuZ1pvbmUpIHtcbiAgICAgICAgdGhpcy5uZ1pvbmUgPSBuZ1pvbmU7XG4gICAgICAgIHRoaXMuY2hhbmdlcyA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5lZGl0ZWRJbmRpY2VzID0gW107XG4gICAgICAgIHRoaXMuY2hhbmdlZFNvdXJjZSA9IG5ldyBTdWJqZWN0KCk7XG4gICAgICAgIHRoaXMuY2hhbmdlZCA9IHRoaXMuY2hhbmdlZFNvdXJjZS5hc09ic2VydmFibGUoKS5waXBlKHN3aXRjaE1hcCgoKSA9PiB0aGlzLm5nWm9uZS5vblN0YWJsZS5hc09ic2VydmFibGUoKS5waXBlKHRha2UoMSkpKSk7XG4gICAgfVxuICAgIGVkaXRJdGVtKGluZGV4LCBncm91cCA9IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLmVkaXRlZEluZGljZXMucHVzaCh7IGluZGV4LCBncm91cCB9KTtcbiAgICAgICAgdGhpcy5vbkNoYW5nZWQoKTtcbiAgICB9XG4gICAgYWRkSXRlbShncm91cCkge1xuICAgICAgICB0aGlzLm5ld0l0ZW0gPSB7IGdyb3VwIH07XG4gICAgICAgIHRoaXMub25DaGFuZ2VkKCk7XG4gICAgfVxuICAgIGlzRWRpdGluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWRpdGVkSW5kaWNlcy5sZW5ndGggPiAwO1xuICAgIH1cbiAgICBnZXQgaGFzTmV3SXRlbSgpIHtcbiAgICAgICAgcmV0dXJuIGlzUHJlc2VudCh0aGlzLm5ld0l0ZW0pO1xuICAgIH1cbiAgICBnZXQgbmV3RGF0YUl0ZW0oKSB7XG4gICAgICAgIGlmICh0aGlzLmhhc05ld0l0ZW0pIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm5ld0l0ZW0uZ3JvdXAudmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHt9O1xuICAgIH1cbiAgICBnZXQgbmV3SXRlbUdyb3VwKCkge1xuICAgICAgICBpZiAodGhpcy5oYXNOZXdJdGVtKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5uZXdJdGVtLmdyb3VwO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgRm9ybUdyb3VwKHt9KTtcbiAgICB9XG4gICAgZWRpdEdyb3VwKGluZGV4KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnRleHQoaW5kZXgpLmdyb3VwO1xuICAgIH1cbiAgICBjbG9zZShpbmRleCkge1xuICAgICAgICBpZiAoaXNOZXdJdGVtKGluZGV4KSkge1xuICAgICAgICAgICAgdGhpcy5uZXdJdGVtID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZWRpdGVkSW5kaWNlcyA9IHRoaXMuZWRpdGVkSW5kaWNlcy5maWx0ZXIoaXNOb3RFcXVhbChpbmRleCkpO1xuICAgICAgICB0aGlzLm9uQ2hhbmdlZCgpO1xuICAgIH1cbiAgICBjb250ZXh0KGluZGV4KSB7XG4gICAgICAgIGlmIChpc05ld0l0ZW0oaW5kZXgpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5uZXdJdGVtO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmZpbmRCeUluZGV4KGluZGV4KTtcbiAgICB9XG4gICAgaXNFZGl0ZWQoaW5kZXgpIHtcbiAgICAgICAgaWYgKGlzTmV3SXRlbShpbmRleCkgJiYgaXNQcmVzZW50KHRoaXMubmV3SXRlbSkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpc1ByZXNlbnQodGhpcy5maW5kQnlJbmRleChpbmRleCkpO1xuICAgIH1cbiAgICBoYXNFZGl0ZWQoaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIGlzUHJlc2VudCh0aGlzLmNvbnRleHQoaW5kZXgpKTtcbiAgICB9XG4gICAgYmVnaW5FZGl0KGl0ZW1JbmRleCkge1xuICAgICAgICB0aGlzLmNoYW5nZXMuZW1pdCh7IGFjdGlvbjogJ2VkaXQnLCBpdGVtSW5kZXggfSk7XG4gICAgfVxuICAgIGJlZ2luQWRkKCkge1xuICAgICAgICB0aGlzLmNoYW5nZXMuZW1pdCh7IGFjdGlvbjogJ2FkZCcgfSk7XG4gICAgfVxuICAgIGVuZEVkaXQoaXRlbUluZGV4KSB7XG4gICAgICAgIGNvbnN0IHsgZ3JvdXA6IGZvcm1Hcm91cCB9ID0gdGhpcy5jb250ZXh0KGl0ZW1JbmRleCk7XG4gICAgICAgIHRoaXMuY2hhbmdlcy5lbWl0KHsgYWN0aW9uOiAnY2FuY2VsJywgaXRlbUluZGV4LCBmb3JtR3JvdXAsIGlzTmV3OiBpc05ld0l0ZW0oaXRlbUluZGV4KSB9KTtcbiAgICB9XG4gICAgc2F2ZShpdGVtSW5kZXgpIHtcbiAgICAgICAgY29uc3QgeyBncm91cDogZm9ybUdyb3VwIH0gPSB0aGlzLmNvbnRleHQoaXRlbUluZGV4KTtcbiAgICAgICAgdGhpcy5jaGFuZ2VzLmVtaXQoeyBhY3Rpb246ICdzYXZlJywgaXRlbUluZGV4LCBmb3JtR3JvdXAsIGlzTmV3OiBpc05ld0l0ZW0oaXRlbUluZGV4KSB9KTtcbiAgICB9XG4gICAgcmVtb3ZlKGl0ZW1JbmRleCkge1xuICAgICAgICB0aGlzLmNoYW5nZXMuZW1pdCh7IGFjdGlvbjogJ3JlbW92ZScsIGl0ZW1JbmRleCB9KTtcbiAgICB9XG4gICAgZmluZEJ5SW5kZXgoaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWRpdGVkSW5kaWNlcy5maW5kKGlzRXF1YWwoaW5kZXgpKTtcbiAgICB9XG4gICAgb25DaGFuZ2VkKCkge1xuICAgICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNoYW5nZWRTb3VyY2UubmV4dCgpO1xuICAgICAgICB9KTtcbiAgICB9XG59O1xuRWRpdFNlcnZpY2UgPSBfX2RlY29yYXRlKFtcbiAgICBJbmplY3RhYmxlKCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtOZ1pvbmVdKVxuXSwgRWRpdFNlcnZpY2UpO1xuXG5jb25zdCBERUZBVUxUX1BBR0VSX1NFVFRJTkdTID0ge1xuICAgIHBvc2l0aW9uOiAnYm90dG9tJyxcbiAgICBidXR0b25Db3VudDogNSxcbiAgICBpbmZvOiB0cnVlLFxuICAgIHByZXZpb3VzTmV4dDogdHJ1ZSxcbiAgICB0eXBlOiAnbnVtZXJpYycsXG4gICAgcGFnZVNpemVWYWx1ZXM6IFs1LCAxMCwgMjBdXG59O1xuY29uc3QgY3JlYXRlQ29udHJvbCA9IChzb3VyY2UpID0+IChhY2MsIGtleSkgPT4ge1xuICAgIGFjY1trZXldID0gbmV3IEZvcm1Db250cm9sKHNvdXJjZVtrZXldKTtcbiAgICByZXR1cm4gYWNjO1xufTtcbi8qKlxuICogUmVwcmVzZW50cyB0aGUgS2VuZG8gVUkgTGlzdFZpZXcgY29tcG9uZW50IGZvciBBbmd1bGFyLlxuICovXG5sZXQgTGlzdFZpZXdDb21wb25lbnQgPSBjbGFzcyBMaXN0Vmlld0NvbXBvbmVudCB7XG4gICAgY29uc3RydWN0b3Iobmdab25lLCBlbGVtZW50LCByZW5kZXJlciwgZWRpdFNlcnZpY2UsIG5hdmlnYXRpb25TZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMubmdab25lID0gbmdab25lO1xuICAgICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xuICAgICAgICB0aGlzLnJlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgICAgIHRoaXMuZWRpdFNlcnZpY2UgPSBlZGl0U2VydmljZTtcbiAgICAgICAgdGhpcy5uYXZpZ2F0aW9uU2VydmljZSA9IG5hdmlnYXRpb25TZXJ2aWNlO1xuICAgICAgICAvKipcbiAgICAgICAgICogQGhpZGRlblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jbGFzc05hbWUgPSB0cnVlO1xuICAgICAgICAvKipcbiAgICAgICAgICogU3BlY2lmaWVzIGlmIHRoZSBsb2FkaW5nIGluZGljYXRvciBvZiB0aGUgTGlzdFZpZXcgd2lsbCBiZSBkaXNwbGF5ZWRcbiAgICAgICAgICogKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBwYWdpbmdfbGlzdHZpZXcgJX0jdG9jLXJlbW90ZS1iaW5kaW5nKSkuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNwZWNpZmllcyB0aGUgY29udGVudCBjb250YWluZXIgYHJvbGVgIGF0dHJpYnV0ZVxuICAgICAgICAgKiAoW21vcmUgZGV0YWlsc10oeyUgc2x1ZyBhY2Nlc3NpYmlsaXR5X2xpc3R2aWV3ICV9I3RvYy13YWktYXJpYS1zdXBwb3J0KSkuXG4gICAgICAgICAqIEJ5IGRlZmF1bHQsIHRoZSBjb250YWluZXIgYHJvbGVgIGlzIHNldCB0byBgbGlzdGJveGAuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNvbnRhaW5lclJvbGUgPSAnbGlzdGJveCc7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTcGVjaWZpZXMgdGhlIGxpc3QgaXRlbSBgcm9sZWAgYXR0cmlidXRlXG4gICAgICAgICAqIChbbW9yZSBkZXRhaWxzXSh7JSBzbHVnIGFjY2Vzc2liaWxpdHlfbGlzdHZpZXcgJX0jdG9jLXdhaS1hcmlhLXN1cHBvcnQpKS5cbiAgICAgICAgICogQnkgZGVmYXVsdCwgdGhlIGxpc3QgaXRlbSBgcm9sZWAgaXMgc2V0IHRvIGBvcHRpb25gLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5saXN0SXRlbVJvbGUgPSAnb3B0aW9uJztcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gdGhlIHVzZXIgc2Nyb2xscyB0byB0aGUgbGFzdCByZWNvcmQgb24gdGhlIHBhZ2VcbiAgICAgICAgICogKFtzZWUgZW5kbGVzcyBzY3JvbGxpbmcgZXhhbXBsZV0oeyUgc2x1ZyBzY3JvbGxtb2Rlc19saXN0dmlldyAlfSN0b2MtZW5kbGVzcy1zY3JvbGxpbmcpKS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2Nyb2xsQm90dG9tID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiB0aGUgcGFnZSBvciB0aGUgcGFnZSBzaXplIG9mIHRoZSBMaXN0VmlldyBpcyBjaGFuZ2VkXG4gICAgICAgICAqIChbc2VlIGV4YW1wbGVdKHslIHNsdWcgcGFnaW5nX2xpc3R2aWV3ICV9I3RvYy1yZW1vdGUtYmluZGluZykpLlxuICAgICAgICAgKiBZb3UgaGF2ZSB0byBoYW5kbGUgdGhlIGV2ZW50IHlvdXJzZWxmIGFuZCBwYWdlIHRoZSBkYXRhLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wYWdlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiB0aGUgcGFnZSBzaXplIG9mIHRoZSBMaXN0VmlldyBpcyBjaGFuZ2VkLiBUaGlzIGV2ZW50IGNhbiBiZSBwcmV2ZW50ZWQgKGAkZXZlbnQucHJldmVudERlZmF1bHQoKWApLlxuICAgICAgICAgKiBJZiBub3QgcHJldmVudGVkLCB0aGUgYHBhZ2VDaGFuZ2VgIGV2ZW50IHdpbGwgYmUgZmlyZWQgc3Vic2VxdWVudGx5LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wYWdlU2l6ZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gdGhlIHVzZXIgY2xpY2tzIHRoZSAqKkVkaXQqKiBjb21tYW5kIGJ1dHRvbiB0byBlZGl0IGFuIGl0ZW1cbiAgICAgICAgICogKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBlZGl0aW5nX3RlbXBsYXRlX2Zvcm1zX2xpc3R2aWV3ICV9I3RvYy1lZGl0aW5nLXJlY29yZHMpKS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZWRpdCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gdGhlIHVzZXIgY2xpY2tzIHRoZSAqKkNhbmNlbCoqIGNvbW1hbmQgYnV0dG9uIHRvIGNsb3NlIGFuIGl0ZW1cbiAgICAgICAgICogKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBlZGl0aW5nX3RlbXBsYXRlX2Zvcm1zX2xpc3R2aWV3ICV9I3RvYy1jYW5jZWxsaW5nLWVkaXRpbmcpKS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY2FuY2VsID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiB0aGUgdXNlciBjbGlja3MgdGhlICoqU2F2ZSoqIGNvbW1hbmQgYnV0dG9uIHRvIHNhdmUgY2hhbmdlcyBpbiBhbiBpdGVtXG4gICAgICAgICAqIChbc2VlIGV4YW1wbGVdKHslIHNsdWcgZWRpdGluZ190ZW1wbGF0ZV9mb3Jtc19saXN0dmlldyAlfSN0b2Mtc2F2aW5nLXJlY29yZHMpKS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2F2ZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gdGhlIHVzZXIgY2xpY2tzIHRoZSAqKlJlbW92ZSoqIGNvbW1hbmQgYnV0dG9uIHRvIHJlbW92ZSBhbiBpdGVtXG4gICAgICAgICAqIChbc2VlIGV4YW1wbGVdKHslIHNsdWcgZWRpdGluZ190ZW1wbGF0ZV9mb3Jtc19saXN0dmlldyAlfSN0b2MtcmVtb3ZpbmctcmVjb3JkcykpLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5yZW1vdmUgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyB3aGVuIHRoZSB1c2VyIGNsaWNrcyB0aGUgKipBZGQqKiBjb21tYW5kIGJ1dHRvbiB0byBhZGQgYSBuZXcgaXRlbVxuICAgICAgICAgKiAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIGVkaXRpbmdfdGVtcGxhdGVfZm9ybXNfbGlzdHZpZXcgJX0jdG9jLWFkZGluZy1yZWNvcmRzKSkuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmFkZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5fc2tpcCA9IDA7XG4gICAgICAgIHRoaXMuX25hdmlnYWJsZSA9IGZhbHNlO1xuICAgICAgICB2YWxpZGF0ZVBhY2thZ2UocGFja2FnZU1ldGFkYXRhKTtcbiAgICAgICAgdGhpcy5hdHRhY2hFZGl0SGFuZGxlcnMoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3BlY2lmaWVzIHdoZXRoZXIgdGhlIGtleWJvYXJkIG5hdmlnYXRpb24gaXMgZW5hYmxlZFxuICAgICAqIChbc2VlIGV4YW1wbGVdKHslIHNsdWcga2V5Ym9hcmRfbmF2aWdhdGlvbl9saXN0dmlldyAlfSkpLlxuICAgICAqIEJ5IGRlZmF1bHQsIHRoZSBuYXZpZ2F0aW9uIGlzIGRpc2FibGVkLlxuICAgICAqL1xuICAgIHNldCBuYXZpZ2FibGUobmF2aWdhYmxlKSB7XG4gICAgICAgIGlmICghbmF2aWdhYmxlICYmIGlzUHJlc2VudCh0aGlzLnJlbW92ZU5hdmlnYXRpb25MaXN0ZW5lcnMpKSB7XG4gICAgICAgICAgICB0aGlzLnJlbW92ZU5hdmlnYXRpb25MaXN0ZW5lcnMoKTtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlTmF2aWdhdGlvbkxpc3RlbmVycyA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLm5hdmlnYXRpb25TZXJ2aWNlLmlzRW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG5hdmlnYWJsZSAmJiAhaXNQcmVzZW50KHRoaXMucmVtb3ZlTmF2aWdhdGlvbkxpc3RlbmVycykpIHtcbiAgICAgICAgICAgIHRoaXMuYWRkTmF2aWdhdGlvbkxpc3RlbmVycygpO1xuICAgICAgICAgICAgdGhpcy5uYXZpZ2F0aW9uU2VydmljZS5pc0VuYWJsZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX25hdmlnYWJsZSA9IG5hdmlnYWJsZTtcbiAgICB9XG4gICAgZ2V0IG5hdmlnYWJsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX25hdmlnYWJsZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGVmaW5lcyB0aGUgbnVtYmVyIG9mIHJlY29yZHMgdG8gYmUgc2tpcHBlZCBieSB0aGUgcGFnZXJcbiAgICAgKiAoW21vcmUgZGV0YWlsc10oeyUgc2x1ZyBwYWdpbmdfbGlzdHZpZXcgJX0pKS5cbiAgICAgKi9cbiAgICBzZXQgc2tpcChza2lwKSB7XG4gICAgICAgIGNvbnN0IHBhcnNlZCA9IHBhcnNlSW50KHNraXAsIDEwKTtcbiAgICAgICAgY29uc3QgZGVmYXVsdFNraXBWYWx1ZSA9IDA7XG4gICAgICAgIHRoaXMuX3NraXAgPSAhaXNOYU4ocGFyc2VkKSA/IHBhcnNlZCA6IGRlZmF1bHRTa2lwVmFsdWU7XG4gICAgfVxuICAgIGdldCBza2lwKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2tpcDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29uZmlndXJlcyB3aGV0aGVyIHRoZSBMaXN0VmlldyB3aWxsIHJlbmRlciBhIHBhZ2VyXG4gICAgICogKFttb3JlIGRldGFpbHNdKHslIHNsdWcgcGFnaW5nX2xpc3R2aWV3ICV9KSkuXG4gICAgICogUHJvdmlkaW5nIGEgYm9vbGVhbiB2YWx1ZSB3aWxsIHJlbmRlciBhIHBhZ2VyIHdpdGggdGhlIGRlZmF1bHQgc2V0dGluZ3MuXG4gICAgICovXG4gICAgc2V0IHBhZ2VhYmxlKHBhZ2VhYmxlKSB7XG4gICAgICAgIHRoaXMuX3BhZ2VhYmxlID0gcGFnZWFibGU7XG4gICAgICAgIHRoaXMucGFnZXJTZXR0aW5ncyA9IHBhZ2VhYmxlID8gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9QQUdFUl9TRVRUSU5HUywgcGFnZWFibGUpIDogbnVsbDtcbiAgICB9XG4gICAgZ2V0IHBhZ2VhYmxlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcGFnZWFibGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKlxuICAgICAqIEdldHMgdGhlIGRhdGEgaXRlbXMgcGFzc2VkIHRvIHRoZSBMaXN0Vmlldy5cbiAgICAgKiBJZiBhIExpc3RWaWV3RGF0YVJlc3VsdCBpcyBwYXNzZWQsIHRoZSBkYXRhIHZhbHVlIGlzIHVzZWQuIElmIGFuIGFycmF5IGlzIHBhc3NlZCAtIGl0J3MgZGlyZWN0bHkgdXNlZC5cbiAgICAgKi9cbiAgICBnZXQgaXRlbXMoKSB7XG4gICAgICAgIGlmICghaXNQcmVzZW50KHRoaXMuZGF0YSkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheSh0aGlzLmRhdGEpID8gdGhpcy5kYXRhIDogdGhpcy5kYXRhLmRhdGE7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKlxuICAgICAqIEdldHMgdGhlIHRvdGFsIG51bWJlciBvZiByZWNvcmRzIHBhc3NlZCB0byB0aGUgTGlzdFZpZXcuXG4gICAgICogSWYgYSBMaXN0Vmlld0RhdGFSZXN1bHQgaXMgcGFzc2VkLCB0aGUgdG90YWwgdmFsdWUgaXMgdXNlZC4gSWYgYW4gYXJyYXkgaXMgcGFzc2VkIC0gaXRzIGxlbmd0aCBpcyB1c2VkLlxuICAgICAqL1xuICAgIGdldCB0b3RhbCgpIHtcbiAgICAgICAgaWYgKCFpc1ByZXNlbnQodGhpcy5kYXRhKSkge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkodGhpcy5kYXRhKSA/IHRoaXMuZGF0YS5sZW5ndGggOiB0aGlzLmRhdGEudG90YWw7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBnZXQgY29udGFpbmVyVGFiaW5kZXgoKSB7XG4gICAgICAgIC8vIHdvcmthcm91bmQgZm9yIEZGLCB3aGVyZSBhIHNjcm9sbGFibGUgY29udGFpbmVyIGlzIGZvY3VzYWJsZSBldmVuIHdpdGhvdXQgYSB0YWJpbmRleCBhbmQgY3JlYXRlcyBhbiB1bndhbnRlZCB0YWIgc3RvcFxuICAgICAgICAvLyBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD02MTY1OTRcbiAgICAgICAgcmV0dXJuIHRoaXMubmF2aWdhYmxlID8gLTEgOiBudWxsO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBjdXJyZW50IGFjdGl2ZSBpdGVtIGluZGV4XG4gICAgICogKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBrZXlib2FyZF9uYXZpZ2F0aW9uX2xpc3R2aWV3ICV9I3RvYy1jb250cm9sbGluZy10aGUtZm9jdXMpKS5cbiAgICAgKiBSZXR1cm5zIGBudWxsYCB3aGVuIHRoZSBrZXlib2FyZCBuYXZpZ2F0aW9uIGlzIGRpc2FibGVkLlxuICAgICAqL1xuICAgIGdldCBhY3RpdmVJbmRleCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubmF2aWdhdGlvblNlcnZpY2UuYWN0aXZlSW5kZXg7XG4gICAgfVxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXMpIHtcbiAgICAgICAgaWYgKGlzQ2hhbmdlZCgnaGVpZ2h0JywgY2hhbmdlcywgZmFsc2UpKSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50LCAnaGVpZ2h0JywgYCR7dGhpcy5oZWlnaHR9cHhgKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgaWYgKGlzUHJlc2VudCh0aGlzLmVkaXRTZXJ2aWNlU3Vic2NyaXB0aW9uKSkge1xuICAgICAgICAgICAgdGhpcy5lZGl0U2VydmljZVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICB0ZW1wbGF0ZUNvbnRleHQoaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIFwiJGltcGxpY2l0XCI6IHRoaXMuaXRlbXNbaW5kZXhdLFxuICAgICAgICAgICAgXCJpc0xhc3RcIjogaW5kZXggPT09IHRoaXMuaXRlbXMubGVuZ3RoIC0gMSxcbiAgICAgICAgICAgIFwiaXNGaXJzdFwiOiBpbmRleCA9PT0gMCxcbiAgICAgICAgICAgIFwiZGF0YUl0ZW1cIjogdGhpcy5pdGVtc1tpbmRleF0sXG4gICAgICAgICAgICBcImluZGV4XCI6IGluZGV4XG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBlZGl0VGVtcGxhdGVDb250ZXh0KGluZGV4KSB7XG4gICAgICAgIGNvbnN0IGlzTmV3ID0gaW5kZXggPT09IC0xO1xuICAgICAgICBjb25zdCBncm91cCA9IGlzTmV3ID8gdGhpcy5lZGl0U2VydmljZS5uZXdJdGVtR3JvdXAgOiB0aGlzLmVkaXRTZXJ2aWNlLmVkaXRHcm91cChpbmRleCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBcIiRpbXBsaWNpdFwiOiBncm91cCxcbiAgICAgICAgICAgIFwiZm9ybUdyb3VwXCI6IGdyb3VwLFxuICAgICAgICAgICAgXCJkYXRhSXRlbVwiOiBpc05ldyA/IHRoaXMuZWRpdFNlcnZpY2UubmV3RGF0YUl0ZW0gOiB0aGlzLml0ZW1zW2luZGV4XSxcbiAgICAgICAgICAgIFwiaXNOZXdcIjogaXNOZXcsXG4gICAgICAgICAgICBcImluZGV4XCI6IGluZGV4XG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEZvY3VzZXMgdGhlIGl0ZW0gYXQgdGhlIHNwZWNpZmllZCBpbmRleCAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIGtleWJvYXJkX25hdmlnYXRpb25fbGlzdHZpZXcgJX0jdG9jLWNvbnRyb2xsaW5nLXRoZS1mb2N1cykpOlxuICAgICAqIC0gSWYgbm8gaW5kZXggaXMgc3BlY2lmaWVkLCB0aGUgY3VycmVudCBhY3RpdmUgaW5kZXggd2lsbCBiZSBmb2N1c2VkLlxuICAgICAqIC0gSWYgdGhlIHBhc3NlZCB2YWx1ZSBpcyBiZWxvdyBgMGAsIHRoZSBmaXJzdCBpdGVtIHJlY2VpdmVzIGZvY3VzLlxuICAgICAqIC0gSWYgdGhlIHBhc3NlZCB2YWx1ZSBpcyBhYm92ZSB0aGUgbGFzdCBhdmFpbGFibGUgaW5kZXgsIHRoZSBsYXN0IGl0ZW0gcmVjZWl2ZXMgZm9jdXMuXG4gICAgICpcbiAgICAgKiA+IFRoZSBpbmRleCBwYXJhbSBpcyBiYXNlZCBvbiB0aGUgbG9naWNhbCBzdHJ1Y3R1cmUgb2YgdGhlIExpc3RWaWV3IGFuZCBkb2VzIG5vdCBjb3JyZXNwb25kIHRvIHRoZSBkYXRhIGl0ZW0gaW5kZXggLVxuICAgICAqID4gaS5lLiB0aGUgaW5kZXggYDBgIGNvcnJlc3BvbmRzIHRvIHRoZSBmaXJzdCByZW5kZXJlZCBsaXN0IGl0ZW0uIFBhZ2luZyBpcyBub3QgdGFrZW4gaW50byBhY2NvdW50LlxuICAgICAqID4gQWxzbywgZm9yIHRoZSBmb2N1c2luZyB0byB3b3JrLCB0aGUgYG5hdmlnYWJsZWAgcHJvcCBtdXN0IGZpcnN0IGJlIHNldCB0byBgdHJ1ZWAuXG4gICAgICovXG4gICAgZm9jdXMoaW5kZXgpIHtcbiAgICAgICAgY29uc3QgdG90YWxSZW5kZXJlZEl0ZW1zID0gdGhpcy5saXN0Vmlld0l0ZW1zLmxlbmd0aDtcbiAgICAgICAgdGhpcy5uYXZpZ2F0aW9uU2VydmljZS5mb2N1c0luZGV4KGluZGV4LCB0b3RhbFJlbmRlcmVkSXRlbXMpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IGl0ZW0gZWRpdG9yIChbc2VlIGV4YW1wbGVdKHslIHNsdWcgZWRpdGluZ190ZW1wbGF0ZV9mb3Jtc19saXN0dmlldyAlfSN0b2MtYWRkaW5nLXJlY29yZHMpKS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Rm9ybUdyb3VwfSBncm91cCAtIFRoZSBbYEZvcm1Hcm91cGBdKHt7IHNpdGUuZGF0YS51cmxzLmFuZ3VsYXJbJ2Zvcm1ncm91cGFwaSddIH19KSB0aGF0IGRlc2NyaWJlc1xuICAgICAqIHRoZSBlZGl0IGZvcm0uIElmIGNhbGxlZCB3aXRoIGEgZGF0YSBpdGVtLCBpdCB3aWxsIGJ1aWxkIHRoZSBgRm9ybUdyb3VwYCBmcm9tIHRoZSBkYXRhIGl0ZW0gZmllbGRzLlxuICAgICAqL1xuICAgIGFkZEl0ZW0oZ3JvdXApIHtcbiAgICAgICAgY29uc3QgaXNGb3JtR3JvdXAgPSBncm91cCBpbnN0YW5jZW9mIEZvcm1Hcm91cDtcbiAgICAgICAgaWYgKCFpc0Zvcm1Hcm91cCkge1xuICAgICAgICAgICAgY29uc3QgZmllbGRzID0gT2JqZWN0LmtleXMoZ3JvdXApLnJlZHVjZShjcmVhdGVDb250cm9sKGdyb3VwKSwge30pO1xuICAgICAgICAgICAgZ3JvdXAgPSBuZXcgRm9ybUdyb3VwKGZpZWxkcyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5lZGl0U2VydmljZS5hZGRJdGVtKGdyb3VwKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3dpdGNoZXMgdGhlIHNwZWNpZmllZCBpdGVtIHRvIGVkaXQgbW9kZSAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIGVkaXRpbmdfdGVtcGxhdGVfZm9ybXNfbGlzdHZpZXcgJX0jdG9jLWVkaXRpbmctcmVjb3JkcykpLlxuICAgICAqXG4gICAgICogQHBhcmFtIGluZGV4IC0gVGhlIGl0ZW0gaW5kZXggdGhhdCB3aWxsIGJlIHN3aXRjaGVkIHRvIGVkaXQgbW9kZS5cbiAgICAgKiBAcGFyYW0gZ3JvdXAgLSBUaGUgW2BGb3JtR3JvdXBgXSh7eyBzaXRlLmRhdGEudXJscy5hbmd1bGFyWydmb3JtZ3JvdXBhcGknXSB9fSlcbiAgICAgKiB0aGF0IGRlc2NyaWJlcyB0aGUgZWRpdCBmb3JtLlxuICAgICAqL1xuICAgIGVkaXRJdGVtKGluZGV4LCBncm91cCkge1xuICAgICAgICB0aGlzLmVkaXRTZXJ2aWNlLmVkaXRJdGVtKGluZGV4LCBncm91cCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENsb3NlcyB0aGUgZWRpdG9yIGZvciBhIGdpdmVuIGl0ZW0gKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBlZGl0aW5nX3RlbXBsYXRlX2Zvcm1zX2dyaWQgJX0jdG9jLWNhbmNlbGxpbmctZWRpdGluZykpLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGl0ZW0gaW5kZXggdGhhdCB3aWxsIGJlIHN3aXRjaGVkIG91dCBvZiB0aGUgZWRpdCBtb2RlLiBJZiBubyBpbmRleCBpcyBwcm92aWRlZCwgaXQgaXMgYXNzdW1lZFxuICAgICAqIHRoYXQgdGhlIG5ldyBpdGVtIGVkaXRvciB3aWxsIGJlIGNsb3NlZC5cbiAgICAgKi9cbiAgICBjbG9zZUl0ZW0oaW5kZXgpIHtcbiAgICAgICAgdGhpcy5lZGl0U2VydmljZS5jbG9zZShpbmRleCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBpc0VkaXRlZChpbmRleCkge1xuICAgICAgICByZXR1cm4gdGhpcy5lZGl0U2VydmljZS5pc0VkaXRlZChpbmRleCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBoYW5kbGVQYWdlQ2hhbmdlKGV2ZW50KSB7XG4gICAgICAgIHRoaXMuc2Nyb2xsVG9Db250YWluZXJUb3AoKTtcbiAgICAgICAgY29uc3QgZmlyc3RJbmRleCA9IDA7XG4gICAgICAgIHRoaXMubmF2aWdhdGlvblNlcnZpY2Uuc2V0QWN0aXZlSW5kZXgoZmlyc3RJbmRleCk7XG4gICAgICAgIHRoaXMucGFnZUNoYW5nZS5lbWl0KGV2ZW50KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIGhhbmRsZUNvbnRlbnRTY3JvbGwoKSB7XG4gICAgICAgIGlmICghaGFzT2JzZXJ2ZXJzKHRoaXMuc2Nyb2xsQm90dG9tKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IFRIUkVTSE9MRCA9IDI7XG4gICAgICAgIGNvbnN0IHsgc2Nyb2xsSGVpZ2h0LCBzY3JvbGxUb3AsIGNsaWVudEhlaWdodCB9ID0gdGhpcy5jb250ZW50Q29udGFpbmVyLm5hdGl2ZUVsZW1lbnQ7XG4gICAgICAgIGNvbnN0IGF0Qm90dG9tID0gc2Nyb2xsSGVpZ2h0IC0gY2xpZW50SGVpZ2h0IC0gc2Nyb2xsVG9wIDw9IFRIUkVTSE9MRDtcbiAgICAgICAgaWYgKGF0Qm90dG9tKSB7XG4gICAgICAgICAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0geyBzZW5kZXI6IHRoaXMgfTtcbiAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbEJvdHRvbS5lbWl0KGV2ZW50KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBpdGVtUG9zSW5TZXQoaW5kZXgpIHtcbiAgICAgICAgLy8gYWRkcyAxIGFzIHRoZSBhcmlhLXBvc2luc2V0IGlzIG5vdCB6ZXJvLWJhc2VkIGFuZCB0aGUgY291bnRpbmcgc3RhcnRzIGZyb20gMVxuICAgICAgICByZXR1cm4gdGhpcy5za2lwICsgaW5kZXggKyAxO1xuICAgIH1cbiAgICBzY3JvbGxUb0NvbnRhaW5lclRvcCgpIHtcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gdGhpcy5jb250ZW50Q29udGFpbmVyLm5hdGl2ZUVsZW1lbnQ7XG4gICAgICAgIGNvbnRhaW5lci5zY3JvbGxUb3AgPSAwO1xuICAgICAgICBjb250YWluZXIuc2Nyb2xsTGVmdCA9IDA7XG4gICAgfVxuICAgIGFkZE5hdmlnYXRpb25MaXN0ZW5lcnMoKSB7XG4gICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlbW92ZUtleWRvd25MaXN0ZW5lciA9IHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMuY29udGVudENvbnRhaW5lci5uYXRpdmVFbGVtZW50LCAna2V5ZG93bicsIGV2ZW50ID0+IHRoaXMubmF2aWdhdGlvblNlcnZpY2UuaGFuZGxlS2V5RG93bihldmVudCwgdGhpcy5saXN0Vmlld0l0ZW1zLmxlbmd0aCkpO1xuICAgICAgICAgICAgY29uc3QgcmVtb3ZlRm9jdXNJbkxpc3RlbmVyID0gdGhpcy5yZW5kZXJlci5saXN0ZW4odGhpcy5jb250ZW50Q29udGFpbmVyLm5hdGl2ZUVsZW1lbnQsICdmb2N1c2luJywgZXZlbnQgPT4gdGhpcy5uYXZpZ2F0aW9uU2VydmljZS5oYW5kbGVGb2N1c0luKGV2ZW50KSk7XG4gICAgICAgICAgICBjb25zdCByZW1vdmVGb2N1c091dExpc3RlbmVyID0gdGhpcy5yZW5kZXJlci5saXN0ZW4odGhpcy5jb250ZW50Q29udGFpbmVyLm5hdGl2ZUVsZW1lbnQsICdmb2N1c291dCcsIGV2ZW50ID0+IHRoaXMubmF2aWdhdGlvblNlcnZpY2UuaGFuZGxlRm9jdXNPdXQoZXZlbnQpKTtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlTmF2aWdhdGlvbkxpc3RlbmVycyA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICByZW1vdmVLZXlkb3duTGlzdGVuZXIoKTtcbiAgICAgICAgICAgICAgICByZW1vdmVGb2N1c0luTGlzdGVuZXIoKTtcbiAgICAgICAgICAgICAgICByZW1vdmVGb2N1c091dExpc3RlbmVyKCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgYXR0YWNoRWRpdEhhbmRsZXJzKCkge1xuICAgICAgICBpZiAoIWlzUHJlc2VudCh0aGlzLmVkaXRTZXJ2aWNlKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZWRpdFNlcnZpY2VTdWJzY3JpcHRpb24gPSB0aGlzLmVkaXRTZXJ2aWNlXG4gICAgICAgICAgICAuY2hhbmdlcy5zdWJzY3JpYmUodGhpcy5lbWl0Q1JVREV2ZW50LmJpbmQodGhpcykpO1xuICAgIH1cbiAgICBlbWl0Q1JVREV2ZW50KGFyZ3MpIHtcbiAgICAgICAgY29uc3QgeyBhY3Rpb24sIGl0ZW1JbmRleCwgZm9ybUdyb3VwIH0gPSBhcmdzO1xuICAgICAgICBsZXQgZGF0YUl0ZW0gPSB0aGlzLml0ZW1zW2l0ZW1JbmRleF07XG4gICAgICAgIGlmIChhY3Rpb24gIT09ICdhZGQnICYmIGZvcm1Hcm91cCkge1xuICAgICAgICAgICAgZGF0YUl0ZW0gPSBmb3JtR3JvdXAudmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgT2JqZWN0LmFzc2lnbihhcmdzLCB7XG4gICAgICAgICAgICBkYXRhSXRlbTogZGF0YUl0ZW0sXG4gICAgICAgICAgICBzZW5kZXI6IHRoaXNcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXNbYWN0aW9uXS5lbWl0KGFyZ3MpO1xuICAgIH1cbn07XG5fX2RlY29yYXRlKFtcbiAgICBIb3N0QmluZGluZygnY2xhc3Muay13aWRnZXQnKSxcbiAgICBIb3N0QmluZGluZygnY2xhc3Muay1saXN0dmlldycpLFxuICAgIEhvc3RCaW5kaW5nKCdjbGFzcy5rLWxpc3R2aWV3LWJvcmRlcmVkJyksXG4gICAgSG9zdEJpbmRpbmcoJ2NsYXNzLmstZC1mbGV4JyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEJvb2xlYW4pXG5dLCBMaXN0Vmlld0NvbXBvbmVudC5wcm90b3R5cGUsIFwiY2xhc3NOYW1lXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBDb250ZW50Q2hpbGQoSXRlbVRlbXBsYXRlRGlyZWN0aXZlLCB7IHN0YXRpYzogZmFsc2UgfSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEl0ZW1UZW1wbGF0ZURpcmVjdGl2ZSlcbl0sIExpc3RWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJpdGVtVGVtcGxhdGVcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIENvbnRlbnRDaGlsZChIZWFkZXJUZW1wbGF0ZURpcmVjdGl2ZSwgeyBzdGF0aWM6IGZhbHNlIH0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBIZWFkZXJUZW1wbGF0ZURpcmVjdGl2ZSlcbl0sIExpc3RWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJoZWFkZXJUZW1wbGF0ZVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgQ29udGVudENoaWxkKEZvb3RlclRlbXBsYXRlRGlyZWN0aXZlLCB7IHN0YXRpYzogZmFsc2UgfSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEZvb3RlclRlbXBsYXRlRGlyZWN0aXZlKVxuXSwgTGlzdFZpZXdDb21wb25lbnQucHJvdG90eXBlLCBcImZvb3RlclRlbXBsYXRlXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBDb250ZW50Q2hpbGQoTG9hZGVyVGVtcGxhdGVEaXJlY3RpdmUsIHsgc3RhdGljOiBmYWxzZSB9KSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgTG9hZGVyVGVtcGxhdGVEaXJlY3RpdmUpXG5dLCBMaXN0Vmlld0NvbXBvbmVudC5wcm90b3R5cGUsIFwibG9hZGVyVGVtcGxhdGVcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIFZpZXdDaGlsZCgnY29udGVudENvbnRhaW5lcicsIHsgc3RhdGljOiB0cnVlIH0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBFbGVtZW50UmVmKVxuXSwgTGlzdFZpZXdDb21wb25lbnQucHJvdG90eXBlLCBcImNvbnRlbnRDb250YWluZXJcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIENvbnRlbnRDaGlsZChFZGl0VGVtcGxhdGVEaXJlY3RpdmUsIHsgc3RhdGljOiBmYWxzZSB9KSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgRWRpdFRlbXBsYXRlRGlyZWN0aXZlKVxuXSwgTGlzdFZpZXdDb21wb25lbnQucHJvdG90eXBlLCBcImVkaXRUZW1wbGF0ZVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgVmlld0NoaWxkcmVuKExpc3RWaWV3TmF2aWdhYmxlSXRlbURpcmVjdGl2ZSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFF1ZXJ5TGlzdClcbl0sIExpc3RWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJsaXN0Vmlld0l0ZW1zXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBPYmplY3QpXG5dLCBMaXN0Vmlld0NvbXBvbmVudC5wcm90b3R5cGUsIFwiZGF0YVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgQm9vbGVhbilcbl0sIExpc3RWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJsb2FkaW5nXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBPYmplY3QpXG5dLCBMaXN0Vmlld0NvbXBvbmVudC5wcm90b3R5cGUsIFwiY29udGFpbmVyU3R5bGVcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE9iamVjdClcbl0sIExpc3RWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJpdGVtU3R5bGVcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE9iamVjdClcbl0sIExpc3RWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJjb250YWluZXJDbGFzc1wiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgT2JqZWN0KVxuXSwgTGlzdFZpZXdDb21wb25lbnQucHJvdG90eXBlLCBcIml0ZW1DbGFzc1wiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKVxuXSwgTGlzdFZpZXdDb21wb25lbnQucHJvdG90eXBlLCBcImNvbnRhaW5lckxhYmVsXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpXG5dLCBMaXN0Vmlld0NvbXBvbmVudC5wcm90b3R5cGUsIFwiY29udGFpbmVyUm9sZVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKVxuXSwgTGlzdFZpZXdDb21wb25lbnQucHJvdG90eXBlLCBcImxpc3RJdGVtUm9sZVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgQm9vbGVhbiksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtCb29sZWFuXSlcbl0sIExpc3RWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJuYXZpZ2FibGVcIiwgbnVsbCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBOdW1iZXIpXG5dLCBMaXN0Vmlld0NvbXBvbmVudC5wcm90b3R5cGUsIFwicGFnZVNpemVcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE51bWJlciksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtOdW1iZXJdKVxuXSwgTGlzdFZpZXdDb21wb25lbnQucHJvdG90eXBlLCBcInNraXBcIiwgbnVsbCk7XG5fX2RlY29yYXRlKFtcbiAgICBJbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBPYmplY3QpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbT2JqZWN0XSlcbl0sIExpc3RWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJwYWdlYWJsZVwiLCBudWxsKTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE51bWJlcilcbl0sIExpc3RWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJoZWlnaHRcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIE91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBFdmVudEVtaXR0ZXIpXG5dLCBMaXN0Vmlld0NvbXBvbmVudC5wcm90b3R5cGUsIFwic2Nyb2xsQm90dG9tXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBPdXRwdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgRXZlbnRFbWl0dGVyKVxuXSwgTGlzdFZpZXdDb21wb25lbnQucHJvdG90eXBlLCBcInBhZ2VDaGFuZ2VcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIE91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBFdmVudEVtaXR0ZXIpXG5dLCBMaXN0Vmlld0NvbXBvbmVudC5wcm90b3R5cGUsIFwicGFnZVNpemVDaGFuZ2VcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIE91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBFdmVudEVtaXR0ZXIpXG5dLCBMaXN0Vmlld0NvbXBvbmVudC5wcm90b3R5cGUsIFwiZWRpdFwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgT3V0cHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEV2ZW50RW1pdHRlcilcbl0sIExpc3RWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJjYW5jZWxcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIE91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBFdmVudEVtaXR0ZXIpXG5dLCBMaXN0Vmlld0NvbXBvbmVudC5wcm90b3R5cGUsIFwic2F2ZVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgT3V0cHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEV2ZW50RW1pdHRlcilcbl0sIExpc3RWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJyZW1vdmVcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIE91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBFdmVudEVtaXR0ZXIpXG5dLCBMaXN0Vmlld0NvbXBvbmVudC5wcm90b3R5cGUsIFwiYWRkXCIsIHZvaWQgMCk7XG5MaXN0Vmlld0NvbXBvbmVudCA9IF9fZGVjb3JhdGUoW1xuICAgIENvbXBvbmVudCh7XG4gICAgICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICAgICAgICBleHBvcnRBczogJ2tlbmRvTGlzdFZpZXcnLFxuICAgICAgICBzZWxlY3RvcjogJ2tlbmRvLWxpc3R2aWV3JyxcbiAgICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgICAgICBFZGl0U2VydmljZSxcbiAgICAgICAgICAgIE5hdmlnYXRpb25TZXJ2aWNlLFxuICAgICAgICAgICAgTG9jYWxpemF0aW9uU2VydmljZSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBwcm92aWRlOiBMMTBOX1BSRUZJWCxcbiAgICAgICAgICAgICAgICB1c2VWYWx1ZTogJ2tlbmRvLmxpc3R2aWV3J1xuICAgICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICB0ZW1wbGF0ZTogYFxuICAgICAgICA8IS0tIHRvcCBwYWdlciAtLT5cbiAgICAgICAgPG5nLXRlbXBsYXRlXG4gICAgICAgICAgICAqbmdJZj1cInBhZ2VyU2V0dGluZ3M/LnBvc2l0aW9uICE9PSAnYm90dG9tJ1wiXG4gICAgICAgICAgICBbbmdUZW1wbGF0ZU91dGxldF09XCJwYWdlclRlbXBsYXRlXCJcbiAgICAgICAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0Q29udGV4dF09XCJ7IHBhZ2VyQ2xhc3M6ICdrLWxpc3R2aWV3LXBhZ2VyIGstbGlzdHZpZXctcGFnZXItdG9wJyB9XCJcbiAgICAgICAgPlxuICAgICAgICA8L25nLXRlbXBsYXRlPlxuXG4gICAgICAgIDwhLS0gaGVhZGVyIC0tPlxuICAgICAgICA8ZGl2XG4gICAgICAgICAgICAqbmdJZj1cImhlYWRlclRlbXBsYXRlXCJcbiAgICAgICAgICAgIGNsYXNzPVwiay1saXN0dmlldy1oZWFkZXJcIlxuICAgICAgICA+XG4gICAgICAgICAgICA8bmctdGVtcGxhdGVcbiAgICAgICAgICAgICAgICBbbmdUZW1wbGF0ZU91dGxldF09XCJoZWFkZXJUZW1wbGF0ZT8udGVtcGxhdGVSZWZcIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgPC9uZy10ZW1wbGF0ZT5cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgPCEtLSBjb250ZW50IC0tPlxuICAgICAgICA8ZGl2XG4gICAgICAgICAgICAjY29udGVudENvbnRhaW5lclxuICAgICAgICAgICAgW2F0dHIudGFiaW5kZXhdPVwiY29udGFpbmVyVGFiaW5kZXhcIlxuICAgICAgICAgICAgY2xhc3M9XCJrLWxpc3R2aWV3LWNvbnRlbnRcIlxuICAgICAgICAgICAgW25nQ2xhc3NdPVwiY29udGFpbmVyQ2xhc3NcIlxuICAgICAgICAgICAgW25nU3R5bGVdPVwiY29udGFpbmVyU3R5bGVcIlxuICAgICAgICAgICAgW2tlbmRvRXZlbnRzT3V0c2lkZUFuZ3VsYXJdPVwie1xuICAgICAgICAgICAgICAgIHNjcm9sbDogaGFuZGxlQ29udGVudFNjcm9sbFxuICAgICAgICAgICAgfVwiXG4gICAgICAgICAgICBbc2NvcGVdPVwidGhpc1wiXG4gICAgICAgICAgICBbYXR0ci5yb2xlXT1cImNvbnRhaW5lclJvbGVcIlxuICAgICAgICAgICAgW2F0dHIuYXJpYS1sYWJlbF09XCJjb250YWluZXJMYWJlbFwiXG4gICAgICAgID5cbiAgICAgICAgICAgIDwhLS0gbmV3IGl0ZW0gZWRpdCB0ZW1wbGF0ZSAtLT5cbiAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgICAqbmdJZj1cImVkaXRTZXJ2aWNlLmhhc05ld0l0ZW1cIlxuICAgICAgICAgICAgICAgIGNsYXNzPVwiay1saXN0dmlldy1pdGVtXCJcbiAgICAgICAgICAgICAgICBbYXR0ci5yb2xlXT1cImxpc3RJdGVtUm9sZVwiXG4gICAgICAgICAgICAgICAga2VuZG9MaXN0Vmlld05hdmlnYWJsZUl0ZW1cbiAgICAgICAgICAgICAgICBbaW5kZXhdPVwiLTFcIlxuICAgICAgICAgICAgICAgIFthdHRyLmRhdGEta2VuZG8tbGlzdHZpZXctaXRlbS1pbmRleF09XCItMVwiXG4gICAgICAgICAgICAgICAgW25nQ2xhc3NdPVwiaXRlbUNsYXNzXCJcbiAgICAgICAgICAgICAgICBbbmdTdHlsZV09XCJpdGVtU3R5bGVcIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxuZy10ZW1wbGF0ZVxuICAgICAgICAgICAgICAgICAgICAqbmdJZj1cImVkaXRUZW1wbGF0ZVwiXG4gICAgICAgICAgICAgICAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0XT1cImVkaXRUZW1wbGF0ZT8udGVtcGxhdGVSZWZcIlxuICAgICAgICAgICAgICAgICAgICBbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwiZWRpdFRlbXBsYXRlQ29udGV4dCgtMSlcIlxuICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8L25nLXRlbXBsYXRlPlxuICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgIDwhLS0gaXRlbXMgLS0+XG4gICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgICAgKm5nRm9yPVwibGV0IGRhdGFJdGVtIG9mIGl0ZW1zOyBsZXQgaW5kZXggPSBpbmRleDsgbGV0IGZpcnN0ID0gZmlyc3Q7IGxldCBsYXN0ID0gbGFzdDtcIlxuICAgICAgICAgICAgICAgIGNsYXNzPVwiay1saXN0dmlldy1pdGVtXCJcbiAgICAgICAgICAgICAgICBbYXR0ci5yb2xlXT1cImxpc3RJdGVtUm9sZVwiXG4gICAgICAgICAgICAgICAgW2F0dHIuYXJpYS1wb3NpbnNldF09XCJpdGVtUG9zSW5TZXQoaW5kZXgpXCJcbiAgICAgICAgICAgICAgICBbYXR0ci5hcmlhLXNldHNpemVdPVwidG90YWxcIlxuICAgICAgICAgICAgICAgIGtlbmRvTGlzdFZpZXdOYXZpZ2FibGVJdGVtXG4gICAgICAgICAgICAgICAgW2luZGV4XT1cImluZGV4XCJcbiAgICAgICAgICAgICAgICBbYXR0ci5kYXRhLWtlbmRvLWxpc3R2aWV3LWl0ZW0taW5kZXhdPVwiaW5kZXhcIlxuICAgICAgICAgICAgICAgIFtuZ0NsYXNzXT1cIml0ZW1DbGFzc1wiXG4gICAgICAgICAgICAgICAgW25nU3R5bGVdPVwiaXRlbVN0eWxlXCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8bmctdGVtcGxhdGVcbiAgICAgICAgICAgICAgICAgICAgW25nVGVtcGxhdGVPdXRsZXRdPVwiaXNFZGl0ZWQoaW5kZXgpID8gZWRpdFRlbXBsYXRlPy50ZW1wbGF0ZVJlZiA6IGl0ZW1UZW1wbGF0ZT8udGVtcGxhdGVSZWZcIlxuICAgICAgICAgICAgICAgICAgICBbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwiaXNFZGl0ZWQoaW5kZXgpID8gZWRpdFRlbXBsYXRlQ29udGV4dChpbmRleCkgOiB0ZW1wbGF0ZUNvbnRleHQoaW5kZXgpXCJcbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgPC9uZy10ZW1wbGF0ZT5cbiAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICA8IS0tIGxvYWRpbmcgaW5kaWNhdG9yIC0tPlxuICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICAgICpuZ0lmPVwibG9hZGluZyAmJiAhbG9hZGVyVGVtcGxhdGVcIlxuICAgICAgICAgICAgICAgIGNsYXNzPVwiay1sb2FkaW5nLW1hc2tcIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDwhLS0gVE9ETzogdGhlIGstbG9hZGluZy10ZXh0IGlzIGhpZGRlbiB3aXRoIGNzcyBidXQgcmVhZCBieSByZWFkZXJzIC0gcmV2aWV3IHdoZW4gaW1wbGVtZW50aW5nIGFjY2Vzc2liaWxpdHkgKyBwb3NzaWJsZSBsb2NhbGl6YXRpb24gY2FzZSAtLT5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cImstbG9hZGluZy10ZXh0XCI+TG9hZGluZzwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiay1sb2FkaW5nLWltYWdlXCI+PC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImstbG9hZGluZy1jb2xvclwiPjwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8bmctdGVtcGxhdGVcbiAgICAgICAgICAgICAgICAqbmdJZj1cImxvYWRpbmcgJiYgbG9hZGVyVGVtcGxhdGVcIlxuICAgICAgICAgICAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0XT1cImxvYWRlclRlbXBsYXRlLnRlbXBsYXRlUmVmXCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgIDwvbmctdGVtcGxhdGU+XG4gICAgICAgIDwvZGl2PlxuXG4gICAgICAgIDwhLS0gZm9vdGVyIC0tPlxuICAgICAgICA8ZGl2XG4gICAgICAgICAgICAqbmdJZj1cImZvb3RlclRlbXBsYXRlXCJcbiAgICAgICAgICAgIGNsYXNzPVwiay1saXN0dmlldy1mb290ZXJcIlxuICAgICAgICA+XG4gICAgICAgICAgICA8bmctdGVtcGxhdGVcbiAgICAgICAgICAgICAgICBbbmdUZW1wbGF0ZU91dGxldF09XCJmb290ZXJUZW1wbGF0ZT8udGVtcGxhdGVSZWZcIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgPC9uZy10ZW1wbGF0ZT5cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgPCEtLSBib3R0b20gcGFnZXIgLS0+XG4gICAgICAgIDxuZy10ZW1wbGF0ZVxuICAgICAgICAgICAgKm5nSWY9XCJwYWdlclNldHRpbmdzPy5wb3NpdGlvbiAhPT0gJ3RvcCdcIlxuICAgICAgICAgICAgW25nVGVtcGxhdGVPdXRsZXRdPVwicGFnZXJUZW1wbGF0ZVwiXG4gICAgICAgICAgICBbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwieyBwYWdlckNsYXNzOiAnay1saXN0dmlldy1wYWdlcicgfVwiXG4gICAgICAgID5cbiAgICAgICAgPC9uZy10ZW1wbGF0ZT5cblxuICAgICAgICA8IS0tIHBhZ2VyIHRlbXBsYXRlIC0tPlxuICAgICAgICA8bmctdGVtcGxhdGUgI3BhZ2VyVGVtcGxhdGUgbGV0LXBhZ2VyQ2xhc3M9XCJwYWdlckNsYXNzXCI+XG4gICAgICAgICAgICA8a2VuZG8tZGF0YXBhZ2VyXG4gICAgICAgICAgICAgICAgKm5nSWY9XCJwYWdlYWJsZVwiXG4gICAgICAgICAgICAgICAgW2NsYXNzXT1cInBhZ2VyQ2xhc3NcIlxuICAgICAgICAgICAgICAgIFt0b3RhbF09XCJ0b3RhbFwiXG4gICAgICAgICAgICAgICAgW3BhZ2VTaXplXT1cInBhZ2VTaXplXCJcbiAgICAgICAgICAgICAgICBbc2tpcF09XCJza2lwXCJcbiAgICAgICAgICAgICAgICBbYnV0dG9uQ291bnRdPVwicGFnZXJTZXR0aW5ncy5idXR0b25Db3VudFwiXG4gICAgICAgICAgICAgICAgW2luZm9dPVwicGFnZXJTZXR0aW5ncy5pbmZvXCJcbiAgICAgICAgICAgICAgICBbcHJldmlvdXNOZXh0XT1cInBhZ2VyU2V0dGluZ3MucHJldmlvdXNOZXh0XCJcbiAgICAgICAgICAgICAgICBbdHlwZV09XCJwYWdlclNldHRpbmdzLnR5cGVcIlxuICAgICAgICAgICAgICAgIFtwYWdlU2l6ZVZhbHVlc109XCJwYWdlclNldHRpbmdzLnBhZ2VTaXplVmFsdWVzXCJcbiAgICAgICAgICAgICAgICAocGFnZUNoYW5nZSk9XCJoYW5kbGVQYWdlQ2hhbmdlKCRldmVudClcIlxuICAgICAgICAgICAgICAgIChwYWdlU2l6ZUNoYW5nZSk9XCJwYWdlU2l6ZUNoYW5nZS5lbWl0KCRldmVudClcIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgPC9rZW5kby1kYXRhcGFnZXI+XG4gICAgICAgIDwvbmctdGVtcGxhdGU+XG4gICAgYFxuICAgIH0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbTmdab25lLFxuICAgICAgICBFbGVtZW50UmVmLFxuICAgICAgICBSZW5kZXJlcjIsXG4gICAgICAgIEVkaXRTZXJ2aWNlLFxuICAgICAgICBOYXZpZ2F0aW9uU2VydmljZV0pXG5dLCBMaXN0Vmlld0NvbXBvbmVudCk7XG5cbi8qKlxuICogQSBkaXJlY3RpdmUgdGhhdCBlbmNhcHN1bGF0ZXMgdGhlIGluLW1lbW9yeSBoYW5kbGluZyBvZiBwYWdpbmdcbiAqIChbc2VlIGV4YW1wbGVdKHslIHNsdWcgcGFnaW5nX2xpc3R2aWV3ICV9I3RvYy1iaW5kaW5nLWRpcmVjdGl2ZSkpLlxuICovXG5sZXQgRGF0YUJpbmRpbmdEaXJlY3RpdmUgPSBjbGFzcyBEYXRhQmluZGluZ0RpcmVjdGl2ZSB7XG4gICAgY29uc3RydWN0b3IobGlzdFZpZXcpIHtcbiAgICAgICAgdGhpcy5saXN0VmlldyA9IGxpc3RWaWV3O1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMgPSBuZXcgU3Vic2NyaXB0aW9uKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBhcnJheSBvZiBkYXRhIHdoaWNoIHdpbGwgYmUgdXNlZCB0byBwb3B1bGF0ZSB0aGUgTGlzdFZpZXcuXG4gICAgICovXG4gICAgc2V0IGRhdGEoZGF0YSkge1xuICAgICAgICB0aGlzLl9kYXRhID0gZGF0YSB8fCBbXTtcbiAgICAgICAgdGhpcy51cGRhdGVMaXN0Vmlld0RhdGEoKTtcbiAgICB9XG4gICAgZ2V0IGRhdGEoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kYXRhO1xuICAgIH1cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLmFkZCh0aGlzLmxpc3RWaWV3LnBhZ2VDaGFuZ2Uuc3Vic2NyaWJlKHRoaXMuaGFuZGxlUGFnZUNoYW5nZS5iaW5kKHRoaXMpKSk7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5hZGQodGhpcy5saXN0Vmlldy5wYWdlU2l6ZUNoYW5nZS5zdWJzY3JpYmUodGhpcy5oYW5kbGVQYWdlU2l6ZUNoYW5nZS5iaW5kKHRoaXMpKSk7XG4gICAgICAgIHRoaXMudXBkYXRlTGlzdFZpZXdEYXRhKCk7XG4gICAgfVxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMudW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gICAgaGFuZGxlUGFnZUNoYW5nZShldmVudCkge1xuICAgICAgICB0aGlzLmxpc3RWaWV3LnNraXAgPSBldmVudC5za2lwO1xuICAgICAgICB0aGlzLmxpc3RWaWV3LnBhZ2VTaXplID0gZXZlbnQudGFrZTtcbiAgICAgICAgdGhpcy51cGRhdGVMaXN0Vmlld0RhdGEoKTtcbiAgICB9XG4gICAgaGFuZGxlUGFnZVNpemVDaGFuZ2UoZXZlbnQpIHtcbiAgICAgICAgdGhpcy5saXN0Vmlldy5wYWdlU2l6ZSA9IE51bWJlcihldmVudC5uZXdQYWdlU2l6ZSk7XG4gICAgfVxuICAgIHVwZGF0ZUxpc3RWaWV3RGF0YSgpIHtcbiAgICAgICAgY29uc3QgZnJvbSA9IHRoaXMubGlzdFZpZXcuc2tpcCB8fCAwO1xuICAgICAgICBjb25zdCB0byA9IGZyb20gKyAodGhpcy5saXN0Vmlldy5wYWdlU2l6ZSB8fCB0aGlzLmRhdGEubGVuZ3RoKTtcbiAgICAgICAgdGhpcy5saXN0Vmlldy5kYXRhID0ge1xuICAgICAgICAgICAgZGF0YTogdGhpcy5kYXRhLnNsaWNlKGZyb20sIHRvKSxcbiAgICAgICAgICAgIHRvdGFsOiB0aGlzLmRhdGEubGVuZ3RoXG4gICAgICAgIH07XG4gICAgfVxufTtcbl9fZGVjb3JhdGUoW1xuICAgIElucHV0KCdrZW5kb0xpc3RWaWV3QmluZGluZycpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBBcnJheSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtBcnJheV0pXG5dLCBEYXRhQmluZGluZ0RpcmVjdGl2ZS5wcm90b3R5cGUsIFwiZGF0YVwiLCBudWxsKTtcbkRhdGFCaW5kaW5nRGlyZWN0aXZlID0gX19kZWNvcmF0ZShbXG4gICAgRGlyZWN0aXZlKHtcbiAgICAgICAgc2VsZWN0b3I6ICdba2VuZG9MaXN0Vmlld0JpbmRpbmddJ1xuICAgIH0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbTGlzdFZpZXdDb21wb25lbnRdKVxuXSwgRGF0YUJpbmRpbmdEaXJlY3RpdmUpO1xuXG4vKipcbiAqIFRoZSBhcmd1bWVudHMgb2YgdGhlIFtgcGFnZVNpemVDaGFuZ2VgXSh7JSBzbHVnIGFwaV9saXN0dmlld19saXN0dmlld2NvbXBvbmVudCAlfSN0b2MtcGFnZXNpemVjaGFuZ2UpIGV2ZW50IG9mIHRoZSBMaXN0Vmlld1xuICogKFttb3JlIGRldGFpbHNdKHslIHNsdWcgcGFnaW5nX2xpc3R2aWV3ICV9KS5cbiAqL1xuY2xhc3MgUGFnZVNpemVDaGFuZ2VFdmVudCQxIGV4dGVuZHMgUGFnZVNpemVDaGFuZ2VFdmVudCB7XG59XG5cbi8qKlxuICogQGhpZGRlblxuICovXG5sZXQgVGVtcGxhdGVDb250ZXh0RGlyZWN0aXZlID0gY2xhc3MgVGVtcGxhdGVDb250ZXh0RGlyZWN0aXZlIHtcbiAgICBjb25zdHJ1Y3Rvcih2aWV3Q29udGFpbmVyUmVmKSB7XG4gICAgICAgIHRoaXMudmlld0NvbnRhaW5lclJlZiA9IHZpZXdDb250YWluZXJSZWY7XG4gICAgfVxuICAgIHNldCB0ZW1wbGF0ZUNvbnRleHQoY29udGV4dCkge1xuICAgICAgICBpZiAodGhpcy5pbnNlcnRlZFZpZXdSZWYpIHtcbiAgICAgICAgICAgIHRoaXMudmlld0NvbnRhaW5lclJlZi5yZW1vdmUodGhpcy52aWV3Q29udGFpbmVyUmVmLmluZGV4T2YodGhpcy5pbnNlcnRlZFZpZXdSZWYpKTtcbiAgICAgICAgICAgIHRoaXMuaW5zZXJ0ZWRWaWV3UmVmID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb250ZXh0LnRlbXBsYXRlUmVmKSB7XG4gICAgICAgICAgICB0aGlzLmluc2VydGVkVmlld1JlZiA9IHRoaXMudmlld0NvbnRhaW5lclJlZi5jcmVhdGVFbWJlZGRlZFZpZXcoY29udGV4dC50ZW1wbGF0ZVJlZiwgY29udGV4dCk7XG4gICAgICAgIH1cbiAgICB9XG59O1xuX19kZWNvcmF0ZShbXG4gICAgSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgT2JqZWN0KSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW09iamVjdF0pXG5dLCBUZW1wbGF0ZUNvbnRleHREaXJlY3RpdmUucHJvdG90eXBlLCBcInRlbXBsYXRlQ29udGV4dFwiLCBudWxsKTtcblRlbXBsYXRlQ29udGV4dERpcmVjdGl2ZSA9IF9fZGVjb3JhdGUoW1xuICAgIERpcmVjdGl2ZSh7XG4gICAgICAgIHNlbGVjdG9yOiAnW3RlbXBsYXRlQ29udGV4dF0nIC8vIHRzbGludDpkaXNhYmxlLWxpbmVcbiAgICB9KSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW1ZpZXdDb250YWluZXJSZWZdKVxuXSwgVGVtcGxhdGVDb250ZXh0RGlyZWN0aXZlKTtcblxuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBgZWRpdGAgY29tbWFuZCBvZiB0aGUgTGlzdFZpZXcuIFlvdSBjYW4gYXBwbHkgdGhpcyBkaXJlY3RpdmUgdG8gYW55IGBidXR0b25gXG4gKiBlbGVtZW50IGluc2lkZSBhIFtgRWRpdFRlbXBsYXRlRGlyZWN0aXZlYF0oeyUgc2x1ZyBhcGlfbGlzdHZpZXdfZWRpdHRlbXBsYXRlZGlyZWN0aXZlICV9KSB0ZW1wbGF0ZS5cbiAqIFdoZW4gYW4gYXNzb2NpYXRlZCBidXR0b24gd2l0aCB0aGUgZGlyZWN0aXZlIGlzIGNsaWNrZWQsIHRoZVxuICogW2BlZGl0YF0oeyUgc2x1ZyBhcGlfbGlzdHZpZXdfbGlzdHZpZXdjb21wb25lbnQgJX0jdG9jLWVkaXQpIGV2ZW50XG4gKiBpcyB0cmlnZ2VyZWQgKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBlZGl0aW5nX2xpc3R2aWV3ICV9KSkuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGh0bWwtbm8tcnVuXG4gKiA8a2VuZG8tbGlzdHZpZXc+XG4gKiAgIDxuZy10ZW1wbGF0ZSBrZW5kb0xpc3RWaWV3RWRpdFRlbXBsYXRlPlxuICogICAgIDxidXR0b24ga2VuZG9MaXN0Vmlld0VkaXRDb21tYW5kIGNsYXNzPVwiay1wcmltYXJ5XCI+RWRpdDwvYnV0dG9uPlxuICogICA8L25nLXRlbXBsYXRlPlxuICogPC9rZW5kby1saXN0dmlldz5cbiAqIGBgYFxuICpcbiAqL1xubGV0IEVkaXRDb21tYW5kRGlyZWN0aXZlID0gY2xhc3MgRWRpdENvbW1hbmREaXJlY3RpdmUgZXh0ZW5kcyBCdXR0b24ge1xuICAgIGNvbnN0cnVjdG9yKGVkaXRTZXJ2aWNlLCBlbGVtZW50LCByZW5kZXJlciwgbG9jYWxpemF0aW9uLCBuZ1pvbmUpIHtcbiAgICAgICAgc3VwZXIoZWxlbWVudCwgcmVuZGVyZXIsIG51bGwsIGxvY2FsaXphdGlvbiwgbmdab25lKTtcbiAgICAgICAgdGhpcy5lZGl0U2VydmljZSA9IGVkaXRTZXJ2aWNlO1xuICAgICAgICB0aGlzLmVsZW1lbnRSZWYgPSBlbGVtZW50O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgY2xpY2tIYW5kbGVyKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBjb25zdCBpbmRleCA9IGdldENsb3Nlc3RMaXN0SXRlbUluZGV4KHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50KTtcbiAgICAgICAgdGhpcy5lZGl0U2VydmljZS5iZWdpbkVkaXQoaW5kZXgpO1xuICAgIH1cbn07XG5fX2RlY29yYXRlKFtcbiAgICBIb3N0TGlzdGVuZXIoJ2NsaWNrJywgWyckZXZlbnQnXSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEZ1bmN0aW9uKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW09iamVjdF0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cmV0dXJudHlwZVwiLCB2b2lkIDApXG5dLCBFZGl0Q29tbWFuZERpcmVjdGl2ZS5wcm90b3R5cGUsIFwiY2xpY2tIYW5kbGVyXCIsIG51bGwpO1xuRWRpdENvbW1hbmREaXJlY3RpdmUgPSBfX2RlY29yYXRlKFtcbiAgICBEaXJlY3RpdmUoe1xuICAgICAgICBzZWxlY3RvcjogJ1trZW5kb0xpc3RWaWV3RWRpdENvbW1hbmRdJ1xuICAgIH0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbRWRpdFNlcnZpY2UsXG4gICAgICAgIEVsZW1lbnRSZWYsXG4gICAgICAgIFJlbmRlcmVyMixcbiAgICAgICAgTG9jYWxpemF0aW9uU2VydmljZSxcbiAgICAgICAgTmdab25lXSlcbl0sIEVkaXRDb21tYW5kRGlyZWN0aXZlKTtcblxuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBgY2FuY2VsYCBjb21tYW5kIG9mIHRoZSBMaXN0Vmlldy4gWW91IGNhbiBhcHBseSB0aGlzIGRpcmVjdGl2ZSB0byBhbnkgYGJ1dHRvbmBcbiAqIGVsZW1lbnQgaW5zaWRlIGEgW2BFZGl0VGVtcGxhdGVEaXJlY3RpdmVgXSh7JSBzbHVnIGFwaV9saXN0dmlld19lZGl0dGVtcGxhdGVkaXJlY3RpdmUgJX0pIHRlbXBsYXRlLlxuICogV2hlbiBhbiBhc3NvY2lhdGVkIGJ1dHRvbiB3aXRoIHRoZSBkaXJlY3RpdmUgaXMgY2xpY2tlZCwgdGhlXG4gKiBbYGNhbmNlbGBdKHslIHNsdWcgYXBpX2xpc3R2aWV3X2xpc3R2aWV3Y29tcG9uZW50ICV9I3RvYy1jYW5jZWwpIGV2ZW50XG4gKiBpcyB0cmlnZ2VyZWQgKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBlZGl0aW5nX2xpc3R2aWV3ICV9KSkuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGh0bWwtbm8tcnVuXG4gKiA8a2VuZG8tbGlzdHZpZXc+XG4gKiAgIDxuZy10ZW1wbGF0ZSBrZW5kb0xpc3RWaWV3RWRpdFRlbXBsYXRlPlxuICogICAgIDxidXR0b24ga2VuZG9MaXN0Vmlld0NhbmNlbENvbW1hbmQ+Q2FuY2VsIGNoYW5nZXM8L2J1dHRvbj5cbiAqICAgPC9uZy10ZW1wbGF0ZT5cbiAqIDwva2VuZG8tbGlzdHZpZXc+XG4gKiBgYGBcbiAqXG4gKiBZb3UgY2FuIGNvbnRyb2wgdGhlIGNvbnRlbnQgb2YgdGhlIGJ1dHRvbiBiYXNlZCBvbiB0aGUgc3RhdGUgb2YgdGhlIGl0ZW0uXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGh0bWwtbm8tcnVuXG4gKiA8a2VuZG8tbGlzdHZpZXc+XG4gKiAgIDxuZy10ZW1wbGF0ZSBrZW5kb0xpc3RWaWV3RWRpdFRlbXBsYXRlIGxldC1pc05ldz1cImlzTmV3XCI+XG4gKiAgICAgPGJ1dHRvbiBrZW5kb0xpc3RWaWV3Q2FuY2VsQ29tbWFuZD57e2lzTmV3ID8gJ0Rpc2NhcmQnIDogJ0NhbmNlbCBjaGFuZ2VzJ319PC9idXR0b24+XG4gKiAgIDwvbmctdGVtcGxhdGU+XG4gKiA8L2tlbmRvLWxpc3R2aWV3PlxuICogYGBgXG4gKi9cbmxldCBDYW5jZWxDb21tYW5kRGlyZWN0aXZlID0gY2xhc3MgQ2FuY2VsQ29tbWFuZERpcmVjdGl2ZSBleHRlbmRzIEJ1dHRvbiB7XG4gICAgY29uc3RydWN0b3IoZWRpdFNlcnZpY2UsIGVsZW1lbnQsIHJlbmRlcmVyLCBsb2NhbGl6YXRpb24sIG5nWm9uZSkge1xuICAgICAgICBzdXBlcihlbGVtZW50LCByZW5kZXJlciwgbnVsbCwgbG9jYWxpemF0aW9uLCBuZ1pvbmUpO1xuICAgICAgICB0aGlzLmVkaXRTZXJ2aWNlID0gZWRpdFNlcnZpY2U7XG4gICAgICAgIHRoaXMuZWxlbWVudFJlZiA9IGVsZW1lbnQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBjbGlja0hhbmRsZXIoZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGNvbnN0IGluZGV4ID0gZ2V0Q2xvc2VzdExpc3RJdGVtSW5kZXgodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQpO1xuICAgICAgICBpZiAodGhpcy5lZGl0U2VydmljZS5pc0VkaXRlZChpbmRleCkpIHtcbiAgICAgICAgICAgIHRoaXMuZWRpdFNlcnZpY2UuZW5kRWRpdChpbmRleCk7XG4gICAgICAgIH1cbiAgICB9XG59O1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdExpc3RlbmVyKCdjbGljaycsIFsnJGV2ZW50J10pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBGdW5jdGlvbiksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtPYmplY3RdKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnJldHVybnR5cGVcIiwgdm9pZCAwKVxuXSwgQ2FuY2VsQ29tbWFuZERpcmVjdGl2ZS5wcm90b3R5cGUsIFwiY2xpY2tIYW5kbGVyXCIsIG51bGwpO1xuQ2FuY2VsQ29tbWFuZERpcmVjdGl2ZSA9IF9fZGVjb3JhdGUoW1xuICAgIERpcmVjdGl2ZSh7XG4gICAgICAgIHNlbGVjdG9yOiAnW2tlbmRvTGlzdFZpZXdDYW5jZWxDb21tYW5kXSdcbiAgICB9KSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW0VkaXRTZXJ2aWNlLFxuICAgICAgICBFbGVtZW50UmVmLFxuICAgICAgICBSZW5kZXJlcjIsXG4gICAgICAgIExvY2FsaXphdGlvblNlcnZpY2UsXG4gICAgICAgIE5nWm9uZV0pXG5dLCBDYW5jZWxDb21tYW5kRGlyZWN0aXZlKTtcblxuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBgc2F2ZWAgY29tbWFuZCBvZiB0aGUgTGlzdFZpZXcuIFlvdSBjYW4gYXBwbHkgdGhpcyBkaXJlY3RpdmUgdG8gYW55IGBidXR0b25gXG4gKiBlbGVtZW50IGluc2lkZSBhIFtgRWRpdFRlbXBsYXRlRGlyZWN0aXZlYF0oeyUgc2x1ZyBhcGlfbGlzdHZpZXdfZWRpdHRlbXBsYXRlZGlyZWN0aXZlICV9KSB0ZW1wbGF0ZS5cbiAqIFdoZW4gYW4gYXNzb2NpYXRlZCBidXR0b24gd2l0aCB0aGUgZGlyZWN0aXZlIGlzIGNsaWNrZWQsIHRoZVxuICogW2BzYXZlYF0oeyUgc2x1ZyBhcGlfbGlzdHZpZXdfbGlzdHZpZXdjb21wb25lbnQgJX0jdG9jLXNhdmUpIGV2ZW50XG4gKiBpcyB0cmlnZ2VyZWQgKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBlZGl0aW5nX2xpc3R2aWV3ICV9KSkuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGh0bWwtbm8tcnVuXG4gKiA8a2VuZG8tbGlzdHZpZXc+XG4gKiAgIDxuZy10ZW1wbGF0ZSBrZW5kb0xpc3RWaWV3RWRpdFRlbXBsYXRlPlxuICogICAgIDxidXR0b24ga2VuZG9MaXN0Vmlld1NhdmVDb21tYW5kPlNhdmUgY2hhbmdlczwvYnV0dG9uPlxuICogICA8L25nLXRlbXBsYXRlPlxuICogPC9rZW5kby1saXN0dmlldz5cbiAqIGBgYFxuICpcbiAqIFlvdSBjYW4gY29udHJvbCB0aGUgY29udGVudCBvZiB0aGUgYnV0dG9uIGJhc2VkIG9uIHRoZSBzdGF0ZSBvZiB0aGUgaXRlbS5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgaHRtbC1uby1ydW5cbiAqIDxrZW5kby1saXN0dmlldz5cbiAqICAgPG5nLXRlbXBsYXRlIGtlbmRvTGlzdFZpZXdFZGl0VGVtcGxhdGUgbGV0LWlzTmV3PVwiaXNOZXdcIj5cbiAqICAgICA8YnV0dG9uIGtlbmRvTGlzdFZpZXdTYXZlQ29tbWFuZD57e2lzTmV3ID8gJ0FkZCcgOiAnVXBkYXRlJ319PC9idXR0b24+XG4gKiAgIDwvbmctdGVtcGxhdGU+XG4gKiA8L2tlbmRvLWxpc3R2aWV3PlxuICogYGBgXG4gKi9cbmxldCBTYXZlQ29tbWFuZERpcmVjdGl2ZSA9IGNsYXNzIFNhdmVDb21tYW5kRGlyZWN0aXZlIGV4dGVuZHMgQnV0dG9uIHtcbiAgICBjb25zdHJ1Y3RvcihlZGl0U2VydmljZSwgZWxlbWVudCwgcmVuZGVyZXIsIGxvY2FsaXphdGlvbiwgbmdab25lKSB7XG4gICAgICAgIHN1cGVyKGVsZW1lbnQsIHJlbmRlcmVyLCBudWxsLCBsb2NhbGl6YXRpb24sIG5nWm9uZSk7XG4gICAgICAgIHRoaXMuZWRpdFNlcnZpY2UgPSBlZGl0U2VydmljZTtcbiAgICAgICAgdGhpcy5lbGVtZW50UmVmID0gZWxlbWVudDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIGNsaWNrSGFuZGxlcihlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgY29uc3QgaW5kZXggPSBnZXRDbG9zZXN0TGlzdEl0ZW1JbmRleCh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCk7XG4gICAgICAgIGlmICh0aGlzLmVkaXRTZXJ2aWNlLmlzRWRpdGVkKGluZGV4KSkge1xuICAgICAgICAgICAgdGhpcy5lZGl0U2VydmljZS5zYXZlKGluZGV4KTtcbiAgICAgICAgfVxuICAgIH1cbn07XG5fX2RlY29yYXRlKFtcbiAgICBIb3N0TGlzdGVuZXIoJ2NsaWNrJywgWyckZXZlbnQnXSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEZ1bmN0aW9uKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW09iamVjdF0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cmV0dXJudHlwZVwiLCB2b2lkIDApXG5dLCBTYXZlQ29tbWFuZERpcmVjdGl2ZS5wcm90b3R5cGUsIFwiY2xpY2tIYW5kbGVyXCIsIG51bGwpO1xuU2F2ZUNvbW1hbmREaXJlY3RpdmUgPSBfX2RlY29yYXRlKFtcbiAgICBEaXJlY3RpdmUoe1xuICAgICAgICBzZWxlY3RvcjogJ1trZW5kb0xpc3RWaWV3U2F2ZUNvbW1hbmRdJ1xuICAgIH0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbRWRpdFNlcnZpY2UsXG4gICAgICAgIEVsZW1lbnRSZWYsXG4gICAgICAgIFJlbmRlcmVyMixcbiAgICAgICAgTG9jYWxpemF0aW9uU2VydmljZSxcbiAgICAgICAgTmdab25lXSlcbl0sIFNhdmVDb21tYW5kRGlyZWN0aXZlKTtcblxuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBgcmVtb3ZlYCBjb21tYW5kIG9mIHRoZSBMaXN0Vmlldy4gWW91IGNhbiBhcHBseSB0aGlzIGRpcmVjdGl2ZSB0byBhbnkgYGJ1dHRvbmAgZWxlbWVudFxuICogaW5zaWRlIGEgW2BFZGl0VGVtcGxhdGVEaXJlY3RpdmVgXSh7JSBzbHVnIGFwaV9saXN0dmlld19lZGl0dGVtcGxhdGVkaXJlY3RpdmUgJX0pIHRlbXBsYXRlLlxuICogV2hlbiBhbiBhc3NvY2lhdGVkIGJ1dHRvbiB3aXRoIHRoZSBkaXJlY3RpdmUgaXMgY2xpY2tlZCwgdGhlXG4gKiBbYHJlbW92ZWAgZXZlbnRdKHslIHNsdWcgYXBpX2xpc3R2aWV3X2xpc3R2aWV3Y29tcG9uZW50ICV9I3RvYy1yZW1vdmUpXG4gKiBpcyB0cmlnZ2VyZWQgKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBlZGl0aW5nX2xpc3R2aWV3ICV9KSkuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGh0bWwtbm8tcnVuXG4gKiA8a2VuZG8tbGlzdHZpZXc+XG4gKiAgIDxuZy10ZW1wbGF0ZSBrZW5kb0xpc3RWaWV3RWRpdFRlbXBsYXRlPlxuICogICAgIDxidXR0b24ga2VuZG9MaXN0Vmlld1JlbW92ZUNvbW1hbmQ+UmVtb3ZlIGl0ZW08L2J1dHRvbj5cbiAqICAgPC9uZy10ZW1wbGF0ZT5cbiAqIDwva2VuZG8tbGlzdHZpZXc+XG4gKiBgYGBcbiAqL1xubGV0IFJlbW92ZUNvbW1hbmREaXJlY3RpdmUgPSBjbGFzcyBSZW1vdmVDb21tYW5kRGlyZWN0aXZlIGV4dGVuZHMgQnV0dG9uIHtcbiAgICBjb25zdHJ1Y3RvcihlZGl0U2VydmljZSwgZWxlbWVudCwgcmVuZGVyZXIsIGxvY2FsaXphdGlvbiwgbmdab25lKSB7XG4gICAgICAgIHN1cGVyKGVsZW1lbnQsIHJlbmRlcmVyLCBudWxsLCBsb2NhbGl6YXRpb24sIG5nWm9uZSk7XG4gICAgICAgIHRoaXMuZWRpdFNlcnZpY2UgPSBlZGl0U2VydmljZTtcbiAgICAgICAgdGhpcy5lbGVtZW50UmVmID0gZWxlbWVudDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIGNsaWNrSGFuZGxlcihlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgY29uc3QgaW5kZXggPSBnZXRDbG9zZXN0TGlzdEl0ZW1JbmRleCh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCk7XG4gICAgICAgIHRoaXMuZWRpdFNlcnZpY2UucmVtb3ZlKGluZGV4KTtcbiAgICB9XG59O1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdExpc3RlbmVyKCdjbGljaycsIFsnJGV2ZW50J10pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBGdW5jdGlvbiksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtPYmplY3RdKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnJldHVybnR5cGVcIiwgdm9pZCAwKVxuXSwgUmVtb3ZlQ29tbWFuZERpcmVjdGl2ZS5wcm90b3R5cGUsIFwiY2xpY2tIYW5kbGVyXCIsIG51bGwpO1xuUmVtb3ZlQ29tbWFuZERpcmVjdGl2ZSA9IF9fZGVjb3JhdGUoW1xuICAgIERpcmVjdGl2ZSh7XG4gICAgICAgIHNlbGVjdG9yOiAnW2tlbmRvTGlzdFZpZXdSZW1vdmVDb21tYW5kXSdcbiAgICB9KSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW0VkaXRTZXJ2aWNlLFxuICAgICAgICBFbGVtZW50UmVmLFxuICAgICAgICBSZW5kZXJlcjIsXG4gICAgICAgIExvY2FsaXphdGlvblNlcnZpY2UsXG4gICAgICAgIE5nWm9uZV0pXG5dLCBSZW1vdmVDb21tYW5kRGlyZWN0aXZlKTtcblxuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBjb21tYW5kIGZvciBhZGRpbmcgYSBuZXcgaXRlbSB0byB0aGUgTGlzdFZpZXcuIFlvdSBjYW4gYXBwbHkgdGhpcyBkaXJlY3RpdmUgdG8gYW55XG4gKiBgYnV0dG9uYCBlbGVtZW50IGluc2lkZSBhIFtgSGVhZGVyVGVtcGxhdGVgXSh7JSBzbHVnIGFwaV9saXN0dmlld19oZWFkZXJ0ZW1wbGF0ZWRpcmVjdGl2ZSAlfSkuXG4gKiBXaGVuIGFuIGFzc29jaWF0ZWQgYnV0dG9uIHdpdGggdGhlIGRpcmVjdGl2ZSBpcyBjbGlja2VkLCB0aGVcbiAqIFtgYWRkYF0oeyUgc2x1ZyBhcGlfbGlzdHZpZXdfbGlzdHZpZXdjb21wb25lbnQgJX0jdG9jLWFkZCkgZXZlbnQgaXMgdHJpZ2dlcmVkXG4gKiAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIGVkaXRpbmdfbGlzdHZpZXcgJX0pKS5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgaHRtbC1uby1ydW5cbiAqIDxrZW5kby1saXN0dmlldz5cbiAqICAgIDxuZy10ZW1wbGF0ZSBrZW5kb0xpc3RWaWV3SGVhZGVyVGVtcGxhdGU+XG4gKiAgICAgICA8YnV0dG9uIGtlbmRvTGlzdFZpZXdBZGRDb21tYW5kPkFkZCBuZXc8L2J1dHRvbj5cbiAqICAgIDwvbmctdGVtcGxhdGU+XG4gKiA8L2tlbmRvLWxpc3R2aWV3PlxuICogYGBgXG4gKi9cbmxldCBBZGRDb21tYW5kRGlyZWN0aXZlID0gY2xhc3MgQWRkQ29tbWFuZERpcmVjdGl2ZSBleHRlbmRzIEJ1dHRvbiB7XG4gICAgY29uc3RydWN0b3IoZWRpdFNlcnZpY2UsIGVsZW1lbnQsIHJlbmRlcmVyLCBsb2NhbGl6YXRpb24sIG5nWm9uZSkge1xuICAgICAgICBzdXBlcihlbGVtZW50LCByZW5kZXJlciwgbnVsbCwgbG9jYWxpemF0aW9uLCBuZ1pvbmUpO1xuICAgICAgICB0aGlzLmVkaXRTZXJ2aWNlID0gZWRpdFNlcnZpY2U7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBjbGlja0hhbmRsZXIoZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHRoaXMuZWRpdFNlcnZpY2UuYmVnaW5BZGQoKTtcbiAgICB9XG59O1xuX19kZWNvcmF0ZShbXG4gICAgSG9zdExpc3RlbmVyKCdjbGljaycsIFsnJGV2ZW50J10pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBGdW5jdGlvbiksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtPYmplY3RdKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnJldHVybnR5cGVcIiwgdm9pZCAwKVxuXSwgQWRkQ29tbWFuZERpcmVjdGl2ZS5wcm90b3R5cGUsIFwiY2xpY2tIYW5kbGVyXCIsIG51bGwpO1xuQWRkQ29tbWFuZERpcmVjdGl2ZSA9IF9fZGVjb3JhdGUoW1xuICAgIERpcmVjdGl2ZSh7XG4gICAgICAgIHNlbGVjdG9yOiAnW2tlbmRvTGlzdFZpZXdBZGRDb21tYW5kXSdcbiAgICB9KSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW0VkaXRTZXJ2aWNlLFxuICAgICAgICBFbGVtZW50UmVmLFxuICAgICAgICBSZW5kZXJlcjIsXG4gICAgICAgIExvY2FsaXphdGlvblNlcnZpY2UsXG4gICAgICAgIE5nWm9uZV0pXG5dLCBBZGRDb21tYW5kRGlyZWN0aXZlKTtcblxuY29uc3QgVEVNUExBVEVfRElSRUNUSVZFUyA9IFtcbiAgICBJdGVtVGVtcGxhdGVEaXJlY3RpdmUsXG4gICAgSGVhZGVyVGVtcGxhdGVEaXJlY3RpdmUsXG4gICAgRm9vdGVyVGVtcGxhdGVEaXJlY3RpdmUsXG4gICAgTG9hZGVyVGVtcGxhdGVEaXJlY3RpdmVcbl07XG5jb25zdCBCSU5ESU5HX0RJUkVDVElWRVMgPSBbXG4gICAgRGF0YUJpbmRpbmdEaXJlY3RpdmVcbl07XG5jb25zdCBFRElUSU5HX0RJUkVDVElWRVMgPSBbXG4gICAgRWRpdFRlbXBsYXRlRGlyZWN0aXZlLFxuICAgIEVkaXRDb21tYW5kRGlyZWN0aXZlLFxuICAgIENhbmNlbENvbW1hbmREaXJlY3RpdmUsXG4gICAgU2F2ZUNvbW1hbmREaXJlY3RpdmUsXG4gICAgUmVtb3ZlQ29tbWFuZERpcmVjdGl2ZSxcbiAgICBBZGRDb21tYW5kRGlyZWN0aXZlXG5dO1xuLyoqXG4gKiBUaGUgZXhwb3J0ZWQgcGFja2FnZSBtb2R1bGUuXG4gKlxuICogVGhlIHBhY2thZ2UgZXhwb3J0czpcbiAqIC0gW2BMaXN0Vmlld0NvbXBvbmVudGBdKHslIHNsdWcgYXBpX2xpc3R2aWV3X2xpc3R2aWV3Y29tcG9uZW50ICV9KSZtZGFzaDtUaGUgTGlzdFZpZXcgY29tcG9uZW50IGNsYXNzLlxuICogLSBbYEl0ZW1UZW1wbGF0ZURpcmVjdGl2ZWBdKHslIHNsdWcgYXBpX2xpc3R2aWV3X2l0ZW10ZW1wbGF0ZWRpcmVjdGl2ZSAlfSkmbWRhc2g7VGhlIGl0ZW0gdGVtcGxhdGUgZGlyZWN0aXZlLlxuICogLSBbYEhlYWRlclRlbXBsYXRlRGlyZWN0aXZlYF0oeyUgc2x1ZyBhcGlfbGlzdHZpZXdfaGVhZGVydGVtcGxhdGVkaXJlY3RpdmUgJX0pJm1kYXNoO1RoZSBoZWFkZXIgdGVtcGxhdGUgZGlyZWN0aXZlLlxuICogLSBbYEZvb3RlclRlbXBsYXRlRGlyZWN0aXZlYF0oeyUgc2x1ZyBhcGlfbGlzdHZpZXdfZm9vdGVydGVtcGxhdGVkaXJlY3RpdmUgJX0pJm1kYXNoO1RoZSBmb290ZXIgdGVtcGxhdGUgZGlyZWN0aXZlLlxuICogLSBbYExvYWRlclRlbXBsYXRlRGlyZWN0aXZlYF0oeyUgc2x1ZyBhcGlfbGlzdHZpZXdfbG9hZGVydGVtcGxhdGVkaXJlY3RpdmUgJX0pJm1kYXNoO1RoZSBsb2VhZGVyIHRlbXBsYXRlIGRpcmVjdGl2ZS5cbiAqIC0gW2BEYXRhQmluZGluZ0RpcmVjdGl2ZWBdKHslIHNsdWcgYXBpX2xpc3R2aWV3X2RhdGFiaW5kaW5nZGlyZWN0aXZlICV9KSZtZGFzaDtUaGUgZGF0YSBiaW5kaW5nIGRpcmVjdGl2ZS5cbiAqIC0gW2BFZGl0VGVtcGxhdGVEaXJlY3RpdmVgXSh7JSBzbHVnIGFwaV9saXN0dmlld19lZGl0aW5nZGlyZWN0aXZlICV9Jm1kYXNoO1RoZSBlZGl0aW5nIHRlbXBsYXRlIGRpcmVjdGl2ZS5cbiAqL1xubGV0IExpc3RWaWV3TW9kdWxlID0gY2xhc3MgTGlzdFZpZXdNb2R1bGUge1xufTtcbkxpc3RWaWV3TW9kdWxlID0gX19kZWNvcmF0ZShbXG4gICAgTmdNb2R1bGUoe1xuICAgICAgICBkZWNsYXJhdGlvbnM6IFtcbiAgICAgICAgICAgIFRFTVBMQVRFX0RJUkVDVElWRVMsXG4gICAgICAgICAgICBCSU5ESU5HX0RJUkVDVElWRVMsXG4gICAgICAgICAgICBFRElUSU5HX0RJUkVDVElWRVMsXG4gICAgICAgICAgICBMaXN0Vmlld0NvbXBvbmVudCxcbiAgICAgICAgICAgIFRlbXBsYXRlQ29udGV4dERpcmVjdGl2ZSxcbiAgICAgICAgICAgIExpc3RWaWV3TmF2aWdhYmxlSXRlbURpcmVjdGl2ZVxuICAgICAgICBdLFxuICAgICAgICBleHBvcnRzOiBbXG4gICAgICAgICAgICBURU1QTEFURV9ESVJFQ1RJVkVTLFxuICAgICAgICAgICAgQklORElOR19ESVJFQ1RJVkVTLFxuICAgICAgICAgICAgRURJVElOR19ESVJFQ1RJVkVTLFxuICAgICAgICAgICAgTGlzdFZpZXdDb21wb25lbnQsXG4gICAgICAgICAgICBDb21tb25Nb2R1bGUsXG4gICAgICAgICAgICBFdmVudHNNb2R1bGVcbiAgICAgICAgXSxcbiAgICAgICAgaW1wb3J0czogW1xuICAgICAgICAgICAgQ29tbW9uTW9kdWxlLFxuICAgICAgICAgICAgUGFnZXJNb2R1bGUsXG4gICAgICAgICAgICBFdmVudHNNb2R1bGVcbiAgICAgICAgXVxuICAgIH0pXG5dLCBMaXN0Vmlld01vZHVsZSk7XG5cbi8qKlxuICogR2VuZXJhdGVkIGJ1bmRsZSBpbmRleC4gRG8gbm90IGVkaXQuXG4gKi9cblxuZXhwb3J0IHsgQWRkQ29tbWFuZERpcmVjdGl2ZSwgQ2FuY2VsQ29tbWFuZERpcmVjdGl2ZSwgRWRpdENvbW1hbmREaXJlY3RpdmUsIFJlbW92ZUNvbW1hbmREaXJlY3RpdmUsIFNhdmVDb21tYW5kRGlyZWN0aXZlLCBFZGl0U2VydmljZSwgTGlzdFZpZXdOYXZpZ2FibGVJdGVtRGlyZWN0aXZlLCBOYXZpZ2F0aW9uU2VydmljZSwgVGVtcGxhdGVDb250ZXh0RGlyZWN0aXZlLCBMaXN0Vmlld0NvbXBvbmVudCwgSXRlbVRlbXBsYXRlRGlyZWN0aXZlLCBIZWFkZXJUZW1wbGF0ZURpcmVjdGl2ZSwgRm9vdGVyVGVtcGxhdGVEaXJlY3RpdmUsIExvYWRlclRlbXBsYXRlRGlyZWN0aXZlLCBEYXRhQmluZGluZ0RpcmVjdGl2ZSwgRWRpdFRlbXBsYXRlRGlyZWN0aXZlLCBQYWdlU2l6ZUNoYW5nZUV2ZW50JDEgYXMgUGFnZVNpemVDaGFuZ2VFdmVudCwgTGlzdFZpZXdNb2R1bGUgfTtcbiJdfQ==