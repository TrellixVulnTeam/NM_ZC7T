import { Component } from '@angular/core';
import { MenuEventType } from '../../models/menu-events';
import { SfMenuService } from '../../sf-menu.service';
export class MenuUserComponent {
    constructor(svc) {
        this.svc = svc;
        this.tenants = [];
        this.collapsed = false;
        this.multipleTenantMenu = false;
        this.anchorAlign = { horizontal: 'right', vertical: 'top' };
        this.popupAlign = { horizontal: 'left', vertical: 'top' };
        this.userName = 'Username';
        this.darkMode = false;
    }
    ngOnInit() {
        this.color = this.svc.colors.gray900;
        this.tenantBg = this.svc.colors.gray200;
        this.configSubs$ = this.svc.menuConfig$.subscribe((cfg) => {
            var _a;
            this.menuConfig = cfg;
            this.userActions = {
                userName: { id: 'username', text: this.menuConfig.userName, iconClass: 'fas fa-user-circle' },
                tenant: { id: 'tenant', text: this.menuConfig.fleetName, iconClass: 'fas fa-building' },
                help: { id: 'help', text: this.menuConfig.helpText, iconClass: 'fas fa-question-circle' },
                logout: { id: 'logout', text: this.menuConfig.logoutText, iconClass: 'fas fa-sign-out-alt' }
            };
            this.tenants.length = 0;
            if (((_a = cfg.multipleTenants) === null || _a === void 0 ? void 0 : _a.length) > 1) {
                for (const t of cfg.multipleTenants.sort((a, b) => a.localeCompare(b))) {
                    this.tenants.push({ id: t, active: t === cfg.fleetName });
                }
            }
        });
        this.collapsedSubs$ = this.svc.menuCollapse$.subscribe((value) => {
            this.collapsed = value;
        });
        this.svc.currentTheme.subscribe((theme) => (this.darkMode = theme === 'dark'));
    }
    ngOnDestroy() {
        this.configSubs$.unsubscribe();
        this.collapsedSubs$.unsubscribe();
    }
    get disableUserNameClick() {
        return this.menuConfig.disableUserNameClick && !this.collapsed;
    }
    changeTenant(tenant) {
        this.svc.events$.next({
            type: MenuEventType.ChangeTenantClick,
            value: { text: tenant.id }
        });
        this.multipleTenantMenu = false;
    }
    showMultipleTenantMenu() {
        if (this.collapsed) {
            this.svc.menuCollapse$.next(false);
        }
        this.svc.events$.next({
            type: MenuEventType.OpenTenantListClick,
            value: null
        });
        this.multipleTenantMenu = true;
    }
    hideMultipleTenantMenu() {
        this.multipleTenantMenu = false;
    }
    userOptionClicked(item) {
        if (!this.disableUserNameClick) {
            if (this.collapsed) {
                this.svc.menuCollapse$.next(false);
                return;
            }
            this.svc.events$.next({
                type: MenuEventType.UserActionClick,
                value: item
            });
            if (window.innerWidth <= this.svc.SMALL_RESOLUTION && !this.collapsed) {
                this.svc.menuCollapse$.next(!this.svc.menuCollapse$.value);
            }
        }
    }
    setDarkMode() {
        console.log('set dark mode');
        this.svc.setTheme(this.darkMode ? 'dark' : 'light');
    }
    themeIconClicked() {
        console.log('icon clicked');
        if (this.collapsed) {
            this.svc.menuCollapse$.next(false);
        }
    }
    onSsoManageAccount(event, config) {
        event.stopPropagation();
        if (!config.disable) {
            window.open(config.url);
        }
    }
    sortMultipleTenant(tenants) {
        if (tenants) {
            return tenants.sort((a, b) => a.localeCompare(b));
        }
        else {
            return [];
        }
    }
}
MenuUserComponent.decorators = [
    { type: Component, args: [{
                selector: 'sf-menu-user',
                template: "<ul class=\"ul-container\" [style.color]=\"color\">\n  <li>\n    <div\n      class=\"li-container user-li\"\n      (click)=\"userOptionClicked(userActions.userName)\"\n      title=\"{{ menuConfig.tooltips || collapsed ? menuConfig.userName : '' }}\"\n      [class.collapsed]=\"collapsed\"\n    >\n      <div\n        class=\"main-div menu-item\"\n        [class.disable-user-click]=\"disableUserNameClick\"\n        [class.sso-manage-account]=\"menuConfig.ssoManageAccount && menuConfig.ssoManageAccount.url\"\n      >\n        <div class=\"icon-container\">\n          <div class=\"sf-icons-menu\">\n            <em class=\"fas fa-user-circle\"></em>\n          </div>\n        </div>\n        <div *ngIf=\"menuConfig.userName && !collapsed\">\n          <span class=\"sf-user-text\" data-testid=\"menu-user-name\">{{ menuConfig.userName }} </span>\n          <span class=\"sf-user-fleet-name\" (click)=\"showMultipleTenantMenu()\" data-testid=\"menu-user-fleet-name-single\">\n            {{ menuConfig?.multipleTenants?.length >= 2 ? '' : menuConfig.fleetName }}\n          </span>\n        </div>\n      </div>\n      <div\n\n        class=\"sso-settings\"\n        *ngIf=\"menuConfig.ssoManageAccount?.url && !collapsed\"\n        (click)=\"onSsoManageAccount($event, menuConfig.ssoManageAccount)\"\n      >\n        <div kendoTooltip showOn=\"{{ !menuConfig.tooltips ? 'hover' : 'none' }}\"\n          class=\"sf-icons-menu\" [class.disable]=\"menuConfig.ssoManageAccount.disable\"\n          title=\"{{ menuConfig.ssoManageAccount.title }}\">\n          <em class=\"icon-manage-account\"\n            data-testid=\"menu-products-sso-settings-icon\"></em>\n        </div>\n      </div>\n    </div>\n  </li>\n\n  <li *ngIf=\"menuConfig?.multipleTenants?.length > 1\" #anchor>\n    <div class=\"li-container\" [class.show-arrow]=\"menuConfig?.multipleTenants\" [class.collapsed]=\"collapsed\">\n      <div\n        [class.expanded-item]=\"multipleTenantMenu\"\n        class=\"main-div menu-item sf-fleet-list\"\n        [ngStyle]=\"{ 'border-left-color': menuConfig?.borderColor }\"\n        title=\"{{ menuConfig.tooltips || collapsed ? menuConfig.fleetName : '' }}\"\n        (click)=\"showMultipleTenantMenu()\"\n      >\n        <div class=\"icon-container\">\n          <div class=\"sf-icons-menu\">\n            <em class=\"fas fa-building\"></em>\n          </div>\n        </div>\n        <span *ngIf=\"!collapsed\">\n          <div class=\"sf-fleet-title\" *ngIf=\"menuConfig.fleetTitle\">\n            {{ menuConfig.fleetTitle }}\n          </div>\n          <div>\n            {{ menuConfig.fleetName }}\n          </div>\n        </span>\n        <em *ngIf=\"!collapsed\" class=\"fas fa-chevron-right\"\n          data-testid=\"menu-user-show-tenant-list\"></em>\n      </div>\n    </div>\n\n    <kendo-popup\n      [anchor]=\"anchor\"\n      [anchorAlign]=\"anchorAlign\"\n      [popupAlign]=\"popupAlign\"\n      *ngIf=\"multipleTenantMenu\"\n      (clickOutside)=\"hideMultipleTenantMenu()\"\n    >\n      <div class=\"tenant-picker\" [style.color]=\"color\" [style.background-color]=\"tenantBg\">\n        <div class=\"tenant\" *ngFor=\"let tenant of tenants\" [class.active]=\"tenant.active\" (click)=\"changeTenant(tenant)\"\n          data-testid=\"menu-user-tenants-list\">\n          {{ tenant.id }}\n        </div>\n      </div>\n    </kendo-popup>\n  </li>\n\n  <li *ngIf=\"!menuConfig?.denyChangeTheme && menuConfig?.themeTitle\" (click)=\"themeIconClicked()\">\n    <div class=\"li-container\" [class.collapsed]=\"collapsed\">\n      <div class=\"main-div menu-item theme-selector-container\" title=\"{{ menuConfig.tooltips || collapsed ? menuConfig.themeTitle : '' }}\">\n        <div class=\"icon-container\">\n          <div class=\"sf-icons-menu\">\n            <em class=\"fas fa-moon\"></em>\n          </div>\n        </div>\n        <span *ngIf=\"!collapsed\">{{ menuConfig?.themeTitle }}</span>\n        <kendo-switch *ngIf=\"!collapsed\" (valueChange)=\"setDarkMode()\" [(ngModel)]=\"darkMode\"></kendo-switch>\n      </div>\n    </div>\n  </li>\n  <li\n    sf-menu-item\n    *ngIf=\"userActions.help.text\"\n    [class.show-arrow]=\"userActions.help.items\"\n    [class.active-item]=\"userActions.help.active\"\n    [item]=\"userActions.help\"\n    [itemType]=\"3\"\n    data-testid=\"menu-user-help\"\n  ></li>\n  <li\n    sf-menu-item\n    *ngIf=\"userActions.logout.text\"\n    [class.show-arrow]=\"userActions.logout.items\"\n    [class.active-item]=\"userActions.logout.active\"\n    [item]=\"userActions.logout\"\n    [itemType]=\"3\"\n    data-testid=\"menu-user-logout\"\n  ></li>\n</ul>\n",
                styles: [":host{display:flex;flex-direction:column;width:100%;height:auto;align-items:flex-start;justify-content:flex-start;overflow:hidden;position:relative}:host:before{content:\" \";width:100%;height:1px;background-color:#fff;opacity:.15}:host ul{list-style:none;padding-left:0;width:100%}:host .li-container{display:inline-block;width:100%;padding:0;overflow:hidden;cursor:pointer}:host .li-container .icon-container{width:24px}:host .li-container>div.main-div{margin-left:2px}:host .li-container>.menu-item{display:flex;align-items:center;justify-content:flex-start;padding:7px 10px;position:relative;min-height:38px}:host .li-container>.menu-item .sf-menu-logo-bg{width:1.6em;height:1.55em}:host .li-container>.menu-item span{width:calc(100% - 24px);min-width:100px;padding:0 10px;font-size:14px;line-height:18px;opacity:.71;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}:host .li-container>.menu-item:hover{position:relative}:host .li-container>.menu-item:hover:before{content:\" \";position:absolute;top:0;left:0;width:100%;height:100%;background-color:#fff;opacity:.1}:host .li-container>.menu-item:hover span{opacity:1}:host .li-container>.menu-item .fa-chevron-down{display:none;position:absolute;right:15px;top:16px;width:auto;height:auto;font-size:12px}:host .li-container.show-arrow>div .fa-chevron-down{display:inline-block;transform:rotate(0deg)}:host .li-container.show-arrow>div.expanded-item span{opacity:1}:host .li-container.show-arrow>div.expanded-item em.fa-chevron-down,:host .li-container.show-arrow>div.expanded-item i.fa-chevron-down{transform:rotate(180deg)}:host .li-container.show-arrow>div:hover{position:relative}:host .li-container.show-arrow>div:hover:before{content:\" \";position:absolute;top:0;left:0;width:100%;height:100%;background-color:#fff;opacity:.1}:host .li-container.show-arrow>div:hover span{opacity:1}:host .li-container.active-item>div.main-div{border-left:3px solid;margin-left:0}:host .li-container.active-item>div.main-div:before{content:\" \";position:absolute;top:0;left:0;width:100%;height:100%;background-color:#fff;opacity:.2}:host .li-container.active-item>div.main-div span{opacity:1}:host .li-container.collapsed div{justify-content:center}:host .li-container.collapsed em,:host .li-container.collapsed i{width:auto}:host .li-container.collapsed .item-children,:host .li-container.collapsed span{display:none}:host .sf-icons-menu{text-align:center}:host .sf-icons-menu em,:host .sf-icons-menu i{font-size:16px}.user-li{display:flex!important}.user-li .menu-item{flex:1}.user-li .menu-item.sso-manage-account{flex-basis:75%}.user-li .menu-item.disable-user-click{cursor:default}.user-li .menu-item.disable-user-click:hover{background-color:transparent}.user-li .menu-item.disable-user-click:hover .sf-user-fleet-name,.user-li .menu-item.disable-user-click:hover .sf-user-text{opacity:.7}.user-li .menu-item.disable-user-click:hover:before{display:none}.user-li .sso-settings{display:flex;justify-content:flex-end;flex:1;align-items:center;padding-right:15px;cursor:default}.user-li .sso-settings .sf-icons-menu{cursor:pointer}.user-li .sso-settings .sf-icons-menu.disable{opacity:.5;cursor:not-allowed}.user-li .sso-settings .sf-icons-menu:hover{position:relative}.user-li .sso-settings .sf-icons-menu:hover:before{content:\" \";position:absolute;top:0;left:0;width:100%;height:100%;background-color:#fff;opacity:.1}.user-li .sso-settings .sf-icons-menu:hover span{opacity:1}.sf-user-fleet-name{display:block;font-size:.8em!important;margin-top:.2em}.sf-fleet-list .sf-fleet-title{font-size:.8em}.theme-selector-container span{width:calc(100% - 84px)!important}.theme-selector-container .k-switch{margin-right:0}.ul-container{margin:5px 0 0}.tenant-picker{padding:.5em 0;max-height:14em;max-width:14em;min-width:12em;overflow-y:auto;margin-left:-1px}.tenant-picker .tenant{padding:.7em 1em;position:relative}.tenant-picker .tenant:hover:before{opacity:.1}.tenant-picker .tenant.active:before,.tenant-picker .tenant:hover:before{content:\"\";position:absolute;top:0;left:0;width:100%;height:100%;background-color:#fff}.tenant-picker .tenant.active:before{opacity:.2}.tenant-picker::-webkit-scrollbar{width:6px;background-color:transparent}.tenant-picker::-webkit-scrollbar-thumb{border-radius:10px;background-color:var(--clr-gray-500)}::ng-deep .sf-menu-container .k-popup{background-color:transparent;border-color:transparent}"]
            },] }
];
MenuUserComponent.ctorParameters = () => [
    { type: SfMenuService }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVudS11c2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3NmLW1lbnUvc3JjL2xpYi9jb21wb25lbnRzL21lbnUtdXNlci9tZW51LXVzZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQXFCLE1BQU0sZUFBZSxDQUFDO0FBSTdELE9BQU8sRUFBYSxhQUFhLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUVwRSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFZdEQsTUFBTSxPQUFPLGlCQUFpQjtJQXFCNUIsWUFBcUIsR0FBa0I7UUFBbEIsUUFBRyxHQUFILEdBQUcsQ0FBZTtRQWpCdkMsWUFBTyxHQUFhLEVBQUUsQ0FBQztRQUt2QixjQUFTLEdBQUcsS0FBSyxDQUFDO1FBR2xCLHVCQUFrQixHQUFHLEtBQUssQ0FBQztRQUMzQixnQkFBVyxHQUFVLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLENBQUM7UUFDOUQsZUFBVSxHQUFVLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLENBQUM7UUFHNUQsYUFBUSxHQUFHLFVBQVUsQ0FBQztRQUV0QixhQUFRLEdBQUcsS0FBSyxDQUFDO0lBRXlCLENBQUM7SUFFM0MsUUFBUTtRQUNOLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDO1FBQ3JDLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDO1FBQ3hDLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUU7O1lBQ3hELElBQUksQ0FBQyxVQUFVLEdBQUcsR0FBRyxDQUFDO1lBQ3RCLElBQUksQ0FBQyxXQUFXLEdBQUc7Z0JBQ2pCLFFBQVEsRUFBRSxFQUFFLEVBQUUsRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxFQUFFLFNBQVMsRUFBRSxvQkFBb0IsRUFBYztnQkFDekcsTUFBTSxFQUFFLEVBQUUsRUFBRSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLEVBQUUsU0FBUyxFQUFFLGlCQUFpQixFQUFjO2dCQUNuRyxJQUFJLEVBQUUsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLFFBQVEsRUFBRSxTQUFTLEVBQUUsd0JBQXdCLEVBQWM7Z0JBQ3JHLE1BQU0sRUFBRSxFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsVUFBVSxFQUFFLFNBQVMsRUFBRSxxQkFBcUIsRUFBYzthQUN6RyxDQUFDO1lBQ0YsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1lBQ3hCLElBQUksT0FBQSxHQUFHLENBQUMsZUFBZSwwQ0FBRSxNQUFNLElBQUcsQ0FBQyxFQUFFO2dCQUNuQyxLQUFLLE1BQU0sQ0FBQyxJQUFJLEdBQUcsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFO29CQUN0RSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsS0FBSyxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQztpQkFDM0Q7YUFDRjtRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRTtZQUMvRCxJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztRQUN6QixDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxHQUFHLEtBQUssS0FBSyxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQ2pGLENBQUM7SUFFRCxXQUFXO1FBQ1QsSUFBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUMvQixJQUFJLENBQUMsY0FBYyxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3BDLENBQUM7SUFFRCxJQUFJLG9CQUFvQjtRQUN0QixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsb0JBQW9CLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO0lBQ2pFLENBQUM7SUFFRCxZQUFZLENBQUMsTUFBYztRQUN6QixJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUM7WUFDcEIsSUFBSSxFQUFFLGFBQWEsQ0FBQyxpQkFBaUI7WUFDckMsS0FBSyxFQUFFLEVBQUUsSUFBSSxFQUFFLE1BQU0sQ0FBQyxFQUFFLEVBQUU7U0FDZCxDQUFDLENBQUM7UUFDaEIsSUFBSSxDQUFDLGtCQUFrQixHQUFHLEtBQUssQ0FBQztJQUNsQyxDQUFDO0lBRUQsc0JBQXNCO1FBQ3BCLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNsQixJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDcEM7UUFDRCxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUM7WUFDcEIsSUFBSSxFQUFFLGFBQWEsQ0FBQyxtQkFBbUI7WUFDdkMsS0FBSyxFQUFFLElBQUk7U0FDQyxDQUFDLENBQUM7UUFDaEIsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksQ0FBQztJQUNqQyxDQUFDO0lBRUQsc0JBQXNCO1FBQ3BCLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxLQUFLLENBQUM7SUFDbEMsQ0FBQztJQUVELGlCQUFpQixDQUFDLElBQWM7UUFDOUIsSUFBSSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsRUFBRTtZQUM5QixJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7Z0JBQ2xCLElBQUksQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDbkMsT0FBTzthQUNSO1lBQ0QsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDO2dCQUNwQixJQUFJLEVBQUUsYUFBYSxDQUFDLGVBQWU7Z0JBQ25DLEtBQUssRUFBRSxJQUFJO2FBQ0MsQ0FBQyxDQUFDO1lBQ2hCLElBQUksTUFBTSxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLGdCQUFnQixJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRTtnQkFDckUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDNUQ7U0FDRjtJQUNILENBQUM7SUFFRCxXQUFXO1FBQ1QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUM3QixJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3RELENBQUM7SUFFRCxnQkFBZ0I7UUFDZCxPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQzVCLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNsQixJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDcEM7SUFDSCxDQUFDO0lBRUQsa0JBQWtCLENBQUMsS0FBaUIsRUFBRSxNQUE4QjtRQUNsRSxLQUFLLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDeEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUU7WUFDbkIsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDekI7SUFDSCxDQUFDO0lBRUQsa0JBQWtCLENBQUMsT0FBaUI7UUFDbEMsSUFBSSxPQUFPLEVBQUU7WUFDWCxPQUFPLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDbkQ7YUFBTTtZQUNMLE9BQU8sRUFBRSxDQUFDO1NBQ1g7SUFDSCxDQUFDOzs7WUEvSEYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxjQUFjO2dCQUN4QiwwaUpBQXlDOzthQUUxQzs7O1lBWFEsYUFBYSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25EZXN0cm95LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFsaWduIH0gZnJvbSAnQHByb2dyZXNzL2tlbmRvLWFuZ3VsYXItcG9wdXAnO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBNZW51Q29uZmlnLCBTc29NYW5hZ2VBY2NvdW50Q29uZmlnIH0gZnJvbSAnLi4vLi4vbW9kZWxzL21lbnUtY29uZmlnJztcbmltcG9ydCB7IE1lbnVFdmVudCwgTWVudUV2ZW50VHlwZSB9IGZyb20gJy4uLy4uL21vZGVscy9tZW51LWV2ZW50cyc7XG5pbXBvcnQgeyBNZW51SXRlbSB9IGZyb20gJy4uLy4uL21vZGVscy9tZW51LWl0ZW0nO1xuaW1wb3J0IHsgU2ZNZW51U2VydmljZSB9IGZyb20gJy4uLy4uL3NmLW1lbnUuc2VydmljZSc7XG5cbmludGVyZmFjZSBUZW5hbnQge1xuICBpZDogc3RyaW5nO1xuICBhY3RpdmU6IGJvb2xlYW47XG59XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3NmLW1lbnUtdXNlcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9tZW51LXVzZXIuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9tZW51LXVzZXIuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBNZW51VXNlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcbiAgbWVudUNvbmZpZzogTWVudUNvbmZpZztcbiAgcHJpdmF0ZSBjb25maWdTdWJzJDogU3Vic2NyaXB0aW9uO1xuXG4gIHRlbmFudHM6IFRlbmFudFtdID0gW107XG5cbiAgY29sb3I6IHN0cmluZztcbiAgdGVuYW50Qmc6IHN0cmluZztcblxuICBjb2xsYXBzZWQgPSBmYWxzZTtcbiAgcHJpdmF0ZSBjb2xsYXBzZWRTdWJzJDogU3Vic2NyaXB0aW9uO1xuXG4gIG11bHRpcGxlVGVuYW50TWVudSA9IGZhbHNlO1xuICBhbmNob3JBbGlnbjogQWxpZ24gPSB7IGhvcml6b250YWw6ICdyaWdodCcsIHZlcnRpY2FsOiAndG9wJyB9O1xuICBwb3B1cEFsaWduOiBBbGlnbiA9IHsgaG9yaXpvbnRhbDogJ2xlZnQnLCB2ZXJ0aWNhbDogJ3RvcCcgfTtcbiAgdXNlckFjdGlvbnM6IGFueTtcblxuICB1c2VyTmFtZSA9ICdVc2VybmFtZSc7XG5cbiAgZGFya01vZGUgPSBmYWxzZTtcblxuICBjb25zdHJ1Y3RvcihyZWFkb25seSBzdmM6IFNmTWVudVNlcnZpY2UpIHt9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5jb2xvciA9IHRoaXMuc3ZjLmNvbG9ycy5ncmF5OTAwO1xuICAgIHRoaXMudGVuYW50QmcgPSB0aGlzLnN2Yy5jb2xvcnMuZ3JheTIwMDtcbiAgICB0aGlzLmNvbmZpZ1N1YnMkID0gdGhpcy5zdmMubWVudUNvbmZpZyQuc3Vic2NyaWJlKChjZmcpID0+IHtcbiAgICAgIHRoaXMubWVudUNvbmZpZyA9IGNmZztcbiAgICAgIHRoaXMudXNlckFjdGlvbnMgPSB7XG4gICAgICAgIHVzZXJOYW1lOiB7IGlkOiAndXNlcm5hbWUnLCB0ZXh0OiB0aGlzLm1lbnVDb25maWcudXNlck5hbWUsIGljb25DbGFzczogJ2ZhcyBmYS11c2VyLWNpcmNsZScgfSBhcyBNZW51SXRlbSxcbiAgICAgICAgdGVuYW50OiB7IGlkOiAndGVuYW50JywgdGV4dDogdGhpcy5tZW51Q29uZmlnLmZsZWV0TmFtZSwgaWNvbkNsYXNzOiAnZmFzIGZhLWJ1aWxkaW5nJyB9IGFzIE1lbnVJdGVtLFxuICAgICAgICBoZWxwOiB7IGlkOiAnaGVscCcsIHRleHQ6IHRoaXMubWVudUNvbmZpZy5oZWxwVGV4dCwgaWNvbkNsYXNzOiAnZmFzIGZhLXF1ZXN0aW9uLWNpcmNsZScgfSBhcyBNZW51SXRlbSxcbiAgICAgICAgbG9nb3V0OiB7IGlkOiAnbG9nb3V0JywgdGV4dDogdGhpcy5tZW51Q29uZmlnLmxvZ291dFRleHQsIGljb25DbGFzczogJ2ZhcyBmYS1zaWduLW91dC1hbHQnIH0gYXMgTWVudUl0ZW1cbiAgICAgIH07XG4gICAgICB0aGlzLnRlbmFudHMubGVuZ3RoID0gMDtcbiAgICAgIGlmIChjZmcubXVsdGlwbGVUZW5hbnRzPy5sZW5ndGggPiAxKSB7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiBjZmcubXVsdGlwbGVUZW5hbnRzLnNvcnQoKGEsIGIpID0+IGEubG9jYWxlQ29tcGFyZShiKSkpIHtcbiAgICAgICAgICB0aGlzLnRlbmFudHMucHVzaCh7IGlkOiB0LCBhY3RpdmU6IHQgPT09IGNmZy5mbGVldE5hbWUgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuY29sbGFwc2VkU3VicyQgPSB0aGlzLnN2Yy5tZW51Q29sbGFwc2UkLnN1YnNjcmliZSgodmFsdWUpID0+IHtcbiAgICAgIHRoaXMuY29sbGFwc2VkID0gdmFsdWU7XG4gICAgfSk7XG5cbiAgICB0aGlzLnN2Yy5jdXJyZW50VGhlbWUuc3Vic2NyaWJlKCh0aGVtZSkgPT4gKHRoaXMuZGFya01vZGUgPSB0aGVtZSA9PT0gJ2RhcmsnKSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLmNvbmZpZ1N1YnMkLnVuc3Vic2NyaWJlKCk7XG4gICAgdGhpcy5jb2xsYXBzZWRTdWJzJC51bnN1YnNjcmliZSgpO1xuICB9XG5cbiAgZ2V0IGRpc2FibGVVc2VyTmFtZUNsaWNrKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLm1lbnVDb25maWcuZGlzYWJsZVVzZXJOYW1lQ2xpY2sgJiYgIXRoaXMuY29sbGFwc2VkO1xuICB9XG5cbiAgY2hhbmdlVGVuYW50KHRlbmFudDogVGVuYW50KSB7XG4gICAgdGhpcy5zdmMuZXZlbnRzJC5uZXh0KHtcbiAgICAgIHR5cGU6IE1lbnVFdmVudFR5cGUuQ2hhbmdlVGVuYW50Q2xpY2ssXG4gICAgICB2YWx1ZTogeyB0ZXh0OiB0ZW5hbnQuaWQgfVxuICAgIH0gYXMgTWVudUV2ZW50KTtcbiAgICB0aGlzLm11bHRpcGxlVGVuYW50TWVudSA9IGZhbHNlO1xuICB9XG5cbiAgc2hvd011bHRpcGxlVGVuYW50TWVudSgpIHtcbiAgICBpZiAodGhpcy5jb2xsYXBzZWQpIHtcbiAgICAgIHRoaXMuc3ZjLm1lbnVDb2xsYXBzZSQubmV4dChmYWxzZSk7XG4gICAgfVxuICAgIHRoaXMuc3ZjLmV2ZW50cyQubmV4dCh7XG4gICAgICB0eXBlOiBNZW51RXZlbnRUeXBlLk9wZW5UZW5hbnRMaXN0Q2xpY2ssXG4gICAgICB2YWx1ZTogbnVsbFxuICAgIH0gYXMgTWVudUV2ZW50KTtcbiAgICB0aGlzLm11bHRpcGxlVGVuYW50TWVudSA9IHRydWU7XG4gIH1cblxuICBoaWRlTXVsdGlwbGVUZW5hbnRNZW51KCkge1xuICAgIHRoaXMubXVsdGlwbGVUZW5hbnRNZW51ID0gZmFsc2U7XG4gIH1cblxuICB1c2VyT3B0aW9uQ2xpY2tlZChpdGVtOiBNZW51SXRlbSkge1xuICAgIGlmICghdGhpcy5kaXNhYmxlVXNlck5hbWVDbGljaykge1xuICAgICAgaWYgKHRoaXMuY29sbGFwc2VkKSB7XG4gICAgICAgIHRoaXMuc3ZjLm1lbnVDb2xsYXBzZSQubmV4dChmYWxzZSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMuc3ZjLmV2ZW50cyQubmV4dCh7XG4gICAgICAgIHR5cGU6IE1lbnVFdmVudFR5cGUuVXNlckFjdGlvbkNsaWNrLFxuICAgICAgICB2YWx1ZTogaXRlbVxuICAgICAgfSBhcyBNZW51RXZlbnQpO1xuICAgICAgaWYgKHdpbmRvdy5pbm5lcldpZHRoIDw9IHRoaXMuc3ZjLlNNQUxMX1JFU09MVVRJT04gJiYgIXRoaXMuY29sbGFwc2VkKSB7XG4gICAgICAgIHRoaXMuc3ZjLm1lbnVDb2xsYXBzZSQubmV4dCghdGhpcy5zdmMubWVudUNvbGxhcHNlJC52YWx1ZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgc2V0RGFya01vZGUoKSB7XG4gICAgY29uc29sZS5sb2coJ3NldCBkYXJrIG1vZGUnKTtcbiAgICB0aGlzLnN2Yy5zZXRUaGVtZSh0aGlzLmRhcmtNb2RlID8gJ2RhcmsnIDogJ2xpZ2h0Jyk7XG4gIH1cblxuICB0aGVtZUljb25DbGlja2VkKCkge1xuICAgIGNvbnNvbGUubG9nKCdpY29uIGNsaWNrZWQnKTtcbiAgICBpZiAodGhpcy5jb2xsYXBzZWQpIHtcbiAgICAgIHRoaXMuc3ZjLm1lbnVDb2xsYXBzZSQubmV4dChmYWxzZSk7XG4gICAgfVxuICB9XG5cbiAgb25Tc29NYW5hZ2VBY2NvdW50KGV2ZW50OiBNb3VzZUV2ZW50LCBjb25maWc6IFNzb01hbmFnZUFjY291bnRDb25maWcpIHtcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICBpZiAoIWNvbmZpZy5kaXNhYmxlKSB7XG4gICAgICB3aW5kb3cub3Blbihjb25maWcudXJsKTtcbiAgICB9XG4gIH1cblxuICBzb3J0TXVsdGlwbGVUZW5hbnQodGVuYW50czogc3RyaW5nW10pOiBzdHJpbmdbXSB7XG4gICAgaWYgKHRlbmFudHMpIHtcbiAgICAgIHJldHVybiB0ZW5hbnRzLnNvcnQoKGEsIGIpID0+IGEubG9jYWxlQ29tcGFyZShiKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==